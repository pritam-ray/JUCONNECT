const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/enhancedServices-wFH4Gj3X.js","assets/vendor-DNJA2DLw.js","assets/supabase-IaWL2ZTc.js","assets/ui-xSEi1b0x.js"])))=>i.map(i=>d[i]);
var gt=Object.defineProperty;var ft=(s,t,a)=>t in s?gt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var Q=(s,t,a)=>ft(s,typeof t!="symbol"?t+"":t,a);import{b as yt,c as bt,r as l,d as jt,u as es,e as wt,L as ye,R as rs,N as ws,f as vt,H as Nt,h as Ct,i as Se}from"./vendor-DNJA2DLw.js";import{c as _t,_ as Fe}from"./supabase-IaWL2ZTc.js";import{t as St,c as kt,X as Me,S as Te,a as Je,U as de,P as $s,M as Ke,L as ze,E as ms,b as Ue,d as ke,B as ps,F as ce,e as Ye,A as Qe,f as Ce,g as Ge,h as _e,i as Xe,j as Bs,k as gs,l as Et,H as Pt,m as Tt,n as Mt,o as Js,p as Vs,T as Hs,C as vs,D as Ns,q as Rt,r as Ws,Z as At,s as De,u as fs,v as Ys,w as Ne,x as Ee,y as Le,z as $e,G as Ze,I as Ut,J as Ks,K as qt,N as ns,O as Ps,Q as Ts,R as is,V as It,W as Ft,Y as Qs,_ as Dt,$ as zt,a0 as Gt,a1 as Oe,a2 as Lt,a3 as Ot,a4 as $t,a5 as Bt,a6 as Jt,a7 as Vt,a8 as Ht,a9 as Wt,aa as Yt}from"./ui-xSEi1b0x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();var hs={exports:{}},He={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ms;function Kt(){if(Ms)return He;Ms=1;var s=yt(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(c,d,u){var m,p={},j=null,g=null;u!==void 0&&(j=""+u),d.key!==void 0&&(j=""+d.key),d.ref!==void 0&&(g=d.ref);for(m in d)r.call(d,m)&&!i.hasOwnProperty(m)&&(p[m]=d[m]);if(c&&c.defaultProps)for(m in d=c.defaultProps,d)p[m]===void 0&&(p[m]=d[m]);return{$$typeof:t,type:c,key:j,ref:g,props:p,_owner:n.current}}return He.Fragment=a,He.jsx=o,He.jsxs=o,He}var Rs;function Qt(){return Rs||(Rs=1,hs.exports=Kt()),hs.exports}var e=Qt();class Xt{constructor(){Q(this,"callCount",0);Q(this,"resetTime",0);Q(this,"MAX_CALLS_PER_MINUTE",120);Q(this,"RESET_INTERVAL",6e4);Q(this,"isBlocked",!1);Q(this,"blockedUntil",0)}canMakeCall(){const t=Date.now();return t>this.resetTime&&(this.callCount=0,this.resetTime=t+this.RESET_INTERVAL,this.isBlocked=!1),this.isBlocked&&t<this.blockedUntil?(console.warn("üö´ API calls blocked - too many requests"),!1):this.callCount>=this.MAX_CALLS_PER_MINUTE?(this.isBlocked=!0,this.blockedUntil=t+3e4,console.error(`üö® CIRCUIT BREAKER TRIGGERED! ${this.callCount} calls in last minute. Blocking API calls for 30 seconds.`),!1):(this.callCount++,this.callCount>this.MAX_CALLS_PER_MINUTE*.8&&console.warn(`‚ö†Ô∏è High API usage: ${this.callCount}/${this.MAX_CALLS_PER_MINUTE} calls`),!0)}getStats(){return{callCount:this.callCount,isBlocked:this.isBlocked,maxCalls:this.MAX_CALLS_PER_MINUTE}}reset(){this.callCount=0,this.isBlocked=!1,this.blockedUntil=0,console.log("üîÑ Circuit breaker reset")}}const ls=new Xt,Zt=globalThis.fetch;globalThis.fetch=async(s,t)=>{const a=typeof s=="string"?s:s.toString();if(a.includes("supabase")||a.includes("localhost:54321")){if(!ls.canMakeCall())throw new Error("API call blocked by circuit breaker - too many requests");console.log(`üåê API Call #${ls.getStats().callCount}: ${a.substring(a.lastIndexOf("/")+1)}`)}return Zt(s,t)};typeof window<"u"&&(window.stopAllAPICalls=()=>{ls.reset(),console.log("üõë Emergency API stop activated")},window.getAPIStats=()=>ls.getStats());var ss={},As;function ea(){if(As)return ss;As=1;var s=bt();return ss.createRoot=s.createRoot,ss.hydrateRoot=s.hydrateRoot,ss}var sa=ea();class ta{constructor(){Q(this,"calls",[]);Q(this,"MAX_CALLS_PER_MINUTE",200);Q(this,"WINDOW_SIZE",6e4)}logCall(t,a){const r=Date.now();return this.calls=this.calls.filter(n=>r-n.timestamp<this.WINDOW_SIZE),this.calls.push({timestamp:r,method:t,table:a,count:1}),this.calls.length>this.MAX_CALLS_PER_MINUTE&&console.warn(`üö® High API usage: ${this.calls.length} calls in last minute`),this.calls.length%20===0&&console.log(`üìä API Calls: ${this.calls.length}/min`),!0}getCallSummary(){const t={};return this.calls.forEach(a=>{const r=a.table?`${a.method}:${a.table}`:a.method;t[r]=(t[r]||0)+1}),t}getCurrentCount(){return this.calls.length}}const aa=new ta,Us=console.log;let ts=0;const qs=100;console.log=(...s)=>{if(ts++,ts>qs){ts===qs+1&&Us("üîá Console logging suppressed due to excessive output");return}Us(...s)};setInterval(()=>{ts=0},6e4);const ra="https://mnycotjmvsairaqgjaux.supabase.co",na="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ueWNvdGptdnNhaXJhcWdqYXV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4NjczMTUsImV4cCI6MjA3MDQ0MzMxNX0.Xeex5usohxsqKUZ67RWgr1sip3WXGvTd9A8CL4xOlUk",ia=()=>{try{const s=_t(ra,na,{auth:{autoRefreshToken:!0,persistSession:!0}}),t=s.from.bind(s);return s.from=a=>aa.logCall("SELECT",a)?t(a):{select:()=>Promise.reject(new Error("Rate limit exceeded")),insert:()=>Promise.reject(new Error("Rate limit exceeded")),update:()=>Promise.reject(new Error("Rate limit exceeded")),delete:()=>Promise.reject(new Error("Rate limit exceeded"))},s}catch{return null}},f=ia(),pe=()=>!!("https://mnycotjmvsairaqgjaux.supabase.co"&&"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ueWNvdGptdnNhaXJhcWdqYXV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4NjczMTUsImV4cCI6MjA3MDQ0MzMxNX0.Xeex5usohxsqKUZ67RWgr1sip3WXGvTd9A8CL4xOlUk"&&f);class la{constructor(){Q(this,"isInitializing",!1);Q(this,"isInitialized",!1);Q(this,"initPromise",null)}async initialize(t){if(this.isInitialized){console.log("üîí App already initialized, skipping duplicate initialization");return}return this.isInitializing&&this.initPromise?(console.log("‚è≥ App initialization in progress, waiting..."),this.initPromise):(console.log("üöÄ Starting app initialization..."),this.isInitializing=!0,this.initPromise=(async()=>{try{await t(),this.isInitialized=!0,console.log("‚úÖ App initialization completed")}catch(a){throw console.error("‚ùå App initialization failed:",a),a}finally{this.isInitializing=!1}})(),this.initPromise)}reset(){this.isInitialized=!1,this.isInitializing=!1,this.initPromise=null,console.log("üîÑ Initialization guard reset")}getStatus(){return{isInitialized:this.isInitialized,isInitializing:this.isInitializing}}}const oa=new la,Xs=l.createContext(void 0),me=()=>{const s=l.useContext(Xs);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s},ca=({children:s})=>{const[t,a]=l.useState(null),[r,n]=l.useState(null),[i,o]=l.useState(null),[c,d]=l.useState(!0),[u,m]=l.useState(!1),[p,j]=l.useState(!1),[g,y]=l.useState(0),T=l.useCallback(()=>{console.log("üßπ Clearing all authentication state..."),a(null),n(null),o(null),m(!0),y(h=>h+1),localStorage.clear(),sessionStorage.clear(),typeof window<"u"&&document.cookie.split(";").forEach(h=>{const P=h.indexOf("="),R=P>-1?h.substr(0,P):h;(R.trim().includes("sb-")||R.trim().includes("supabase"))&&(document.cookie=`${R}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`)}),console.log("‚úÖ Authentication state cleared")},[]),k=l.useCallback(()=>{if(!i||u)return!1;const h=new Date().getTime();return(i.expires_at?i.expires_at*1e3:0)>h},[i,u]),v=l.useCallback(async()=>{try{if(console.log("üö™ Starting sign out process..."),pe()&&f&&!u){const{error:h}=await f.auth.signOut({scope:"global"});h&&console.warn("Error during sign out:",h.message)}}catch(h){console.error("Error signing out:",h)}finally{T(),console.log("‚úÖ Sign out complete - user is now guest"),setTimeout(()=>{window.location.href="/"},100)}},[u,T]),C=l.useCallback(async()=>{if(!(!pe()||!f||u))try{const{data:{session:h},error:P}=await f.auth.refreshSession();if(P){console.warn("Session refresh failed:",P.message),await v();return}h&&(o(h),a(h.user),console.log("Session refreshed successfully"))}catch(h){console.error("Error refreshing session:",h),await v()}},[u,v]),x=l.useCallback(async()=>{const h=Date.now(),P=parseInt(localStorage.getItem("last-profile-refresh")||"0");if(h-P<6e4){console.log("Profile refresh rate limited");return}if(t&&!u&&pe()&&f)try{localStorage.setItem("last-profile-refresh",h.toString());const{data:R,error:L}=await f.from("profiles").select("*").eq("id",t.id).single();if(L){if(L.code==="PGRST116"){console.warn("Profile not found for user");return}throw L}n(R)}catch(R){console.error("Error fetching profile:",R)}},[t,u]),w=l.useCallback(async()=>{if(console.log("üîÑ Force refreshing profile..."),console.log("üîç Current user:",t==null?void 0:t.email,"User ID:",t==null?void 0:t.id),console.log("üîç Is guest:",u,"Supabase configured:",pe()),!t||u||!pe()||!f){console.warn("‚ö†Ô∏è Cannot refresh profile - missing requirements:",{hasUser:!!t,isGuest:u,supabaseConfigured:pe(),hasSupabase:!!f});return}try{console.log("üì° Fetching profile for user:",t.id);const{data:h,error:P}=await f.from("profiles").select("*").eq("id",t.id).single();if(P){if(P.code==="PGRST116"){console.warn("‚ö†Ô∏è Profile not found for user:",t.id);return}throw console.error("‚ùå Error fetching profile:",P),P}h?(console.log("‚úÖ Profile force refreshed successfully:",h.username),n(h),localStorage.setItem("last-profile-refresh",Date.now().toString())):console.warn("‚ö†Ô∏è No profile data returned for user:",t.id)}catch(h){console.error("‚ùå Error force refreshing profile:",h)}},[t,u]),M=l.useCallback(()=>{console.log("üêõ === AUTH STATE DEBUG ==="),console.log("User:",(t==null?void 0:t.email)||"null"),console.log("User ID:",(t==null?void 0:t.id)||"null"),console.log("Profile:",(r==null?void 0:r.username)||"null"),console.log("Session exists:",!!i),console.log("Is Guest:",u),console.log("Loading:",c),console.log("Auth Key:",g),console.log("Session valid:",k()),console.log("üêõ === END DEBUG ===")},[t,r,i,u,c,g,k]);l.useEffect(()=>{let h=!0,P=null,R=null;return(async()=>{if(p){console.log("üîí Auth already initialized, skipping...");return}try{console.log("üöÄ Initializing Auth..."),j(!0),await oa.initialize(async()=>{var ne;if(console.log("üîê Initializing authentication..."),!pe()||!f){console.warn("Supabase not configured, setting as guest mode"),h&&(m(!0),a(null),n(null),o(null),d(!1));return}let N=null,B=0;const X=3;for(;B<X&&!N;){try{console.log(`üîç Attempting to get session (attempt ${B+1}/${X})`);const{data:{session:E},error:A}=await f.auth.getSession();if(A){if(console.warn(`Session retrieval attempt ${B+1} failed:`,A),B===X-1)throw A}else if(N=E,N!=null&&N.user){console.log("‚úÖ Session found:",N.user.email);break}else console.log("üìù No session found on this attempt")}catch(E){console.error(`Failed to retrieve session (attempt ${B+1}):`,E),B===X-1&&console.error("All session retrieval attempts failed")}B++,B<X&&await new Promise(E=>setTimeout(E,500))}if(h){if(o(N),a((N==null?void 0:N.user)??null),!(N!=null&&N.user))console.log("‚ùå No authenticated session found, setting as guest"),m(!0),n(null),y(E=>E+1),console.log("AuthContext: Set isGuest to true - user is null");else{if(console.log("‚úÖ Authenticated session found, setting as authenticated user"),console.log("üë§ User email:",N.user.email),console.log("üÜî User ID:",N.user.id),m(!1),y(E=>E+1),console.log("AuthContext: Set isGuest to false - user authenticated"),(ne=N.user)!=null&&ne.id){console.log("üîÑ Loading profile for user:",N.user.id);try{const{data:E,error:A}=await f.from("profiles").select("*").eq("id",N.user.id).single();A?A.code!=="PGRST116"?console.error("‚ùå Profile fetch error:",A):console.warn("‚ö†Ô∏è Profile not found for user:",N.user.id):E&&(console.log("‚úÖ Profile loaded successfully:",E.username),n(E))}catch(E){console.error("‚ùå Failed to load profile:",E)}}setTimeout(async()=>{console.log("‚è∞ Delayed profile refresh after state settlement"),await w()},500)}d(!1),console.log("üéØ Auth initialization complete. isGuest:",!(N!=null&&N.user),"user exists:",!!(N!=null&&N.user))}N&&h&&(P=setInterval(()=>{h&&N&&!k()&&(console.log("Session expired, refreshing..."),C())},300*1e3));const{data:{subscription:G}}=f.auth.onAuthStateChange(async(E,A)=>{var ee,ue,xe;if(h){console.log("üîÑ Auth state changed:",E,"Session exists:",!!(A!=null&&A.user)),console.log("üîÑ Session user:",(ee=A==null?void 0:A.user)==null?void 0:ee.email);try{if(o(A),a((A==null?void 0:A.user)??null),E==="SIGNED_OUT")console.log("üö™ SIGNED_OUT event - forcing guest mode"),T();else if(E==="SIGNED_IN"&&(A!=null&&A.user)){if(console.log("üîë SIGNED_IN event - user authenticated"),m(!1),console.log("AuthContext: SIGNED_IN - isGuest set to false, user:",A.user.email),localStorage.removeItem("ju-connect-guest-mode"),y(V=>V+1),(ue=A.user)!=null&&ue.id&&pe()&&f)try{const{data:V,error:J}=await f.from("profiles").select("*").eq("id",A.user.id).single();J?J.code!=="PGRST116"&&console.error("‚ùå Profile fetch error during SIGNED_IN:",J):V&&(console.log("‚úÖ Profile loaded during SIGNED_IN:",V.username),n(V))}catch(V){console.error("‚ùå Failed to load profile during SIGNED_IN:",V)}}else if(A!=null&&A.user){if(m(!1),console.log("AuthContext: Auth state change - user authenticated, isGuest set to false"),localStorage.removeItem("ju-connect-guest-mode"),y(V=>V+1),(xe=A.user)!=null&&xe.id&&pe()&&f)try{const{data:V,error:J}=await f.from("profiles").select("*").eq("id",A.user.id).single();J?J.code!=="PGRST116"&&console.error("‚ùå Profile fetch error during auth change:",J):V&&(console.log("‚úÖ Profile loaded during auth change:",V.username),n(V))}catch(V){console.error("‚ùå Failed to load profile during auth change:",V)}}else console.log("Auth state change: No user session, setting as guest"),m(!0),n(null),y(V=>V+1),console.log("AuthContext: Auth state change - no user, isGuest set to true")}catch(V){console.error("Error handling auth state change:",V)}}});R=G;const W=()=>{h&&document.visibilityState==="visible"&&N&&!k()&&C()};document.addEventListener("visibilitychange",W)})}catch(N){console.error("Error initializing auth:",N),h&&d(!1)}})(),()=>{h=!1,P&&clearInterval(P),R&&R.unsubscribe()}},[k,C,x,w]);const b={user:t,profile:r,session:i,loading:c,isGuest:u,authKey:g,signOut:v,refreshProfile:x,forceRefreshProfile:w,isSessionValid:k,refreshSession:C,debugAuthState:M};return e.jsx(Xs.Provider,{value:b,children:s})},we={debug:(s,...t)=>{},info:(s,...t)=>{},warn:(s,...t)=>{},error:(s,...t)=>{},demoMode:(s,...t)=>{}};class da extends l.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){this.setState({errorInfo:a});const r=t.message,n=r.includes("memory")||r.includes("leak")||r.includes("Maximum call stack"),i=r.includes("auth")||r.includes("session"),o=r.includes("infinite recursion")||r.includes("database")||r.includes("supabase");we.error("Error caught by boundary:",{error:r,stack:t.stack,componentStack:a.componentStack,errorBoundary:!0,isMemoryError:n,isAuthError:i,isDatabaseError:o,timestamp:new Date().toISOString()}),Fe(async()=>{const{enhancedErrorReporting:c}=await import("./enhancedServices-wFH4Gj3X.js");return{enhancedErrorReporting:c}},__vite__mapDeps([0,1,2,3])).then(({enhancedErrorReporting:c})=>{c.reportError(t,{operation:"component_render",component:"ErrorBoundary",metadata:{componentStack:a.componentStack,isMemoryError:n,isAuthError:i,isDatabaseError:o}})}).catch(c=>{}),o&&r.includes("infinite recursion")&&(we.warn("Infinite recursion detected, auto-reloading in 3 seconds..."),setTimeout(()=>{window.location.reload()},3e3)),t.message.includes("infinite recursion")||t.message.includes("Maximum call stack")||t.message.includes("out of memory")}render(){var t;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const a=((t=this.state.error)==null?void 0:t.message)||"Unknown error",r=a.includes("infinite recursion")||a.includes("Database configuration"),n=a.includes("Maximum call stack")||a.includes("out of memory");return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:r?"Database Configuration Issue":n?"Performance Issue Detected":"Application Error"})})]}),e.jsx("div",{className:"text-sm text-gray-600 mb-4",children:r?e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"There's a database configuration issue that needs to be resolved."}),e.jsx("p",{className:"text-xs text-gray-500",children:"This usually relates to database policies that need to be updated."})]}):n?e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"The application encountered a performance issue."}),e.jsx("p",{className:"text-xs text-gray-500",children:"This might be due to too many active connections or memory usage."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"The application encountered an unexpected error:"}),e.jsx("pre",{className:"mt-2 text-xs bg-gray-100 p-2 rounded overflow-auto max-h-20",children:a})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors",children:"Reload App"}),e.jsx("button",{onClick:()=>{localStorage.clear(),sessionStorage.clear(),window.location.href="/"},className:"flex-1 bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md transition-colors",children:"Reset & Reload"})]}),!1]})})}return this.props.children}}function ge(...s){return St(kt(s))}class Zs extends Error{constructor(a,r,n,i="error",o,c){super(a);Q(this,"code");Q(this,"statusCode");Q(this,"userFriendlyMessage");Q(this,"action");Q(this,"severity");Q(this,"context");this.name="AppError",this.code=o,this.userFriendlyMessage=r||this.convertToUserFriendlyMessage(a),this.action=n,this.severity=i,this.context=c}convertToUserFriendlyMessage(a){const r={"Network request failed":"Connection problem. Please check your internet.","Invalid credentials":"Please check your username and password.","User not found":"We could not find your account.","Permission denied":"You do not have permission to do this.","File too large":"Please upload a file or PDF smaller than 5MB","Invalid file type":"Please upload a valid file type.","Session expired":"Your session has expired. Please log in again.","Rate limit exceeded":"Too many requests. Please wait a moment.","Service unavailable":"Our service is temporarily unavailable."};for(const[n,i]of Object.entries(r))if(a.toLowerCase().includes(n.toLowerCase()))return i;return"Something went wrong. Please try again."}convertToUserFriendly(){return{message:this.userFriendlyMessage,action:this.action,severity:this.severity,code:this.code}}}function ma(s,t){if(s instanceof Zs)return s.convertToUserFriendly();const a=(s==null?void 0:s.message)||"An unexpected error occurred",r={"network error":{message:"Connection problem",action:"Please check your internet connection and try again",severity:"warning"},unauthorized:{message:"Access denied",action:"Please log in and try again",severity:"warning"},forbidden:{message:"Permission denied",action:"You do not have permission to perform this action",severity:"error"},"not found":{message:"Not found",action:"The requested item could not be found",severity:"info"},timeout:{message:"Request timed out",action:"Please try again",severity:"warning"},"file too large":{message:"Please upload a file or PDF smaller than 5MB",action:"Choose a smaller file and try again",severity:"warning"},"session expired":{message:"Session expired",action:"Please log in again",severity:"warning"}};for(const[n,i]of Object.entries(r))if(a.toLowerCase().includes(n))return{message:i.message,action:i.action,severity:i.severity||"error",code:n.toUpperCase().replace(" ","_")};switch(t.operation){case"file_upload":return{message:"Upload failed",action:"Please check your file and try again",severity:"warning",code:"UPLOAD_ERROR"};case"auth":return{message:"Authentication failed",action:"Please check your credentials and try again",severity:"warning",code:"AUTH_ERROR"};case"chat":return{message:"Message could not be sent",action:"Please try sending your message again",severity:"warning",code:"CHAT_ERROR"};case"group":return{message:"Group operation failed",action:"Please try again or contact support",severity:"error",code:"GROUP_ERROR"}}return{message:"Something went wrong",action:"Please try again or contact support if the problem continues",severity:"error",code:"UNKNOWN_ERROR"}}function ys(s){const t=(s==null?void 0:s.message)||"Database operation failed",a=ma(s,{operation:"database"});return new Zs(t,a.message,a.action,a.severity,a.code)}const et=async(s,t,a,r,n)=>{try{if(!f)throw new Error("Sign up is not available right now. Please try again later.");const{data:i}=await f.from("profiles").select("username").eq("username",r).maybeSingle();if(i)throw new Error("This username is taken. Please choose a different one.");const{data:o}=await f.from("profiles").select("mobile_number").eq("mobile_number",n).maybeSingle();if(o)throw new Error("This phone number is already registered. Please use a different number.");const{data:c,error:d}=await f.auth.signUp({email:s,password:t,options:{data:{username:r,full_name:a}}});if(d)throw ys(d);if(!c.user)throw new Error("Could not create your account. Please try again.");const u={id:c.user.id,username:r,mobile_number:n,full_name:a},{error:m}=await f.from("profiles").insert([u]);if(m)throw await f.auth.signOut(),ys(m);return we.info("User signed up successfully:",c.user.id),{user:c.user,profile:u}}catch(i){throw we.error("Sign up error:",i),i instanceof Error?i:new Error("Could not create your account. Please try again.")}},st=async(s,t)=>{var a;try{if(!f)throw new Error("Sign in is not available right now. Please try again later.");const{data:r,error:n}=await f.auth.signInWithPassword({email:s,password:t});if(n)throw ys(n);return we.info("User signed in successfully:",(a=r.user)==null?void 0:a.id),r.user&&Fe(async()=>{const{activityService:i}=await import("./enhancedServices-wFH4Gj3X.js");return{activityService:i}},__vite__mapDeps([0,1,2,3])).then(({activityService:i})=>{i.logActivity(r.user.id,"login",{method:"email_password"},void 0,navigator.userAgent).catch(o=>console.warn("Failed to log login activity:",o))}).catch(i=>console.warn("Failed to import enhanced services:",i)),r}catch(r){throw we.error("Sign in error:",r),Fe(async()=>{const{enhancedErrorReporting:n}=await import("./enhancedServices-wFH4Gj3X.js");return{enhancedErrorReporting:n}},__vite__mapDeps([0,1,2,3])).then(({enhancedErrorReporting:n})=>{n.reportError(r,{operation:"user_login",component:"authService",metadata:{email:s}})}).catch(n=>console.warn("Failed to log error:",n)),r instanceof Error?r:new Error("Could not sign you in. Please check your email and password.")}},D=({variant:s="primary",size:t="md",loading:a=!1,className:r,disabled:n,children:i,glow:o=!1,icon:c,...d})=>{const u="inline-flex items-center justify-center font-semibold transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transform active:scale-95 relative overflow-hidden",m={primary:"bg-gradient-to-r from-primary-500 to-primary-600 text-white hover:from-primary-600 hover:to-primary-700 focus:ring-primary-500 shadow-lg shadow-primary-500/25 hover:shadow-xl hover:shadow-primary-500/30 hover:scale-105",secondary:"bg-gradient-to-r from-secondary-100 to-secondary-200 text-secondary-700 hover:from-secondary-200 hover:to-secondary-300 focus:ring-secondary-500 border border-secondary-300 hover:border-secondary-400 hover:scale-105",outline:"border-2 border-primary-500 text-primary-600 hover:bg-primary-500 hover:text-white focus:ring-primary-500 hover:scale-105",ghost:"text-secondary-600 hover:bg-secondary-100 hover:text-secondary-900 focus:ring-secondary-500 hover:scale-105",danger:"bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 focus:ring-red-500 shadow-lg shadow-red-500/25 hover:shadow-xl hover:shadow-red-500/30 hover:scale-105",premium:"btn-premium"},p={sm:"px-4 py-2 text-sm rounded-xl",md:"px-6 py-3 text-sm rounded-xl",lg:"px-8 py-4 text-base rounded-2xl",xl:"px-10 py-5 text-lg rounded-2xl"},j=o?"animate-pulse-glow":"";return e.jsxs("button",{className:ge(u,m[s],p[t],j,r),disabled:n||a,...d,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform -skew-x-12 -translate-x-full transition-transform duration-700 group-hover:translate-x-full"}),a&&e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),c&&!a&&e.jsx("span",{className:"mr-2 flex items-center",children:c}),e.jsx("span",{className:"relative z-10",children:i})]})},ae=({label:s,error:t,helpText:a,className:r,id:n,icon:i,premium:o=!1,...c})=>{const d=n||`input-${Math.random().toString(36).substring(2)}`;return e.jsxs("div",{className:"space-y-2",children:[s&&e.jsx("label",{htmlFor:d,className:"block text-sm font-semibold text-secondary-700",children:s}),e.jsxs("div",{className:"relative",children:[i&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-secondary-400",children:i}),e.jsx("input",{id:d,className:ge(o?"input-premium":"block w-full rounded-xl border border-secondary-200 px-4 py-3 text-secondary-900 placeholder-secondary-400","transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent","disabled:cursor-not-allowed disabled:bg-secondary-50 disabled:text-secondary-500",t&&"border-red-300 focus:border-red-500 focus:ring-red-500",i&&"pl-10",o&&"shadow-lg shadow-primary-500/10 hover:shadow-primary-500/20",r),...c}),e.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-primary-500/20 to-primary-600/20 opacity-0 transition-opacity duration-300 pointer-events-none focus-within:opacity-100"})]}),t&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center space-x-1 animate-fade-in",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{children:t})]}),a&&!t&&e.jsx("p",{className:"text-sm text-secondary-500",children:a})]})},Pe=({isOpen:s,onClose:t,title:a,size:r="md",children:n,premium:i=!0,blur:o=!0})=>{if(l.useEffect(()=>{s?document.body.style.overflow="hidden":document.body.style.overflow="unset";const d=u=>{u.key==="Escape"&&t()};return s&&document.addEventListener("keydown",d),()=>{document.body.style.overflow="unset",document.removeEventListener("keydown",d)}},[s,t]),!s)return null;const c={sm:"max-w-md mx-4",md:"max-w-lg mx-4",lg:"max-w-2xl mx-4",xl:"max-w-4xl mx-4",full:"max-w-7xl mx-4"};return jt.createPortal(e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto animate-fade-in",children:e.jsxs("div",{className:"flex min-h-full items-center justify-center p-4 sm:p-6",children:[e.jsx("div",{className:ge("fixed inset-0 transition-all duration-300",o?"backdrop-blur-sm bg-black/50":"bg-black/50"),onClick:t}),e.jsxs("div",{className:ge("relative w-full transform transition-all duration-300 animate-scale-in max-h-[90vh] overflow-y-auto",i?"modal-premium":"bg-white rounded-2xl shadow-2xl",c[r]),children:[a&&e.jsxs("div",{className:"flex items-center justify-between border-b border-secondary-200/50 px-4 md:px-6 py-4",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-secondary-900 text-gradient",children:a}),e.jsx("button",{onClick:t,className:"rounded-xl p-2 text-secondary-400 hover:bg-secondary-100 hover:text-secondary-600 transition-all duration-200 hover:scale-110",children:e.jsx(Me,{className:"h-5 w-5"})})]}),!a&&e.jsx("button",{onClick:t,className:"absolute right-4 top-4 z-10 rounded-xl p-2 text-secondary-400 hover:bg-secondary-100 hover:text-secondary-600 transition-all duration-200 hover:scale-110",children:e.jsx(Me,{className:"h-5 w-5"})}),e.jsx("div",{className:ge("px-4 md:px-6",a?"py-4 md:py-6":"py-6 md:py-8"),children:n}),e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-r from-primary-500/20 via-transparent to-primary-500/20 pointer-events-none"})]})]})}),document.body)},re=({variant:s="neutral",size:t="sm",children:a,className:r,glow:n=!1,pulse:i=!1})=>{const o="inline-flex items-center font-semibold rounded-full transition-all duration-300",c={primary:"bg-gradient-to-r from-primary-500 to-primary-600 text-white shadow-lg shadow-primary-500/30",secondary:"bg-gradient-to-r from-secondary-100 to-secondary-200 text-secondary-700 border border-secondary-300",success:"bg-gradient-to-r from-success-500 to-success-600 text-white shadow-lg shadow-success-500/30",warning:"bg-gradient-to-r from-accent-500 to-accent-600 text-white shadow-lg shadow-accent-500/30",error:"bg-gradient-to-r from-red-500 to-red-600 text-white shadow-lg shadow-red-500/30",neutral:"bg-gradient-to-r from-secondary-200 to-secondary-300 text-secondary-700",premium:"bg-gradient-to-r from-primary-600 via-primary-500 to-primary-700 text-white shadow-xl shadow-primary-500/40 border border-primary-400/50"},d={sm:"px-2.5 py-1 text-xs",md:"px-3 py-1.5 text-sm",lg:"px-4 py-2 text-base"},u=n?"animate-pulse-glow":"",m=i?"animate-pulse":"";return e.jsx("span",{className:ge(o,c[s],d[t],u,m,r),children:a})},us=({isOpen:s,onClose:t,defaultMode:a="signin",initialMode:r,onSuccess:n})=>{const i=()=>r==="login"?"signin":r==="signup"?"signup":a,[o,c]=l.useState(i());l.useEffect(()=>{s&&r&&c(i())},[s,r]);const[d,u]=l.useState(!1),[m,p]=l.useState(!1),[j,g]=l.useState(""),{forceRefreshProfile:y,user:T,isGuest:k}=me(),[v,C]=l.useState({email:"",password:"",fullName:"",username:"",mobileNumber:""}),[x,w]=l.useState({}),M=()=>{const R={};return v.email?/\S+@\S+\.\S+/.test(v.email)||(R.email="Please enter a valid email"):R.email="Email is required",v.password?v.password.length<6&&(R.password="Password must be at least 6 characters"):R.password="Password is required",o==="signup"&&(v.fullName||(R.fullName="Full name is required"),v.username?v.username.length<3?R.username="Username must be at least 3 characters":/^[a-zA-Z0-9_]+$/.test(v.username)||(R.username="Username can only contain letters, numbers, and underscores"):R.username="Username is required",v.mobileNumber?/^\+?[\d\s-()]{10,}$/.test(v.mobileNumber)||(R.mobileNumber="Please enter a valid mobile number"):R.mobileNumber="Mobile number is required"),w(R),Object.keys(R).length===0},b=async R=>{if(R.preventDefault(),g(""),!!M()){p(!0);try{console.log("üîê Starting authentication process..."),o==="signup"?await et(v.email,v.password,v.fullName,v.username,v.mobileNumber):await st(v.email,v.password),console.log("‚úÖ Authentication successful, waiting for auth state update..."),console.log("üîÑ Forcing page reload to update auth state..."),await new Promise(L=>setTimeout(L,1e3)),window.location.reload()}catch(L){console.error("‚ùå Authentication failed:",L);const N=L.message||"Something went wrong. Please try again.";g(N)}finally{p(!1)}}},h=R=>{const{name:L,value:N}=R.target;C(B=>({...B,[L]:N})),x[L]&&w(B=>({...B,[L]:""}))},P=()=>{c(o==="signin"?"signup":"signin"),g(""),w({})};return e.jsx(Pe,{isOpen:s,onClose:t,size:"md",premium:!0,children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(Te,{className:"h-6 w-6 text-primary-500 animate-bounce-subtle"}),e.jsx(re,{variant:"premium",glow:!0,pulse:!0,children:"JU CONNECTS"}),e.jsx(Te,{className:"h-6 w-6 text-primary-500 animate-bounce-subtle"})]}),e.jsx("h2",{className:"text-2xl md:text-3xl font-display font-bold text-secondary-900 text-gradient",children:o==="signup"?"Join JU CONNECTS":"Welcome Back"}),e.jsx("p",{className:"text-secondary-600 text-base md:text-lg",children:o==="signup"?"Create your JU CONNECTS account and unlock exclusive features":"Sign in to access your JU CONNECTS dashboard"}),o==="signup"&&e.jsxs("div",{className:"grid grid-cols-2 md:flex md:items-center md:justify-center gap-2 md:space-x-4 text-xs md:text-sm text-secondary-500",children:[e.jsxs("div",{className:"flex items-center space-x-1 justify-center",children:[e.jsx(Je,{className:"h-4 w-4 text-accent-500"}),e.jsx("span",{children:"Upload Files"})]}),e.jsxs("div",{className:"flex items-center space-x-1 justify-center",children:[e.jsx(Je,{className:"h-4 w-4 text-accent-500"}),e.jsx("span",{children:"Chat globally"})]}),e.jsxs("div",{className:"flex items-center space-x-1 justify-center",children:[e.jsx(Je,{className:"h-4 w-4 text-accent-500"}),e.jsx("span",{children:"Private Messaging"})]}),e.jsxs("div",{className:"flex items-center space-x-1 justify-center",children:[e.jsx(Je,{className:"h-4 w-4 text-accent-500"}),e.jsx("span",{children:"Personalized support"})]})]})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4 md:space-y-6",children:[j&&e.jsxs("div",{className:"p-4 text-sm text-red-600 bg-red-50 rounded-xl border border-red-200 flex items-center space-x-2 animate-fade-in",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsx("span",{children:j})]}),o==="signup"&&e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(ae,{name:"fullName",label:"Full Name",value:v.fullName,onChange:h,error:x.fullName,placeholder:"Enter your full name",disabled:m,icon:e.jsx(de,{className:"h-5 w-5"}),premium:!0}),e.jsx(ae,{name:"username",label:"Username",value:v.username,onChange:h,error:x.username,placeholder:"Choose a unique username",disabled:m,helpText:"This will be displayed publicly",icon:e.jsx(de,{className:"h-5 w-5"}),premium:!0}),e.jsx(ae,{name:"mobileNumber",label:"Mobile Number",type:"tel",value:v.mobileNumber,onChange:h,error:x.mobileNumber,placeholder:"Enter your mobile number",disabled:m,icon:e.jsx($s,{className:"h-5 w-5"}),premium:!0})]}),e.jsx(ae,{name:"email",label:"Email Address",type:"email",value:v.email,onChange:h,error:x.email,placeholder:"Enter your email",disabled:m,icon:e.jsx(Ke,{className:"h-5 w-5"}),premium:!0}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{name:"password",label:"Password",type:d?"text":"password",value:v.password,onChange:h,error:x.password,placeholder:"Enter your password",disabled:m,icon:e.jsx(ze,{className:"h-5 w-5"}),premium:!0}),e.jsx("button",{type:"button",onClick:()=>u(!d),className:"absolute right-4 top-10 text-secondary-400 hover:text-secondary-600 transition-colors duration-300 hover:scale-110",children:d?e.jsx(ms,{className:"h-5 w-5"}):e.jsx(Ue,{className:"h-5 w-5"})})]}),e.jsx(D,{type:"submit",variant:"premium",size:"lg",className:"w-full",loading:m,disabled:m,glow:!0,children:o==="signup"?"Create JU CONNECTS Account":"Sign In to JU CONNECTS"}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:P,className:"text-primary-600 hover:text-primary-500 font-semibold transition-colors duration-300 hover:scale-105 transform",disabled:m,children:o==="signup"?"Already have an account? Sign in":"Don't have an account? Join JU CONNECTS"})})]}),o==="signup"&&e.jsx("div",{className:"border-t border-secondary-200 pt-4 md:pt-6",children:e.jsxs("div",{className:"text-center text-sm text-secondary-600",children:[e.jsx("p",{className:"mb-3 font-medium",children:"What you get with Membership:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{className:"truncate",children:"Unlimited Downloads"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{className:"truncate",children:"Private Messaging"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{className:"truncate",children:"Upload Content"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{className:"truncate",children:"Priority Support"})]})]})]})})]})})},ua=async(s,t,a,r)=>{const{data:n}=await f.from("content_reports").select("id").eq("content_id",s).eq("reported_by",t).maybeSingle();if(n)throw new Error("You have already reported this content");const i={content_id:s,reported_by:t,reason:a.trim(),description:(r==null?void 0:r.trim())||null},{data:o,error:c}=await f.from("content_reports").insert([i]).select().single();if(c)throw c;return o},xa=async(s,t,a,r)=>{const{data:n}=await f.from("chat_reports").select("id").eq("message_id",s).eq("reported_by",t).single();if(n)throw new Error("You have already reported this message");const i={message_id:s,reported_by:t,reason:a.trim(),description:null},{data:o,error:c}=await f.from("chat_reports").insert([i]).select().single();if(c)throw c;return o},ha=async s=>{let t=f.from("content_reports").select(`
      *,
      content (
        id,
        title,
        content_type
      ),
      reporter:profiles!content_reports_reported_by_fkey (
        id,
        username,
        full_name
      ),
      reviewer:profiles!content_reports_reviewed_by_fkey (
        id,
        username,
        full_name
      )
    `).order("created_at",{ascending:!1});const{data:a,error:r}=await t;if(r)throw r;return a||[]},pa=async s=>{let t=f.from("chat_reports").select(`
      *,
      chat_messages (
        id,
        message,
        user_id
      ),
      reporter:profiles!chat_reports_reported_by_fkey (
        id,
        username,
        full_name
      ),
      reviewer:profiles!chat_reports_reviewed_by_fkey (
        id,
        username,
        full_name
      )
    `).order("created_at",{ascending:!1});const{data:a,error:r}=await t;if(r)throw r;return a||[]},tt=async(s,t,a,r)=>{const{data:n,error:i}=await f.from("content_reports").update({status:t,reviewed_by:a,admin_notes:(r==null?void 0:r.trim())||null,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(i)throw i;return n},at=async(s,t,a,r)=>{const{data:n,error:i}=await f.from("chat_reports").update({status:t,reviewed_by:a,admin_notes:(r==null?void 0:r.trim())||null,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(i)throw i;return n},ga=async(s,t,a,r)=>{await tt(t,"resolved",a,`Content removed: ${r}`);const{error:n}=await f.from("content").delete().eq("id",s);if(n)throw n},fa=async(s,t,a,r)=>{await at(t,"resolved",a,`Message removed: ${r}`);const{error:n}=await f.from("chat_messages").update({is_reported:!0}).eq("id",s);if(n)throw n},ya=async()=>{const[s,t]=await Promise.all([f.from("content_reports").select("status"),f.from("chat_reports").select("status")]);if(s.error)throw s.error;if(t.error)throw t.error;const a={total:s.data.length,pending:s.data.filter(n=>n.status==="pending").length,reviewed:s.data.filter(n=>n.status==="reviewed").length,resolved:s.data.filter(n=>n.status==="resolved").length,dismissed:s.data.filter(n=>n.status==="dismissed").length},r={total:t.data.length,pending:t.data.filter(n=>n.status==="pending").length,reviewed:t.data.filter(n=>n.status==="reviewed").length,resolved:t.data.filter(n=>n.status==="resolved").length,dismissed:t.data.filter(n=>n.status==="dismissed").length};return{contentReports:a,chatReports:r}},Z=({size:s="md",className:t,variant:a="primary",text:r})=>{const n={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"},i={primary:"text-primary-600",secondary:"text-secondary-600",white:"text-white"};return e.jsxs("div",{className:ge("flex flex-col items-center justify-center space-y-3",t),children:[e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:ge("animate-spin",n[s],i[a]),fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("div",{className:ge("absolute inset-0 rounded-full animate-pulse",s==="xl"?"shadow-glow":"")})]}),r&&e.jsx("p",{className:ge("text-sm font-medium animate-pulse",i[a]),children:r})]})},ba=({isOpen:s,onClose:t})=>{var b;const{user:a,profile:r}=me(),[n,i]=l.useState("overview"),[o,c]=l.useState([]),[d,u]=l.useState([]),[m,p]=l.useState(null),[j,g]=l.useState(!1),[y,T]=l.useState(null),[k,v]=l.useState(!1);l.useEffect(()=>{s&&(r!=null&&r.is_admin)&&C()},[s,r]);const C=async()=>{g(!0);try{const[h,P,R]=await Promise.all([ha(),pa(),ya()]);c(h),u(P),p(R)}catch{}finally{g(!1)}},x=async(h,P,R,L)=>{if(a){v(!0);try{if(L){const N=o.find(B=>B.id===h);N&&await ga(N.content_id,h,a.id,R||"Content removed due to policy violation")}else await tt(h,P,a.id,R);await C(),T(null)}catch(N){alert(N.message||"Failed to update report")}finally{v(!1)}}},w=async(h,P,R,L)=>{if(a){v(!0);try{if(L){const N=d.find(B=>B.id===h);N&&await fa(N.message_id,h,a.id,R||"Message removed due to policy violation")}else await at(h,P,a.id,R);await C(),T(null)}catch(N){alert(N.message||"Failed to update report")}finally{v(!1)}}},M=h=>{switch(h){case"pending":return"warning";case"reviewed":return"primary";case"resolved":return"success";case"dismissed":return"neutral";default:return"neutral"}};return r!=null&&r.is_admin?e.jsx(Pe,{isOpen:s,onClose:t,size:"xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(ke,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Admin Panel"})]}),e.jsxs("div",{className:"flex space-x-2 md:space-x-4 mb-6 border-b border-gray-200 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>i("overview"),className:`pb-2 px-1 font-medium text-sm ${n==="overview"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(ps,{className:"h-4 w-4 inline mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Overview"})]}),e.jsxs("button",{onClick:()=>i("content"),className:`pb-2 px-1 font-medium text-sm ${n==="content"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(ce,{className:"h-4 w-4 inline mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Content Reports"}),e.jsx("span",{className:"sm:hidden",children:"Content"}),e.jsxs("span",{className:"ml-1",children:["(",o.filter(h=>h.status==="pending").length,")"]})]}),e.jsxs("button",{onClick:()=>i("chat"),className:`pb-2 px-1 font-medium text-sm ${n==="chat"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(Ye,{className:"h-4 w-4 inline mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Chat Reports"}),e.jsx("span",{className:"sm:hidden",children:"Chat"}),e.jsxs("span",{className:"ml-1",children:["(",d.filter(h=>h.status==="pending").length,")"]})]})]}),j?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Z,{size:"lg"})}):e.jsxs("div",{className:"max-h-64 md:max-h-96 overflow-y-auto",children:[n==="overview"&&m&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qe,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-900",children:"Content Reports"})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:m.contentReports.pending}),e.jsxs("div",{className:"text-sm text-orange-700",children:["Pending (",m.contentReports.total," total)"]})]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ye,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"font-medium text-red-900",children:"Chat Reports"})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("div",{className:"text-2xl font-bold text-red-900",children:m.chatReports.pending}),e.jsxs("div",{className:"text-sm text-red-700",children:["Pending (",m.chatReports.total," total)"]})]})]})]}),e.jsx("div",{className:"text-sm text-gray-600",children:e.jsx("p",{children:"Review and moderate reported content to maintain community standards."})})]}),n==="content"&&e.jsx("div",{className:"space-y-4",children:o.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No content reports found"}):o.map(h=>{var P,R;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 md:p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start justify-between space-y-3 md:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(re,{variant:M(h.status),children:h.status}),e.jsx("span",{className:"text-sm text-gray-500",children:h.reason})]}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1 text-sm md:text-base",children:((P=h.content)==null?void 0:P.title)||"Content Title"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 mb-2",children:h.description}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:["Reported by @",(R=h.reporter)==null?void 0:R.username," ‚Ä¢ "," ",Ce(new Date(h.created_at),{addSuffix:!0})]})]}),e.jsx(D,{size:"sm",variant:"outline",className:"w-full md:w-auto",onClick:()=>T(h),children:"Review"})]})},h.id)})}),n==="chat"&&e.jsx("div",{className:"space-y-4",children:d.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No chat reports found"}):d.map(h=>{var P,R;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(re,{variant:M(h.status),children:h.status}),e.jsx("span",{className:"text-sm text-gray-500",children:h.reason})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded mb-2",children:e.jsxs("p",{className:"text-sm text-gray-900",children:['"',(P=h.chat_messages)==null?void 0:P.message,'"']})}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:h.description}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Reported by @",(R=h.reporter)==null?void 0:R.username," ‚Ä¢ "," ",Ce(new Date(h.created_at),{addSuffix:!0})]})]}),e.jsx(D,{size:"sm",variant:"outline",onClick:()=>T(h),children:"Review"})]})},h.id)})})]}),y&&e.jsx(Pe,{isOpen:!!y,onClose:()=>T(null),title:"Review Report",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Report Details"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Reason:"})," ",y.reason]}),y.description&&e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"Description:"})," ",y.description]}),e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"Reported by:"})," @",(b=y.reporter)==null?void 0:b.username]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(D,{size:"sm",variant:"outline",onClick:()=>{y.content_id?x(y.id,"reviewed"):w(y.id,"reviewed")},loading:k,children:"Mark Reviewed"}),e.jsx(D,{size:"sm",variant:"danger",onClick:()=>{y.content_id?x(y.id,"resolved","Content removed",!0):w(y.id,"resolved","Message removed",!0)},loading:k,children:"Remove Content"}),e.jsx(D,{size:"sm",variant:"ghost",onClick:()=>{y.content_id?x(y.id,"dismissed","No action needed"):w(y.id,"dismissed","No action needed")},loading:k,children:"Dismiss"})]})]})})]})}):null},ja=async(s,t,a)=>{if(s===t)throw new Error("Cannot send message to yourself");if(!f)throw new Error("Supabase client not initialized");const{data:r}=await f.from("profiles").select("id").eq("id",t).single();if(!r)throw new Error("Recipient not found");const{data:n}=await f.from("user_blocks").select("id").eq("blocker_id",t).eq("blocked_id",s).maybeSingle();if(n)throw new Error("Cannot send message to this user");const i={sender_id:s,recipient_id:t,message:a.trim()},{data:o,error:c}=await f.from("private_messages").insert([i]).select().single();if(c)throw c;return o},wa=async(s,t,a=50,r=0)=>{const{data:n,error:i}=await f.from("private_messages").select(`
      *,
      sender:profiles!private_messages_sender_id_fkey (
        id,
        username,
        full_name,
        avatar_url,
        is_online
      ),
      recipient:profiles!private_messages_recipient_id_fkey (
        id,
        username,
        full_name,
        avatar_url,
        is_online
      )
    `).or(`and(sender_id.eq.${s},recipient_id.eq.${t}),and(sender_id.eq.${t},recipient_id.eq.${s})`).eq("is_deleted_by_sender",!1).eq("is_deleted_by_recipient",!1).order("created_at",{ascending:!1}).range(r,r+a-1);if(i)throw i;return(n||[]).reverse()},va=async s=>{const{data:t,error:a}=await f.from("private_messages").select(`
      *,
      sender:profiles!private_messages_sender_id_fkey (
        id,
        username,
        full_name,
        avatar_url,
        is_online,
        last_seen
      ),
      recipient:profiles!private_messages_recipient_id_fkey (
        id,
        username,
        full_name,
        avatar_url,
        is_online,
        last_seen
      )
    `).or(`sender_id.eq.${s},recipient_id.eq.${s}`).order("created_at",{ascending:!1});if(a)throw a;const r=new Map;return t==null||t.forEach(i=>{const o=i.sender_id===s,c=o?i.recipient_id:i.sender_id,d=o?i.recipient:i.sender;r.has(c)||r.set(c,{otherUser:d,messages:[],unreadCount:0});const u=r.get(c);u.messages.push(i),!o&&!i.is_read&&u.unreadCount++}),Array.from(r.values()).map(i=>({otherUser:i.otherUser,lastMessage:i.messages[0],unreadCount:i.unreadCount})).sort((i,o)=>{var u,m;const c=((u=i.lastMessage)==null?void 0:u.created_at)||"0";return(((m=o.lastMessage)==null?void 0:m.created_at)||"0").localeCompare(c)})},rt=async(s,t,a=20)=>{if(!s.trim())return[];const{data:r,error:n}=await f.from("profiles").select("id, username, full_name, avatar_url, is_online").neq("id",t).or(`username.ilike.%${s}%,full_name.ilike.%${s}%`).limit(a);if(n)throw n;return r||[]},xs=s=>{const[t,a]=l.useState([]),[r,n]=l.useState([]),[i,o]=l.useState(!1),[c,d]=l.useState(!1),[u,m]=l.useState(null),p=l.useRef(null),j=t.reduce((x,w)=>x+w.unreadCount,0),g=l.useCallback(async(x=!1)=>{if(!s)return;const w=Date.now(),M=parseInt(sessionStorage.getItem(`last-conversations-load-${s}`)||"0");if(!(!x&&w-M<2e3)){sessionStorage.setItem(`last-conversations-load-${s}`,w.toString());try{o(!0);const b=await va(s);a(b)}catch{m("Failed to load conversations")}finally{o(!1)}}},[s]),y=l.useCallback(async x=>{if(s)try{o(!0);const w=await wa(s,x);n(w)}catch{m("Failed to load conversation")}finally{o(!1)}},[s]),T=l.useCallback(async(x,w)=>{if(!(!s||!w.trim()))try{d(!0),m(null);const M=await ja(s,x,w.trim());return n(b=>[...b,M]),await g(),M}catch(M){throw m(M instanceof Error?M.message:"Failed to send message"),M}finally{d(!1)}},[s,g]),k=l.useCallback(()=>{if(r.length===0)return null;const x=r[0];return x.sender_id===s?x.recipient_id:x.sender_id},[r,s]);l.useEffect(()=>{if(!s)return;const x=k();if(!x)return;const w=setInterval(()=>{document.visibilityState==="visible"&&y(x)},3e4);return()=>clearInterval(w)},[s,k,y,r.length]),l.useEffect(()=>{if(!s||!f||(p.current&&f.removeChannel(p.current),t.length===0))return;const x=f.channel(`private_messages_${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"private_messages",filter:`recipient_id.eq.${s}`},async w=>{const M=w.new;if(t.some(h=>h.otherUser.id===M.sender_id)){const h=Date.now(),P=parseInt(sessionStorage.getItem(`last-rt-update-${s}`)||"0");h-P>5e3&&(sessionStorage.setItem(`last-rt-update-${s}`,h.toString()),await g(!1))}}).subscribe();return p.current=x,()=>{p.current&&f&&f.removeChannel(p.current)}},[s,g,y,k]),l.useEffect(()=>{g(!1)},[g]),l.useEffect(()=>{if(!s)return;const x=setInterval(()=>{document.visibilityState==="visible"&&g(!1)},3e4);return()=>clearInterval(x)},[s,g]),l.useEffect(()=>{if(u){const x=setTimeout(()=>m(null),5e3);return()=>clearTimeout(x)}},[u]);const v=l.useCallback(async x=>{if(!s)return;if(await y(x),!t.find(M=>M.otherUser.id===x))try{if(!f)return;const{data:M}=await f.from("profiles").select("id, username, full_name, avatar_url").eq("id",x).single();if(M){const b={otherUser:{id:M.id,username:M.username,full_name:M.full_name,avatar_url:M.avatar_url||void 0,is_online:!1,last_seen:void 0},lastMessage:void 0,unreadCount:0};a(h=>[b,...h])}}catch(M){console.error("Error fetching user profile:",M)}},[s,y,t]),C=l.useCallback(x=>{const w=k();w&&(x.sender_id===w||x.recipient_id===w)&&n(b=>b.some(h=>h.id===x.id)?b:[...b,x]),a(b=>b.map(h=>h.otherUser.id===x.sender_id||h.otherUser.id===x.recipient_id?{...h,lastMessage:x,unreadCount:x.sender_id!==s?h.unreadCount+1:h.unreadCount}:h))},[k,s]);return{conversations:t,currentConversation:r,totalUnreadCount:j,loading:i,sending:c,error:u,loadConversations:g,loadConversation:y,sendMessage:T,startNewConversation:v,setCurrentConversation:n,addMessageToConversation:C}},Na=()=>{const[s,t]=l.useState(!1),[a,r]=l.useState(!1),[n,i]=l.useState(!1),{user:o,profile:c,isGuest:d,signOut:u,debugAuthState:m}=me(),p=es(),j=wt(),{totalUnreadCount:g}=xs((o==null?void 0:o.id)||null);l.useEffect(()=>{console.log("üîç Navbar: Auth state changed"),m()},[o,d,m]);const y=C=>p.pathname===C,T=[{name:"Browse",href:"/",icon:Ge,shortName:"Home"},{name:"Categories",href:"/categories",icon:ce,shortName:"Cat"},{name:"Groups",href:"/groups",icon:_e,shortName:"Groups"},{name:"Upload",href:"/upload",icon:Xe,shortName:"Upload"},{name:"Requests",href:"/my-requests",icon:Bs,shortName:"Req"}],k=async()=>{try{t(!1),console.log("üö™ User initiated sign out"),await u()}catch(C){console.error("Error during sign out:",C),t(!1)}},v=(C,x=!1)=>{if(t(!1),x&&(!o||d)){C.preventDefault(),r(!0);return}};return e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"glass-card sticky top-0 z-40 border-b border-white/30 backdrop-blur-2xl bg-white/80 shadow-lg",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16 sm:h-20",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(ye,{to:"/",className:"flex items-center space-x-3 sm:space-x-4 group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary-400 to-primary-600 rounded-2xl opacity-20 animate-pulse"}),e.jsx(Ge,{className:"relative h-8 w-8 sm:h-10 sm:w-10 text-primary-600 group-hover:scale-110 transition-all duration-500 p-1"}),e.jsx("div",{className:"absolute inset-0 bg-primary-500 rounded-2xl blur-xl opacity-0 group-hover:opacity-40 transition-all duration-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-display font-bold text-xl sm:text-2xl text-gradient animate-gradient-text hidden xs:block",children:"JU CONNECTS"}),e.jsx("span",{className:"font-display font-bold text-xl sm:text-2xl text-gradient animate-gradient-text xs:hidden",children:"JU"}),e.jsx("span",{className:"text-xs text-secondary-500 font-medium hidden sm:block",children:"Education Hub"})]}),e.jsx(Te,{className:"h-5 w-5 sm:h-6 sm:w-6 text-accent-500 animate-bounce-subtle"})]}),e.jsx("div",{className:"hidden lg:ml-12 lg:flex lg:space-x-2",children:T.map(C=>{const x=["/upload","/my-requests","/groups","/chat"].includes(C.href);return e.jsxs(ye,{to:C.href,onClick:w=>v(w,x),className:ge("relative px-5 xl:px-7 py-3 rounded-2xl text-sm font-semibold transition-all duration-500 flex items-center space-x-3 group overflow-hidden hover:scale-105 active:scale-95",y(C.href)?"text-white bg-gradient-to-r from-primary-500 via-primary-600 to-primary-700 shadow-xl shadow-primary-500/50":"text-gray-700 hover:text-primary-600 hover:bg-white/80 backdrop-blur-lg"),children:[y(C.href)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary-400 via-primary-600 to-primary-800 rounded-2xl animate-pulse opacity-30"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent transform -skew-x-12 -translate-x-full animate-shimmer"})]}),e.jsx(C.icon,{className:ge("h-5 w-5 transition-all duration-500",y(C.href)?"text-white drop-shadow-lg":"text-gray-600 group-hover:text-primary-500 group-hover:scale-110")}),e.jsx("span",{className:"relative z-10 hidden xl:block",children:C.name}),e.jsx("span",{className:"relative z-10 xl:hidden",children:C.shortName}),x&&(!o||d)&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-gradient-to-br from-accent-400 to-accent-600 rounded-full animate-pulse shadow-lg"})]},C.name)})})]}),e.jsx("div",{className:"hidden md:flex md:items-center md:space-x-4",children:d?e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"glass px-4 py-2 rounded-2xl border border-white/50",children:e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"üëã Browsing as Guest"})}),e.jsxs(D,{size:"sm",variant:"premium",onClick:()=>r(!0),children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Sign In"]})]}):o&&c?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>j("/chat?tab=private"),className:"relative p-3 text-gray-600 hover:text-primary-600 rounded-2xl hover:bg-white/60 transition-all duration-500 hover:scale-110 active:scale-95 backdrop-blur-lg",title:"Messages",children:[e.jsx(Ke,{className:"h-5 w-5"}),g>0&&e.jsx("div",{className:"absolute -top-1 -right-1 min-w-[20px] h-[20px] bg-gradient-to-br from-red-400 to-red-600 text-white text-xs rounded-full flex items-center justify-center px-1 animate-pulse shadow-lg",children:g>99?"99+":g})]}),c.is_admin&&e.jsx("button",{onClick:()=>i(!0),className:"p-3 text-gray-600 hover:text-primary-600 rounded-2xl hover:bg-white/60 transition-all duration-500 hover:scale-110 active:scale-95 backdrop-blur-lg",title:"Admin Panel",children:e.jsx(ke,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center space-x-3 px-5 py-3 glass-card border border-white/60",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-4 w-4 text-white"})}),e.jsx("div",{className:"status-online absolute -bottom-1 -right-1"})]}),e.jsxs(ye,{to:`/profile/${o.id}`,className:"flex flex-col hover:text-primary-600 transition-all duration-300 group",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-700 group-hover:text-primary-600",children:["@",c.username]}),c.is_admin&&e.jsxs("span",{className:"text-xs text-primary-600 font-medium flex items-center",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Admin"]})]})]}),e.jsx("button",{onClick:k,className:"p-3 text-gray-600 hover:text-red-600 rounded-2xl hover:bg-red-50/80 transition-all duration-500 hover:scale-110 active:scale-95 backdrop-blur-lg",title:"Sign Out",children:e.jsx(gs,{className:"h-5 w-5"})})]}):e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm text-gray-600 hidden xl:block",children:"üëã Guest"}),e.jsxs(D,{size:"sm",variant:"premium",onClick:()=>r(!0),children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Sign In"]})]})}),e.jsx("div",{className:"lg:hidden flex items-center",children:e.jsx("button",{onClick:()=>t(!s),className:"p-3 rounded-2xl text-gray-600 hover:text-primary-600 hover:bg-white/60 transition-all duration-500 hover:scale-110 active:scale-95 backdrop-blur-lg","aria-label":s?"Close menu":"Open menu",children:s?e.jsx(Me,{className:"h-6 w-6"}):e.jsx(Et,{className:"h-6 w-6"})})})]})}),s&&e.jsx("div",{className:"lg:hidden border-t border-white/30 glass-card backdrop-blur-2xl bg-white/80 animate-fade-in-down",children:e.jsxs("div",{className:"px-6 pt-6 pb-8 space-y-4",children:[T.map(C=>{const x=["/upload","/my-requests","/groups","/chat"].includes(C.href);return e.jsxs(ye,{to:C.href,onClick:w=>v(w,x),className:ge("flex items-center space-x-4 px-6 py-4 rounded-2xl text-base font-semibold transition-all duration-500 group hover:scale-105 active:scale-95",y(C.href)?"text-white bg-gradient-to-r from-primary-500 via-primary-600 to-primary-700 shadow-xl shadow-primary-500/40":"text-gray-700 hover:text-primary-600 hover:bg-white/80"),children:[e.jsxs("div",{className:"relative",children:[e.jsx(C.icon,{className:ge("h-6 w-6 transition-all duration-500",y(C.href)?"text-white drop-shadow-lg":"text-gray-600 group-hover:text-primary-500 group-hover:scale-110")}),y(C.href)&&e.jsx("div",{className:"absolute inset-0 bg-white/30 rounded-full blur-sm animate-pulse"})]}),e.jsx("span",{className:"relative z-10",children:C.name}),x&&(!o||d)&&e.jsx("div",{className:"ml-auto w-3 h-3 bg-gradient-to-br from-accent-400 to-accent-600 rounded-full animate-pulse shadow-lg"})]},C.name)}),e.jsx("div",{className:"pt-4 border-t border-white/30",children:d?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"glass px-4 py-3 rounded-2xl border border-white/50 text-center",children:e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"üëã Browsing as Guest"})}),e.jsxs(D,{variant:"premium",className:"w-full",onClick:()=>r(!0),children:[e.jsx(de,{className:"h-5 w-5 mr-2"}),"Sign In"]})]}):o&&c?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 px-6 py-4 glass-card border border-white/60",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-5 w-5 text-white"})}),e.jsx("div",{className:"status-online absolute -bottom-1 -right-1"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-base font-semibold text-gray-700",children:["@",c.username]}),c.is_admin&&e.jsxs("p",{className:"text-sm text-primary-600 font-medium flex items-center",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Admin"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>j("/chat?tab=private"),className:"flex items-center justify-center space-x-2 px-4 py-3 rounded-2xl text-secondary-700 hover:text-primary-600 hover:bg-white/80 transition-all duration-500 hover:scale-105 active:scale-95 relative",children:[e.jsx(Ke,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Messages"}),g>0&&e.jsx("div",{className:"absolute -top-1 -right-1 min-w-[20px] h-[20px] bg-gradient-to-br from-red-400 to-red-600 text-white text-xs rounded-full flex items-center justify-center px-1 animate-pulse shadow-lg",children:g>99?"99+":g})]}),c.is_admin&&e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center justify-center space-x-2 px-4 py-3 rounded-2xl text-secondary-700 hover:text-primary-600 hover:bg-white/80 transition-all duration-500 hover:scale-105 active:scale-95",children:[e.jsx(ke,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Admin"})]})]}),e.jsxs("button",{onClick:k,className:"w-full flex items-center justify-center space-x-2 px-6 py-4 rounded-2xl text-red-600 hover:text-red-700 hover:bg-red-50/80 transition-all duration-500 hover:scale-105 active:scale-95",children:[e.jsx(gs,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Sign Out"})]})]}):e.jsxs(D,{variant:"premium",className:"w-full",onClick:()=>r(!0),children:[e.jsx(de,{className:"h-5 w-5 mr-2"}),"Sign In"]})})]})})]}),e.jsx(us,{isOpen:a,onClose:()=>r(!1),onSuccess:()=>r(!1)}),(c==null?void 0:c.is_admin)&&e.jsx(ba,{isOpen:n,onClose:()=>i(!1)})]})},Ca=({className:s})=>e.jsxs("footer",{className:ge("relative bg-gradient-to-br from-secondary-900 via-secondary-800 to-primary-900 text-white overflow-hidden z-0",s),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary-500/10 via-transparent to-primary-500/10"}),e.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-primary-500/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-accent-500/5 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative max-w-7xl mx-auto py-16 px-4 sm:px-6 lg:px-8 pb-24 md:pb-16",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-12",children:[e.jsxs("div",{className:"col-span-1 md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 group",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"h-10 w-10 text-primary-400 group-hover:scale-110 transition-transform duration-300"}),e.jsx("div",{className:"absolute inset-0 bg-primary-500 rounded-full blur-lg opacity-0 group-hover:opacity-30 transition-opacity duration-300"})]}),e.jsx("span",{className:"font-display font-bold text-2xl text-gradient",children:"JU CONNECTS"}),e.jsx(Te,{className:"h-5 w-5 text-accent-400 animate-bounce-subtle"})]}),e.jsx("p",{className:"text-secondary-300 text-lg leading-relaxed max-w-md",children:"A premium platform for JECRC University students. Share knowledge, connect globally, and access thousands of educational resources in a beautiful, secure environment."}),e.jsxs("div",{className:"flex items-center space-x-2 text-secondary-400",children:[e.jsx("span",{children:"Crafted with"}),e.jsx(Pt,{className:"h-5 w-5 text-primary-400 animate-pulse"}),e.jsx("span",{children:"for students"}),e.jsx("div",{className:"flex space-x-1 ml-2",children:[...Array(5)].map((t,a)=>e.jsx(Je,{className:"h-4 w-4 text-accent-400 fill-current animate-bounce-subtle",style:{animationDelay:`${a*.1}s`}},a))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center space-x-2",children:[e.jsx("span",{children:"Quick Links"}),e.jsx("div",{className:"w-8 h-0.5 bg-gradient-to-r from-primary-500 to-transparent"})]}),e.jsx("ul",{className:"space-y-3",children:[{name:"Browse Content",href:"/",external:!1},{name:"Categories",href:"/categories",external:!1},{name:"Upload Content",href:"/upload",external:!1},{name:"Student Chat",href:"/chat",external:!1}].map(t=>e.jsx("li",{children:t.external?e.jsxs("a",{href:t.href,target:"_blank",rel:"noopener noreferrer",className:"text-secondary-300 hover:text-primary-400 transition-all duration-300 flex items-center space-x-2 group",children:[e.jsx("div",{className:"w-1 h-1 bg-primary-500 rounded-full group-hover:w-2 transition-all duration-300"}),e.jsx("span",{className:"group-hover:translate-x-1 transition-transform duration-300",children:t.name})]}):e.jsxs(ye,{to:t.href,className:"text-secondary-300 hover:text-primary-400 transition-all duration-300 flex items-center space-x-2 group",children:[e.jsx("div",{className:"w-1 h-1 bg-primary-500 rounded-full group-hover:w-2 transition-all duration-300"}),e.jsx("span",{className:"group-hover:translate-x-1 transition-transform duration-300",children:t.name})]})},t.name))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center space-x-2",children:[e.jsx("span",{children:"Support"}),e.jsx("div",{className:"w-8 h-0.5 bg-gradient-to-r from-primary-500 to-transparent"})]}),e.jsx("ul",{className:"space-y-3",children:[{name:"Help Center",href:"/help",external:!1},{name:"Privacy Policy",href:"/privacy",external:!1},{name:"Terms of Service",href:"/terms",external:!1},{name:"Contact Us",href:"/contact",external:!1}].map(t=>e.jsx("li",{children:t.external?e.jsxs("a",{href:t.href,target:"_blank",rel:"noopener noreferrer",className:"text-secondary-300 hover:text-primary-400 transition-all duration-300 flex items-center space-x-2 group",children:[e.jsx("div",{className:"w-1 h-1 bg-primary-500 rounded-full group-hover:w-2 transition-all duration-300"}),e.jsx("span",{className:"group-hover:translate-x-1 transition-transform duration-300",children:t.name})]}):e.jsxs(ye,{to:t.href,className:"text-secondary-300 hover:text-primary-400 transition-all duration-300 flex items-center space-x-2 group",children:[e.jsx("div",{className:"w-1 h-1 bg-primary-500 rounded-full group-hover:w-2 transition-all duration-300"}),e.jsx("span",{className:"group-hover:translate-x-1 transition-transform duration-300",children:t.name})]})},t.name))})]})]}),e.jsx("div",{className:"border-t border-secondary-700/50 pt-8 mt-12",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0",children:[e.jsx("p",{className:"text-secondary-400 text-sm",children:"¬© 2025 JU CONNECTS. All rights reserved. | Made by Pritam Ray (@impritamray@gmail.com)"}),e.jsx("div",{className:"flex items-center space-x-6",children:e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-gradient-to-r from-primary-500/20 to-primary-600/20 rounded-full border border-primary-500/30",children:[e.jsx("div",{className:"w-2 h-2 bg-success-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-secondary-300 font-medium",children:"v1.0.0"})]})})]})})]})]}),_a=({onAuthRequired:s})=>{const{user:t,isGuest:a}=me(),r=es(),{totalUnreadCount:n}=xs((t==null?void 0:t.id)||null),i=d=>d==="/chat"?r.pathname==="/chat":r.pathname===d,o=[{name:"Home",href:"/",icon:Tt,requiresAuth:!1},{name:"Categories",href:"/categories",icon:ce,requiresAuth:!1},{name:"Upload",href:"/upload",icon:Xe,requiresAuth:!0},{name:"Messages",href:"/chat",icon:Ke,requiresAuth:!0},{name:"Groups",href:"/groups",icon:_e,requiresAuth:!0}],c=(d,u)=>{u.requiresAuth&&(!t||a)&&(d.preventDefault(),s())};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 md:hidden bg-white/95 backdrop-blur-sm border-t border-secondary-200/50 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-around py-3 px-2 relative",children:[o.map((d,u)=>e.jsxs(ye,{to:d.href,onClick:m=>c(m,d),className:ge("flex flex-col items-center justify-center py-2 px-2 rounded-xl transition-all duration-300 relative group min-w-0 flex-1",i(d.href)?"text-primary-600 bg-primary-50":"text-secondary-500 hover:text-primary-500 hover:bg-secondary-50",u===2?"opacity-0 pointer-events-none":""),"aria-label":d.name,children:[e.jsxs("div",{className:"relative mb-1",children:[e.jsx(d.icon,{className:ge("h-5 w-5 transition-all duration-300",i(d.href)?"scale-110":"group-hover:scale-110")}),d.name==="Messages"&&n>0&&e.jsx("div",{className:"absolute -top-2 -right-2 min-w-[18px] h-[18px] bg-red-500 text-white text-xs rounded-full flex items-center justify-center px-1 animate-pulse",children:n>99?"99+":n}),d.requiresAuth&&(!t||a)&&e.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-accent-500 rounded-full animate-pulse border border-white"})]}),e.jsx("span",{className:ge("text-xs font-medium transition-all duration-300 text-center truncate",d.name.length>8?"text-2xs":"text-xs"),children:d.name})]},d.name)),e.jsx(ye,{to:"/upload",onClick:d=>c(d,{requiresAuth:!0}),className:"absolute left-1/2 top-0 transform -translate-x-1/2 -translate-y-1/4 z-10",children:e.jsx("div",{className:"w-14 h-14 bg-red-500 rounded-full shadow-lg flex items-center justify-center hover:bg-red-600 transition-all duration-300 hover:scale-110 active:scale-95",children:e.jsx("div",{className:"w-8 h-8 bg-white rounded-full flex items-center justify-center",children:e.jsx(Xe,{className:"text-red-500 w-5 h-5"})})})})]})})})},Sa=({children:s})=>{const[t,a]=l.useState(!1),r=es();return l.useEffect(()=>{a(!0),window.scrollTo({top:0,behavior:"instant"});const n=setTimeout(()=>{a(!1)},100);return()=>clearTimeout(n)},[r.pathname]),t?e.jsx("div",{className:"fixed inset-0 z-50 bg-white flex items-center justify-center",children:e.jsx(Z,{size:"lg"})}):e.jsx(e.Fragment,{children:s})},We=({children:s,fallback:t,pageName:a="this feature"})=>{const{user:r,isGuest:n,loading:i}=me();return i?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):r&&!n?e.jsx(e.Fragment,{children:s}):t?e.jsx(e.Fragment,{children:t}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(ze,{className:"h-8 w-8 text-primary-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Authentication Required"}),e.jsxs("p",{className:"text-gray-600",children:["You need to be logged in to access ",a,". Please sign in or create an account to continue."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(D,{onClick:()=>{const o=new CustomEvent("openAuthModal",{detail:{mode:"login"}});window.dispatchEvent(o)},className:"flex items-center justify-center space-x-2",variant:"primary",children:[e.jsx(Mt,{className:"h-4 w-4"}),e.jsx("span",{children:"Sign In"})]}),e.jsxs(D,{onClick:()=>{const o=new CustomEvent("openAuthModal",{detail:{mode:"signup"}});window.dispatchEvent(o)},className:"flex items-center justify-center space-x-2",variant:"outline",children:[e.jsx(Js,{className:"h-4 w-4"}),e.jsx("span",{children:"Sign Up"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"or"})})]}),e.jsx(D,{onClick:()=>{window.location.href="/"},variant:"ghost",className:"w-full",children:"Return to Home"})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-500",children:e.jsx("strong",{children:"Available Features for Guests:"})}),e.jsxs("ul",{className:"text-sm text-gray-500 mt-2 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Browse public content"}),e.jsx("li",{children:"‚Ä¢ View help center"}),e.jsx("li",{children:"‚Ä¢ Contact support"})]})]})]})})},ka="/assets/slide1-Bs0a-rFc.jpg",Ea="/assets/slide2-hEhGsOcv.jpg",Pa="/assets/slide3-BuwYLEvl.jpg",Ta="/assets/slide4-BSNdurEF.jpg",Ma="/assets/slide5-CAVaPhPx.jpg",Ra="/assets/slide6-DkMIzLmR.jpg";class Aa{constructor(){Q(this,"cache",new Map);Q(this,"DEFAULT_TTL",3e4);Q(this,"MAX_CACHE_SIZE",100);Q(this,"pendingRequests",new Map)}generateKey(t,a){const r=a?JSON.stringify(a):"";return`${t}${r}`}async get(t){const a=this.cache.get(t);return a?Date.now()>a.timestamp+a.expiry?(this.cache.delete(t),null):a.data:null}set(t,a,r=this.DEFAULT_TTL){if(this.cache.size>=this.MAX_CACHE_SIZE){const n=Array.from(this.cache.entries());n.sort((i,o)=>i[1].timestamp-o[1].timestamp),n.slice(0,10).forEach(([i])=>this.cache.delete(i))}this.cache.set(t,{data:a,timestamp:Date.now(),expiry:r})}async getOrFetch(t,a,r=this.DEFAULT_TTL){const n=await this.get(t);if(n!==null)return n;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const i=a().then(o=>(this.set(t,o,r),this.pendingRequests.delete(t),o)).catch(o=>{throw this.pendingRequests.delete(t),o});return this.pendingRequests.set(t,i),i}clear(){this.cache.clear(),this.pendingRequests.clear()}invalidate(t){const a=[];for(const[r]of this.cache)r.includes(t)&&a.push(r);a.forEach(r=>this.cache.delete(r))}getStats(){return{cacheSize:this.cache.size,pendingRequests:this.pendingRequests.size}}}const os=new Aa;setInterval(()=>{os.getStats().cacheSize>0&&os.clear()},300*1e3);const as=async(s,t,a,r=20,n=0)=>{if(!pe())return console.warn("Supabase is not configured. Returning empty content list."),[];const i=os.generateKey("approved_content",{contentType:s,categoryId:t,searchQuery:a,limit:r,offset:n});return os.getOrFetch(i,async()=>{var o;try{if(!f)return console.warn("Supabase client is not available"),[];let c=f.from("content").select(`
          *,
          categories (
            id,
            name,
            slug
          ),
          profiles (
            id,
            username,
          full_name
        )
      `).eq("is_approved",!0).order("created_at",{ascending:!1}).range(n,n+r-1);if(s&&(c=c.eq("content_type",s)),t&&(c=c.eq("category_id",t)),a){const m=`%${a.trim()}%`;c=c.or(`title.ilike.${m},description.ilike.${m}`)}const{data:d,error:u}=await c;if(u)throw u;return d||[]}catch(c){throw console.error("Failed to fetch content:",c),(o=c.message)!=null&&o.includes("Failed to fetch")||c.name==="TypeError"?new Error("Connection problem. Please check your internet."):new Error("Could not load content. Please try again.")}},3e4)},Ua=async s=>{const{data:t,error:a}=await f.from("content").insert([s]).select().single();if(a)throw a;return t},qa=async s=>{const{error:t}=await f.rpc("increment_view_count",{content_id:s});if(t){const{data:a}=await f.from("content").select("view_count").eq("id",s).single();a&&await f.from("content").update({view_count:(a.view_count||0)+1}).eq("id",s)}},Ia=async()=>{if(!pe())return{total:0,approved:0,pending:0,byType:{question_paper:0,notes:0,syllabus:0,educational_link:0,assignments:0}};try{const{data:s,error:t}=await f.from("content").select("content_type, is_approved");if(t)throw t;return{total:s.length,approved:s.filter(r=>r.is_approved).length,pending:s.filter(r=>!r.is_approved).length,byType:{question_paper:s.filter(r=>r.content_type==="question_paper").length,notes:s.filter(r=>r.content_type==="notes").length,syllabus:s.filter(r=>r.content_type==="syllabus").length,educational_link:s.filter(r=>r.content_type==="educational_link").length,assignments:s.filter(r=>r.content_type==="assignments").length}}}catch(s){return console.error("Failed to fetch content stats:",s),{totalContent:0,totalCategories:0,totalUsers:0,recentUploads:0}}},Cs=async()=>{var s;if(!pe())return console.warn("Supabase is not configured. Returning empty categories list."),[];try{const{data:t,error:a}=await f.from("categories").select("*").order("name");if(a)throw a;const r=new Map,n=[];return t.forEach(i=>{r.set(i.id,{...i,children:[]})}),t.forEach(i=>{const o=r.get(i.id);if(i.parent_id){const c=r.get(i.parent_id);c&&(c.children=c.children||[],c.children.push(o),o.parent=c)}else n.push(o)}),n}catch(t){throw logger.error("Failed to fetch categories:",t),(s=t.message)!=null&&s.includes("Failed to fetch")||t.name==="TypeError"?new Error("Connection problem. Please check your internet."):new Error("Could not load categories. Please try again.")}},Fa=async(s,t,a)=>{const r=s.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),{data:n}=await f.from("categories").select("id").eq("slug",r).single();if(n)throw new Error("A category with this name already exists");const i={name:s.trim(),slug:r,description:(t==null?void 0:t.trim())||null,parent_id:a||null},{data:o,error:c}=await f.from("categories").insert([i]).select().single();if(c)throw c;return o},Is=async()=>{const s=await Cs(),{data:t,error:a}=await f.from("content").select("category_id").eq("is_approved",!0);if(a)throw a;const r=new Map;t.forEach(i=>{i.category_id&&r.set(i.category_id,(r.get(i.category_id)||0)+1)});const n=i=>i.map(o=>({...o,content_count:r.get(o.id)||0,children:o.children?n(o.children):[]}));return n(s)},Ie=class Ie{constructor(){Q(this,"initialized",!1);Q(this,"initializing",!1);Q(this,"components",new Set)}static getInstance(){return Ie.instance||(Ie.instance=new Ie),Ie.instance}markComponentMounted(t){return this.components.has(t)?(console.log(`‚ö†Ô∏è Component ${t} already mounted, preventing duplicate mount`),!1):(this.components.add(t),console.log(`‚úÖ Component ${t} mounted`),!0)}markComponentUnmounted(t){this.components.delete(t),console.log(`‚ùå Component ${t} unmounted`)}setInitialized(){this.initialized=!0,this.initializing=!1,console.log("üéØ App fully initialized")}setInitializing(){this.initializing=!0,console.log("‚è≥ App initializing...")}isInitialized(){return this.initialized}isInitializing(){return this.initializing}getMountedComponents(){return Array.from(this.components)}reset(){this.initialized=!1,this.initializing=!1,this.components.clear(),console.log("üîÑ App state reset")}};Q(Ie,"instance");let bs=Ie;const js=bs.getInstance();typeof window<"u"&&(window.appState=js);const _s=({content:s,onClick:t,showUploader:a=!1,showReportButton:r=!0})=>{const{user:n,isGuest:i}=me(),o=p=>{switch(p){case"question_paper":return e.jsx(ce,{className:"h-5 w-5"});case"notes":return e.jsx(ce,{className:"h-5 w-5"});case"syllabus":return e.jsx(ce,{className:"h-5 w-5"});default:return e.jsx(ce,{className:"h-5 w-5"})}},c=p=>{switch(p){case"question_paper":return"Question Paper";case"notes":return"Notes";case"syllabus":return"Syllabus";case"assignments":return"Assignments";case"other":return"Other";default:return p}},d=p=>{switch(p){case"question_paper":return"primary";case"notes":return"secondary";case"syllabus":return"warning";case"assignments":return"success";case"other":return"neutral";default:return"neutral"}},u=p=>{if(!p)return"";const j=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(p)/Math.log(1024));return Math.round(p/Math.pow(1024,g)*100)/100+" "+j[g]},m=async p=>{if(p.stopPropagation(),!n||i){alert("Please sign in to report content");return}const j=prompt("Please specify the reason for reporting this content:");if(!j)return;const g=prompt("Additional details (optional):");try{await ua(s.id,n.id,j.trim(),g==null?void 0:g.trim()),alert("Content reported successfully. Our moderators will review it.")}catch(y){alert(y.message||"Failed to report content")}};return e.jsxs("div",{className:"card-premium p-4 md:p-6 cursor-pointer group relative overflow-hidden",onClick:t,children:[e.jsx("div",{className:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx(Te,{className:"h-4 w-4 text-accent-500 animate-bounce-subtle"})}),e.jsxs("div",{className:"flex items-start justify-between mb-4 md:mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 bg-gradient-to-br from-primary-500 to-primary-600 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300",children:o(s.content_type)}),e.jsx(re,{variant:d(s.content_type),glow:!0,children:c(s.content_type)})]}),e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-3 text-sm text-secondary-500",children:[r&&e.jsx("button",{onClick:m,className:"opacity-0 group-hover:opacity-100 transition-all duration-300 p-1 md:p-2 hover:text-red-600 hover:bg-red-50 rounded-lg hover:scale-110",title:"Report content",children:e.jsx(Vs,{className:"h-3 w-3 md:h-4 md:w-4"})}),s.view_count>0&&e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 bg-secondary-100 rounded-lg text-xs",children:[e.jsx(Ue,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:s.view_count})]})]})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h3",{className:"font-bold text-secondary-900 text-lg md:text-xl mb-2 md:mb-3 group-hover:text-primary-600 transition-colors duration-300 line-clamp-2",children:s.title}),s.description&&e.jsx("p",{className:"text-secondary-600 text-xs md:text-sm line-clamp-2 md:line-clamp-3 leading-relaxed",children:s.description})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 md:mb-6",children:[s.categories&&e.jsx(re,{variant:"neutral",size:"sm",children:s.categories.name}),s.year&&e.jsxs(re,{variant:"neutral",size:"sm",children:["Year: ",s.year]}),s.semester&&e.jsxs(re,{variant:"neutral",size:"sm",children:["Sem: ",s.semester]})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsxs("div",{className:"flex items-center space-x-2 flex-wrap gap-2",children:[e.jsx(Hs,{className:"h-3 w-3 text-secondary-400 hidden sm:block"}),s.tags.slice(0,2).map((p,j)=>e.jsx("span",{className:"text-xs text-secondary-600 bg-secondary-100 px-2 py-1 rounded-full font-medium truncate max-w-20 sm:max-w-none",children:p},j)),s.tags.length>2&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",s.tags.length-2," more"]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between text-sm text-secondary-500 pt-4 md:pt-6 border-t border-secondary-100 space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm",children:[e.jsx(vs,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx("span",{className:"font-medium truncate",children:Ce(new Date(s.created_at),{addSuffix:!0})})]}),a&&s.profiles&&e.jsxs("div",{className:"flex items-center space-x-2 px-2 py-1 bg-secondary-100 rounded-lg text-xs",children:[e.jsx(de,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsxs("span",{className:"font-medium truncate max-w-24 sm:max-w-none",children:["@",s.profiles.username]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-3 self-end sm:self-auto",children:[s.file_size&&e.jsx("span",{className:"text-xs bg-secondary-100 px-2 py-1 rounded-full font-medium whitespace-nowrap",children:u(s.file_size)}),s.file_url&&e.jsx("div",{className:"w-6 h-6 md:w-8 md:h-8 bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-all duration-300 hover:scale-110",children:e.jsx(Ns,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-br from-primary-500/5 via-transparent to-primary-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"})]})]})},Ss=({content:s,isOpen:t,onClose:a})=>{const[r,n]=l.useState(!1);if(l.useEffect(()=>{s&&t&&!r&&(qa(s.id).catch(console.error),n(!0))},[s,t,r]),l.useEffect(()=>{t||n(!1)},[t]),!s)return null;const i=m=>{switch(m){case"question_paper":return"Question Paper";case"notes":return"Notes";case"syllabus":return"Syllabus";case"assignments":return"Assignments";case"other":return"Other";default:return m}},o=m=>{switch(m){case"question_paper":return"primary";case"notes":return"secondary";case"syllabus":return"warning";case"assignments":return"success";case"other":return"neutral";default:return"neutral"}},c=m=>{if(!m)return"";const p=["Bytes","KB","MB","GB"],j=Math.floor(Math.log(m)/Math.log(1024));return Math.round(m/Math.pow(1024,j)*100)/100+" "+p[j]},d=()=>{s.file_url&&window.open(s.file_url,"_blank")},u=()=>{s.external_url&&window.open(s.external_url,"_blank")};return e.jsx(Pe,{isOpen:t,onClose:a,size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row items-start justify-between space-y-4 md:space-y-0",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(re,{variant:o(s.content_type),children:i(s.content_type)}),s.categories&&e.jsx(re,{variant:"neutral",children:s.categories.name})]}),e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:s.description})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 p-3 md:p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm text-gray-600",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:Ce(new Date(s.created_at),{addSuffix:!0})})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm text-gray-600",children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.view_count," views"]})]}),s.profiles&&e.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm text-gray-600 col-span-2 lg:col-span-1",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{className:"truncate",children:["@",s.profiles.username]})]}),s.file_size&&e.jsxs("div",{className:"text-xs md:text-sm text-gray-600",children:["Size: ",c(s.file_size)]})]}),(s.year||s.semester)&&e.jsxs("div",{className:"flex items-center space-x-4",children:[s.year&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Year:"}),e.jsx(re,{variant:"neutral",children:s.year})]}),s.semester&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Semester:"}),e.jsx(re,{variant:"neutral",children:s.semester})]})]}),s.tags&&s.tags.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Hs,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tags:"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map((m,p)=>e.jsx("span",{className:"text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full",children:m},p))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between pt-4 border-t border-gray-200 space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"text-xs md:text-sm text-gray-500",children:["Content ID: ",s.id.split("-")[0],"..."]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-3 w-full sm:w-auto",children:[s.external_url&&e.jsxs(D,{onClick:u,variant:"outline",size:"sm",className:"flex items-center justify-center space-x-2 w-full sm:w-auto",children:[e.jsx(Rt,{className:"h-4 w-4"}),e.jsx("span",{children:"Open Link"})]}),s.file_url&&e.jsxs(D,{onClick:d,size:"sm",className:"flex items-center justify-center space-x-2 w-full sm:w-auto",children:[e.jsx(Ns,{className:"h-4 w-4"}),e.jsx("span",{children:"Download"})]})]})]}),s.file_url&&s.file_type&&["jpg","png"].includes(s.file_type)&&e.jsx("div",{className:"border rounded-lg overflow-hidden mt-4",children:e.jsx("img",{src:s.file_url,alt:s.title,className:"w-full h-auto max-h-64 md:max-h-96 object-contain"})})]})})},Da=()=>e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Qe,{className:"h-5 w-5 text-yellow-400"})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-yellow-700",children:[e.jsx("strong",{children:"Demo Mode:"})," This app is running in demo mode without a backend connection. Some features may not work as expected."]})})]})}),za=()=>{var ie,oe,te;const{user:s,isGuest:t}=me(),[a,r]=l.useState([]),[n,i]=l.useState([]),[o,c]=l.useState(!0),[d,u]=l.useState(""),[m,p]=l.useState(""),[j,g]=l.useState(""),[y,T]=l.useState(""),[k,v]=l.useState(null),[C,x]=l.useState(!1),[w,M]=l.useState(!1),[b,h]=l.useState(null),[P,R]=l.useState(!1),L=rs.useMemo(()=>{try{const $=Object.values(Object.assign({"../assets/hero/slide1.jpg":ka,"../assets/hero/slide2.jpg":Ea,"../assets/hero/slide3.jpg":Pa,"../assets/hero/slide4.jpg":Ta,"../assets/hero/slide5.jpg":Ma,"../assets/hero/slide6.jpg":Ra}));return $.length>0?$:[]}catch(U){return console.warn("Failed to load hero images:",U),[]}},[]),[N,B]=l.useState(0),[X,G]=l.useState(!1),W=l.useRef(null),ne=U=>B((U+L.length)%L.length),E=()=>{G(!0),W.current&&clearTimeout(W.current),W.current=setTimeout(()=>G(!1),8e3)},A=()=>{L.length!==0&&(ne(N+1),E())},ee=()=>{L.length!==0&&(ne(N-1),E())};l.useEffect(()=>{if(L.length===0||X)return;const U=setInterval(()=>{B($=>($+1)%L.length)},4e3);return()=>clearInterval(U)},[L.length,X]),l.useEffect(()=>()=>{W.current&&clearTimeout(W.current)},[]);const ue=[{value:"",label:"All Types",icon:"üìö"},{value:"question_paper",label:"Question Papers",icon:"üìù"},{value:"notes",label:"Study Notes",icon:"üìñ"},{value:"syllabus",label:"Syllabus",icon:"üìã"},{value:"assignments",label:"Assignments",icon:"üìÑ"},{value:"other",label:"Other",icon:"üìÑ"}];l.useEffect(()=>js.markComponentMounted("HomePage")?((async()=>{if(R(!1),!pe()){console.log("Supabase not configured, showing demo content"),R(!0),c(!1);return}try{const[$,q,Y]=await Promise.all([as(),Cs(),Ia()]);r($),i(q),h(Y),R(!1)}catch($){console.error("Failed to fetch data:",$),R(!0)}finally{c(!1)}})(),()=>{js.markComponentUnmounted("HomePage")}):void 0,[]),l.useEffect(()=>{(d||j||y)&&(async()=>{if(pe()){c(!0);try{const $=await as(y,j,d);r($)}catch($){console.error("Failed to fetch filtered content:",$),R(!0)}finally{c(!1)}}})()},[d,j,y]),l.useEffect(()=>{!d&&!j&&!y&&(async()=>{if(pe())try{const $=await as();r($)}catch($){console.error("Failed to fetch content:",$)}})()},[d,j,y]);const xe=U=>{v(U),x(!0)},V=()=>{(m.trim().length>=2||m.trim().length===0)&&u(m.trim())},J=U=>{p(U),U.trim()===""&&u("")},O=(U,$=0)=>U.map(q=>e.jsxs(rs.Fragment,{children:[e.jsxs("option",{value:q.id,children:["  ".repeat($),q.name]}),q.children&&O(q.children,$+1)]},q.id));return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-secondary-50 via-white to-primary-50",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx(Z,{size:"xl",text:"Loading content..."}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-secondary-600",children:[e.jsx(Te,{className:"h-5 w-5 animate-bounce-subtle"}),e.jsx("span",{className:"font-medium",children:"Preparing your experience"}),e.jsx(Te,{className:"h-5 w-5 animate-bounce-subtle"})]})]})}):P?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-secondary-50 via-white to-primary-50 flex items-center justify-center",children:e.jsx("div",{className:"max-w-md mx-auto text-center p-6",children:e.jsxs("div",{className:"card-premium p-12",children:[e.jsx("div",{className:"text-primary-500 mb-6",children:e.jsx(ke,{className:"h-20 w-20 mx-auto animate-bounce-subtle"})}),e.jsx("h2",{className:"text-2xl font-bold text-secondary-900 mb-4 text-gradient",children:"Connection Issue"}),e.jsx("p",{className:"text-secondary-600 mb-6 leading-relaxed",children:"We're having trouble connecting to our servers. This might be due to:"}),e.jsxs("ul",{className:"text-left text-sm text-secondary-600 mb-8 space-y-2",children:[e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{children:"Network connectivity issues"})]}),e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{children:"Server configuration problems"})]}),e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{children:"Missing environment variables"})]})]}),e.jsx(D,{onClick:()=>window.location.reload(),variant:"premium",size:"lg",className:"w-full",children:"Try Again"})]})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-secondary-50 via-white to-primary-50 mesh-bg",children:[!pe()&&e.jsx(Da,{}),e.jsxs("div",{className:"hero-gradient text-white relative overflow-hidden min-h-[35vh] sm:min-h-[30vh] md:min-h-[28vh] lg:min-h-[25vh] flex items-center",onMouseEnter:()=>G(!0),onMouseLeave:()=>G(!1),children:[e.jsxs("div",{className:"absolute inset-0 -z-0 overflow-hidden",children:[L.length>0?e.jsx("div",{className:"flex h-full transition-transform duration-700 ease-out",style:{transform:`translateX(-${N*100}%)`},children:L.map((U,$)=>e.jsx("div",{className:"w-full h-full flex-shrink-0",children:e.jsx("img",{src:U,alt:`Hero ${$+1}`,className:"w-full h-full object-cover",draggable:!1})},$))}):e.jsx("div",{className:"w-full h-full"}),e.jsx("div",{className:"absolute inset-0 bg-red-600/40 mix-blend-multiply"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/25 via-transparent to-black/25"})]}),e.jsx("div",{className:"absolute top-0 left-1/4 w-48 sm:w-72 md:w-96 h-48 sm:h-72 md:h-96 bg-white/10 rounded-full blur-3xl animate-float pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-48 sm:w-72 md:w-96 h-48 sm:h-72 md:h-96 bg-white/5 rounded-full blur-3xl animate-float pointer-events-none",style:{animationDelay:"2s"}}),e.jsx("div",{className:"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 md:py-8 w-full",children:e.jsxs("div",{className:"text-center space-y-3 sm:space-y-4 md:space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 sm:space-x-3 mb-3 sm:mb-4",children:[e.jsx(Te,{className:"h-5 w-5 sm:h-6 sm:w-6 text-accent-400 animate-bounce-subtle"}),e.jsx(re,{variant:"premium",size:"lg",glow:!0,pulse:!0,children:"The JECRC App"}),e.jsx(Te,{className:"h-5 w-5 sm:h-6 sm:w-6 text-accent-400 animate-bounce-subtle"})]}),e.jsxs("h1",{className:"text-xl sm:text-3xl md:text-4xl lg:text-5xl font-display font-bold mb-3 sm:mb-4 md:mb-5 animate-fade-in-up",children:[e.jsx("span",{className:"block text-white text-shadow-lg",children:"JU CONNECTS"}),e.jsx("span",{className:"block text-xs sm:text-base md:text-lg lg:text-xl font-medium text-white/90 mt-1 sm:mt-2",children:"Resource Hub"})]}),e.jsx("p",{className:"text-xs sm:text-sm md:text-base lg:text-lg mb-4 sm:mb-5 md:mb-6 max-w-3xl mx-auto text-white/90 leading-relaxed animate-fade-in-up px-2 sm:px-4",style:{animationDelay:"0.2s"},children:"Access all the study materials, PYQ'S, Notes and many more. Connect with fellow students, and elevate your academic journey with this platform"}),b&&e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3 md:gap-4 max-w-3xl mx-auto animate-fade-in-up px-2 sm:px-4",style:{animationDelay:"0.4s"},children:[{label:"Resources Available",value:b.approved,icon:Ge},{label:"Question Papers",value:b.byType.question_paper,icon:ce},{label:"Study Notes",value:b.byType.notes,icon:Ws},{label:"Subject Areas",value:n.length,icon:_e}].map(U=>e.jsxs("div",{className:"glass p-2 sm:p-3 md:p-4 rounded-lg sm:rounded-xl text-center group hover:scale-105 transition-all duration-300",children:[e.jsx(U.icon,{className:"h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 text-accent-400 mx-auto mb-1 sm:mb-2 group-hover:scale-110 transition-transform duration-300"}),e.jsx("div",{className:"text-sm sm:text-lg md:text-xl font-bold text-white mb-1",children:U.value}),e.jsx("div",{className:"text-2xs sm:text-xs text-white/80 font-medium leading-tight",children:U.label})]},U.label))}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center space-y-2 sm:space-y-0 sm:space-x-3 md:space-x-4 animate-fade-in-up px-2 sm:px-4",style:{animationDelay:"0.6s"},children:[e.jsxs(D,{size:"lg",variant:"secondary",className:"bg-white/30 backdrop-blur-none border-white/30 text-white hover:bg-white/40 w-full sm:w-auto",onClick:()=>{var U;return(U=document.getElementById("content-section"))==null?void 0:U.scrollIntoView({behavior:"smooth"})},children:[e.jsx(At,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5"}),"Explore Content"]}),(!s||t)&&e.jsxs(D,{size:"lg",variant:"outline",className:"border-white/50 text-white hover:bg-white hover:text-primary-600 w-full sm:w-auto",onClick:()=>M(!0),children:[e.jsx(Je,{className:"mr-2 h-5 w-5"}),"Join JU CONNECTS"]})]})]})}),L.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{"aria-label":"Previous",onClick:ee,className:"absolute left-3 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-black/50 hover:bg-black/70 text-white backdrop-blur-none",children:"‚Äπ"}),e.jsx("button",{"aria-label":"Next",onClick:A,className:"absolute right-3 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-black/50 hover:bg-black/70 text-white backdrop-blur-none",children:"‚Ä∫"}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-10 hidden sm:flex items-center gap-1",children:L.map((U,$)=>e.jsx("button",{"aria-label":`Go to slide ${$+1}`,onClick:()=>{ne($),E()},className:`h-1.5 w-1.5 rounded-full transition-all duration-300 ${N===$?"bg-red-500 scale-125":"bg-white/60 hover:bg-white/90 hover:scale-110"}`},$))})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 md:py-12",id:"content-section",children:[e.jsxs("div",{className:"card-premium p-4 sm:p-6 md:p-8 mb-8 sm:mb-12 animate-fade-in-up",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-secondary-900 mb-2 text-gradient",children:"Find Your Perfect Study Material"}),e.jsx("p",{className:"text-sm sm:text-base text-secondary-600",children:"Use our advanced filters to discover exactly what you need"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 order-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative group flex-1",children:[e.jsx(De,{className:"absolute left-3 sm:left-4 top-3 sm:top-4 h-4 w-4 sm:h-5 sm:w-5 text-secondary-400 group-focus-within:text-primary-500 transition-colors duration-300"}),e.jsx("input",{type:"text",placeholder:"Search resources, notes, question papers...",value:m,onChange:U=>J(U.target.value),className:"input-premium pl-10 sm:pl-12 pr-3 sm:pr-4 text-base sm:text-lg w-full h-12 sm:h-14",onKeyDown:U=>{U.key==="Enter"&&(V(),U.currentTarget.blur())}}),e.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-primary-500/10 to-primary-600/10 opacity-0 group-focus-within:opacity-100 transition-opacity duration-300 pointer-events-none"})]}),e.jsxs(D,{onClick:V,variant:"premium",size:"lg",className:"px-4 sm:px-6 flex items-center justify-center gap-2 h-12 sm:h-14 w-full sm:w-auto",disabled:m.trim().length>0&&m.trim().length<2,children:[e.jsx(De,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{children:"Search"})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-xs text-secondary-500",children:"üí° Type your search terms and click the Search button or press Enter"})})]}),e.jsx("div",{className:"order-3 lg:order-2",children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:j,onChange:U=>g(U.target.value),className:"input-premium appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"üìö All Categories"}),O(n)]}),e.jsx(fs,{className:"absolute right-4 top-4 h-5 w-5 text-secondary-400 pointer-events-none"})]})}),e.jsx("div",{className:"order-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:y,onChange:U=>T(U.target.value),className:"input-premium appearance-none cursor-pointer",children:ue.map(U=>e.jsxs("option",{value:U.value,children:[U.icon," ",U.label]},U.value))}),e.jsx(fs,{className:"absolute right-4 top-4 h-5 w-5 text-secondary-400 pointer-events-none"})]})})]}),(d||j||y)&&e.jsxs("div",{className:"mt-6 flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-secondary-600",children:"Active filters:"}),d&&e.jsxs(re,{variant:"premium",className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-3 w-3"}),'"',d,'"',e.jsx("button",{onClick:()=>{u(""),p("")},className:"ml-1 hover:text-red-500 transition-colors",title:"Remove search filter",children:"‚úï"})]}),j&&e.jsxs(re,{variant:"premium",className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-3 w-3"}),(ie=n.find(U=>U.id===j))==null?void 0:ie.name,e.jsx("button",{onClick:()=>g(""),className:"ml-1 hover:text-red-500 transition-colors",title:"Remove category filter",children:"‚úï"})]}),y&&e.jsxs(re,{variant:"premium",className:"flex items-center gap-2",children:[(oe=ue.find(U=>U.value===y))==null?void 0:oe.icon,(te=ue.find(U=>U.value===y))==null?void 0:te.label,e.jsx("button",{onClick:()=>T(""),className:"ml-1 hover:text-red-500 transition-colors",title:"Remove type filter",children:"‚úï"})]}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{u(""),p(""),g(""),T("")},className:"text-secondary-500 hover:text-primary-600",children:"Clear all filters"})]})]}),e.jsxs("div",{className:"mb-8 flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-secondary-900 text-gradient",children:d||j||y?"Filtered Results":"All Resources"}),e.jsxs("p",{className:"text-secondary-600",children:[a.length," ",a.length===1?"resource":"resources"," found",(d||j||y)&&e.jsx("span",{className:"text-primary-600 font-medium",children:" matching your criteria"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(re,{variant:"premium",glow:!0,children:[e.jsx(Te,{className:"w-3 h-3 mr-1"}),"Enjoy"]})})]}),a.length===0?e.jsx("div",{className:"text-center py-12 md:py-20",children:e.jsxs("div",{className:"card-premium p-12 max-w-md mx-auto",children:[e.jsx(Ge,{className:"h-20 w-20 text-secondary-300 mx-auto mb-6 animate-bounce-subtle"}),d||j||y?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-semibold text-secondary-900 mb-4",children:"No matching resources found"}),e.jsx("p",{className:"text-secondary-600 mb-6",children:"No resources match your current search criteria. Try:"}),e.jsxs("ul",{className:"text-sm text-secondary-600 mb-6 text-left space-y-2",children:[e.jsx("li",{children:"‚Ä¢ Using different keywords"}),e.jsx("li",{children:"‚Ä¢ Checking your spelling"}),e.jsx("li",{children:"‚Ä¢ Selecting a different category"}),e.jsx("li",{children:"‚Ä¢ Browsing all content types"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-semibold text-secondary-900 mb-4",children:"No resources available"}),e.jsx("p",{className:"text-secondary-600 mb-6",children:"There are currently no approved resources in the database."})]}),e.jsx(D,{variant:"premium",onClick:()=>{u(""),p(""),g(""),T("")},children:d||j||y?"Clear Filters":"Refresh"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6 lg:gap-8 animate-fade-in-up",children:a.map((U,$)=>e.jsx("div",{className:"animate-fade-in-up w-full",style:{animationDelay:`${$*.1}s`},children:e.jsx(_s,{content:U,onClick:()=>xe(U),showUploader:!0})},U.id))}),e.jsxs("div",{className:"mt-8 sm:mt-12 lg:mt-16 xl:mt-20",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8 lg:mb-12",children:[e.jsx("h3",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-secondary-900 mb-2 sm:mb-4 text-gradient",children:"Browse by Subject"}),e.jsx("p",{className:"text-secondary-600 text-sm sm:text-base lg:text-lg px-4",children:"Explore our carefully organized subject categories"})]}),e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3 sm:gap-4 lg:gap-6",children:n.slice(0,8).map((U,$)=>e.jsxs("button",{onClick:()=>g(U.id),className:"card-premium p-3 sm:p-4 lg:p-6 text-left group hover:scale-105 transition-all duration-300 animate-fade-in-up",style:{animationDelay:`${$*.1}s`},children:[e.jsxs("div",{className:"flex flex-col items-center space-y-2 sm:space-y-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 bg-gradient-to-br from-primary-500 to-primary-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300",children:e.jsx(ce,{className:"h-4 w-4 sm:h-5 sm:w-5 lg:h-6 lg:w-6 text-white"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"font-semibold text-xs sm:text-sm lg:text-base text-secondary-900 group-hover:text-primary-600 transition-colors duration-300 line-clamp-2",children:U.name}),U.description&&e.jsx("div",{className:"text-xs text-secondary-500 mt-1 line-clamp-1 hidden sm:block",children:U.description})]})]}),e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-br from-primary-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]},U.id))})]}),e.jsx(Ss,{content:k,isOpen:C,onClose:()=>{x(!1),v(null)}}),e.jsx(us,{isOpen:w,onClose:()=>M(!1),onSuccess:()=>M(!1)})]})]})},Ga=({onSuccess:s})=>{const[t,a]=l.useState(!1),[r,n]=l.useState(!1),[i,o]=l.useState(!1),[c,d]=l.useState(""),{forceRefreshProfile:u}=me(),[m,p]=l.useState({email:"",password:"",fullName:"",username:"",mobileNumber:""}),[j,g]=l.useState({}),y=()=>{const v={};return m.email?/\S+@\S+\.\S+/.test(m.email)||(v.email="Please enter a valid email"):v.email="Email is required",m.password?m.password.length<6&&(v.password="Password must be at least 6 characters"):v.password="Password is required",t&&(m.fullName||(v.fullName="Full name is required"),m.username?m.username.length<3?v.username="Username must be at least 3 characters":/^[a-zA-Z0-9_]+$/.test(m.username)||(v.username="Username can only contain letters, numbers, and underscores"):v.username="Username is required",m.mobileNumber?/^\+?[\d\s-()]{10,}$/.test(m.mobileNumber)||(v.mobileNumber="Please enter a valid mobile number"):v.mobileNumber="Mobile number is required"),g(v),Object.keys(v).length===0},T=async v=>{if(v.preventDefault(),d(""),!!y()){o(!0);try{t?await et(m.email,m.password,m.fullName,m.username,m.mobileNumber):await st(m.email,m.password),await new Promise(C=>setTimeout(C,1e3)),window.location.reload()}catch(C){const x=C.message||"Something went wrong. Please try again.";d(x)}finally{o(!1)}}},k=v=>{const{name:C,value:x}=v.target;p(w=>({...w,[C]:x})),j[C]&&g(w=>({...w,[C]:""}))};return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:t?"Create Account":"Sign In"}),e.jsx("p",{className:"mt-2 text-gray-600",children:t?"Join our exam preparation community":"Welcome back to JU CONNECTS"})]}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[c&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200",children:c}),t&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{name:"fullName",label:"Full Name",value:m.fullName,onChange:k,error:j.fullName,placeholder:"Enter your full name",disabled:i}),e.jsx(ae,{name:"username",label:"Username",value:m.username,onChange:k,error:j.username,placeholder:"Choose a unique username",disabled:i,helpText:"This will be displayed publicly"}),e.jsx(ae,{name:"mobileNumber",label:"Mobile Number",type:"tel",value:m.mobileNumber,onChange:k,error:j.mobileNumber,placeholder:"Enter your mobile number",disabled:i})]}),e.jsx(ae,{name:"email",label:"Email Address",type:"email",value:m.email,onChange:k,error:j.email,placeholder:"Enter your email",disabled:i}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{name:"password",label:"Password",type:r?"text":"password",value:m.password,onChange:k,error:j.password,placeholder:"Enter your password",disabled:i}),e.jsx("button",{type:"button",onClick:()=>n(!r),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600",children:r?e.jsx(ms,{className:"h-5 w-5"}):e.jsx(Ue,{className:"h-5 w-5"})})]}),e.jsx(D,{type:"submit",className:"w-full",loading:i,disabled:i,children:t?"Create Account":"Sign In"}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>a(!t),className:"text-blue-600 hover:text-blue-500 font-medium",disabled:i,children:t?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})]})},La=()=>{const{user:s,loading:t}=me();return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Z,{size:"lg"})}):s?e.jsx(ws,{to:"/",replace:!0}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsx("div",{className:"bg-white py-8 px-4 shadow-sm rounded-lg sm:px-10 border border-gray-200",children:e.jsx(Ga,{onSuccess:()=>window.location.href="/"})})})})},Oa=["exe","bat","cmd","com","pif","scr","vbs","js","jar","app","deb","pkg","rpm","dmg","iso","msi","run","ps1","sh","bash","zsh","fish","csh","tcsh"],$a=[/script/i,/payload/i,/exploit/i,/backdoor/i,/trojan/i,/virus/i,/malware/i,/keylog/i,/rootkit/i],Ba=[/('|(\\')|(;)|(\\;)|(\\x27)|(\\x3D))/i,/(\\x3C)|(\\x3E)|(\\x22)|(\\x27)/i,/(select|insert|update|delete|drop|create|alter|exec|execute)/i,/(union|having|order\s+by|group\s+by)/i,/(script|javascript|vbscript|onload|onerror)/i],nt=s=>{var a;if(!s||s.trim().length===0)return{isValid:!1,error:"File name cannot be empty"};if(s.length>255)return{isValid:!1,error:"File name is too long (max 255 characters)"};const t=(a=s.split(".").pop())==null?void 0:a.toLowerCase();if(t&&Oa.includes(t))return{isValid:!1,error:`File type .${t} is not allowed for security reasons`};for(const r of $a)if(r.test(s))return{isValid:!1,error:"File name contains suspicious content"};for(const r of Ba)if(r.test(s))return{isValid:!1,error:"File name contains invalid characters"};return s.includes("..")||s.includes("/")||s.includes("\\")?{isValid:!1,error:"File name contains invalid path characters"}:/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x9F]/.test(s)?{isValid:!1,error:"File name contains invalid control characters"}:{isValid:!0}},it=async s=>{try{if(s.size>5242880)return{isValid:!1,error:"File size exceeds 5MB limit"};if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","image/jpeg","image/png","image/gif","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(s.type))return{isValid:!1,error:"File type not allowed"};const r=await s.slice(0,512).arrayBuffer(),n=new Uint8Array(r),i=[[77,90],[127,69,76,70],[207,250,237,254],[254,237,250,206]];for(const o of i)if(n.length>=o.length){let c=!0;for(let d=0;d<o.length;d++)if(n[d]!==o[d]){c=!1;break}if(c)return{isValid:!1,error:"Executable files are not allowed"}}if(s.type==="text/plain"){const o=await s.text(),c=[/<script/i,/javascript:/i,/vbscript:/i,/on\w+\s*=/i,/eval\s*\(/i,/document\.write/i,/innerHTML/i];for(const d of c)if(d.test(o))return{isValid:!1,error:"File contains potentially malicious script content"}}return{isValid:!0}}catch(t){return console.error("File validation error:",t),{isValid:!1,error:"Failed to validate file content"}}},Ae=5*1024*1024,Ja={pdf:Ae,doc:Ae,docx:Ae,txt:Ae,jpg:Ae,png:Ae,jpeg:Ae,gif:Ae,webp:Ae},Va=["pdf","doc","docx","txt","jpg","png","jpeg","gif","webp"],Ha=s=>{var r;if(!s.name||s.name.trim()==="")return{isValid:!1,error:"Please choose a valid file with a proper name"};const t=(r=s.name.split(".").pop())==null?void 0:r.toLowerCase();if(!t||!Va.includes(t))return{isValid:!1,error:"This file type is not supported. Please choose a PDF, Word document, text file, or image (JPG, PNG)"};const a=Ja[t];return s.size>a?{isValid:!1,error:"Please upload a file or PDF smaller than 5MB"}:s.size===0?{isValid:!1,error:"The file appears to be empty. Please choose a different file"}:{isValid:!0}},lt=async(s,t,a={})=>{var d,u,m,p,j;const{onProgress:r,onError:n,bucket:i="files",folder:o="general"}=a;let c=null;try{const{fileUploadTrackingService:g}=await Fe(async()=>{const{fileUploadTrackingService:N}=await import("./enhancedServices-wFH4Gj3X.js");return{fileUploadTrackingService:N}},__vite__mapDeps([0,1,2,3]));if(c=await g.createUploadSession(t,s.name,s.size,s.type),r==null||r({loaded:0,total:100,percentage:0,stage:"validating",message:"Checking file..."}),c&&await g.updateUploadProgress(c.id,5,"pending"),!f){const N="File upload is not available right now. Please try again later";return c&&await g.markUploadFailed(c.id,N),n==null||n(N),{success:!1,error:N}}const y=Ha(s);if(!y.isValid)return c&&await g.markUploadFailed(c.id,y.error),n==null||n(y.error),{success:!1,error:y.error};if(!nt(s.name).isValid){const N="This file name contains invalid characters. Please rename your file and try again";return n==null||n(N),{success:!1,error:N}}try{if(!(await it(s)).isValid){const B="This file appears to be corrupted or unsafe. Please try a different file";return n==null||n(B),{success:!1,error:B}}}catch(N){console.warn("Content validation failed:",N)}r==null||r({loaded:20,total:100,percentage:20,stage:"uploading",message:"Uploading file..."});const k=(d=s.name.split(".").pop())==null?void 0:d.toLowerCase(),v=Date.now(),C=`${t}_${v}_${s.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,x=`${o}/${C}`,{error:w}=await f.storage.from(i).upload(x,s,{cacheControl:"3600",upsert:!1});if(w){let N="Failed to upload file. Please try again";return(u=w.message)!=null&&u.includes("Bucket not found")?N="File storage is not properly set up. Please contact support":(m=w.message)!=null&&m.includes("File size")?N="Please upload a file or PDF smaller than 5MB":(p=w.message)!=null&&p.includes("row-level security policy")?N="You do not have permission to upload files right now":(j=w.message)!=null&&j.includes("already exists")&&(N="A file with this name already exists. Please rename your file and try again"),we.error("Storage upload error:",w),n==null||n(N),{success:!1,error:N}}r==null||r({loaded:70,total:100,percentage:70,stage:"processing",message:"Processing file..."});const{data:M}=f.storage.from(i).getPublicUrl(x);if(!(M!=null&&M.publicUrl)){const N="Failed to generate file access link. Please try again";return n==null||n(N),{success:!1,error:N}}const b=k==="jpeg"||k==="gif"||k==="webp"?"jpg":k,h={user_id:t,original_filename:s.name,stored_filename:C,file_size:s.size,file_type:b,upload_path:x,is_processed:!1},{data:P,error:R}=await f.from("file_uploads").insert([h]).select().single();if(R){try{await f.storage.from(i).remove([x])}catch(B){we.error("Failed to cleanup file after DB error:",B)}const N="Failed to save file information. Please try again";return we.error("Database insert error:",R),n==null||n(N),{success:!1,error:N}}r==null||r({loaded:100,total:100,percentage:100,stage:"complete",message:"Upload complete!"}),c&&await g.updateUploadProgress(c.id,100,"completed");const{activityService:L}=await Fe(async()=>{const{activityService:N}=await import("./enhancedServices-wFH4Gj3X.js");return{activityService:N}},__vite__mapDeps([0,1,2,3]));return await L.logActivity(t,"upload",{fileName:s.name,fileSize:s.size,fileType:k,uploadPath:x}).catch(N=>console.warn("Failed to log upload activity:",N)),{success:!0,fileUrl:M.publicUrl,fileName:s.name,fileSize:s.size,uploadId:P.id}}catch(g){const y="An unexpected error occurred during upload. Please try again";if(we.error("File upload error:",g),c){const{fileUploadTrackingService:k}=await Fe(async()=>{const{fileUploadTrackingService:v}=await import("./enhancedServices-wFH4Gj3X.js");return{fileUploadTrackingService:v}},__vite__mapDeps([0,1,2,3]));await k.markUploadFailed(c.id,y)}const{enhancedErrorReporting:T}=await Fe(async()=>{const{enhancedErrorReporting:k}=await import("./enhancedServices-wFH4Gj3X.js");return{enhancedErrorReporting:k}},__vite__mapDeps([0,1,2,3]));return await T.reportError(g,{userId:t,operation:"file_upload",component:"fileUploadService",metadata:{fileName:s.name,fileSize:s.size,fileType:s.type}}),n==null||n(y),r==null||r({loaded:0,total:100,percentage:0,stage:"error",message:y}),{success:!1,error:y}}},Wa=({onSuccess:s})=>{const{user:t}=me(),a=l.useRef(null),[r,n]=l.useState(!1),[i,o]=l.useState(""),[c,d]=l.useState(""),[u,m]=l.useState([]),[p,j]=l.useState(null),[g,y]=l.useState({title:"",description:"",contentType:"notes",categoryId:"",year:"",semester:"",tags:""});rs.useEffect(()=>{(async()=>{try{const M=await Cs();m(M)}catch(M){console.error("Failed to fetch categories:",M)}})()},[]);const T=w=>{var h;const M=(h=w.target.files)==null?void 0:h[0];if(!M)return;const b=nt(M.name);if(!b.isValid){o(b.error||"This file name is not allowed");return}if(it(M).then(P=>{if(!P.isValid){o(P.error||"This file cannot be uploaded"),j(null),a.current&&(a.current.value="");return}}),j(M),o(""),!g.title){const P=M.name.split(".").slice(0,-1).join(".");y(R=>({...R,title:P}))}},k=()=>{j(null),a.current&&(a.current.value="")},v=w=>{const{name:M,value:b}=w.target;y(h=>({...h,[M]:b}))},C=async w=>{var M;if(w.preventDefault(),!(!t||!p)){n(!0),o(""),d("");try{if(!p)throw new Error("No file selected");if(!(t!=null&&t.id))throw new Error("User not authenticated");const b={title:g.title,description:g.description,tags:g.tags.split(",").map(P=>P.trim()).filter(Boolean),year:g.year,semester:g.semester},{fileUrl:h}=await lt(p,t.id,"content",b);await Ua({title:g.title.trim(),description:g.description.trim()||null,content_type:g.contentType,category_id:g.categoryId||null,uploaded_by:t.id,file_url:h,file_size:p.size,file_type:(M=p.name.split(".").pop())==null?void 0:M.toLowerCase(),year:g.year?parseInt(g.year):null,semester:g.semester?parseInt(g.semester):null,tags:g.tags.split(",").map(P=>P.trim()).filter(Boolean)}),d("Content uploaded successfully and is now available to everyone!"),y({title:"",description:"",contentType:"notes",categoryId:"",year:"",semester:"",tags:""}),j(null),a.current&&(a.current.value=""),s==null||s()}catch(b){let h=b.message||"Upload failed";h.includes("Failed to upload file")&&(h="File upload failed. Please check your internet connection and try again."),(h.includes("row-level security policy")||h.includes("Unauthorized")||h.includes("permissions are not configured"))&&(h="File uploads are not yet enabled. Please contact the administrator to configure upload permissions."),(h.includes("storage is not configured")||h.includes("Bucket not found"))&&(h="File uploads are temporarily unavailable. The storage system needs to be configured by the administrator."),o(h)}finally{n(!1)}}},x=(w,M=0)=>w.flatMap(b=>[e.jsxs("option",{value:b.id,children:["  ".repeat(M),b.name]},b.id),...b.children?x(b.children,M+1):[]]);return e.jsx("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-0",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 mb-2",children:"Upload Content"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Share your study materials with the community. All uploads are reviewed before publishing."})]}),e.jsxs("form",{onSubmit:C,className:"space-y-4 sm:space-y-6",children:[i&&e.jsxs("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200 flex items-start space-x-2",children:[e.jsx(Ys,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"break-words",children:i})]}),c&&e.jsx("div",{className:"p-3 text-sm text-green-600 bg-green-50 rounded-lg border border-green-200",children:c}),e.jsxs("div",{className:"p-3 text-sm text-blue-600 bg-blue-50 rounded-lg border border-blue-200 flex items-start space-x-2",children:[e.jsx(ke,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Security Notice"}),e.jsx("p",{className:"text-xs mt-1",children:"All files are automatically scanned for security threats and validated before upload. Your content will be available immediately after passing security checks."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select File *"}),p?e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 sm:p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 min-w-0 flex-1",children:[e.jsx(ce,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:p.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500",children:[(p.size/(1024*1024)).toFixed(2)," MB"]})]})]}),e.jsx("button",{type:"button",onClick:k,className:"text-red-600 hover:text-red-700 p-1 ml-2 flex-shrink-0",children:e.jsx(Me,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]}):e.jsxs("div",{onClick:()=>{var w;return(w=a.current)==null?void 0:w.click()},className:"border-2 border-dashed border-gray-300 rounded-lg p-4 sm:p-6 lg:p-8 text-center cursor-pointer hover:border-blue-400 transition-colors",children:[e.jsx(Xe,{className:"h-8 w-8 sm:h-10 sm:w-10 lg:h-12 lg:w-12 text-gray-400 mx-auto mb-3 sm:mb-4"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mb-2",children:"Click to select a file or drag and drop"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"Supported: PDF, DOC, DOCX, TXT, JPG, PNG"})]}),e.jsx("input",{ref:a,type:"file",onChange:T,accept:".pdf,.doc,.docx,.txt,.jpg,.png",className:"hidden"})]}),e.jsx(ae,{name:"title",label:"Title *",value:g.title,onChange:v,placeholder:"Enter a descriptive title",required:!0,disabled:r}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{name:"description",value:g.description,onChange:v,placeholder:"Describe the content (optional)",rows:3,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Content Type *"}),e.jsxs("select",{name:"contentType",value:g.contentType,onChange:v,required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 appearance-none bg-white",disabled:r,children:[e.jsx("option",{value:"notes",children:"Study Notes"}),e.jsx("option",{value:"question_paper",children:"Question Paper"}),e.jsx("option",{value:"syllabus",children:"Syllabus"}),e.jsx("option",{value:"assignments",children:"Assignments"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{name:"categoryId",value:g.categoryId,onChange:v,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 appearance-none bg-white",disabled:r,children:[e.jsx("option",{value:"",children:"Select a category (optional)"}),x(u)]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(ae,{name:"year",label:"Academic Year",type:"number",value:g.year,onChange:v,placeholder:"e.g., 2024",min:"2000",max:"2030",disabled:r,helpText:"Optional"}),e.jsx(ae,{name:"semester",label:"Semester",type:"number",value:g.semester,onChange:v,placeholder:"e.g., 1",min:"1",max:"8",disabled:r,helpText:"Optional"})]}),e.jsx(ae,{name:"tags",label:"Tags",value:g.tags,onChange:v,placeholder:"algorithms, programming, data structures",helpText:"Comma-separated tags",disabled:r}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-2",children:e.jsx(D,{type:"submit",className:"w-full sm:w-auto order-1 sm:order-2",loading:r,disabled:r||!p||!g.title.trim(),children:"Upload Content"})})]})]})})},Ya=()=>{const{user:s,loading:t,isGuest:a}=me();return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Z,{size:"lg"})}):!s||a?e.jsx(ws,{to:"/auth",replace:!0}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-4 sm:py-6 lg:py-12 px-4 pb-20 sm:pb-4 lg:pb-0",children:e.jsx(Wa,{})})},cs=async(s=50,t=0)=>{const{data:a,error:r}=await f.from("chat_messages").select(`
      *,
      profiles (
        id,
        username,
        full_name
      )
    `).eq("is_reported",!1).order("created_at",{ascending:!1}).range(t,t+s-1);if(r)throw r;return(a||[]).reverse()},ot=async(s,t)=>{const a={user_id:t,message:s.trim()},{data:r,error:n}=await f.from("chat_messages").insert([a]).select().single();if(n)throw n;return r},Ka=async s=>{const{error:t}=await f.from("chat_messages").delete().eq("id",s);if(t)throw t},Qa=(s,t,a,r,n={})=>{const i=l.useRef(null),o=l.useRef(null),c=l.useRef(0),d=l.useRef(0),u=l.useRef(!1),{enabled:m=!0,onError:p,onConnected:j,onDisconnected:g}=n;return l.useEffect(()=>{if(!m||!s||!pe()||!f)return;const T=typeof window<"u"&&window.innerWidth<768?1e4:5e3,k=Date.now();if(k-d.current<T){console.log("üö´ Rate limited: Skipping connection attempt");return}d.current=k,i.current&&f.removeChannel(i.current);const v=f.channel(`group_messages_${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"group_messages",filter:`group_id=eq.${s}`},async C=>{try{if(we.debug("New message received:",C.new.id),!f)return;const{data:x,error:w}=await f.from("group_messages").select(`
                *,
                profiles (
                  id,
                  username,
                  full_name,
                  avatar_url
                )
              `).eq("id",C.new.id).single();if(w){console.error("‚ùå Error loading new message details:",w),console.error("‚ùå Error details:",{message:w.message,code:w.code,details:w.details,hint:w.hint}),we.error("Error loading new message:",w),p==null||p(new Error("Could not load new message"));return}x&&t(x)}catch(x){we.error("Error loading new message:",x),p==null||p(x)}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"group_messages",filter:`group_id=eq.${s}`},C=>{we.debug("Message updated:",C.new.id),a==null||a(C.new)}).on("postgres_changes",{event:"DELETE",schema:"public",table:"group_messages",filter:`group_id=eq.${s}`},C=>{we.debug("Message deleted:",C.old.id),r==null||r(C.old.id)}).subscribe(C=>{if(C==="SUBSCRIBED"&&!u.current)u.current=!0,c.current=0,j==null||j();else if(C==="CHANNEL_ERROR")u.current=!1,console.error("Real-time connection failed"),p==null||p(new Error("Live updates are not working right now"));else if(C==="CLOSED"&&u.current&&(u.current=!1,g==null||g(),c.current++,c.current<5)){const x=Math.min(1e3*Math.pow(2,c.current),3e4);o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{},x)}});return i.current=v,()=>{i.current&&f&&(u.current=!1,c.current=0,o.current&&(clearTimeout(o.current),o.current=null),we.debug("Disconnecting real-time updates"),f.removeChannel(i.current),i.current=null)}},[s,m,t,a,r,p,j,g]),()=>{i.current&&f&&f.removeChannel(i.current)}},Xa=(s,t,a,r={})=>{const n=l.useRef(null),{enabled:i=!0,onError:o}=r;l.useEffect(()=>{if(!i||!pe()||!f)return;n.current&&f.removeChannel(n.current);const c=f.channel("chat_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages"},async d=>{try{if(!f)return;const{data:u,error:m}=await f.from("chat_messages").select(`
                *,
                profiles (
                  id,
                  username,
                  full_name,
                  avatar_url
                )
              `).eq("id",d.new.id).single();if(m)throw m;u&&s(u)}catch(u){console.error("Error fetching new chat message:",u),o==null||o(u)}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_messages"},d=>{t==null||t(d.new)}).on("postgres_changes",{event:"DELETE",schema:"public",table:"chat_messages"},d=>{a==null||a(d.old.id)}).subscribe();return n.current=c,()=>{n.current&&f&&f.removeChannel(n.current)}},[i,s,t,a,o])},ds=new Map,ct=5e3,Za=(s,t=ct)=>{const a=Date.now(),r=ds.get(s);return r&&a-r<t?!1:(ds.set(s,a),!0)},er=()=>!document.hidden;setInterval(()=>{const t=Date.now()-ct*2;for(const[a,r]of ds.entries())r<t&&ds.delete(a)},6e4);const sr=({onClose:s})=>{const t=es(),{user:a,isGuest:r}=me(),n=l.useRef(null),i=l.useRef(null),o=l.useRef(null),[c,d]=l.useState("tabs"),[u,m]=l.useState(null),[p,j]=l.useState([]),[g,y]=l.useState(""),[T,k]=l.useState(!1),[v,C]=l.useState(!1),[x,w]=l.useState(""),[M,b]=l.useState(!1),[h,P]=l.useState(""),[R,L]=l.useState([]),[N,B]=l.useState(!1),[X,G]=l.useState(null),[W,ne]=l.useState(!1),{conversations:E,currentConversation:A,sendMessage:ee,startNewConversation:ue,loadConversations:xe,loadConversation:V}=xs((a==null?void 0:a.id)||null),J=async()=>{try{C(!0);const q=await cs();j(q||[]),setTimeout(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},200)}catch(q){console.error("Error loading global messages:",q)}finally{C(!1)}},O=async()=>{if(!(!g.trim()||T)){if(console.log("üîç Mobile Send Global Message Debug:",{hasUser:!!a,userId:a==null?void 0:a.id,isGuest:r,userEmail:a==null?void 0:a.email}),!(a!=null&&a.id)){console.log("‚ùå No user ID found, showing auth modal"),ne(!0);return}if(r&&!(a!=null&&a.id)){console.log("‚ùå User is guest with no ID, showing auth modal"),ne(!0);return}console.log("‚úÖ User authenticated, proceeding to send message");try{k(!0),await ot(g.trim(),a.id),y(""),await J()}catch(q){console.error("Error sending message:",q),G("Failed to send message. Please try again.")}finally{k(!1)}}},ie=async()=>{if(!(!x.trim()||M||!u||!(a!=null&&a.id)))try{b(!0),await ee(u,x.trim()),w("")}catch(q){console.error("Error sending private message:",q)}finally{b(!1)}},oe=async q=>{if(!q.trim()){L([]);return}if(!(a!=null&&a.id)){console.error("User not authenticated");return}try{B(!0);const Y=await rt(q,a.id);L(Y||[])}catch(Y){console.error("Error searching users:",Y),L([])}finally{B(!1)}},te=async q=>{try{a!=null&&a.id&&(await ue(q),m(q),d("private-chat"))}catch(Y){console.error("Error starting conversation:",Y)}},U=(q,Y)=>{q.key==="Enter"&&!q.shiftKey&&(q.preventDefault(),Y())},$=()=>{c==="private-chat"?(d("private-list"),m(null)):c==="global-chat"||c==="private-list"||c==="new-chat"?d("tabs"):s()};if(l.useEffect(()=>{c==="global-chat"&&J()},[c]),l.useEffect(()=>{c==="global-chat"&&p.length>0&&setTimeout(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},50)},[p]),l.useEffect(()=>{c==="private-chat"&&A&&A.length>0&&setTimeout(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},50)},[A]),l.useEffect(()=>{c==="global-chat"&&p.length>0&&setTimeout(()=>{var Y;const q=(Y=n.current)==null?void 0:Y.parentElement;q&&(q.scrollTop=q.scrollHeight)},200)},[c,p.length]),l.useEffect(()=>{if(c!=="global-chat")return;const q=setInterval(async()=>{var Y;try{if(!er()||!Za("global-chat-refresh",25e3))return;const le=(Y=n.current)==null?void 0:Y.parentElement,_=le?le.scrollHeight-le.scrollTop-le.clientHeight<100:!1,z=await cs();j(H=>JSON.stringify(H)!==JSON.stringify(z||[])?(!_&&le&&setTimeout(()=>{le&&(le.scrollTop=le.scrollHeight-le.clientHeight)},10),z||[]):H)}catch(le){console.error("Failed to refresh global messages:",le)}},3e4);return()=>clearInterval(q)},[c]),l.useEffect(()=>{c==="private-list"&&(a!=null&&a.id)&&xe&&xe(!1)},[c,a==null?void 0:a.id,xe]),l.useEffect(()=>{c==="private-chat"&&u&&(a!=null&&a.id)&&V&&(V(u),setTimeout(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},300))},[c,u,a==null?void 0:a.id,V]),l.useEffect(()=>{c==="private-chat"&&A&&A.length>0&&setTimeout(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},100)},[c,A]),l.useEffect(()=>{c==="global-chat"&&p.length>0&&setTimeout(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},100)},[c,p.length]),l.useEffect(()=>{c==="global-chat"&&J()},[c]),l.useEffect(()=>{const q=new URLSearchParams(t.search).get("tab");q==="global"?d("global-chat"):q==="private"&&d("private-list")},[t]),c==="tabs")return e.jsxs("div",{className:"h-screen w-full bg-white flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-primary-600 text-white p-4 shadow-lg",children:e.jsx("h1",{className:"text-xl font-bold text-center",children:"Messages"})}),e.jsx("div",{className:"flex-1 flex flex-col p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{className:"w-full p-6 bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-2xl hover:shadow-lg transition-all duration-200",onClick:()=>d("global-chat"),children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(_e,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Global Chat"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Join the community conversation"})]})]})}),e.jsx("button",{className:"w-full p-6 bg-gradient-to-r from-purple-50 to-purple-100 border border-purple-200 rounded-2xl hover:shadow-lg transition-all duration-200",onClick:()=>d("private-list"),disabled:r,children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center",children:e.jsx(Ne,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Private Messages"}),e.jsx("p",{className:"text-sm text-gray-600",children:r?"Sign in to access private messages":"Your private conversations"})]})]})})]})})]});if(c==="global-chat")return e.jsxs("div",{className:"h-screen w-full bg-white flex flex-col relative",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 shadow-lg flex-shrink-0",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:$,className:"p-2 hover:bg-white/20 rounded-lg",children:e.jsx(Ee,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-lg font-semibold",children:"Global Chat"})]})]})}),e.jsx("div",{ref:o,className:"flex-1 overflow-y-auto bg-gray-50 p-4 pb-24",style:{height:"calc(100vh - 140px)"},children:v?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Z,{})}):p.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No messages yet. Be the first to start!"})]}):e.jsxs("div",{className:"space-y-3 pb-20",children:[p.map(q=>{var le,_;const Y=q.user_id===(a==null?void 0:a.id);return e.jsx("div",{className:`flex ${Y?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:"max-w-[85%]",children:[!Y&&e.jsxs("div",{className:"flex items-center space-x-2 mb-1 px-2",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-3 w-3 text-white"})}),e.jsx("span",{className:"text-xs font-medium text-gray-600",children:((le=q.profiles)==null?void 0:le.full_name)||"Anonymous"}),((_=q.profiles)==null?void 0:_.is_admin)&&e.jsx("span",{className:"text-xs bg-primary-100 text-primary-700 px-1 rounded",children:"Admin"})]}),e.jsxs("div",{className:`px-4 py-3 rounded-2xl break-words overflow-hidden ${Y?"bg-blue-500 text-white":"bg-white text-gray-900 shadow-sm border border-gray-100"}`,children:[e.jsx("p",{className:"text-sm break-words",children:q.message}),e.jsx("p",{className:`text-xs mt-1 ${Y?"text-blue-100":"text-gray-500"}`,children:Ce(new Date(q.created_at),{addSuffix:!0})})]})]})},q.id)}),e.jsx("div",{ref:n})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"text",value:g,onChange:q=>y(q.target.value),onKeyPress:q=>U(q,O),placeholder:r?"Sign in to chat":"Type a message...",className:"flex-1 px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",disabled:r||T}),e.jsx("button",{onClick:O,disabled:!g.trim()||r||T,className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",children:T?e.jsx(Z,{size:"sm"}):e.jsx(Le,{className:"h-4 w-4"})})]})})]});if(c==="private-list")return e.jsxs("div",{className:"h-screen w-full bg-white flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 shadow-lg flex-shrink-0 sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:$,className:"p-2 hover:bg-white/20 rounded-lg",children:e.jsx(Ee,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-semibold",children:"Private Messages"})]}),e.jsx("button",{onClick:()=>d("new-chat"),className:"p-2 hover:bg-white/20 rounded-lg",children:e.jsx($e,{className:"h-5 w-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50",children:E.length===0?e.jsxs("div",{className:"text-center py-12 px-6 text-gray-500",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"mb-4",children:"No conversations yet"}),e.jsx("button",{onClick:()=>d("new-chat"),className:"px-6 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors",children:"Start New Chat"})]}):e.jsx("div",{className:"p-4 space-y-2",children:E.map(q=>e.jsx("button",{onClick:()=>{m(q.otherUser.id),V(q.otherUser.id),d("private-chat")},className:"w-full p-4 bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:q.otherUser.full_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["@",q.otherUser.username]}),q.lastMessage&&e.jsxs("p",{className:"text-sm text-gray-600 truncate mt-1",children:[q.lastMessage.message.split(" ").slice(0,4).join(" "),q.lastMessage.message.split(" ").length>4?"...":""]})]}),q.lastMessage&&e.jsx("div",{className:"text-xs text-gray-400",children:Ce(new Date(q.lastMessage.created_at),{addSuffix:!0})})]})},q.otherUser.id))})})]});if(c==="new-chat")return e.jsxs("div",{className:"h-screen w-full bg-white flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 shadow-lg flex-shrink-0 sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:$,className:"p-2 hover:bg-white/20 rounded-lg",children:e.jsx(Ee,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-semibold",children:"New Conversation"})]})}),e.jsx("div",{className:"p-4 bg-white border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:h,onChange:q=>{P(q.target.value),oe(q.target.value)},placeholder:"Search users by name or username...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50",children:N?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Z,{})}):R.length===0?e.jsx("div",{className:"text-center py-12 px-6 text-gray-500",children:h?e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsxs("p",{children:['No users found for "',h,'"']})]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Search for users to start a conversation"})]})}):e.jsx("div",{className:"p-4 space-y-2",children:R.map(q=>e.jsx("button",{onClick:()=>te(q.id),className:"w-full p-4 bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:q.full_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["@",q.username]})]})]})},q.id))})})]});if(c==="private-chat"){const q=E.find(Y=>Y.otherUser.id===u);return q?e.jsxs("div",{className:"h-screen w-full bg-white flex flex-col relative",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 shadow-lg flex-shrink-0",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:$,className:"p-2 hover:bg-white/20 rounded-lg",children:e.jsx(Ee,{className:"h-5 w-5"})}),e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold",children:q.otherUser.full_name}),e.jsxs("p",{className:"text-sm text-purple-100",children:["@",q.otherUser.username]})]})]})}),e.jsx("div",{ref:i,className:"flex-1 overflow-y-auto bg-gray-50 p-4 pb-24",style:{height:"calc(100vh - 140px)"},children:A?e.jsxs("div",{className:"space-y-3",children:[A.map(Y=>{const le=Y.sender_id===(a==null?void 0:a.id);return e.jsx("div",{className:`flex ${le?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-4 py-3 rounded-2xl break-words overflow-hidden ${le?"bg-purple-500 text-white":"bg-white text-gray-900 shadow-sm border border-gray-100"}`,children:[e.jsx("p",{className:"text-sm break-words",children:Y.message}),e.jsx("p",{className:`text-xs mt-1 ${le?"text-purple-100":"text-gray-500"}`,children:Ce(new Date(Y.created_at),{addSuffix:!0})})]})},Y.id)}),e.jsx("div",{ref:n})]}):e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Z,{})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"text",value:x,onChange:Y=>w(Y.target.value),onKeyPress:Y=>U(Y,ie),placeholder:"Type a message...",className:"flex-1 px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",disabled:M}),e.jsx("button",{onClick:ie,disabled:!x.trim()||M,className:"w-12 h-12 bg-purple-500 text-white rounded-full flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",children:M?e.jsx(Z,{size:"sm"}):e.jsx(Le,{className:"h-4 w-4"})})]})})]}):null}return null},tr=()=>{const{user:s,profile:t,isGuest:a}=me(),r=es(),n=l.useRef(null),i=l.useRef(null),o=l.useRef(null),c=l.useRef(null),u=new URLSearchParams(r.search).get("tab")==="private"?"private":"global",[m,p]=l.useState(u),[j,g]=l.useState(!1),[y,T]=l.useState([]),[k,v]=l.useState(!0),[C,x]=l.useState(""),[w,M]=l.useState(!1),[b,h]=l.useState(null),[P,R]=l.useState(""),[L,N]=l.useState(""),[B,X]=l.useState([]),[G,W]=l.useState(!1),[ne,E]=l.useState(!1),[A,ee]=l.useState(!1),[ue,xe]=l.useState(null),{conversations:V,currentConversation:J,totalUnreadCount:O,loading:ie,sending:oe,error:te,loadConversations:U,sendMessage:$,startNewConversation:q}=xs((s==null?void 0:s.id)||null),Y=l.useCallback(S=>{T(I=>{const F=I.findIndex(se=>se.isOptimistic&&se.user_id===S.user_id&&se.message===S.message&&Math.abs(new Date(se.created_at).getTime()-new Date(S.created_at).getTime())<5e3);if(F!==-1){const se=[...I];return se[F]=S,se}else return I.some(qe=>qe.id===S.id)?I:[...I,S]})},[]),le=l.useCallback(S=>{T(I=>I.map(F=>F.id===S.id?{...F,...S}:F))},[]),_=l.useCallback(S=>{T(I=>I.filter(F=>F.id!==S))},[]);l.useEffect(()=>{const S=()=>{g(window.innerWidth<768)};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]),l.useEffect(()=>(i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{(y.length>0&&m==="global"||J&&J.length>0&&m==="private")&&requestAnimationFrame(()=>{const S=n.current;if(S){const I=S.parentElement;if(I){const F=I.scrollHeight-I.scrollTop-I.clientHeight<100,se=y.length>0&&y.length<=10&&m==="global"||J&&J.length>0&&J.length<=10&&m==="private";(F||se||J&&J.length<=1||y.length<=1)&&I.scrollTo({top:I.scrollHeight,behavior:se?"instant":"smooth"})}}})},50),()=>{i.current&&clearTimeout(i.current)}),[y.length,J==null?void 0:J.length,m]),l.useEffect(()=>{j||(async()=>{try{v(!0);const I=await cs();T(I||[]),setTimeout(()=>{var se;const F=(se=n.current)==null?void 0:se.parentElement;F&&(F.scrollTop=F.scrollHeight)},100)}catch(I){console.error("Failed to load global messages:",I),xe("Failed to load chat messages")}finally{v(!1)}})()},[j]),l.useEffect(()=>{if(j||m!=="global")return;const S=setInterval(async()=>{var I;try{const F=(I=n.current)==null?void 0:I.parentElement,se=F?F.scrollHeight-F.scrollTop-F.clientHeight<100:!1,qe=await cs();T(Ve=>JSON.stringify(Ve)!==JSON.stringify(qe||[])?(!se&&F&&setTimeout(()=>{F&&(F.scrollTop=F.scrollHeight-F.clientHeight)},10),qe||[]):Ve)}catch(F){console.error("Failed to refresh global messages:",F)}},3e4);return()=>clearInterval(S)},[j,m]),l.useEffect(()=>{!j&&m==="private"&&(s!=null&&s.id)&&U&&U(!0)},[m,s==null?void 0:s.id,j,U]),l.useEffect(()=>{m==="global"&&y.length>0?setTimeout(()=>{var I;const S=(I=n.current)==null?void 0:I.parentElement;S&&(S.scrollTop=S.scrollHeight)},100):m==="private"&&b&&J&&J.length>0&&setTimeout(()=>{var I;const S=(I=n.current)==null?void 0:I.parentElement;S&&(S.scrollTop=S.scrollHeight)},100)},[m,b,y.length,J==null?void 0:J.length]),l.useEffect(()=>{if(ue||te){const S=setTimeout(()=>xe(null),5e3);return()=>clearTimeout(S)}},[ue,te]),Xa(Y,le,_,{enabled:!j,onError:S=>{console.error("Real-time subscription error:",S),xe("Real-time updates unavailable")}});const z=async()=>{var F,se,qe,Ve,Es;if(!C.trim())return;if(console.log("üîç Send Global Message Debug:",{hasUser:!!s,userId:s==null?void 0:s.id,isGuest:a,userEmail:s==null?void 0:s.email,profileExists:!!t}),!(s!=null&&s.id)){console.log("‚ùå No user ID found, showing auth modal"),ee(!0);return}if(a&&!(s!=null&&s.id)){console.log("‚ùå User is guest with no ID, showing auth modal"),ee(!0);return}console.log("‚úÖ User authenticated, proceeding to send message");const S=`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,I={id:S,user_id:s.id,message:C.trim(),is_reported:!1,is_flagged:!1,created_at:new Date().toISOString(),profiles:{id:s.id,username:((F=s.user_metadata)==null?void 0:F.username)||((se=s.email)==null?void 0:se.split("@")[0])||"Anonymous",full_name:((qe=s.user_metadata)==null?void 0:qe.full_name)||((Ve=s.user_metadata)==null?void 0:Ve.username)||"Anonymous User",avatar_url:((Es=s.user_metadata)==null?void 0:Es.avatar_url)||null,is_admin:(t==null?void 0:t.is_admin)||!1},isOptimistic:!0};try{M(!0),xe(null),T(Be=>[...Be,I]),x(""),await ot(I.message,s.id),setTimeout(()=>{var Be;(Be=c.current)==null||Be.focus()},50)}catch(Be){console.error("Failed to send global message:",Be),T(ht=>ht.filter(pt=>pt.id!==S)),x(I.message),xe("Failed to send message. Please try again.")}finally{M(!1)}},H=async()=>{if(!P.trim()||!b)return;if(!s||a){ee(!0);return}const S=P.trim();R("");try{await $(b,S),setTimeout(()=>{var I;(I=o.current)==null||I.focus()},50)}catch(I){console.error("Failed to send private message:",I),xe("Failed to send private message. Please try again."),R(S)}},K=S=>{S.key==="Enter"&&!S.shiftKey&&(S.preventDefault(),m==="global"?z():H())},he=async S=>{if(!s||a){ee(!0);return}try{await xa(S,s.id,"inappropriate"),alert("Message reported successfully")}catch(I){console.error("Failed to report message:",I),alert("Failed to report message")}},be=async S=>{if(t!=null&&t.is_admin)try{await Ka(S)}catch(I){console.error("Failed to delete message:",I),alert("Failed to delete message")}},fe=async S=>{if(!S.trim()){X([]);return}if(s!=null&&s.id)try{W(!0);const I=await rt(S,s.id);X(I.filter(F=>F.id!==(s==null?void 0:s.id)))}catch(I){console.error("Failed to search users:",I)}finally{W(!1)}},ve=async S=>{h(S);try{await q(S)}catch(I){console.error("Failed to start conversation:",I)}E(!1),N(""),X([])};if(j)return e.jsx("div",{className:"h-full",children:e.jsx(sr,{onClose:()=>{}})});const je=()=>e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center",children:e.jsx(_e,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Global Chat"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Chat with everyone in the community"})]})]})}),ue&&e.jsxs("div",{className:"p-4 bg-red-50 border-l-4 border-red-400 flex items-center gap-2",children:[e.jsx(Ys,{className:"h-5 w-5 text-red-400"}),e.jsx("span",{className:"text-red-700",children:ue})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 bg-gradient-to-b from-gray-50 to-white",children:[k?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Z,{})}):y.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ne,{className:"h-8 w-8 text-blue-500"})}),e.jsx("p",{children:"No messages yet. Be the first to start the conversation!"})]}):y.map(S=>{var I,F,se;return e.jsxs("div",{className:`flex gap-3 p-3 rounded-lg transition-all duration-200 ${S.is_flagged?"bg-red-50 border border-red-200":"hover:bg-gray-50"} ${S.isOptimistic?"opacity-70 animate-pulse":""}`,children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-5 w-5 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:((I=S.profiles)==null?void 0:I.full_name)||((F=S.profiles)==null?void 0:F.username)||"Anonymous"}),((se=S.profiles)==null?void 0:se.is_admin)&&e.jsx("span",{className:"px-2 py-0.5 bg-primary-100 text-primary-700 text-xs rounded-full",children:"Admin"}),e.jsx("span",{className:"text-sm text-gray-500",children:Ce(new Date(S.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:`text-gray-800 leading-relaxed ${S.is_flagged?"line-through opacity-60":""}`,children:S.message}),S.is_flagged&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"This message has been flagged"})]}),e.jsxs("div",{className:"flex-shrink-0 flex gap-1",children:[s&&!a&&S.user_id!==s.id&&e.jsx("button",{onClick:()=>he(S.id),className:"p-1 text-gray-400 hover:text-red-500 rounded",title:"Report message",children:e.jsx(Vs,{className:"h-4 w-4"})}),s&&(t==null?void 0:t.is_admin)&&e.jsx("button",{onClick:()=>be(S.id),className:"p-1 text-gray-400 hover:text-red-500 rounded",title:"Delete message",children:e.jsx(Ze,{className:"h-4 w-4"})})]})]},S.id)}),e.jsx("div",{ref:n})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-white shadow-lg",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{ref:c,type:"text",value:C,onChange:S=>x(S.target.value),onKeyPress:K,placeholder:a?"Please sign in to chat":"Type your message...",className:"flex-1 px-6 py-3 border-2 border-gray-200 rounded-2xl focus:outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 bg-white shadow-sm text-gray-900 placeholder-gray-500",disabled:a||w}),e.jsx(D,{onClick:z,disabled:!C.trim()||a||w,className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-medium shadow-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:w?e.jsx(Z,{size:"sm"}):e.jsx(Le,{className:"h-5 w-5"})})]})})]}),Re=()=>{if(!b)return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-secondary-400 to-secondary-600 rounded-full flex items-center justify-center",children:e.jsx(Ne,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Private Messages"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Direct conversations with other users"})]})]}),e.jsxs(D,{onClick:()=>E(!0),className:"px-4 py-2 rounded-full flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),"New Chat"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:ie?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Z,{})}):V.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"mb-4",children:"No conversations yet"}),e.jsx(D,{onClick:()=>E(!0),className:"px-6 py-2",children:"Start a Conversation"})]}):e.jsx("div",{className:"p-4 space-y-2",children:V.map(F=>e.jsxs("div",{onClick:()=>ve(F.otherUser.id),className:"flex items-center gap-4 p-4 rounded-xl hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 cursor-pointer transition-all duration-200 border border-transparent hover:border-blue-100 hover:shadow-sm",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center shadow-md",children:e.jsx(de,{className:"h-6 w-6 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:F.otherUser.full_name}),F.lastMessage&&e.jsx("span",{className:"text-xs text-gray-500",children:Ce(new Date(F.lastMessage.created_at),{addSuffix:!0})})]}),e.jsxs("p",{className:"text-sm text-gray-500 truncate",children:["@",F.otherUser.username]}),F.lastMessage&&e.jsxs("p",{className:"text-sm text-gray-600 truncate mt-1",children:[F.lastMessage.message.split(" ").slice(0,4).join(" "),F.lastMessage.message.split(" ").length>4?"...":""]})]}),F.unreadCount>0&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"bg-primary-500 text-white text-xs font-medium px-2 py-1 rounded-full",children:F.unreadCount})})]},F.otherUser.id))})}),ne&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Start New Conversation"}),e.jsx("button",{onClick:()=>{E(!1),N(""),X([])},className:"text-gray-400 hover:text-gray-600",children:e.jsx(Me,{className:"h-5 w-5"})})]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(De,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:L,onChange:F=>{N(F.target.value),fe(F.target.value)},placeholder:"Search users...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),G&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Z,{size:"sm"})}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:B.map(F=>e.jsxs("div",{onClick:()=>ve(F.id),className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:F.full_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["@",F.username]})]})]},F.id))})]})]})})]});const S=V.find(F=>F.otherUser.id===b),I=(S==null?void 0:S.otherUser)||B.find(F=>F.id===b);return!I&&!S?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>h(null),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Ee,{className:"h-5 w-5"})}),e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Loading..."})})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(Z,{})})]}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>h(null),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Ee,{className:"h-5 w-5"})}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:(S==null?void 0:S.otherUser.full_name)||(I==null?void 0:I.full_name)||"User"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["@",(S==null?void 0:S.otherUser.username)||(I==null?void 0:I.username)||"username"]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 bg-gradient-to-b from-gray-50 to-white",children:[J&&J.length>0?J.map(F=>{const se=F.sender_id===(s==null?void 0:s.id);return e.jsx("div",{className:`flex ${se?"justify-end":"justify-start"} mb-3`,children:e.jsxs("div",{className:`max-w-xs md:max-w-md px-6 py-3 rounded-2xl shadow-sm break-words overflow-hidden ${se?"bg-gradient-to-r from-blue-500 to-indigo-600 text-white":"bg-white border border-gray-200 text-gray-900"}`,children:[e.jsx("p",{className:"leading-relaxed break-words",children:F.message}),e.jsx("p",{className:`text-xs mt-2 ${se?"text-blue-100":"text-gray-500"}`,children:Ce(new Date(F.created_at),{addSuffix:!0})})]})},F.id)}):J?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ne,{className:"h-8 w-8 text-blue-500"})}),e.jsx("p",{className:"text-lg font-medium text-gray-700",children:"No messages yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Start a conversation!"})]}):e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Z,{})}),e.jsx("div",{ref:n})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-white shadow-lg",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{ref:o,type:"text",value:P,onChange:F=>R(F.target.value),onKeyPress:K,placeholder:"Type your message...",className:"flex-1 px-6 py-3 border-2 border-gray-200 rounded-2xl focus:outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 bg-white shadow-sm text-gray-900 placeholder-gray-500",disabled:oe}),e.jsx(D,{onClick:H,disabled:!P.trim()||oe,className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-medium shadow-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:oe?e.jsx(Z,{size:"sm"}):e.jsx(Le,{className:"h-5 w-5"})})]})})]})};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50 py-6 md:py-8",children:[e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm",children:e.jsx(Ne,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:"JU CONNECTS Chat"}),e.jsx("p",{className:"text-white/80 text-sm",children:"Connect with your community"})]})]}),O>0&&e.jsxs("div",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-medium",children:[O," unread"]})]})}),e.jsxs("div",{className:"flex bg-gray-50/50 border-b border-gray-200/50",children:[e.jsx("button",{onClick:()=>p("global"),className:`flex-1 px-6 py-4 text-sm font-semibold transition-all duration-200 ${m==="global"?"text-blue-600 border-b-3 border-blue-600 bg-blue-50/50":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),"Global Chat"]})}),e.jsx("button",{onClick:()=>p("private"),className:`flex-1 px-6 py-4 text-sm font-semibold transition-all duration-200 relative ${m==="private"?"text-purple-600 border-b-3 border-purple-600 bg-purple-50/50":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Private Messages",O>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:O})]})})]}),e.jsx("div",{className:"h-[calc(75vh)] flex flex-col",children:m==="global"?je():Re()})]})}),e.jsx(us,{isOpen:A,onClose:()=>ee(!1)})]})},ar=()=>e.jsx(tr,{}),rr=({isOpen:s,onClose:t,onSuccess:a,categories:r})=>{const{user:n}=me(),[i,o]=l.useState(!1),[c,d]=l.useState(""),[u,m]=l.useState({name:"",description:"",parentId:""}),p=async y=>{if(y.preventDefault(),!(!n||i)){o(!0),d("");try{await Fa(u.name.trim(),u.description.trim()||void 0,u.parentId||void 0),m({name:"",description:"",parentId:""}),a(),t()}catch(T){d(T.message||"Failed to create category")}finally{o(!1)}}},j=y=>{const{name:T,value:k}=y.target;m(v=>({...v,[T]:k}))},g=(y,T=0)=>y.map(k=>e.jsxs(rs.Fragment,{children:[e.jsxs("option",{value:k.id,children:["  ".repeat(T),k.name]}),k.children&&g(k.children,T+1)]},k.id));return e.jsx(Pe,{isOpen:s,onClose:t,title:"Add New Category",size:"md",children:e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[c&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200",children:c}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-blue-50 rounded-lg",children:[e.jsx(Ut,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Create Custom Category"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Add a new category to help organize content better"})]})]}),e.jsx(ae,{name:"name",label:"Category Name *",value:u.name,onChange:j,placeholder:"e.g., Machine Learning, Web Development",required:!0,disabled:i,premium:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Parent Category (Optional)"}),e.jsxs("select",{name:"parentId",value:u.parentId,onChange:j,className:"input-premium appearance-none cursor-pointer",disabled:i,children:[e.jsx("option",{value:"",children:"None (Top Level Category)"}),g(r)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a parent category to create a subcategory"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),e.jsx("textarea",{name:"description",value:u.description,onChange:j,placeholder:"Brief description of what this category contains...",rows:3,className:"input-premium resize-none",disabled:i})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(D,{type:"button",variant:"outline",onClick:t,disabled:i,children:"Cancel"}),e.jsxs(D,{type:"submit",loading:i,disabled:i||!u.name.trim(),className:"flex items-center space-x-2",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Category"})]})]})]})})},nr=()=>{const{user:s,isGuest:t}=me(),[a,r]=l.useState([]),[n,i]=l.useState(null),[o,c]=l.useState([]),[d,u]=l.useState(!0),[m,p]=l.useState(!1),[j,g]=l.useState(null),[y,T]=l.useState(!1),[k,v]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const h=await Is();r(h)}catch(h){console.error("Failed to fetch categories:",h)}finally{u(!1)}})()},[]);const C=async()=>{try{const b=await Is();r(b)}catch(b){console.error("Failed to refresh categories:",b)}},x=async b=>{i(b),p(!0);try{const h=await as(void 0,b.id);c(h)}catch(h){console.error("Failed to fetch category content:",h)}finally{p(!1)}},w=b=>{g(b),T(!0)},M=(b,h=0)=>e.jsxs("div",{className:`${h>0?"ml-3 sm:ml-6":""}`,children:[e.jsx("div",{className:`p-3 sm:p-4 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-all cursor-pointer ${(n==null?void 0:n.id)===b.id?"ring-2 ring-blue-500 border-blue-500":""}`,onClick:()=>x(b),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0",children:[e.jsx(ce,{className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:b.name}),b.description&&e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 line-clamp-2",children:b.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 flex-shrink-0 ml-2",children:[b.content_count!==void 0&&e.jsxs(re,{variant:"neutral",size:"sm",children:[e.jsxs("span",{className:"hidden sm:inline",children:[b.content_count," items"]}),e.jsx("span",{className:"sm:hidden",children:b.content_count})]}),e.jsx(qt,{className:"h-3 w-3 sm:h-4 sm:w-4 text-gray-400"})]})]})}),b.children&&b.children.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:b.children.map(P=>M(P,h+1))})]},b.id);return d?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Z,{size:"lg"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 pb-20 sm:pb-4 md:pb-0",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-12",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between mb-4 sm:mb-6 lg:mb-8 space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"text-center lg:text-left w-full lg:w-auto",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 mb-2 sm:mb-4",children:"Browse by Categories"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 max-w-2xl px-4 sm:px-0",children:"Explore our organized collection of study materials, question papers, and resources categorized by subject areas"})]}),s&&!t&&e.jsxs(D,{onClick:()=>v(!0),className:"flex items-center justify-center space-x-2 w-full sm:w-auto",size:"sm",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Category"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8",children:[e.jsx("div",{className:"lg:col-span-1 order-2 lg:order-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 lg:p-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Subject Areas"}),e.jsx("div",{className:"space-y-2 sm:space-y-3 max-h-64 sm:max-h-80 lg:max-h-96 overflow-y-auto",children:a.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4 text-sm",children:"No categories available"}):a.map(b=>M(b))})]})}),e.jsx("div",{className:"lg:col-span-2 order-1 lg:order-2",children:n?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 mb-2",children:n.name}),n.description&&e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:n.description})]}),m?e.jsx("div",{className:"flex justify-center py-8 sm:py-12",children:e.jsx(Z,{})}):o.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx(Ks,{className:"h-12 w-12 sm:h-16 sm:w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-2",children:"No content available"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 px-4",children:"There are no resources in this category yet"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:o.map(b=>e.jsx(_s,{content:b,onClick:()=>w(b),showUploader:!0},b.id))})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8 sm:p-12 text-center",children:[e.jsx(ce,{className:"h-12 w-12 sm:h-16 sm:w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-2",children:"Select a Category"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 px-4",children:"Choose a subject area from the left to explore available resources"})]})})]}),e.jsx(Ss,{content:j,isOpen:y,onClose:()=>{T(!1),g(null)}}),e.jsx(rr,{isOpen:k,onClose:()=>v(!1),onSuccess:C,categories:a})]})})},ir=async s=>{const{data:t,error:a}=await f.from("update_requests").insert([s]).select().single();if(a)throw a;return t},lr=async s=>{const{data:t,error:a}=await f.from("update_requests").select(`
      *,
      profiles!update_requests_user_id_fkey (
        id,
        username,
        full_name
      ),
      reviewer:profiles!update_requests_reviewed_by_fkey (
        id,
        username,
        full_name
      )
    `).eq("user_id",s).order("created_at",{ascending:!1});if(a)throw a;return t||[]},or=()=>{const{user:s,loading:t,isGuest:a}=me(),[r,n]=l.useState([]),[i,o]=l.useState(!0),[c,d]=l.useState(!1),[u,m]=l.useState(!1),[p,j]=l.useState({contentType:"general_query",contentId:"",issueDescription:"",suggestedChanges:""}),g=l.useCallback(async()=>{try{const x=await lr(s.id);n(x)}catch(x){console.error("Failed to fetch data:",x)}finally{o(!1)}},[s]);l.useEffect(()=>{s&&!a&&g()},[s,a,g]);const y=async x=>{if(x.preventDefault(),!(!s||u)){m(!0);try{let w=p.contentType;["general_query","content_update","content_removal","bug_report","feature_request"].includes(p.contentType)&&(w="notes"),await ir({user_id:s.id,content_type:w,content_id:p.contentId||null,issue_description:p.issueDescription.trim(),suggested_changes:p.suggestedChanges.trim()||null}),j({contentType:"general_query",contentId:"",issueDescription:"",suggestedChanges:""}),d(!1),await g()}catch(w){alert(w.message||"Failed to submit request")}finally{m(!1)}}},T=x=>{switch(x){case"pending":return e.jsx(is,{className:"h-4 w-4 text-yellow-500"});case"approved":return e.jsx(Ft,{className:"h-4 w-4 text-green-500"});case"rejected":return e.jsx(It,{className:"h-4 w-4 text-red-500"});default:return e.jsx(is,{className:"h-4 w-4 text-gray-400"})}},k=x=>{switch(x){case"pending":return"warning";case"approved":return"success";case"rejected":return"error";default:return"neutral"}},v=x=>{switch(x){case"question_paper":return"Question Paper";case"notes":return"Study Notes";case"syllabus":return"Syllabus";case"educational_link":return"Educational Link";case"assignments":return"Assignments";case"content_update":return"Content Update";case"content_removal":return"Content Removal";case"bug_report":return"Bug Report";case"feature_request":return"Feature Request";case"general_query":return"General Query";default:return x}},C=x=>{switch(x){case"question_paper":return e.jsx(ce,{className:"h-4 w-4"});case"notes":return e.jsx(ce,{className:"h-4 w-4"});case"content_update":return e.jsx(Ps,{className:"h-4 w-4"});case"content_removal":return e.jsx(Ze,{className:"h-4 w-4"});case"bug_report":return e.jsx(Qe,{className:"h-4 w-4"});case"feature_request":return e.jsx(Ts,{className:"h-4 w-4"});case"general_query":return e.jsx(ns,{className:"h-4 w-4"});default:return e.jsx(Ye,{className:"h-4 w-4"})}};return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Z,{size:"lg"})}):!s||a?e.jsx(ws,{to:"/auth",replace:!0}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-4 sm:py-6 lg:py-12 px-4 pb-20 sm:pb-4 lg:pb-0",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between mb-6 space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"w-full lg:w-auto",children:[e.jsx("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900",children:"Support & Requests"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1 mb-3",children:"Submit your queries, report issues, or request content updates"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-blue-900 mb-2 flex items-center",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"What can you request?"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-blue-800",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ns,{className:"h-3 w-3 mr-2 text-blue-600"}),"General queries & questions"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ps,{className:"h-3 w-3 mr-2 text-blue-600"}),"Content updates & corrections"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ze,{className:"h-3 w-3 mr-2 text-blue-600"}),"Content removal requests"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Qe,{className:"h-3 w-3 mr-2 text-blue-600"}),"Bug reports & technical issues"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ts,{className:"h-3 w-3 mr-2 text-blue-600"}),"Feature suggestions"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"h-3 w-3 mr-2 text-blue-600"}),"Material-specific issues"]})]})]})]}),e.jsxs(D,{onClick:()=>d(!0),className:"flex items-center justify-center space-x-2 w-full sm:w-auto",size:"sm",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{children:"New Request"})]})]}),i?e.jsx("div",{className:"flex justify-center py-8 sm:py-12",children:e.jsx(Z,{})}):r.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx(Ye,{className:"h-12 w-12 sm:h-16 sm:w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-2",children:"No requests yet"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mb-4 px-4",children:"You haven't submitted any requests yet. Feel free to ask questions, report issues, or suggest improvements!"}),e.jsx(D,{onClick:()=>d(!0),size:"sm",children:"Submit Your First Request"})]}):e.jsx("div",{className:"space-y-3 sm:space-y-4",children:r.map(x=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 sm:p-4 hover:shadow-sm transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[T(x.status),e.jsx(re,{variant:k(x.status),size:"sm",children:x.status.charAt(0).toUpperCase()+x.status.slice(1)})]}),e.jsxs(re,{variant:"neutral",size:"sm",className:"flex items-center gap-1",children:[C(x.content_type),v(x.content_type)]})]}),e.jsx("h3",{className:"font-medium text-gray-900 mb-2 text-sm sm:text-base",children:"Issue Description"}),e.jsx("p",{className:"text-gray-700 mb-3 text-sm sm:text-base leading-relaxed",children:x.issue_description}),x.suggested_changes&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1 text-sm sm:text-base",children:"Suggested Changes"}),e.jsx("p",{className:"text-gray-700 mb-3 text-sm sm:text-base leading-relaxed",children:x.suggested_changes})]}),x.admin_notes&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1 text-sm sm:text-base",children:"Admin Response"}),e.jsx("p",{className:"text-gray-700 mb-3 text-sm sm:text-base leading-relaxed",children:x.admin_notes})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between text-xs sm:text-sm text-gray-500 pt-3 border-t border-gray-100 space-y-2 sm:space-y-0",children:[e.jsxs("span",{children:["Submitted ",Ce(new Date(x.created_at),{addSuffix:!0})]}),x.reviewed_by&&x.reviewer&&e.jsxs("span",{className:"truncate",children:["Reviewed by @",x.reviewer.username]})]})]},x.id))})]}),e.jsxs(Pe,{isOpen:c,onClose:()=>d(!1),title:"Submit a Request",size:"lg",children:[e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Need help or have feedback?"})," Use this form to ask questions, report issues, request content updates, suggest new features, or get support with the platform."]})}),e.jsxs("form",{onSubmit:y,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Request Type *"}),e.jsxs("select",{value:p.contentType,onChange:x=>j(w=>({...w,contentType:x.target.value})),required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 appearance-none bg-white",disabled:u,children:[e.jsx("option",{value:"general_query",children:"General Query - Ask questions or get help"}),e.jsx("option",{value:"content_update",children:"Content Update - Report errors or request corrections"}),e.jsx("option",{value:"content_removal",children:"Content Removal - Request content to be removed"}),e.jsx("option",{value:"bug_report",children:"Bug Report - Report technical issues or glitches"}),e.jsx("option",{value:"feature_request",children:"Feature Request - Suggest new features or improvements"}),e.jsx("option",{value:"notes",children:"Study Notes - Issues with study notes"}),e.jsx("option",{value:"question_paper",children:"Question Paper - Issues with question papers"}),e.jsx("option",{value:"syllabus",children:"Syllabus - Issues with syllabus content"}),e.jsx("option",{value:"educational_link",children:"Educational Link - Issues with educational links"}),e.jsx("option",{value:"assignments",children:"Assignments - Issues with assignments"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose the category that best describes your request"})]}),e.jsx(ae,{label:"Content ID (Optional)",value:p.contentId,onChange:x=>j(w=>({...w,contentId:x.target.value})),placeholder:"Enter content ID if you know it",helpText:"If your request is about specific content, you can provide the content ID here",disabled:u}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Describe your request *"}),e.jsx("textarea",{value:p.issueDescription,onChange:x=>j(w=>({...w,issueDescription:x.target.value})),placeholder:"Please describe your query, issue, or request in detail...",rows:4,required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none",disabled:u}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Be as specific as possible to help us understand and address your request"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Details / Suggestions (Optional)"}),e.jsx("textarea",{value:p.suggestedChanges,onChange:x=>j(w=>({...w,suggestedChanges:x.target.value})),placeholder:"Any additional information, suggestions, or proposed solutions...",rows:3,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none",disabled:u})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:u,className:"w-full sm:w-auto order-2 sm:order-1",size:"sm",children:"Cancel"}),e.jsx(D,{type:"submit",loading:u,disabled:u||!p.issueDescription.trim(),className:"w-full sm:w-auto order-1 sm:order-2",size:"sm",children:"Submit Request"})]})]})]})]})})},cr=async s=>{const{data:t,error:a}=await f.from("profiles").select("*").eq("id",s).single();if(a){if(a.code==="PGRST116")return null;throw a}return t},dr=async s=>{const{data:t,error:a}=await f.from("content").select(`
      id,
      content_type,
      view_count,
      created_at,
      categories (
        name
      )
    `).eq("uploaded_by",s).eq("is_approved",!0);if(a)throw a;const{data:r,error:n}=await f.from("profiles").select("created_at").eq("id",s).single();if(n)throw n;const i=(t==null?void 0:t.length)||0,o=(t==null?void 0:t.reduce((g,y)=>g+(y.view_count||0),0))||0,c=new Date;c.setDate(c.getDate()-30);const d=(t==null?void 0:t.filter(g=>new Date(g.created_at)>c).length)||0,u=new Map;t==null||t.forEach(g=>{var T;const y=((T=g.categories)==null?void 0:T.name)||"Uncategorized";u.set(y,(u.get(y)||0)+1)});const m=Array.from(u.entries()).map(([g,y])=>({name:g,count:y})).sort((g,y)=>y.count-g.count),p=new Map;t==null||t.forEach(g=>{const y=g.content_type;p.set(y,(p.get(y)||0)+1)});const j=Array.from(p.entries()).map(([g,y])=>({type:g,count:y})).sort((g,y)=>y.count-g.count);return{totalUploads:i,totalViews:o,recentUploads:d,joinedDate:r.created_at,categories:m,contentTypes:j}},mr=async(s,t)=>{const{data:a,error:r}=await f.from("profiles").update(t).eq("id",s).select().single();if(r)throw r;return a},ur=async(s,t=20,a=0)=>{const{data:r,error:n}=await f.from("content").select(`
      *,
      categories (
        id,
        name,
        slug
      )
    `).eq("uploaded_by",s).eq("is_approved",!0).order("created_at",{ascending:!1}).range(a,a+t-1);if(n)throw n;return r||[]},xr=()=>{const{userId:s}=vt(),{user:t}=me(),[a,r]=l.useState(null),[n,i]=l.useState(null),[o,c]=l.useState([]),[d,u]=l.useState(!0),[m,p]=l.useState(!1),[j,g]=l.useState(null),[y,T]=l.useState(!1),[k,v]=l.useState(!1),[C,x]=l.useState(!1),[w,M]=l.useState(""),[b,h]=l.useState({username:"",full_name:"",bio:""}),P=(t==null?void 0:t.id)===s,R=l.useCallback(async()=>{if(s){u(!0);try{const[G,W]=await Promise.all([cr(s),dr(s)]);r(G),i(W),G&&h({username:G.username,full_name:G.full_name,bio:G.bio||""})}catch(G){console.error("Failed to fetch user data:",G)}finally{u(!1)}}},[s]),L=l.useCallback(async()=>{if(s){p(!0);try{const G=await ur(s,20,0);c(G)}catch(G){console.error("Failed to fetch user content:",G)}finally{p(!1)}}},[s]);l.useEffect(()=>{s&&R()},[s,R]),l.useEffect(()=>{s&&L()},[s,L]);const N=async G=>{if(G.preventDefault(),!(!t||!P)){x(!0),M("");try{await mr(t.id,{username:b.username.trim(),full_name:b.full_name.trim(),bio:b.bio.trim()||null}),await R(),v(!1)}catch(W){M(W.message||"Failed to update profile")}finally{x(!1)}}},B=G=>{g(G),T(!0)},X=G=>{switch(G){case"question_paper":return"Question Paper";case"notes":return"Notes";case"syllabus":return"Syllabus";case"assignments":return"Assignments";case"other":return"Other";default:return G}};return d?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Z,{size:"lg",text:"Loading profile..."})}):a?e.jsx("div",{className:"min-h-screen bg-gray-50 py-4 sm:py-6 lg:py-12 pb-20 sm:pb-4 lg:pb-0",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"card-premium p-4 sm:p-6 lg:p-8 mb-6 sm:mb-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 lg:space-x-6 w-full lg:w-auto",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-primary-500 to-primary-600 rounded-full flex items-center justify-center flex-shrink-0 mx-auto sm:mx-0",children:e.jsx(de,{className:"h-8 w-8 sm:h-10 sm:w-10 text-white"})}),e.jsxs("div",{className:"text-center sm:text-left w-full sm:w-auto",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 mb-1",children:a.full_name}),e.jsxs("p",{className:"text-base sm:text-lg text-gray-600 mb-2",children:["@",a.username]}),a.bio&&e.jsx("p",{className:"text-sm sm:text-base text-gray-700 max-w-md leading-relaxed",children:a.bio}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4 mt-3 text-xs sm:text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(vs,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsxs("span",{children:["Joined ",Ce(new Date(a.created_at),{addSuffix:!0})]})]}),a.is_admin&&e.jsx(re,{variant:"premium",size:"sm",children:"Admin"})]})]})]}),P&&e.jsxs(D,{onClick:()=>v(!0),variant:"outline",className:"flex items-center justify-center space-x-2 w-full sm:w-auto",size:"sm",children:[e.jsx(Qs,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit Profile"})]})]})}),n&&e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"card-premium p-3 sm:p-4 lg:p-6 text-center",children:[e.jsx(Xe,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary-600 mx-auto mb-2"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:n.totalUploads}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Total Uploads"})]}),e.jsxs("div",{className:"card-premium p-3 sm:p-4 lg:p-6 text-center",children:[e.jsx(Ue,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600 mx-auto mb-2"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:n.totalViews}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Total Views"})]}),e.jsxs("div",{className:"card-premium p-3 sm:p-4 lg:p-6 text-center",children:[e.jsx(Ws,{className:"h-6 w-6 sm:h-8 sm:w-8 text-green-600 mx-auto mb-2"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:n.recentUploads}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Recent Uploads"})]}),e.jsxs("div",{className:"card-premium p-3 sm:p-4 lg:p-6 text-center",children:[e.jsx(ps,{className:"h-6 w-6 sm:h-8 sm:w-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:n.categories.length}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Categories"})]})]}),n&&(n.contentTypes.length>0||n.categories.length>0)&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 lg:gap-8 mb-6 sm:mb-8",children:[n.contentTypes.length>0&&e.jsxs("div",{className:"card-premium p-4 sm:p-6",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4 flex items-center space-x-2",children:[e.jsx(ce,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{children:"Content Types"})]}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:n.contentTypes.map((G,W)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-700 truncate",children:X(G.type)}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2",children:[e.jsx("div",{className:"w-16 sm:w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-600 h-2 rounded-full transition-all duration-500",style:{width:`${G.count/n.totalUploads*100}%`,animationDelay:`${W*.1}s`}})}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-900 w-6 sm:w-8 text-right",children:G.count})]})]},G.type))})]}),n.categories.length>0&&e.jsxs("div",{className:"card-premium p-4 sm:p-6",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4 flex items-center space-x-2",children:[e.jsx(ps,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{children:"Top Categories"})]}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:n.categories.slice(0,5).map((G,W)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-700 truncate",children:G.name}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2",children:[e.jsx("div",{className:"w-16 sm:w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:`${G.count/n.totalUploads*100}%`,animationDelay:`${W*.1}s`}})}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-900 w-6 sm:w-8 text-right",children:G.count})]})]},G.name))})]})]}),e.jsxs("div",{className:"card-premium p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900",children:P?"Your Uploads":`${a.full_name}'s Uploads`}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600",children:[o.length," items"]})]}),m?e.jsx("div",{className:"flex justify-center py-8 sm:py-12",children:e.jsx(Z,{})}):o.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx(ce,{className:"h-12 w-12 sm:h-16 sm:w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-2",children:P?"No uploads yet":"No public uploads"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 px-4",children:P?"Start sharing your study materials with the community":"This user hasn't shared any content yet"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:o.map((G,W)=>e.jsx("div",{className:"animate-fade-in-up",style:{animationDelay:`${W*.1}s`},children:e.jsx(_s,{content:G,onClick:()=>B(G),showUploader:!1})},G.id))})]}),e.jsx(Ss,{content:j,isOpen:y,onClose:()=>{T(!1),g(null)}}),e.jsx(Pe,{isOpen:k,onClose:()=>v(!1),title:"Edit Profile",size:"md",children:e.jsxs("form",{onSubmit:N,className:"space-y-4 sm:space-y-6",children:[w&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200",children:w}),e.jsx(ae,{name:"username",label:"Username",value:b.username,onChange:G=>h(W=>({...W,username:G.target.value})),placeholder:"Enter username",required:!0,disabled:C,premium:!0}),e.jsx(ae,{name:"full_name",label:"Full Name",value:b.full_name,onChange:G=>h(W=>({...W,full_name:G.target.value})),placeholder:"Enter full name",required:!0,disabled:C,premium:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio (Optional)"}),e.jsx("textarea",{name:"bio",value:b.bio,onChange:G=>h(W=>({...W,bio:G.target.value})),placeholder:"Tell us about yourself...",rows:3,className:"input-premium resize-none",disabled:C,maxLength:500}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[b.bio.length,"/500 characters"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>v(!1),disabled:C,className:"w-full sm:w-auto order-2 sm:order-1",size:"sm",children:"Cancel"}),e.jsx(D,{type:"submit",loading:C,disabled:C,className:"w-full sm:w-auto order-1 sm:order-2",size:"sm",children:"Save Changes"})]})]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(de,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"User not found"}),e.jsx("p",{className:"text-gray-600",children:"The user profile you're looking for doesn't exist."})]})})},hr=()=>{const s=[{title:"Getting Started",icon:Ks,items:[{question:"How do I create an account?",answer:'Click the "Sign In" button and choose "Create Account". Fill in your details and verify your email to get started.'},{question:"How do I upload content?",answer:"Navigate to the Upload page, select your file type, add a title and description, choose a category, and click upload."},{question:"How do I browse content?",answer:"Use the Browse page to see all content, or visit Categories to filter by specific topics."},{question:"What file types are supported?",answer:"We support PDF documents, images (JPG, PNG), and text files. Maximum file size is 10MB."}]},{title:"Messaging & Chat",icon:Ne,items:[{question:"How do I send private messages?",answer:"Click the message icon in the navbar, search for a user, and start a conversation."},{question:"How do I join the global chat?",answer:"Navigate to the Chat page to participate in community discussions."},{question:"Can I see when someone is online?",answer:"Yes, green dots indicate when users are online in conversations."},{question:"How do I report inappropriate messages?",answer:"Click the flag icon next to any message to report it to administrators."}]},{title:"Account & Profile",icon:_e,items:[{question:"How do I update my profile?",answer:"Click on your username in the navbar to access your profile settings."},{question:"How do I change my password?",answer:'Go to your profile settings and click "Change Password".'},{question:"Can I delete my account?",answer:"Contact support through the Contact Us page to request account deletion."},{question:"How do I view my uploaded content?",answer:'Visit the "My Requests" page to see all your uploads and their status.'}]},{title:"Content & Categories",icon:ke,items:[{question:"How are content submissions reviewed?",answer:"All uploads are reviewed by administrators before being published to ensure quality and appropriateness."},{question:"Why was my content rejected?",answer:"Content may be rejected for violating community guidelines, being inappropriate, or not meeting quality standards."},{question:"How do I request a new category?",answer:"Contact administrators through the Contact Us page with your category suggestion."},{question:"Can I edit my uploaded content?",answer:"Currently, you need to contact support to make changes to published content."}]},{title:"Technical Issues",icon:Bs,items:[{question:"The website is not loading properly",answer:"Try refreshing the page, clearing your browser cache, or using a different browser."},{question:"I'm not receiving email notifications",answer:"Check your spam folder and ensure your email is verified in your profile settings."},{question:"Upload is failing",answer:"Ensure your file is under 10MB and in a supported format. Check your internet connection."},{question:"Messages are not sending",answer:"Refresh the page and try again. If the issue persists, contact support."}]}];return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(ye,{to:"/",className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 mb-4 transition-colors",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Back to Home"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-3 bg-primary-100 rounded-xl",children:e.jsx(ns,{className:"h-8 w-8 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Help Center"}),e.jsx("p",{className:"text-gray-600",children:"Find answers to frequently asked questions"})]})]})})]}),e.jsx("div",{className:"space-y-6",children:s.map((t,a)=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(t.icon,{className:"h-6 w-6 text-primary-600"})}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:t.title})]}),e.jsx("div",{className:"space-y-4",children:t.items.map((r,n)=>e.jsxs("details",{className:"group",children:[e.jsxs("summary",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:r.question}),e.jsx("div",{className:"ml-4 flex-shrink-0",children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-primary-100 flex items-center justify-center group-open:rotate-45 transition-transform",children:e.jsx("span",{className:"text-primary-600 text-sm font-bold",children:"+"})})})]}),e.jsx("div",{className:"mt-3 px-4 pb-4",children:e.jsx("p",{className:"text-gray-600 leading-relaxed",children:r.answer})})]},n))})]},a))}),e.jsxs("div",{className:"mt-12 bg-gradient-to-r from-primary-500 to-primary-600 rounded-2xl p-8 text-white text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Still need help?"}),e.jsx("p",{className:"mb-6 text-primary-100",children:"Can't find what you're looking for? Our support team is here to help."}),e.jsxs(ye,{to:"/contact",className:"inline-flex items-center gap-2 bg-white text-primary-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors",children:[e.jsx(Ne,{className:"h-5 w-5"}),"Contact Support"]})]})]})})},pr=()=>e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(ye,{to:"/",className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 mb-4 transition-colors",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Back to Home"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:e.jsx(ke,{className:"h-8 w-8 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Privacy Policy"}),e.jsx("p",{className:"text-gray-600",children:"Last updated: August 21, 2025"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 space-y-8",children:[e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Ue,{className:"h-6 w-6 text-primary-600"}),"Introduction"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:'JU CONNECTS ("we," "our," or "us") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our educational content sharing platform. By using JU CONNECTS, you agree to the collection and use of information in accordance with this policy.'})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Dt,{className:"h-6 w-6 text-blue-600"}),"Information We Collect"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Personal Information"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:[e.jsx("li",{children:"Email address and username"}),e.jsx("li",{children:"Full name and profile information"}),e.jsx("li",{children:"Academic institution details (if provided)"}),e.jsx("li",{children:"Profile picture (optional)"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Content Information"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:[e.jsx("li",{children:"Files and documents you upload"}),e.jsx("li",{children:"Messages and chat communications"}),e.jsx("li",{children:"Comments and feedback on content"}),e.jsx("li",{children:"Usage patterns and preferences"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Technical Information"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:[e.jsx("li",{children:"IP address and device information"}),e.jsx("li",{children:"Browser type and version"}),e.jsx("li",{children:"Login timestamps and activity logs"}),e.jsx("li",{children:"Cookies and local storage data"})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(_e,{className:"h-6 w-6 text-purple-600"}),"How We Use Your Information"]}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"To provide and maintain our educational platform services"}),e.jsx("li",{children:"To facilitate content sharing and academic collaboration"}),e.jsx("li",{children:"To enable messaging and communication features"}),e.jsx("li",{children:"To moderate content and ensure community safety"}),e.jsx("li",{children:"To send important notifications about your account or content"}),e.jsx("li",{children:"To analyze usage patterns and improve our services"}),e.jsx("li",{children:"To prevent fraud and maintain platform security"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Information Sharing and Disclosure"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"We do not sell, trade, or rent your personal information to third parties. We may share your information only in the following circumstances:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"With Your Consent:"})," When you explicitly agree to share information"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Public Content:"})," Content you upload is visible to other platform users"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Legal Requirements:"})," When required by law or to protect our rights"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Service Providers:"})," With trusted partners who help operate our platform"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Safety:"})," To prevent harm or illegal activities"]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(ke,{className:"h-6 w-6 text-green-600"}),"Data Security"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-4",children:"We implement industry-standard security measures to protect your information:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Encryption of data in transit and at rest"}),e.jsx("li",{children:"Regular security audits and monitoring"}),e.jsx("li",{children:"Secure authentication and access controls"}),e.jsx("li",{children:"Automatic logout for inactive sessions"}),e.jsx("li",{children:"Regular backup and disaster recovery procedures"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Your Rights and Choices"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"You have the following rights regarding your personal information:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Access:"})," Request a copy of your personal data"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Correction:"})," Update or correct inaccurate information"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Deletion:"})," Request deletion of your account and data"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Portability:"})," Export your data in a readable format"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Opt-out:"})," Unsubscribe from notifications"]})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Cookies and Tracking"}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-4",children:"We use cookies and similar technologies to enhance your experience:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Essential cookies for platform functionality"}),e.jsx("li",{children:"Preference cookies to remember your settings"}),e.jsx("li",{children:"Analytics cookies to understand usage patterns"}),e.jsx("li",{children:"Session cookies for authentication"})]}),e.jsx("p",{className:"text-gray-600 mt-4",children:"You can control cookie settings through your browser preferences."})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Ze,{className:"h-6 w-6 text-red-600"}),"Data Retention"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"We retain your information for as long as necessary to provide our services and comply with legal obligations:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2 mt-4",children:[e.jsx("li",{children:"Account information: Until account deletion"}),e.jsx("li",{children:"Uploaded content: As long as publicly available"}),e.jsx("li",{children:"Messages: 2 years or until deletion request"}),e.jsx("li",{children:"Logs and analytics: 1 year for security purposes"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Children's Privacy"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"JU CONNECTS is designed for university students and educators (18+). We do not knowingly collect personal information from children under 18. If we discover that a child under 18 has provided personal information, we will delete it immediately."})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(zt,{className:"h-6 w-6 text-yellow-600"}),"Updates to This Policy"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"We may update this Privacy Policy periodically. We will notify you of significant changes via email or platform notification. Your continued use of JU CONNECTS after changes indicates acceptance of the updated policy."})]}),e.jsxs("section",{className:"bg-gray-50 rounded-xl p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Contact Us"}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-4",children:"If you have questions about this Privacy Policy or how we handle your information, please contact us:"}),e.jsxs("div",{className:"space-y-2 text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," jecrcuconnects@gmail.com"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Support:"})," Visit our ",e.jsx(ye,{to:"/contact",className:"text-primary-600 hover:underline",children:"Contact Us"})," page"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," JECRC University, Jaipur, Rajasthan 302022, India"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Made by:"})," Pritam Ray (@impritamray@gmail.com)"]})]})]})]})]})}),gr=()=>e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(ye,{to:"/",className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 mb-4 transition-colors",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Back to Home"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(ce,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Terms of Service"}),e.jsx("p",{className:"text-gray-600",children:"Last updated: August 21, 2025"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 space-y-8",children:[e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Gt,{className:"h-6 w-6 text-blue-600"}),"Agreement to Terms"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:'By accessing and using JU CONNECTS ("the Platform"), you accept and agree to be bound by the terms and provision of this agreement. These Terms of Service ("Terms") govern your use of our educational content sharing platform operated by JECRC University Connect ("we," "us," or "our").'}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400",children:e.jsx("p",{className:"text-blue-700 font-medium",children:"If you do not agree to abide by the above, please do not use this service."})})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(_e,{className:"h-6 w-6 text-green-600"}),"Eligibility"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-4",children:"JU CONNECTS is intended for educational purposes and is available to:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Current students of JECRC University and affiliated institutions"}),e.jsx("li",{children:"Faculty members and academic staff"}),e.jsx("li",{children:"Alumni and educational researchers"}),e.jsx("li",{children:"Individuals aged 18 years or older"}),e.jsx("li",{children:"Users with legitimate educational interests"})]}),e.jsx("p",{className:"text-gray-600 mt-4",children:"By registering, you represent that you meet these eligibility requirements and that all information provided is accurate and truthful."})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(ke,{className:"h-6 w-6 text-purple-600"}),"Account Responsibilities"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"When you create an account, you agree to:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Provide accurate and complete registration information"}),e.jsx("li",{children:"Maintain the security of your password and account"}),e.jsx("li",{children:"Notify us immediately of any unauthorized use"}),e.jsx("li",{children:"Accept responsibility for all activities under your account"}),e.jsx("li",{children:"Use your real name and authentic information"}),e.jsx("li",{children:"Maintain one account per person"})]}),e.jsx("div",{className:"p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-400",children:e.jsxs("p",{className:"text-yellow-700",children:[e.jsx("strong",{children:"Important:"})," You are responsible for maintaining the confidentiality of your account credentials."]})})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Acceptable Use Policy"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"You may use JU CONNECTS to:"}),e.jsxs("ul",{className:"list-disc list-inside text-green-600 space-y-1",children:[e.jsx("li",{children:"Share educational content and academic resources"}),e.jsx("li",{children:"Collaborate on educational projects and research"}),e.jsx("li",{children:"Participate in academic discussions and forums"}),e.jsx("li",{children:"Access and download shared educational materials"}),e.jsx("li",{children:"Connect with fellow students and educators"})]}),e.jsx("p",{className:"text-gray-600 font-medium mt-6",children:"You may NOT use JU CONNECTS to:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-600 space-y-1",children:[e.jsx("li",{children:"Upload copyrighted material without permission"}),e.jsx("li",{children:"Share inappropriate, offensive, or harmful content"}),e.jsx("li",{children:"Engage in harassment, bullying, or discriminatory behavior"}),e.jsx("li",{children:"Spam, advertise, or promote commercial activities"}),e.jsx("li",{children:"Attempt to hack, disrupt, or damage the platform"}),e.jsx("li",{children:"Create fake accounts or impersonate others"}),e.jsx("li",{children:"Share personal information of others without consent"}),e.jsx("li",{children:"Use automated tools to scrape or download content"})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Content Guidelines"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Content You Upload"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Must be educational, academic, or research-related"}),e.jsx("li",{children:"Should be original work or properly attributed"}),e.jsx("li",{children:"Must not violate copyright or intellectual property rights"}),e.jsx("li",{children:"Should be appropriate for an academic environment"}),e.jsx("li",{children:"Must comply with applicable laws and regulations"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 mt-6",children:"Content Moderation"}),e.jsx("p",{className:"text-gray-600",children:"All uploaded content is subject to review and approval by our moderation team. We reserve the right to remove content that violates these guidelines or is deemed inappropriate for our educational platform."})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Oe,{className:"h-6 w-6 text-yellow-600"}),"Intellectual Property Rights"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Your Content"}),e.jsx("p",{className:"text-gray-600",children:"You retain ownership of content you create and upload to JU CONNECTS. By uploading content, you grant us a non-exclusive, worldwide license to host, display, and distribute your content on the platform for educational purposes."}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Platform Content"}),e.jsx("p",{className:"text-gray-600",children:"The JU CONNECTS platform, including its design, features, and functionality, is owned by us and protected by copyright and other intellectual property laws."}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Respect for Others' Rights"}),e.jsx("p",{className:"text-gray-600",children:"You must respect the intellectual property rights of others. If you believe content infringes your rights, please contact us immediately through our reporting system."})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Privacy and Data Usage"}),e.jsxs("p",{className:"text-gray-600 leading-relaxed",children:["Your privacy is important to us. Our collection and use of personal information is governed by our ",e.jsx(ye,{to:"/privacy",className:"text-primary-600 hover:underline",children:"Privacy Policy"}),", which is incorporated into these Terms by reference. By using JU CONNECTS, you also consent to our Privacy Policy."]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Lt,{className:"h-6 w-6 text-red-600"}),"Prohibited Activities"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"The following activities are strictly prohibited:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-red-700 mb-2",children:"Security Violations"}),e.jsxs("ul",{className:"text-red-600 text-sm space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Attempting to breach security measures"}),e.jsx("li",{children:"‚Ä¢ Accessing others' accounts without permission"}),e.jsx("li",{children:"‚Ä¢ Introducing malware or viruses"}),e.jsx("li",{children:"‚Ä¢ Reverse engineering the platform"})]})]}),e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-orange-700 mb-2",children:"Content Violations"}),e.jsxs("ul",{className:"text-orange-600 text-sm space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Uploading illegal or harmful content"}),e.jsx("li",{children:"‚Ä¢ Sharing copyrighted material illegally"}),e.jsx("li",{children:"‚Ä¢ Posting spam or unwanted content"}),e.jsx("li",{children:"‚Ä¢ Misrepresenting content ownership"})]})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Qe,{className:"h-6 w-6 text-orange-600"}),"Enforcement and Consequences"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Violations of these Terms may result in:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Warning notifications"}),e.jsx("li",{children:"Temporary suspension of account privileges"}),e.jsx("li",{children:"Removal of violating content"}),e.jsx("li",{children:"Permanent account termination"}),e.jsx("li",{children:"Legal action in severe cases"})]}),e.jsx("div",{className:"p-4 bg-orange-50 rounded-lg border-l-4 border-orange-400",children:e.jsx("p",{className:"text-orange-700",children:"We reserve the right to investigate violations and take appropriate action at our discretion."})})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Disclaimers and Limitations"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:'JU CONNECTS is provided "as is" without warranties of any kind. We do not guarantee:'}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Uninterrupted or error-free service"}),e.jsx("li",{children:"Accuracy or reliability of content"}),e.jsx("li",{children:"Security against all threats"}),e.jsx("li",{children:"Compatibility with all devices or browsers"})]}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Your use of the platform is at your own risk. We are not liable for any damages arising from your use of JU CONNECTS."})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Changes to Terms"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"We may modify these Terms at any time. Significant changes will be announced through the platform or via email. Your continued use after changes indicates acceptance of the new Terms. If you disagree with changes, you must stop using the platform."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Termination"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"Either party may terminate your account at any time. Upon termination, your right to use the platform ceases immediately. We may retain certain information as required by law or for legitimate business purposes."})]}),e.jsxs("section",{className:"bg-gray-50 rounded-xl p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Questions About These Terms"}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-4",children:"If you have questions about these Terms of Service, please contact us:"}),e.jsxs("div",{className:"space-y-2 text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," jecrcuconnects@gmail.com"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Support:"})," Visit our ",e.jsx(ye,{to:"/contact",className:"text-primary-600 hover:underline",children:"Contact Us"})," page"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," JECRC University, Jaipur, Rajasthan 302022, India"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Made by:"})," Pritam Ray (@impritamray@gmail.com)"]})]})]})]})]})}),fr=()=>{const[s,t]=l.useState({name:"",email:"",subject:"",category:"general",message:""}),[a,r]=l.useState(!1),[n,i]=l.useState(!1),o=[{value:"general",label:"General Inquiry"},{value:"technical",label:"Technical Support"},{value:"content",label:"Content Issues"},{value:"account",label:"Account Problems"},{value:"privacy",label:"Privacy Concerns"},{value:"feedback",label:"Feedback & Suggestions"}],c=p=>{const{name:j,value:g}=p.target;t(y=>({...y,[j]:g}))},d=async p=>{p.preventDefault(),r(!0),await new Promise(j=>setTimeout(j,2e3)),i(!0),r(!1),setTimeout(()=>{i(!1),t({name:"",email:"",subject:"",category:"general",message:""})},3e3)},u=[{icon:Ke,title:"Email Support",description:"Get help via email",contact:"jecrcuconnects@gmail.com",response:"Response within 24 hours"},{icon:Ne,title:"Live Chat",description:"Chat with our support team",contact:"Available 9 AM - 6 PM",response:"Instant response"},{icon:$s,title:"Phone Support",description:"Call for urgent issues",contact:"+91 33 2414-6666",response:"Mon-Fri, 9 AM - 5 PM"}],m=[{question:"How quickly do you respond to support requests?",answer:"We aim to respond to all inquiries within 24 hours during business days."},{question:"Can I get help with technical issues?",answer:"Yes! Our technical support team can help with platform issues, login problems, and more."},{question:"How do I report inappropriate content?",answer:"Use the report button on any content, or contact us directly with details."},{question:"Can you help with account recovery?",answer:"Absolutely. Contact us with your account details and we'll help you regain access."}];return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(ye,{to:"/",className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 mb-4 transition-colors",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Back to Home"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-3 bg-primary-100 rounded-xl",children:e.jsx(Ne,{className:"h-8 w-8 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Contact Us"}),e.jsx("p",{className:"text-gray-600",children:"We're here to help! Reach out with any questions or concerns."})]})]})})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-6",children:"Send us a Message"}),n?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Le,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Message Sent!"}),e.jsx("p",{className:"text-gray-600",children:"Thank you for contacting us. We'll get back to you soon."})]}):e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",value:s.name,onChange:c,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Your full name"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:c,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"your.email@example.com"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsx("select",{id:"category",name:"category",value:s.category,onChange:c,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:o.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject *"}),e.jsx("input",{type:"text",id:"subject",name:"subject",value:s.subject,onChange:c,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Brief description of your inquiry"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:"Message *"}),e.jsx("textarea",{id:"message",name:"message",value:s.message,onChange:c,required:!0,rows:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none",placeholder:"Please provide as much detail as possible about your inquiry..."})]}),e.jsx(D,{type:"submit",disabled:a,className:"w-full bg-primary-600 text-white py-3 rounded-lg hover:bg-primary-700 disabled:opacity-50 flex items-center justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:"sm"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"h-5 w-5"}),"Send Message"]})})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Other Ways to Reach Us"}),e.jsx("div",{className:"space-y-4",children:u.map((p,j)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(p.icon,{className:"h-5 w-5 text-primary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:p.title}),e.jsx("p",{className:"text-sm text-gray-600",children:p.description}),e.jsx("p",{className:"text-sm font-medium text-primary-600",children:p.contact}),e.jsx("p",{className:"text-xs text-gray-500",children:p.response})]})]},j))})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ot,{className:"h-5 w-5 text-primary-600"}),"Our Office"]}),e.jsxs("div",{className:"space-y-3 text-gray-600",children:[e.jsx("p",{children:e.jsx("strong",{children:"JU CONNECTS Support Center"})}),e.jsxs("p",{children:["Made by Pritam Ray (@impritamray@gmail.com)",e.jsx("br",{}),"JECRC University",e.jsx("br",{}),"Plot No. IS-2036 to IS-2039 Ramchandrapura Industrial Area",e.jsx("br",{}),"Jaipur, Sitapura, Vidhani, Rajasthan 302022",e.jsx("br",{}),"India"]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(is,{className:"h-4 w-4 text-primary-600"}),e.jsx("span",{className:"font-medium",children:"Office Hours"})]}),e.jsx("p",{className:"text-sm",children:"Monday - Friday: 9:00 AM - 6:00 PM"}),e.jsx("p",{className:"text-sm",children:"Saturday: 10:00 AM - 4:00 PM"}),e.jsx("p",{className:"text-sm",children:"Sunday: Closed"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ns,{className:"h-5 w-5 text-primary-600"}),"Quick FAQ"]}),e.jsx("div",{className:"space-y-4",children:m.map((p,j)=>e.jsxs("details",{className:"group",children:[e.jsxs("summary",{className:"flex items-center justify-between cursor-pointer text-sm font-medium text-gray-900 hover:text-primary-600",children:[p.question,e.jsx("span",{className:"ml-2 transform group-open:rotate-45 transition-transform",children:"+"})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 leading-relaxed",children:p.answer})]},j))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsx(ye,{to:"/help",className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"View Full Help Center ‚Üí"})})]})]})]})]})})},yr={getAllGroups:{calls:0,lastReset:Date.now(),maxCalls:2,resetInterval:6e4},getUserGroups:{calls:0,lastReset:Date.now(),maxCalls:3,resetInterval:6e4}},ks={allGroups:{data:null,timestamp:0,ttl:3e4}},br=(s,t)=>{{const a=ks.allGroups;if(a.data&&Date.now()-a.timestamp<a.ttl)return a.data}return null},jr=(s,t,a)=>{ks.allGroups={data:t,timestamp:Date.now(),ttl:3e4}},dt=s=>{const t=yr[s],a=Date.now();return a-t.lastReset>t.resetInterval&&(t.calls=0,t.lastReset=a),t.calls>=t.maxCalls?!1:(t.calls++,!0)},wr=async()=>{if(!f)return console.error("Supabase not available"),[];const s=br();if(s)return s;if(!dt("getAllGroups"))return console.warn("getAllClassGroups: Rate limit exceeded, returning cached/empty data"),ks.allGroups.data||[];try{const{data:t,error:a}=await f.from("class_groups").select("id, name, description, year, section, subject, member_count, created_by, is_active, is_password_protected, created_at, updated_at").eq("is_active",!0).order("year",{ascending:!0}).order("section",{ascending:!0}).limit(10);if(a){if(console.error("Error fetching all groups:",a),a.code==="42P01")return console.warn("class_groups table does not exist yet"),[];throw a}const r=(t||[]).map(n=>({...n,is_member:!1,user_role:void 0,unread_count:0,join_status:n.is_password_protected?"üîí Password Protected":"Open to Join",password_hash:null}));return jr("allGroups",r),r}catch(t){return console.error("Error fetching all groups:",t),[]}},vr=async s=>{if(!f||!s)return console.error("Supabase not available or no user ID provided"),[];if(!dt("getUserGroups"))return console.warn("getUserGroups: Rate limit exceeded, returning cached/empty data"),[];try{const{data:t,error:a}=await f.from("group_members").select(`
        group_id,
        role,
        joined_at,
        class_groups!inner (
          id,
          name,
          description,
          year,
          section,
          subject,
          member_count,
          created_by,
          is_active,
          created_at,
          updated_at
        )
      `).eq("user_id",s).eq("is_active",!0).eq("class_groups.is_active",!0);if(a)throw console.error("Error fetching user groups:",a),a;return(t||[]).map(r=>({id:r.class_groups.id,name:r.class_groups.name,description:r.class_groups.description,year:r.class_groups.year,section:r.class_groups.section,subject:r.class_groups.subject,created_by:r.class_groups.created_by,is_active:r.class_groups.is_active,member_count:r.class_groups.member_count,created_at:r.class_groups.created_at,updated_at:r.class_groups.updated_at,user_role:r.role,unread_count:0,is_member:!0}))}catch(t){return console.error("Error fetching user groups:",t),[]}},Nr=async s=>{if(!f)throw new Error("Database connection not available");if(!s.name||!s.year||!s.section||!s.subject||!s.created_by)throw new Error("Missing required fields for group creation");const t={name:s.name,description:s.description||"",year:s.year,section:s.section,subject:s.subject,created_by:s.created_by,is_password_protected:!!s.password,member_count:1,is_active:!0},{data:a,error:r}=await f.from("class_groups").insert([t]).select().single();if(r)throw console.error("Error creating group:",r),new Error("Failed to create group");return a},Fs=async(s,t,a)=>{if(!f)throw new Error("Supabase not available");const{data:r,error:n}=await f.from("class_groups").select("is_password_protected").eq("id",s).single();if(n)throw new Error("Group not found");if(r.is_password_protected){if(!a)throw new Error("This group requires a password to join");const{data:c,error:d}=await f.rpc("verify_group_password",{group_id_param:s,password_param:a});if(d)throw new Error("Error verifying password");if(!c)throw new Error("Incorrect password")}const{data:i}=await f.from("group_members").select("*").eq("group_id",s).eq("user_id",t).single();if(i){if(i.is_active)throw new Error("You are already a member of this group");{const{error:c}=await f.from("group_members").update({is_active:!0}).eq("group_id",s).eq("user_id",t);if(c)throw console.error("Error reactivating membership:",c),new Error("Failed to rejoin group. Please try again.");return}}const{error:o}=await f.from("group_members").insert([{group_id:s,user_id:t,role:"member"}]);if(o)throw console.error("Error joining group:",o),o.message.includes("infinite recursion")?new Error("Database configuration issue. Please contact support or try again later."):o.code==="23505"?new Error("You are already a member of this group"):new Error(`Failed to join group: ${o.message}`)},Cr=async(s,t)=>{if(!f)throw new Error("Supabase not available");const{error:a}=await f.from("group_members").update({is_active:!1}).eq("group_id",s).eq("user_id",t);if(a)throw a},mt=async s=>{if(!f)return console.warn("Supabase not available for getGroupMembers"),[];if(!s)return console.warn("No group ID provided for getGroupMembers"),[];try{const{data:t,error:a}=await f.from("group_members").select(`
        *,
        profiles (
          id,
          username,
          full_name,
          avatar_url,
          is_online,
          last_seen
        )
      `).eq("group_id",s).eq("is_active",!0).order("role",{ascending:!1}).order("joined_at",{ascending:!0});if(a){if(console.error("Database error in getGroupMembers:",a),a.code==="42P01")return console.warn("group_members table does not exist yet"),[];throw a}return t||[]}catch(t){if(console.error("Error in getGroupMembers:",t),t instanceof Error&&t.message.includes("table does not exist"))return[];throw t}},Ds=async(s,t,a,r="text",n,i)=>{if(!f)throw new Error("Supabase not available");if(!s||!t||!a.trim())throw new Error("Missing required parameters");try{const o={group_id:s,user_id:t,message:a.trim(),message_type:r,file_url:(n==null?void 0:n.file_url)||null,file_name:(n==null?void 0:n.file_name)||null,file_size:(n==null?void 0:n.file_size)||null,reply_to:i||null},{data:c,error:d}=await f.from("group_messages").insert([o]).select().single();if(d)throw console.error("Error sending message:",d),d.code==="42P01"?new Error("There is a technical issue. Please try again later."):d.code==="42501"?new Error("You are already in this group"):new Error("Could not join the group. Please try again.");return c}catch(o){throw console.error("Error in sendGroupMessage:",o),o}},_r=async(s,t=50,a=0)=>{if(!f)return[];if(!s)return[];try{const{data:r,error:n}=await f.from("group_messages").select("*").eq("group_id",s).order("created_at",{ascending:!1}).range(a,a+t-1);if(n)throw n;if(!r||r.length===0)return[];const i=[...new Set(r.map(u=>u.user_id))],{data:o}=await f.from("profiles").select("id, username, full_name, avatar_url").in("id",i),c=new Map;return o==null||o.forEach(u=>{c.set(u.id,u)}),r.map(u=>({...u,profiles:c.get(u.user_id)||{id:u.user_id,username:"Unknown User",full_name:"Unknown User",avatar_url:null}})).reverse()}catch(r){if(console.error("Error fetching group messages:",r),r instanceof Error&&r.message.includes("table does not exist"))return[];throw r}},ut=async(s,t)=>{if(!f)throw new Error("Supabase not available");const{data:a,error:r}=await f.rpc("is_group_admin",{group_id_param:s,user_id_param:t});return r?(console.error("Error checking admin status:",r),!1):a||!1},Sr=async(s,t,a)=>{if(!f)throw new Error("Supabase not available");const{data:r,error:n}=await f.rpc("promote_to_admin",{group_id_param:s,target_user_id_param:t,requesting_user_id_param:a});if(n)throw n;return r},kr=async(s,t,a)=>{if(!f)throw new Error("Supabase not available");const{data:r,error:n}=await f.rpc("demote_admin",{group_id_param:s,target_user_id_param:t,requesting_user_id_param:a});if(n)throw n;return r},Er=async(s,t,a)=>{if(!f)throw new Error("Supabase not available");const{data:r,error:n}=await f.rpc("remove_group_member",{group_id_param:s,target_user_id_param:t,requesting_user_id_param:a});if(n)throw n;return r},Pr=async(s,t,a,r)=>{if(!f)throw new Error("Supabase not available");const{data:n,error:i}=await f.rpc("update_group_details",{group_id_param:s,new_name:t||null,new_description:a||null,requesting_user_id_param:r});if(i)throw i;return n},Tr=async(s,t)=>{if(!f)throw new Error("Supabase not available");const{data:a,error:r}=await f.rpc("delete_group",{group_id_param:s,requesting_user_id_param:t});if(r)throw r;return a},Mr=async s=>{if(!f)throw new Error("Supabase not available");const{data:t,error:a}=await f.from("group_admin_info").select("*").eq("group_id",s).single();if(a)throw a;return t},Rr=({isOpen:s,onClose:t,onSuccess:a})=>{const{user:r}=me(),[n,i]=l.useState(!1),[o,c]=l.useState(""),[d,u]=l.useState({name:"",description:"",year:1,section:"",subject:"",isPasswordProtected:!1,password:"",confirmPassword:""}),[m,p]=l.useState(!1),j=async y=>{if(y.preventDefault(),!(!r||n)){if(d.isPasswordProtected){if(!d.password){c("Password is required for protected groups");return}if(d.password!==d.confirmPassword){c("Passwords do not match");return}if(d.password.length<4){c("Password must be at least 4 characters long");return}}i(!0),c("");try{await Nr({name:d.name.trim(),description:d.description.trim()||void 0,year:d.year,section:d.section.trim().toUpperCase(),subject:d.subject.trim()||void 0,created_by:r.id,password:d.isPasswordProtected?d.password:void 0}),u({name:"",description:"",year:1,section:"",subject:"",isPasswordProtected:!1,password:"",confirmPassword:""}),a()}catch(T){T.code==="23505"?c("A group like this already exists. Please try different details."):c(T.message||"Could not create the group. Please try again.")}finally{i(!1)}}},g=y=>{const{name:T,value:k,type:v}=y.target;if(v==="checkbox"){const C=y.target;u(x=>({...x,[T]:C.checked}))}else u(C=>({...C,[T]:T==="year"?parseInt(k):k}))};return e.jsx(Pe,{isOpen:s,onClose:t,title:"Create Class Group",size:"lg",children:e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[o&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200",children:o}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-blue-50 rounded-lg",children:[e.jsx(_e,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Create Your Class Group"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Bring your classmates together for better collaboration"})]})]}),e.jsx(ae,{name:"name",label:"Group Name *",value:d.name,onChange:g,placeholder:"e.g., Computer Science 4th Year Section B",required:!0,disabled:n,premium:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Year *"}),e.jsx("select",{name:"year",value:d.year,onChange:g,required:!0,className:"input-premium appearance-none cursor-pointer",disabled:n,children:[1,2,3,4,5].map(y=>e.jsxs("option",{value:y,children:["Year ",y]},y))})]}),e.jsx(ae,{name:"section",label:"Section *",value:d.section,onChange:g,placeholder:"e.g., A, B, C",required:!0,disabled:n,premium:!0})]}),e.jsx(ae,{name:"subject",label:"Subject (Optional)",value:d.subject,onChange:g,placeholder:"e.g., Computer Science, Mathematics",disabled:n,premium:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),e.jsx("textarea",{name:"description",value:d.description,onChange:g,placeholder:"Brief description of the group purpose...",rows:3,className:"input-premium resize-none",disabled:n})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(ze,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Group Privacy"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Control who can join your group"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"isPasswordProtected",name:"isPasswordProtected",checked:d.isPasswordProtected,onChange:g,disabled:n,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"isPasswordProtected",className:"text-sm font-medium text-gray-700",children:"Password protect this group"})]}),d.isPasswordProtected&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ae,{name:"password",label:"Group Password *",type:m?"text":"password",value:d.password,onChange:g,placeholder:"Enter password (min 4 characters)",required:d.isPasswordProtected,disabled:n,premium:!0}),e.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600",children:m?e.jsx(ms,{className:"h-4 w-4"}):e.jsx(Ue,{className:"h-4 w-4"})})]}),e.jsx(ae,{name:"confirmPassword",label:"Confirm Password *",type:"password",value:d.confirmPassword,onChange:g,placeholder:"Confirm your password",required:d.isPasswordProtected,disabled:n,premium:!0}),e.jsxs("div",{className:"text-xs text-gray-500 bg-yellow-50 p-2 rounded border",children:[e.jsx("p",{className:"font-medium text-yellow-700 mb-1",children:"üîí Password Protected Group"}),e.jsx("p",{children:"Only users with the correct password can join this group. Make sure to share the password securely with your classmates."})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(D,{type:"button",variant:"outline",onClick:t,disabled:n,children:"Cancel"}),e.jsxs(D,{type:"submit",loading:n,disabled:n||!d.name.trim()||!d.section.trim(),className:"flex items-center space-x-2",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Group"})]})]})]})})},Ar=({isOpen:s,onClose:t,onSubmit:a,groupName:r,loading:n=!1,error:i})=>{const[o,c]=l.useState(""),[d,u]=l.useState(!1),m=j=>{j.preventDefault(),o.trim()&&a(o.trim())},p=()=>{c(""),u(!1),t()};return e.jsx(Pe,{isOpen:s,onClose:p,title:"Group Password Required",size:"sm",children:e.jsxs("form",{onSubmit:m,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx(ze,{className:"h-8 w-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-900",children:"Password Protected Group"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:['"',r,'" requires a password to join']})]})]}),i&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200",children:i}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{label:"Enter Group Password",type:d?"text":"password",value:o,onChange:j=>c(j.target.value),placeholder:"Enter the group password",required:!0,disabled:n,premium:!0,autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>u(!d),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600",disabled:n,children:d?e.jsx(ms,{className:"h-4 w-4"}):e.jsx(Ue,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg",children:e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:"Tip:"})," Contact the group admin or a member to get the password if you don't have it."]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(D,{type:"button",variant:"outline",onClick:p,disabled:n,children:"Cancel"}),e.jsxs(D,{type:"submit",loading:n,disabled:n||!o.trim(),className:"flex items-center space-x-2",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Join Group"})]})]})]})})},zs=({onGroupSelect:s})=>{const{user:t,isGuest:a,loading:r}=me(),[n,i]=l.useState([]),[o,c]=l.useState([]),[d,u]=l.useState(!0),[m,p]=l.useState(null),[j,g]=l.useState(!1),[y,T]=l.useState(!1),[k,v]=l.useState(null),[C,x]=l.useState(""),[w,M]=l.useState(""),[b,h]=l.useState(null),[P,R]=l.useState("my-groups"),[L,N]=l.useState(null),B=l.useRef(!0),X=l.useRef(null),G=l.useRef(!0),W=l.useMemo(()=>t==null?void 0:t.id,[t==null?void 0:t.id]),ne=l.useMemo(()=>a,[a]),E=l.useMemo(()=>r,[r]),A=l.useCallback(async()=>{if(!B.current){console.log("ClassGroupList: Component unmounted, skipping fetch");return}X.current&&clearTimeout(X.current);const O=Date.now(),ie=parseInt(sessionStorage.getItem("last-groups-fetch")||"0"),oe=O-ie;if(oe<15e3){console.log("Groups fetch rate limited - last fetch was",oe/1e3,"seconds ago, minimum 15 seconds required");return}sessionStorage.setItem("last-groups-fetch",O.toString());try{u(!0),N(null);let te=[],U=[];try{te=await wr(),console.log("All groups fetched:",te.length)}catch($){console.error("Failed to fetch all groups:",$),N(`Failed to load groups: ${$.message}`),te=[]}if(W&&!ne)try{U=await vr(W),console.log("User groups fetched:",U.length)}catch($){console.error("Failed to fetch user groups:",$),te.length===0&&N(`Failed to load user groups: ${$.message}`),U=[]}i(te),c(U)}catch(te){console.error("Failed to fetch groups:",te),N(`Failed to load groups: ${te.message||"Unknown error"}`),i([]),c([])}finally{u(!1)}},[W,ne]);if(l.useEffect(()=>{if(E){console.log("ClassGroupList: Skipping fetch - auth still loading");return}return G.current?(G.current=!1,X.current=setTimeout(()=>{console.log("ClassGroupList: First mount - triggering fetchGroups after delay"),A()},500)):X.current=setTimeout(()=>{console.log("ClassGroupList: Subsequent call - triggering fetchGroups"),A()},300),()=>{X.current&&clearTimeout(X.current)}},[A,E]),l.useEffect(()=>()=>{B.current=!1,X.current&&clearTimeout(X.current)},[]),E)return e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(Z,{})});const ee=async(O,ie)=>{if(!t||a)return;const oe=ie||n.find(te=>te.id===O);if(oe!=null&&oe.is_password_protected){v(oe),T(!0),x("");return}try{p(O),await Fs(O,t.id),await A()}catch(te){console.error("Failed to join group:",te),alert(te.message||"Could not join the group. Please try again.")}finally{p(null)}},ue=async O=>{if(!(!k||!t))try{p(k.id),x(""),await Fs(k.id,t.id,O),T(!1),v(null),await A()}catch(ie){console.error("Failed to join protected group:",ie),x(ie.message||"Failed to join group")}finally{p(null)}},xe=()=>{T(!1),v(null),x(""),p(null)},V=O=>O.filter(ie=>{var U,$;const oe=ie.name.toLowerCase().includes(w.toLowerCase())||((U=ie.description)==null?void 0:U.toLowerCase().includes(w.toLowerCase()))||(($=ie.subject)==null?void 0:$.toLowerCase().includes(w.toLowerCase())),te=b===null||ie.year===b;return oe&&te}),J=Array.from(new Set(n.map(O=>O.year))).sort();return d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Z,{size:"lg",text:"Loading groups..."})}):L?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsxs("div",{className:"text-red-600 text-center",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Unable to load groups"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:L}),e.jsx(D,{onClick:A,className:"mt-4",children:"Try Again"})]}),e.jsxs("div",{className:"text-center text-sm text-gray-500 mt-4",children:[e.jsx("p",{children:"This might be because:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Database migrations haven't been applied"}),e.jsx("li",{children:"Group tables don't exist yet"}),e.jsx("li",{children:"Network connectivity issue"})]})]})]}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-3 sm:space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Class Groups"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Join your class groups to collaborate and share resources"})]}),t&&!a&&e.jsxs(D,{onClick:()=>g(!0),className:"flex items-center space-x-2",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Group"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search groups...",value:w,onChange:O=>M(O.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm sm:text-base"})]}),e.jsxs("div",{className:"flex items-center space-x-2 min-w-0",children:[e.jsx(fs,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),e.jsxs("select",{value:b||"",onChange:O=>h(O.target.value?parseInt(O.target.value):null),className:"flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"All Years"}),J.map(O=>e.jsxs("option",{value:O,children:["Year ",O]},O))]})]})]})}),e.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>R("my-groups"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${P==="my-groups"?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["My Groups (",o.length,")"]}),e.jsxs("button",{onClick:()=>R("all-groups"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${P==="all-groups"?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["All Groups (",n.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:P==="my-groups"?V(o).length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(Ge,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:w||b?"No matching groups found":"No groups joined yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:w||b?"Try adjusting your search criteria":"Join your first class group to get started"}),!w&&!b&&e.jsx(D,{onClick:()=>R("all-groups"),children:"Browse All Groups"})]}):V(o).map(O=>e.jsx(Gs,{group:O,onSelect:()=>s(O),onJoin:()=>ee(O.id,O),isJoining:m===O.id,showJoinButton:!1,userId:W},O.id)):V(n).length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(Ge,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No groups found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your search criteria"})]}):V(n).map(O=>{const ie=o.some(oe=>oe.id===O.id);return e.jsx(Gs,{group:O,onSelect:()=>s(O),onJoin:()=>ee(O.id,O),isJoining:m===O.id,showJoinButton:!ie&&!!t&&!a,isJoined:ie,userId:W},O.id)})}),e.jsx(Rr,{isOpen:j,onClose:()=>g(!1),onSuccess:()=>{g(!1),A()}}),e.jsx(Ar,{isOpen:y,onClose:xe,onSubmit:ue,groupName:(k==null?void 0:k.name)||"",loading:m===(k==null?void 0:k.id),error:C})]})},Gs=({group:s,onSelect:t,onJoin:a,isJoining:r,showJoinButton:n,isJoined:i=!1,userId:o})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs(re,{variant:"primary",children:["Year ",s.year," - ",s.semester]}),s.user_role==="admin"&&e.jsxs(re,{variant:"warning",children:[e.jsx(Oe,{className:"h-3 w-3 mr-1"}),"Admin"]}),s.creator_id===o&&e.jsxs(re,{variant:"success",children:[e.jsx(Oe,{className:"h-3 w-3 mr-1"}),"Creator"]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.name}),s.subject&&e.jsx("p",{className:"text-sm text-primary-600 font-medium mb-2",children:s.subject}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.description})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.member_count," members"]})]}),s.is_password_protected&&e.jsxs("div",{className:"flex items-center space-x-1 text-amber-600",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Protected"})]}),s.unread_count&&s.unread_count>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsxs("span",{className:"text-primary-600 font-medium",children:[s.unread_count," unread"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(is,{className:"h-3 w-3"}),e.jsx("span",{children:Ce(new Date(s.updated_at||s.created_at||new Date),{addSuffix:!0})})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:i?e.jsx(D,{onClick:t,className:"flex-1",variant:"primary",children:"Open Group"}):n?e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:()=>a(s),loading:r,disabled:r,className:"flex-1",children:s.is_password_protected?e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Join Group"]}):"Join Group"}),e.jsx(D,{onClick:t,variant:"outline",className:"px-3",children:"View"})]}):e.jsx(D,{onClick:t,variant:"outline",className:"flex-1",children:"View Group"})})]}),Ur=async({file:s,groupId:t,userId:a})=>{if(!f)throw new Error("Supabase not available");try{const r=`group-files/${t}`,{fileUrl:n}=await lt(s,a,r),i={group_id:t,user_id:a,message:`üìé ${s.name}`,message_type:"file",file_url:n,file_name:s.name,file_size:s.size},{data:o,error:c}=await f.from("group_messages").insert([i]).select(`
        *,
        profiles (
          id,
          username,
          full_name,
          avatar_url
        )
      `).single();if(c)throw new Error(`Failed to send file: ${c.message}`);return{id:o.id,group_id:o.group_id,user_id:o.user_id,file_url:o.file_url,file_name:o.file_name,file_size:o.file_size,message_type:"file",created_at:o.created_at}}catch(r){throw new Error(`Failed to upload file: ${r.message||"Unknown error"}`)}},qr=async(s,t,a)=>{if(!f)throw new Error("Supabase not available");try{return console.log("üîê Generating secure download URL for:",s),await Ir(s,t,a)}catch(r){throw console.error("‚ùå Secure download URL generation failed:",r.message),r}},Ir=async(s,t,a)=>{if(!f)throw new Error("Supabase not available");try{console.log("üîê Processing file URL:",s);let r,n;if(s.includes("/storage/v1/object/public/")){const c=s.split("/storage/v1/object/public/");if(c.length<2)throw new Error("Invalid public file URL format");const[d,...u]=c[1].split("/");r=d,n=u.join("/")}else if(s.includes("/storage/v1/object/sign/")){const c=s.split("/storage/v1/object/sign/");if(c.length<2)throw new Error("Invalid signed file URL format");const d=c[1].split("?")[0],[u,...m]=d.split("/");r=u,n=m.join("/")}else throw new Error("Unrecognized file URL format");if(console.log("üîê Extracted - Bucket:",r,"Path:",n),a){const{data:c,error:d}=await f.from("group_members").select("id").eq("group_id",a).eq("user_id",t).eq("is_active",!0).single();if(d||!c)throw new Error("Access denied: User not authorized to download this file")}const{data:i,error:o}=await f.storage.from(r).createSignedUrl(n,3600);if(o)throw console.error("‚ùå Error generating signed URL:",o),new Error(`Failed to generate secure download link: ${o.message}`);if(!(i!=null&&i.signedUrl))throw new Error("No signed URL generated");return console.log("‚úÖ Direct signed URL generated successfully"),i.signedUrl}catch(r){throw console.error("‚ùå Direct signed URL generation failed:",r.message),r}},Fr=async({fileUrl:s,fileName:t,userId:a,groupId:r})=>{try{console.log("üîí Starting secure download for:",t);const n=await qr(s,a,r),i=document.createElement("a");i.href=n,i.download=t,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),console.log("‚úÖ Secure download completed for:",t)}catch(n){console.error("‚ùå Secure download failed:",n.message),console.log("‚ö†Ô∏è Falling back to direct download for:",t);try{const i=document.createElement("a");i.href=s,i.download=t,i.target="_blank",i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),console.log("‚úÖ Fallback download completed for:",t)}catch(i){console.error("‚ùå Fallback download also failed:",i.message),window.open(s,"_blank")}}},Dr=({group:s,isOpen:t,onClose:a,onGroupUpdated:r})=>{const{user:n}=me(),[i,o]=l.useState(!1),[c,d]=l.useState([]),[u,m]=l.useState(null),[p,j]=l.useState(!1),[g,y]=l.useState(!1),[T,k]=l.useState(!1),[v,C]=l.useState(s.name),[x,w]=l.useState(s.description||""),[M,b]=l.useState(""),[h,P]=l.useState(""),R=l.useCallback(async()=>{if(n)try{o(!0);const[E,A]=await Promise.all([mt(s.id),Mr(s.id)]);d(E),m(A)}catch(E){b(E.message)}finally{o(!1)}},[n,s.id]),L=l.useCallback(async()=>{if(n)try{const E=await ut(s.id,n.id);j(E)}catch(E){console.error("Error checking admin status:",E)}},[n,s.id]);l.useEffect(()=>{t&&n&&R()},[t,n,s.id,R]),l.useEffect(()=>{n&&(y(s.created_by===n.id),L())},[n,s.created_by,L]);const N=async E=>{if(n)try{o(!0);const A=await Sr(s.id,E,n.id);A.success?(P(A.message||"Member promoted to admin"),await R()):b(A.error||"Failed to promote member")}catch(A){b(A.message)}finally{o(!1)}},B=async E=>{if(n)try{o(!0);const A=await kr(s.id,E,n.id);A.success?(P(A.message||"Admin demoted to member"),await R()):b(A.error||"Failed to demote admin")}catch(A){b(A.message)}finally{o(!1)}},X=async(E,A)=>{if(n&&confirm(`Are you sure you want to remove ${A} from the group?`))try{o(!0);const ee=await Er(s.id,E,n.id);ee.success?(P(ee.message||"Member removed successfully"),await R(),r()):b(ee.error||"Failed to remove member")}catch(ee){b(ee.message)}finally{o(!1)}},G=async()=>{if(n)try{o(!0);const E=await Pr(s.id,v!==s.name?v:void 0,x!==s.description?x:void 0,n.id);E.success?(P(E.message||"Group updated successfully"),k(!1),r()):b(E.error||"Failed to update group")}catch(E){b(E.message)}finally{o(!1)}},W=async()=>{if(!n)return;const E=`Are you sure you want to delete "${s.name}"? This action cannot be undone and will remove all members, messages, and files.`;if(confirm(E))try{o(!0);const A=await Tr(s.id,n.id);A.success?(P(A.message||"Group deleted successfully"),r(),a()):b(A.error||"Failed to delete group")}catch(A){b(A.message)}finally{o(!1)}},ne=()=>{b(""),P("")};return!p&&!g?e.jsx(Pe,{isOpen:t,onClose:a,title:"Access Denied",size:"sm",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ke,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Only group admins can access this panel."}),e.jsx(D,{onClick:a,className:"mt-4",children:"Close"})]})}):e.jsx(Pe,{isOpen:t,onClose:a,title:"Group Administration",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[M&&e.jsxs("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200 flex justify-between items-center",children:[e.jsx("span",{children:M}),e.jsx("button",{onClick:ne,children:e.jsx(Me,{className:"h-4 w-4"})})]}),h&&e.jsxs("div",{className:"p-3 text-sm text-green-600 bg-green-50 rounded-lg border border-green-200 flex justify-between items-center",children:[e.jsx("span",{children:h}),e.jsx("button",{onClick:ne,children:e.jsx(Me,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(Oe,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Group Information"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[(u==null?void 0:u.admin_count)||0," admins ‚Ä¢ ",(u==null?void 0:u.total_members)||0," total members"]})]})]}),T?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ae,{label:"Group Name",value:v,onChange:E=>C(E.target.value),premium:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:x,onChange:E=>w(E.target.value),className:"input-premium resize-none",rows:3,placeholder:"Group description..."})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(D,{onClick:G,loading:i,className:"flex items-center space-x-2",children:[e.jsx($t,{className:"h-4 w-4"}),e.jsx("span",{children:"Save Changes"})]}),e.jsx(D,{variant:"outline",onClick:()=>{k(!1),C(s.name),w(s.description||"")},children:"Cancel"})]})]}):e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),e.jsxs(D,{variant:"outline",onClick:()=>k(!0),className:"flex items-center space-x-2",children:[e.jsx(Qs,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Group Members"}),i?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Z,{})}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:c.map(E=>{var A,ee;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(A=E.profiles)==null?void 0:A.full_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["@",(ee=E.profiles)==null?void 0:ee.username]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(re,{variant:E.role==="admin"?"primary":"secondary",children:E.role==="admin"?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"h-3 w-3 mr-1"})," Admin"]}):"Member"}),E.user_id===s.created_by&&e.jsx(re,{variant:"success",children:"Creator"})]})]}),E.user_id!==(n==null?void 0:n.id)&&e.jsxs("div",{className:"flex space-x-2",children:[E.role==="member"?e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>N(E.user_id),disabled:i,className:"flex items-center space-x-1",children:[e.jsx(Js,{className:"h-3 w-3"}),e.jsx("span",{children:"Promote"})]}):E.user_id!==s.created_by&&e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>B(E.user_id),disabled:i,className:"flex items-center space-x-1",children:[e.jsx(Bt,{className:"h-3 w-3"}),e.jsx("span",{children:"Demote"})]}),E.user_id!==s.created_by&&e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>{var ue;return X(E.user_id,((ue=E.profiles)==null?void 0:ue.full_name)||"User")},disabled:i,className:"flex items-center space-x-1 text-red-600 hover:bg-red-50",children:[e.jsx(Jt,{className:"h-3 w-3"}),e.jsx("span",{children:"Remove"})]})]})]},E.id)})})]}),g&&e.jsxs("div",{className:"border border-red-200 rounded-lg p-4 bg-red-50",children:[e.jsx("h3",{className:"font-medium text-red-900 mb-2",children:"Danger Zone"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:"These actions are permanent and cannot be undone."}),e.jsxs(D,{variant:"outline",onClick:W,disabled:i,className:"flex items-center space-x-2 text-red-600 border-red-300 hover:bg-red-100",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Delete Group"})]})]})]})})},Ls=({group:s,onBack:t,onLeaveGroup:a})=>{var le;const{user:r,loading:n}=me(),[i,o]=l.useState([]),[c,d]=l.useState([]),[u,m]=l.useState(""),[p,j]=l.useState(!0),[g,y]=l.useState(!1),[T,k]=l.useState(!1),[v,C]=l.useState(!1),[x,w]=l.useState(null),[M,b]=l.useState(!1),[h,P]=l.useState(!1),[R,L]=l.useState(!1),[N,B]=l.useState(null),[X,G]=l.useState(!1),W=l.useRef(null),ne=l.useRef(null),E=l.useRef(null),A=l.useCallback(_=>{o(z=>{let H=-1;if(_.message_type==="file"?H=z.findIndex(K=>K.isOptimistic&&K.user_id===_.user_id&&K.message_type==="file"&&K.file_name===_.file_name&&Math.abs(new Date(K.created_at).getTime()-new Date(_.created_at).getTime())<3e4):H=z.findIndex(K=>K.isOptimistic&&K.user_id===_.user_id&&K.message===_.message&&Math.abs(new Date(K.created_at).getTime()-new Date(_.created_at).getTime())<5e3),H!==-1){const K=[...z];return K[H]=_,K}else return z.some(he=>he.id===_.id)?z:[...z,_]}),J()},[]),ee=l.useCallback(_=>{o(z=>z.map(H=>H.id===_.id?{...H,..._}:H))},[]),ue=l.useCallback(_=>{o(z=>z.filter(H=>H.id!==_))},[]);Qa((s==null?void 0:s.id)||null,A,ee,ue,{enabled:!!(s!=null&&s.id)&&!!r&&!p,onError:_=>{console.error("Real-time messages error:",_)},onConnected:()=>{G(!0)},onDisconnected:()=>{G(!1)}}),l.useEffect(()=>{const _=setInterval(()=>{o(z=>{const H=Date.now();let K=!1;const he=z.map(be=>be.isOptimistic&&H-new Date(be.created_at).getTime()>3e4?(console.log("üßπ Auto-cleaning stuck optimistic message:",be.id),K=!0,{...be,isOptimistic:!1}):be);return K?he:z})},6e4);return()=>clearInterval(_)},[]),l.useEffect(()=>{s.id&&r&&(async()=>{try{j(!0),B(null),ne.current&&(ne.current.scrollTop=ne.current.scrollHeight);try{const z=await _r(s.id);o(z)}catch(z){console.error("Failed to load messages:",z),o([])}d([]),L(!1),setTimeout(()=>{J("instant")},50)}catch(z){console.error("Error initializing group data:",z),B(`Failed to load group data. ${z instanceof Error?z.message:"Please try again."}`)}finally{j(!1)}})()},[s.id,s.creator_id,s.name,r==null?void 0:r.id,r]),l.useEffect(()=>{!p&&i.length>0&&setTimeout(()=>{J("instant")},50)},[i,p]),l.useEffect(()=>{!p&&i.length>0&&(console.log("Chat loading finished, scrolling to bottom with",i.length,"messages"),setTimeout(()=>{J("instant")},100))},[p,i.length]);const xe=async()=>{if(r)try{const _=await ut(s.id,r.id);L(_||s.creator_id===r.id)}catch(_){console.error("Error checking admin status:",_),L(s.creator_id===r.id)}},V=async()=>{if(s.id)try{const _=await mt(s.id);d(_)}catch(_){console.error("Error loading members:",_)}},J=(_="smooth")=>{if(ne.current){const z=ne.current;console.log("Scrolling to bottom - ScrollHeight:",z.scrollHeight,"ClientHeight:",z.clientHeight),requestAnimationFrame(()=>{z.scrollTo({top:z.scrollHeight,behavior:_})})}else console.warn("Messages container ref not available for scrolling")},O=async()=>{var K,he,be;if(!u.trim()||!r||g)return;y(!0);const _=`temp-${Date.now()}`,z={id:_,group_id:s.id,user_id:r.id,message:u.trim(),created_at:new Date().toISOString(),profiles:{id:r.id,username:((K=r.email)==null?void 0:K.split("@")[0])||"user",full_name:((he=r.user_metadata)==null?void 0:he.full_name)||"Unknown User",avatar_url:(be=r.user_metadata)==null?void 0:be.avatar_url},isOptimistic:!0};o(fe=>[...fe,z]),m(""),w(null),J();const H=setTimeout(()=>{console.log("üîÑ Fallback: Removing optimistic state for message:",_),o(fe=>fe.map(ve=>ve.id===_?{...ve,isOptimistic:!1}:ve))},5e3);try{const fe=await Ds(s.id,r.id,u.trim(),"text",void 0,x==null?void 0:x.id);console.log("‚úÖ Message sent successfully:",fe.id),clearTimeout(H);const je=window.innerWidth<768?3e3:2e3;setTimeout(()=>{o(Re=>Re.find(I=>I.id===_&&I.isOptimistic)?(console.log("üîÑ Manually replacing optimistic message (realtime delayed)"),Re.map(I=>I.id===_?{...fe,profiles:z.profiles,isOptimistic:!1}:I)):Re)},je)}catch(fe){console.error("‚ùå Error sending message:",fe),clearTimeout(H),o(ve=>ve.filter(je=>je.id!==_)),B("Could not send your message. Please try again.")}finally{y(!1)}},ie=async _=>{var he,be,fe,ve;const z=(he=_.target.files)==null?void 0:he[0];if(!z||!r||T)return;k(!0);const H=`temp-file-${Date.now()}`,K={id:H,group_id:s.id,user_id:r.id,message:`üìé ${z.name}`,message_type:"file",file_url:"uploading",file_name:z.name,file_size:z.size,created_at:new Date().toISOString(),profiles:{id:r.id,username:((be=r.email)==null?void 0:be.split("@")[0])||"user",full_name:((fe=r.user_metadata)==null?void 0:fe.full_name)||"Unknown User",avatar_url:(ve=r.user_metadata)==null?void 0:ve.avatar_url},isOptimistic:!0};o(je=>[...je,K]),w(null),J();try{console.log("Uploading file:",z.name);const je=await Ur({file:z,groupId:s.id,userId:r.id});console.log("File uploaded:",je);const Re=await Ds(s.id,r.id,`üìé ${z.name}`,"file",je,x==null?void 0:x.id);console.log("File message sent:",Re)}catch(je){console.error("Error uploading file:",je),o(Re=>Re.filter(S=>S.id!==H)),B("Could not upload your file. Please try again.")}finally{k(!1),E.current&&(E.current.value="")}},oe=async()=>{if(!(!r||v)){C(!0);try{await Cr(s.id,r.id),a==null||a()}catch(_){console.error("Error leaving group:",_),B("Could not leave the group. Please try again.")}finally{C(!1)}}},te=_=>{_.key==="Enter"&&!_.shiftKey&&(_.preventDefault(),O())},U=_=>{var H;switch((H=_.split(".").pop())==null?void 0:H.toLowerCase()){case"pdf":return e.jsx(ce,{className:"h-4 w-4 text-red-500"});case"doc":case"docx":return e.jsx(ce,{className:"h-4 w-4 text-blue-500"});case"txt":return e.jsx(ce,{className:"h-4 w-4 text-gray-500"});case"jpg":case"jpeg":case"png":case"gif":return e.jsx(Yt,{className:"h-4 w-4 text-green-500"});default:return e.jsx(Wt,{className:"h-4 w-4 text-gray-500"})}},$=_=>{if(_===0)return"0 Bytes";const z=1024,H=["Bytes","KB","MB","GB"],K=Math.floor(Math.log(_)/Math.log(z));return parseFloat((_/Math.pow(z,K)).toFixed(2))+" "+H[K]},q=async(_,z)=>{if(!r){console.error("‚ùå User not authenticated for download"),B("Please log in to download files");return}if(!s.id){B("Unable to download file: Group not found");return}try{await Fr({fileUrl:_,fileName:z,userId:r.id,groupId:s.id}),console.log("‚úÖ Download process completed for:",z)}catch(H){console.error("‚ùå Download failed:",H.message),B(`Failed to download ${z}: ${H.message}`)}},Y=_=>{var be,fe;const z=_.user_id===(r==null?void 0:r.id),H=_.isOptimistic,K=_.message_type==="file"&&_.file_url,he=K&&_.file_url==="uploading";return e.jsx("div",{className:`flex mb-3 sm:mb-4 ${z?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] sm:max-w-xs lg:max-w-md px-3 sm:px-4 py-2 sm:py-3 rounded-2xl break-words overflow-hidden shadow-sm ${z?`bg-blue-500 text-white ${H?"opacity-70":""}`:"bg-white text-gray-800 border border-gray-200"}`,children:[!z&&e.jsx("p",{className:"text-xs font-semibold mb-1 opacity-75",children:((be=_.profiles)==null?void 0:be.full_name)||((fe=_.profiles)==null?void 0:fe.username)||"Unknown User"}),K?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`flex items-center space-x-2 p-2 sm:p-3 rounded-lg ${z?"bg-white bg-opacity-10":"bg-gray-50"}`,children:[U(_.file_name||""),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium break-words",children:_.file_name}),e.jsx("p",{className:"text-xs opacity-75",children:_.file_size?$(_.file_size):"Unknown size"}),he&&e.jsx("p",{className:"text-xs opacity-75 animate-pulse",children:"Uploading..."})]}),!he&&e.jsx("button",{onClick:()=>q(_.file_url,_.file_name),className:`p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors touch-manipulation ${z?"text-white":"text-gray-600"}`,title:"Download file",children:e.jsx(Ns,{className:"h-4 w-4"})})]}),_.message&&_.message!==`üìé ${_.file_name}`&&e.jsx("p",{className:"text-sm break-words",children:_.message})]}):e.jsx("p",{className:"text-sm sm:text-base break-words leading-relaxed",children:_.message}),e.jsxs("p",{className:"text-xs opacity-75 mt-2 flex items-center justify-between",children:[e.jsx("span",{children:new Date(_.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),H&&e.jsxs("span",{className:"text-orange-400 ml-2",children:[he?" (uploading...)":" (sending...)",e.jsx("button",{onClick:()=>{console.log("üëÜ Manually confirming message:",_.id),o(ve=>ve.map(je=>je.id===_.id?{...je,isOptimistic:!1}:je))},className:"ml-2 text-xs text-blue-400 hover:text-blue-300 underline touch-manipulation",children:"confirm"})]})]})]})},_.id)};return n||!r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"mobile-group-header sticky top-0 z-20 backdrop-blur-xl bg-white/90 border-b border-gray-200/50 p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0",children:[e.jsx(D,{variant:"ghost",size:"sm",onClick:t,className:"p-2 hover:bg-gray-100 rounded-full flex-shrink-0",children:e.jsx(Ee,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500 truncate",children:[s.year?`Year ${s.year} - ${s.semester}`:"",s.subject?` ‚Ä¢ ${s.subject}`:""]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>b(!M),className:"p-2 hover:bg-gray-100 rounded-full flex-shrink-0",title:"Members",children:[e.jsx(_e,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"ml-1 text-xs sm:text-sm",children:c.length})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>P(!h),className:"p-2 hover:bg-gray-100 rounded-full flex-shrink-0",title:"More options",children:e.jsx(Vt,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),h&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-30 min-w-[160px]",children:[R&&e.jsxs("button",{onClick:()=>{P(!1)},className:"w-full px-4 py-3 text-left text-sm hover:bg-gray-50 flex items-center space-x-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{children:"Admin Panel"})]}),e.jsxs("button",{onClick:()=>{P(!1),oe()},disabled:v,className:"w-full px-4 py-3 text-left text-sm hover:bg-gray-50 flex items-center space-x-2 text-red-600",children:[e.jsx(gs,{className:"w-4 h-4"}),e.jsx("span",{children:"Leave Group"})]})]})]})]})]})}),N&&e.jsx("div",{className:"p-4 bg-red-50 border-b border-red-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-red-700 text-sm",children:N}),e.jsx("button",{onClick:()=>B(null),className:"text-red-500 hover:text-red-700",children:e.jsx(Me,{className:"w-4 h-4"})})]})}),h&&R&&e.jsx("div",{className:"border-b border-gray-200",children:e.jsx(Dr,{group:s,isOpen:!0,onClose:()=>P(!1),onGroupUpdated:()=>{V(),xe()}})}),M&&e.jsxs("div",{className:"border-b border-gray-200 bg-gray-50/50 backdrop-blur-sm p-3 sm:p-4 max-h-48 sm:max-h-60 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900",children:["Members (",c.length,")"]}),e.jsx("button",{onClick:()=>b(!1),className:"p-1 hover:bg-gray-200 rounded-full",children:e.jsx(Me,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:"space-y-3",children:c.map(_=>{var z,H,K,he;return e.jsxs("div",{className:"flex items-center space-x-3 p-2 rounded-lg hover:bg-white/60",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs sm:text-sm font-medium text-white",children:((H=(z=_.profiles)==null?void 0:z.full_name)==null?void 0:H.charAt(0))||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:((K=_.profiles)==null?void 0:K.full_name)||((he=_.profiles)==null?void 0:he.username)||"Unknown User"}),_.role==="admin"&&e.jsxs("span",{className:"text-xs text-yellow-600 flex items-center",children:[e.jsx(Oe,{className:"w-3 h-3 mr-1"}),"Admin"]})]})]},_.id)})})]}),e.jsxs("div",{ref:ne,className:"mobile-group-messages flex-1 overflow-y-auto p-3 sm:p-4 space-y-3 sm:space-y-4 bg-gray-50/30",children:[p?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Z,{})}):N?e.jsx("div",{className:"flex items-center justify-center h-full text-red-500",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-base sm:text-lg font-medium mb-2",children:"Error Loading Messages"}),e.jsx("p",{className:"text-sm mb-4 text-gray-600",children:N}),e.jsx(D,{onClick:()=>{B(null),j(!0),window.location.reload()},className:"text-sm px-4 py-2",children:"Try Again"})]})}):i.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-base sm:text-lg font-medium mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start the conversation!"})]})}):i.map(_=>Y(_)),e.jsx("div",{ref:W})]}),x&&e.jsxs("div",{className:"p-3 bg-blue-50 border-t border-blue-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs text-blue-600 font-medium",children:["Replying to ",((le=x.profiles)==null?void 0:le.full_name)||"Unknown User"]}),e.jsx("p",{className:"text-sm text-gray-700 truncate",children:x.message})]}),e.jsx("button",{onClick:()=>w(null),className:"text-blue-400 hover:text-blue-600 ml-2 p-1 rounded-full hover:bg-blue-100",children:e.jsx(Me,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mobile-group-input sticky bottom-0 backdrop-blur-xl bg-white/90 border-t border-gray-200/50 p-3 sm:p-4 pb-safe",children:[e.jsxs("div",{className:"flex items-end space-x-2 sm:space-x-3",children:[e.jsx("input",{type:"file",ref:E,onChange:ie,className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{var _;return(_=E.current)==null?void 0:_.click()},disabled:T,className:"p-2 sm:p-3 hover:bg-gray-100 rounded-full flex-shrink-0",title:"Attach file",children:e.jsx(Ht,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("textarea",{value:u,onChange:_=>m(_.target.value),onKeyPress:te,placeholder:"Type a message...",className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm sm:text-base leading-relaxed bg-white/80 backdrop-blur-sm",rows:1,disabled:g,style:{minHeight:"40px",maxHeight:"120px",scrollbarWidth:"thin"}})}),e.jsx(D,{onClick:O,disabled:!u.trim()||g,className:"p-2 sm:p-3 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 rounded-full flex-shrink-0 transition-all touch-manipulation",title:"Send message",children:g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 sm:h-5 sm:w-5 border-b-2 border-white"}):e.jsx(Le,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})})]}),T&&e.jsxs("div",{className:"mt-3 text-sm text-blue-600 flex items-center bg-blue-50 p-2 rounded-lg",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Uploading file..."]})]})]})},zr=()=>{const[s,t]=l.useState(null),[a,r]=l.useState(window.innerWidth<768),[n,i]=l.useState(0);l.useEffect(()=>{const u=()=>{r(window.innerWidth<768)};return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const o=u=>{t(u)},c=()=>{t(null)},d=()=>{t(null),i(u=>u+1)};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:a?e.jsx("div",{className:"h-screen flex flex-col",children:s?e.jsx(Ls,{group:s,onBack:c,onLeaveGroup:d}):e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-20",children:e.jsx(zs,{onGroupSelect:o},n)})}):e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 md:py-12",children:s?e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 h-[calc(100vh-200px)]",children:e.jsx(Ls,{group:s,onBack:c,onLeaveGroup:d})}):e.jsx(zs,{onGroupSelect:o},n)})})};function Gr(){const[s,t]=l.useState(!1),[a,r]=l.useState("login");return l.useEffect(()=>{const n=i=>{const{mode:o}=i.detail;r(o||"login"),t(!0)};return window.addEventListener("openAuthModal",n),()=>{window.removeEventListener("openAuthModal",n)}},[]),e.jsx(da,{children:e.jsx(ca,{children:e.jsx(Nt,{children:e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-secondary-50 via-white to-primary-50 pb-16 md:pb-0",children:[e.jsx(Na,{}),e.jsx("main",{className:"flex-1 relative overflow-hidden",children:e.jsx(Sa,{children:e.jsxs(Ct,{children:[e.jsx(Se,{path:"/",element:e.jsx(za,{})}),e.jsx(Se,{path:"/auth",element:e.jsx(La,{})}),e.jsx(Se,{path:"/categories",element:e.jsx(nr,{})}),e.jsx(Se,{path:"/help",element:e.jsx(hr,{})}),e.jsx(Se,{path:"/privacy",element:e.jsx(pr,{})}),e.jsx(Se,{path:"/terms",element:e.jsx(gr,{})}),e.jsx(Se,{path:"/contact",element:e.jsx(fr,{})}),e.jsx(Se,{path:"/upload",element:e.jsx(We,{pageName:"the Upload page",children:e.jsx(Ya,{})})}),e.jsx(Se,{path:"/chat",element:e.jsx(We,{pageName:"Messages",children:e.jsx(ar,{})})}),e.jsx(Se,{path:"/my-requests",element:e.jsx(We,{pageName:"My Requests",children:e.jsx(or,{})})}),e.jsx(Se,{path:"/groups",element:e.jsx(We,{pageName:"Groups",children:e.jsx(zr,{})})}),e.jsx(Se,{path:"/profile/:userId",element:e.jsx(We,{pageName:"User Profile",children:e.jsx(xr,{})})})]})})}),e.jsx(Ca,{className:"hidden md:block"}),e.jsx(_a,{onAuthRequired:()=>t(!0)}),e.jsx(us,{isOpen:s,onClose:()=>t(!1),onSuccess:()=>t(!1),initialMode:a})]})})})})}class Lr{constructor(){Q(this,"pendingRequests",new Map);Q(this,"REQUEST_TIMEOUT",3e4);Q(this,"requestCount",0)}generateKey(t,a){const r=(a==null?void 0:a.method)||"GET",n=a!=null&&a.body?JSON.stringify(a.body):"";return`${r}:${t}:${n}`}async deduplicate(t,a,r){const n=this.generateKey(t,r);this.requestCount++,this.cleanupExpiredRequests();const i=this.pendingRequests.get(n);if(i)return i.promise;const o=a().finally(()=>{this.pendingRequests.delete(n)});return this.pendingRequests.set(n,{promise:o,timestamp:Date.now()}),o}cleanupExpiredRequests(){const t=Date.now();for(const[a,r]of this.pendingRequests)t-r.timestamp>this.REQUEST_TIMEOUT&&this.pendingRequests.delete(a)}getStats(){return{pendingRequests:this.pendingRequests.size,totalRequests:this.requestCount}}reset(){this.pendingRequests.clear(),this.requestCount=0}}const xt=new Lr,Os=globalThis.fetch;globalThis.fetch=async(s,t)=>{const a=typeof s=="string"?s:s.toString();return a.includes("supabase")||a.includes("localhost:54321")?xt.deduplicate(a,()=>Os(s,t),t):Os(s,t)};setInterval(()=>{xt.getStats()},1e4);window.addEventListener("unhandledrejection",s=>{var t,a,r,n,i,o;if((a=(t=s.reason)==null?void 0:t.message)!=null&&a.includes("infinite recursion")||(n=(r=s.reason)==null?void 0:r.message)!=null&&n.includes("Maximum call stack")||(o=(i=s.reason)==null?void 0:i.message)!=null&&o.includes("out of memory")){const c=document.createElement("div");c.innerHTML=`
      <div style="position: fixed; top: 20px; right: 20px; background: #ef4444; color: white; padding: 16px; border-radius: 8px; z-index: 9999; max-width: 300px;">
        <h4 style="margin: 0 0 8px 0; font-weight: bold;">Critical Error Detected</h4>
        <p style="margin: 0 0 8px 0; font-size: 14px;">The app prevented a potential crash. Please reload the page.</p>
        <button onclick="window.location.reload()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
          Reload
        </button>
      </div>
    `,document.body.appendChild(c),setTimeout(()=>{window.location.reload()},1e4)}s.preventDefault()});window.addEventListener("error",s=>{var t,a,r,n,i,o;((a=(t=s.error)==null?void 0:t.message)!=null&&a.includes("infinite recursion")||(n=(r=s.error)==null?void 0:r.message)!=null&&n.includes("Maximum call stack")||(o=(i=s.error)==null?void 0:i.message)!=null&&o.includes("out of memory"))&&s.preventDefault()});sa.createRoot(document.getElementById("root")).render(e.jsx(Gr,{}));export{we as l,f as s};
