const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/enhancedServices-Bis9DEBu.js","assets/vendor-DNJA2DLw.js","assets/supabase-IaWL2ZTc.js","assets/ui-Dw8rwu8F.js"])))=>i.map(i=>d[i]);
var et=Object.defineProperty;var st=(s,t,r)=>t in s?et(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var W=(s,t,r)=>st(s,typeof t!="symbol"?t+"":t,r);import{b as tt,c as at,r as o,d as rt,u as ds,e as nt,L as ie,R as Je,N as it,f as lt,H as ot,h as ct,i as he}from"./vendor-DNJA2DLw.js";import{c as dt,_ as ke}from"./supabase-IaWL2ZTc.js";import{t as mt,c as ut,X as _e,S as ge,a as Ae,U as we,P as Ts,M as Ke,L as Pe,E as Qe,b as Se,d as fe,B as rs,F as K,e as Ue,A as Fe,f as Ce,g as Re,h as ve,i as Ze,j as As,k as ns,l as xt,H as ht,G as pt,m as gt,n as ft,o as Ms,p as Is,T as qs,C as ms,D as us,q as yt,r as Us,Z as bt,s as Oe,u as is,v as Fs,w as Me,x as De,y as Ve,z as jt,I as ze,J as Ds,K as wt,N as We,O as ys,Q as bs,R as Ye,V as vt,W as Nt,Y as zs,_ as Le,$ as _t,a0 as Ct,a1 as St,a2 as Te,a3 as Et,a4 as kt,a5 as Pt,a6 as Rt,a7 as Tt,a8 as At,a9 as Mt,aa as It}from"./ui-Dw8rwu8F.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var as={exports:{}},Ie={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var js;function qt(){if(js)return Ie;js=1;var s=tt(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(c,d,g){var u,h={},N=null,m=null;g!==void 0&&(N=""+g),d.key!==void 0&&(N=""+d.key),d.ref!==void 0&&(m=d.ref);for(u in d)a.call(d,u)&&!i.hasOwnProperty(u)&&(h[u]=d[u]);if(c&&c.defaultProps)for(u in d=c.defaultProps,d)h[u]===void 0&&(h[u]=d[u]);return{$$typeof:t,type:c,key:N,ref:m,props:h,_owner:n.current}}return Ie.Fragment=r,Ie.jsx=l,Ie.jsxs=l,Ie}var ws;function Ut(){return ws||(ws=1,as.exports=qt()),as.exports}var e=Ut();class Ft{constructor(){W(this,"callCount",0);W(this,"resetTime",0);W(this,"MAX_CALLS_PER_MINUTE",50);W(this,"RESET_INTERVAL",6e4);W(this,"isBlocked",!1);W(this,"blockedUntil",0)}canMakeCall(){const t=Date.now();return t>this.resetTime&&(this.callCount=0,this.resetTime=t+this.RESET_INTERVAL,this.isBlocked=!1),this.isBlocked&&t<this.blockedUntil?(console.warn("üö´ API calls blocked - too many requests"),!1):this.callCount>=this.MAX_CALLS_PER_MINUTE?(this.isBlocked=!0,this.blockedUntil=t+3e4,console.error(`üö® CIRCUIT BREAKER TRIGGERED! ${this.callCount} calls in last minute. Blocking API calls for 30 seconds.`),!1):(this.callCount++,this.callCount>this.MAX_CALLS_PER_MINUTE*.8&&console.warn(`‚ö†Ô∏è High API usage: ${this.callCount}/${this.MAX_CALLS_PER_MINUTE} calls`),!0)}getStats(){return{callCount:this.callCount,isBlocked:this.isBlocked,maxCalls:this.MAX_CALLS_PER_MINUTE}}reset(){this.callCount=0,this.isBlocked=!1,this.blockedUntil=0,console.log("üîÑ Circuit breaker reset")}}const He=new Ft,Dt=globalThis.fetch;globalThis.fetch=async(s,t)=>{const r=typeof s=="string"?s:s.toString();if(r.includes("supabase")||r.includes("localhost:54321")){if(!He.canMakeCall())throw new Error("API call blocked by circuit breaker - too many requests");console.log(`üåê API Call #${He.getStats().callCount}: ${r.substring(r.lastIndexOf("/")+1)}`)}return Dt(s,t)};typeof window<"u"&&(window.stopAllAPICalls=()=>{He.reset(),console.log("üõë Emergency API stop activated")},window.getAPIStats=()=>He.getStats());var Ge={},vs;function zt(){if(vs)return Ge;vs=1;var s=at();return Ge.createRoot=s.createRoot,Ge.hydrateRoot=s.hydrateRoot,Ge}var Lt=zt();class Gt{constructor(){W(this,"calls",[]);W(this,"MAX_CALLS_PER_MINUTE",200);W(this,"WINDOW_SIZE",6e4)}logCall(t,r){const a=Date.now();return this.calls=this.calls.filter(n=>a-n.timestamp<this.WINDOW_SIZE),this.calls.push({timestamp:a,method:t,table:r,count:1}),this.calls.length>this.MAX_CALLS_PER_MINUTE&&console.warn(`üö® High API usage: ${this.calls.length} calls in last minute`),this.calls.length%20===0&&console.log(`üìä API Calls: ${this.calls.length}/min`),!0}getCallSummary(){const t={};return this.calls.forEach(r=>{const a=r.table?`${r.method}:${r.table}`:r.method;t[a]=(t[a]||0)+1}),t}getCurrentCount(){return this.calls.length}}const Ot=new Gt,Ns=console.log;let $e=0;const _s=100;console.log=(...s)=>{if($e++,$e>_s){$e===_s+1&&Ns("üîá Console logging suppressed due to excessive output");return}Ns(...s)};setInterval(()=>{$e=0},6e4);const $t="https://mnycotjmvsairaqgjaux.supabase.co",Bt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ueWNvdGptdnNhaXJhcWdqYXV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4NjczMTUsImV4cCI6MjA3MDQ0MzMxNX0.Xeex5usohxsqKUZ67RWgr1sip3WXGvTd9A8CL4xOlUk",Jt=()=>{try{const s=dt($t,Bt,{auth:{autoRefreshToken:!0,persistSession:!0}}),t=s.from.bind(s);return s.from=r=>Ot.logCall("SELECT",r)?t(r):(console.error("üö® API call blocked due to rate limiting"),{select:()=>Promise.reject(new Error("Rate limit exceeded")),insert:()=>Promise.reject(new Error("Rate limit exceeded")),update:()=>Promise.reject(new Error("Rate limit exceeded")),delete:()=>Promise.reject(new Error("Rate limit exceeded"))}),s}catch(s){return console.error("Failed to create Supabase client:",s),null}},p=Jt(),te=()=>!!("https://mnycotjmvsairaqgjaux.supabase.co"&&"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ueWNvdGptdnNhaXJhcWdqYXV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4NjczMTUsImV4cCI6MjA3MDQ0MzMxNX0.Xeex5usohxsqKUZ67RWgr1sip3WXGvTd9A8CL4xOlUk"&&p);class Vt{constructor(){W(this,"isInitializing",!1);W(this,"isInitialized",!1);W(this,"initPromise",null)}async initialize(t){if(this.isInitialized){console.log("üîí App already initialized, skipping duplicate initialization");return}return this.isInitializing&&this.initPromise?(console.log("‚è≥ App initialization in progress, waiting..."),this.initPromise):(console.log("üöÄ Starting app initialization..."),this.isInitializing=!0,this.initPromise=(async()=>{try{await t(),this.isInitialized=!0,console.log("‚úÖ App initialization completed")}catch(r){throw console.error("‚ùå App initialization failed:",r),r}finally{this.isInitializing=!1}})(),this.initPromise)}reset(){this.isInitialized=!1,this.isInitializing=!1,this.initPromise=null,console.log("üîÑ Initialization guard reset")}getStatus(){return{isInitialized:this.isInitialized,isInitializing:this.isInitializing}}}const Wt=new Vt,Ls=o.createContext(void 0),Z=()=>{const s=o.useContext(Ls);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s},Yt=({children:s})=>{const[t,r]=o.useState(null),[a,n]=o.useState(null),[i,l]=o.useState(null),[c,d]=o.useState(!0),[g,u]=o.useState(!1),[h,N]=o.useState(!1),[m,y]=o.useState(0),A=o.useCallback(()=>{console.log("üßπ Clearing all authentication state..."),r(null),n(null),l(null),u(!0),y(x=>x+1),localStorage.clear(),sessionStorage.clear(),typeof window<"u"&&document.cookie.split(";").forEach(x=>{const f=x.indexOf("="),E=f>-1?x.substr(0,f):x;(E.trim().includes("sb-")||E.trim().includes("supabase"))&&(document.cookie=`${E}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`)}),console.log("‚úÖ Authentication state cleared")},[]),w=o.useCallback(()=>{if(!i||g)return!1;const x=new Date().getTime();return(i.expires_at?i.expires_at*1e3:0)>x},[i,g]),P=o.useCallback(async()=>{try{if(console.log("üö™ Starting sign out process..."),te()&&p&&!g){const{error:x}=await p.auth.signOut({scope:"global"});x&&console.warn("Error during sign out:",x.message)}}catch(x){console.error("Error signing out:",x)}finally{localStorage.removeItem("supabase.auth.token"),localStorage.removeItem("user.authenticated"),sessionStorage.removeItem("auth.justSignedIn"),sessionStorage.clear(),console.log("üßπ Cleared all stored authentication data"),A(),console.log("‚úÖ Sign out complete - user is now guest"),setTimeout(()=>{window.location.href="/"},100)}},[g,A]),S=o.useCallback(async()=>{if(!(!te()||!p||g))try{const{data:{session:x},error:f}=await p.auth.refreshSession();if(f){console.warn("Session refresh failed:",f.message),await P();return}x&&(l(x),r(x.user),console.log("Session refreshed successfully"))}catch(x){console.error("Error refreshing session:",x),await P()}},[g,P]),v=o.useCallback(async()=>{const x=Date.now(),f=parseInt(localStorage.getItem("last-profile-refresh")||"0");if(x-f<6e4){console.log("Profile refresh rate limited");return}if(t&&!g&&te()&&p)try{localStorage.setItem("last-profile-refresh",x.toString());const{data:E,error:M}=await p.from("profiles").select("*").eq("id",t.id).single();if(M){if(M.code==="PGRST116"){console.warn("Profile not found for user");return}throw M}n(E)}catch(E){console.error("Error fetching profile:",E)}},[t,g]),_=o.useCallback(async()=>{if(console.log("üîÑ Force refreshing profile..."),console.log("üîç Current user:",t==null?void 0:t.email,"User ID:",t==null?void 0:t.id),console.log("üîç Is guest:",g,"Supabase configured:",te()),!t||g||!te()||!p){console.warn("‚ö†Ô∏è Cannot refresh profile - missing requirements:",{hasUser:!!t,isGuest:g,supabaseConfigured:te(),hasSupabase:!!p});return}try{console.log("üì° Fetching profile for user:",t.id);const{data:x,error:f}=await p.from("profiles").select("*").eq("id",t.id).single();if(f){if(f.code==="PGRST116"){console.warn("‚ö†Ô∏è Profile not found for user:",t.id);return}throw console.error("‚ùå Error fetching profile:",f),f}x?(console.log("‚úÖ Profile force refreshed successfully:",x.username),n(x),localStorage.setItem("last-profile-refresh",Date.now().toString())):console.warn("‚ö†Ô∏è No profile data returned for user:",t.id)}catch(x){console.error("‚ùå Error force refreshing profile:",x)}},[t,g]),j=o.useCallback(()=>{console.log("üêõ === AUTH STATE DEBUG ==="),console.log("User:",(t==null?void 0:t.email)||"null"),console.log("User ID:",(t==null?void 0:t.id)||"null"),console.log("Profile:",(a==null?void 0:a.username)||"null"),console.log("Session exists:",!!i),console.log("Is Guest:",g),console.log("Loading:",c),console.log("Auth Key:",m),console.log("Session valid:",w()),console.log("üêõ === END DEBUG ===")},[t,a,i,g,c,m,w]);o.useEffect(()=>{let x=!0,f=null,E=null;const M=setTimeout(()=>{x&&c&&(console.log("‚ö†Ô∏è Safety timeout: forcing loading to false after 10 seconds"),d(!1))},1e4);return(async()=>{if(h){console.log("üîí Auth already initialized, skipping...");return}try{console.log("üöÄ Initializing Auth..."),N(!0),await Wt.initialize(async()=>{var xe,Ne;if(console.log("üîê Initializing authentication..."),!te()||!p){console.warn("Supabase not configured, setting as guest mode"),x&&(u(!0),r(null),n(null),l(null),d(!1));return}sessionStorage.getItem("auth.justSignedIn")&&(console.log("üîÑ User just signed in, clearing flag and ensuring proper session restoration"),sessionStorage.removeItem("auth.justSignedIn"));const Q=localStorage.getItem("user.authenticated"),q=localStorage.getItem("supabase.auth.token"),$=localStorage.getItem("user.email"),ee=localStorage.getItem("user.data");let k=null;if(Q==="true"&&(q||ee)){if(console.log("üíæ Found comprehensive stored authentication data"),console.log("üìß Stored email:",$),ee)try{const z=JSON.parse(ee);console.log("ÔøΩ Restoring user from stored data:",z.email),x&&(r(z),u(!1),y(D=>D+1),console.log("‚úÖ User restored from stored data successfully"))}catch(z){console.warn("‚ö†Ô∏è Failed to parse stored user data:",z),localStorage.removeItem("user.data")}if(q)try{const z=JSON.parse(q);console.log("üì¶ Attempting to restore session from stored token:",(xe=z.user)==null?void 0:xe.email);const{data:D,error:U}=await p.auth.setSession({access_token:z.access_token,refresh_token:z.refresh_token});U?console.warn("‚ö†Ô∏è Failed to restore session from stored token:",U):D.session&&(console.log("‚úÖ Successfully restored session from stored token"),k=D.session)}catch(z){console.warn("‚ö†Ô∏è Failed to parse stored token:",z),localStorage.removeItem("supabase.auth.token")}}if(!k){let z=0;const D=3;for(;z<D&&!k;){try{console.log(`üîç Attempting to get session (attempt ${z+1}/${D})`);const{data:{session:U},error:Y}=await p.auth.getSession();if(Y){if(console.warn(`Session retrieval attempt ${z+1} failed:`,Y),z===D-1)throw Y}else if(k=U,k!=null&&k.user){console.log("‚úÖ Session found:",k.user.email);break}else console.log("üìù No session found on this attempt")}catch(U){console.error(`Failed to retrieve session (attempt ${z+1}):`,U),z===D-1&&console.error("All session retrieval attempts failed")}z++,z<D&&await new Promise(U=>setTimeout(U,500))}}if(x){if(l(k),r((k==null?void 0:k.user)??null),!(k!=null&&k.user))console.log("‚ùå No authenticated session found, setting as guest"),u(!0),n(null),y(z=>z+1),console.log("AuthContext: Set isGuest to true - user is null");else{if(console.log("‚úÖ Authenticated session found, setting as authenticated user"),console.log("üë§ User email:",k.user.email),console.log("üÜî User ID:",k.user.id),u(!1),y(z=>z+1),console.log("AuthContext: Set isGuest to false - user authenticated"),(Ne=k.user)!=null&&Ne.id){console.log("üîÑ Loading profile for user:",k.user.id);try{const{data:z,error:D}=await p.from("profiles").select("*").eq("id",k.user.id).single();D?D.code!=="PGRST116"?console.error("‚ùå Profile fetch error:",D):console.warn("‚ö†Ô∏è Profile not found for user:",k.user.id):z&&(console.log("‚úÖ Profile loaded successfully:",z.username),n(z))}catch(z){console.error("‚ùå Failed to load profile:",z)}}setTimeout(async()=>{console.log("‚è∞ Delayed profile refresh after state settlement"),await _()},500)}d(!1),console.log("üéØ Auth initialization complete. isGuest:",!(k!=null&&k.user),"user exists:",!!(k!=null&&k.user))}k&&x&&(f=setInterval(()=>{x&&k&&!w()&&(console.log("Session expired, refreshing..."),S())},300*1e3));const{data:{subscription:B}}=p.auth.onAuthStateChange(async(z,D)=>{var U,Y,se;if(x){console.log("üîÑ Auth state changed:",z,"Session exists:",!!(D!=null&&D.user)),console.log("üîÑ Session user:",(U=D==null?void 0:D.user)==null?void 0:U.email);try{if(l(D),r((D==null?void 0:D.user)??null),z==="SIGNED_OUT")console.log("üö™ SIGNED_OUT event - forcing guest mode"),A();else if(z==="SIGNED_IN"&&(D!=null&&D.user)){if(console.log("üîë SIGNED_IN event - user authenticated"),u(!1),console.log("AuthContext: SIGNED_IN - isGuest set to false, user:",D.user.email),localStorage.removeItem("ju-connect-guest-mode"),y(G=>G+1),(Y=D.user)!=null&&Y.id&&te()&&p)try{const{data:G,error:T}=await p.from("profiles").select("*").eq("id",D.user.id).single();T?T.code!=="PGRST116"&&console.error("‚ùå Profile fetch error during SIGNED_IN:",T):G&&(console.log("‚úÖ Profile loaded during SIGNED_IN:",G.username),n(G))}catch(G){console.error("‚ùå Failed to load profile during SIGNED_IN:",G)}}else if(D!=null&&D.user){if(u(!1),console.log("AuthContext: Auth state change - user authenticated, isGuest set to false"),localStorage.removeItem("ju-connect-guest-mode"),y(G=>G+1),(se=D.user)!=null&&se.id&&te()&&p)try{const{data:G,error:T}=await p.from("profiles").select("*").eq("id",D.user.id).single();T?T.code!=="PGRST116"&&console.error("‚ùå Profile fetch error during auth change:",T):G&&(console.log("‚úÖ Profile loaded during auth change:",G.username),n(G))}catch(G){console.error("‚ùå Failed to load profile during auth change:",G)}}else console.log("Auth state change: No user session, setting as guest"),u(!0),n(null),y(G=>G+1),console.log("AuthContext: Auth state change - no user, isGuest set to true")}catch(G){console.error("Error handling auth state change:",G)}}});E=B;const re=()=>{x&&document.visibilityState==="visible"&&k&&!w()&&S()};document.addEventListener("visibilitychange",re)})}catch(O){console.error("Error initializing auth:",O),x&&d(!1)}})(),()=>{x=!1,clearTimeout(M),f&&clearInterval(f),E&&E.unsubscribe()}},[w,S,v,_,A,h,c]);const b={user:t,profile:a,session:i,loading:c,isGuest:g,authKey:m,signOut:P,refreshProfile:v,forceRefreshProfile:_,isSessionValid:w,refreshSession:S,debugAuthState:j};return e.jsx(Ls.Provider,{value:b,children:s})},ne={debug:(s,...t)=>{},info:(s,...t)=>{},warn:(s,...t)=>{},error:(s,...t)=>{console.error(`[ERROR] ${s}`,...t)},demoMode:(s,...t)=>{console.warn(`[DEMO MODE] ${s}`,...t)}};class Ht extends o.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){this.setState({errorInfo:r});const a=t.message,n=a.includes("memory")||a.includes("leak")||a.includes("Maximum call stack"),i=a.includes("auth")||a.includes("session"),l=a.includes("infinite recursion")||a.includes("database")||a.includes("supabase");ne.error("Error caught by boundary:",{error:a,stack:t.stack,componentStack:r.componentStack,errorBoundary:!0,isMemoryError:n,isAuthError:i,isDatabaseError:l,timestamp:new Date().toISOString()}),ke(async()=>{const{enhancedErrorReporting:c}=await import("./enhancedServices-Bis9DEBu.js");return{enhancedErrorReporting:c}},__vite__mapDeps([0,1,2,3])).then(({enhancedErrorReporting:c})=>{c.reportError(t,{operation:"component_render",component:"ErrorBoundary",metadata:{componentStack:r.componentStack,isMemoryError:n,isAuthError:i,isDatabaseError:l}})}).catch(c=>{ne.warn("Failed to log to enhanced error reporting:",c)}),l&&a.includes("infinite recursion")&&(ne.warn("Infinite recursion detected, auto-reloading in 3 seconds..."),setTimeout(()=>{window.location.reload()},3e3)),(t.message.includes("infinite recursion")||t.message.includes("Maximum call stack")||t.message.includes("out of memory"))&&ne.error("CRITICAL ERROR:",t.message)}render(){var t;if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const r=((t=this.state.error)==null?void 0:t.message)||"Unknown error",a=r.includes("infinite recursion")||r.includes("Database configuration"),n=r.includes("Maximum call stack")||r.includes("out of memory");return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:a?"Database Configuration Issue":n?"Performance Issue Detected":"Application Error"})})]}),e.jsx("div",{className:"text-sm text-gray-600 mb-4",children:a?e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"There's a database configuration issue that needs to be resolved."}),e.jsx("p",{className:"text-xs text-gray-500",children:"This usually relates to database policies that need to be updated."})]}):n?e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"The application encountered a performance issue."}),e.jsx("p",{className:"text-xs text-gray-500",children:"This might be due to too many active connections or memory usage."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"The application encountered an unexpected error:"}),e.jsx("pre",{className:"mt-2 text-xs bg-gray-100 p-2 rounded overflow-auto max-h-20",children:r})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors",children:"Reload App"}),e.jsx("button",{onClick:()=>{localStorage.clear(),sessionStorage.clear(),window.location.href="/"},className:"flex-1 bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md transition-colors",children:"Reset & Reload"})]}),!1]})})}return this.props.children}}function le(...s){return mt(ut(s))}class Gs extends Error{constructor(r,a,n,i="error",l,c){super(r);W(this,"code");W(this,"statusCode");W(this,"userFriendlyMessage");W(this,"action");W(this,"severity");W(this,"context");this.name="AppError",this.code=l,this.userFriendlyMessage=a||this.convertToUserFriendlyMessage(r),this.action=n,this.severity=i,this.context=c}convertToUserFriendlyMessage(r){const a={"Network request failed":"Connection problem. Please check your internet.","Invalid credentials":"Please check your username and password.","User not found":"We could not find your account.","Permission denied":"You do not have permission to do this.","File too large":"Please upload a file or PDF smaller than 5MB","Invalid file type":"Please upload a valid file type.","Session expired":"Your session has expired. Please log in again.","Rate limit exceeded":"Too many requests. Please wait a moment.","Service unavailable":"Our service is temporarily unavailable."};for(const[n,i]of Object.entries(a))if(r.toLowerCase().includes(n.toLowerCase()))return i;return"Something went wrong. Please try again."}convertToUserFriendly(){return{message:this.userFriendlyMessage,action:this.action,severity:this.severity,code:this.code}}}function Xt(s,t){if(s instanceof Gs)return s.convertToUserFriendly();const r=s instanceof Error?s.message:String(s),a={"network error":{message:"Connection problem",action:"Please check your internet connection and try again",severity:"warning"},unauthorized:{message:"Access denied",action:"Please log in and try again",severity:"warning"},forbidden:{message:"Permission denied",action:"You do not have permission to perform this action",severity:"error"},"not found":{message:"Not found",action:"The requested item could not be found",severity:"info"},timeout:{message:"Request timed out",action:"Please try again",severity:"warning"},"file too large":{message:"Please upload a file or PDF smaller than 5MB",action:"Choose a smaller file and try again",severity:"warning"},"session expired":{message:"Session expired",action:"Please log in again",severity:"warning"}};for(const[n,i]of Object.entries(a))if(r.toLowerCase().includes(n))return{message:i.message,action:i.action,severity:i.severity||"error",code:n.toUpperCase().replace(" ","_")};switch(t.operation){case"file_upload":return{message:"Upload failed",action:"Please check your file and try again",severity:"warning",code:"UPLOAD_ERROR"};case"auth":return{message:"Authentication failed",action:"Please check your credentials and try again",severity:"warning",code:"AUTH_ERROR"};case"chat":return{message:"Message could not be sent",action:"Please try sending your message again",severity:"warning",code:"CHAT_ERROR"};case"group":return{message:"Group operation failed",action:"Please try again or contact support",severity:"error",code:"GROUP_ERROR"}}return{message:"Something went wrong",action:"Please try again or contact support if the problem continues",severity:"error",code:"UNKNOWN_ERROR"}}function ls(s){const t=(s==null?void 0:s.message)||"Database operation failed",r=Xt(s,{operation:"database"});return new Gs(t,r.message,r.action,r.severity,r.code)}const Os=async(s,t,r,a,n)=>{try{if(!p)throw new Error("Sign up is not available right now. Please try again later.");const{data:i}=await p.from("profiles").select("username").eq("username",a).maybeSingle();if(i)throw new Error("This username is taken. Please choose a different one.");const{data:l}=await p.from("profiles").select("mobile_number").eq("mobile_number",n).maybeSingle();if(l)throw new Error("This phone number is already registered. Please use a different number.");const{data:c,error:d}=await p.auth.signUp({email:s,password:t,options:{data:{username:a,full_name:r}}});if(d)throw ls(d);if(!c.user)throw new Error("Could not create your account. Please try again.");const g={id:c.user.id,username:a,mobile_number:n,full_name:r},{error:u}=await p.from("profiles").insert([g]);if(u)throw await p.auth.signOut(),ls(u);return ne.info("User signed up successfully:",c.user.id),{user:c.user,profile:g}}catch(i){throw ne.error("Sign up error:",i),i instanceof Error?i:new Error("Could not create your account. Please try again.")}},$s=async(s,t)=>{try{if(console.log("üîê Sign in attempt for:",s),console.log("üîó Supabase URL:","https://mnycotjmvsairaqgjaux.supabase.co"),console.log("üîë Supabase client available:",!!p),!p)throw console.error("‚ùå Supabase not available"),new Error("Sign in is not available right now. Please try again later.");console.log("üì° Calling Supabase signInWithPassword...");const{data:r,error:a}=await p.auth.signInWithPassword({email:s,password:t});if(console.log("üì• Supabase response received"),console.log("üîç Error:",a),console.log("üîç Data:",r),a)throw console.error("‚ùå Supabase auth error:",a),console.error("‚ùå Error message:",a.message),console.error("‚ùå Error code:",a.status),ls(a);if(!r.user)throw console.error("‚ùå No user returned from Supabase"),new Error("Authentication failed. Please try again.");return console.log("‚úÖ Supabase authentication successful for:",r.user.email),console.log("üîë User ID:",r.user.id),console.log("üìß Email confirmed:",r.user.email_confirmed_at?"Yes":"No"),console.log("üìß Email confirmation time:",r.user.email_confirmed_at),console.log("üïê Created at:",r.user.created_at),console.log("üîê Session:",!!r.session),r.user.email_confirmed_at||console.warn("‚ö†Ô∏è EMAIL NOT CONFIRMED - This might cause sign-in issues"),ne.info("User signed in successfully:",r.user.id),ke(async()=>{const{activityService:n}=await import("./enhancedServices-Bis9DEBu.js");return{activityService:n}},__vite__mapDeps([0,1,2,3])).then(({activityService:n})=>{n.logActivity(r.user.id,"login",{method:"email_password"},void 0,navigator.userAgent).catch(i=>console.warn("Failed to log login activity:",i))}).catch(n=>console.warn("Failed to import enhanced services:",n)),r}catch(r){throw console.error("‚ùå Sign in error details:",r),r instanceof Error&&(console.error("‚ùå Error name:",r.name),console.error("‚ùå Error message:",r.message),console.error("‚ùå Error stack:",r.stack)),ke(async()=>{const{enhancedErrorReporting:a}=await import("./enhancedServices-Bis9DEBu.js");return{enhancedErrorReporting:a}},__vite__mapDeps([0,1,2,3])).then(({enhancedErrorReporting:a})=>{a.reportError(r,{operation:"user_login",component:"authService",metadata:{email:s}})}).catch(a=>console.warn("Failed to log error:",a)),r instanceof Error?r:new Error("Could not sign you in. Please check your email and password.")}},I=({variant:s="primary",size:t="md",loading:r=!1,className:a,disabled:n,children:i,glow:l=!1,icon:c,...d})=>{const g="inline-flex items-center justify-center font-semibold transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transform active:scale-95 relative overflow-hidden",u={primary:"bg-gradient-to-r from-primary-500 to-primary-600 text-white hover:from-primary-600 hover:to-primary-700 focus:ring-primary-500 shadow-lg shadow-primary-500/25 hover:shadow-xl hover:shadow-primary-500/30 hover:scale-105",secondary:"bg-gradient-to-r from-secondary-100 to-secondary-200 text-secondary-700 hover:from-secondary-200 hover:to-secondary-300 focus:ring-secondary-500 border border-secondary-300 hover:border-secondary-400 hover:scale-105",outline:"border-2 border-primary-500 text-primary-600 hover:bg-primary-500 hover:text-white focus:ring-primary-500 hover:scale-105",ghost:"text-secondary-600 hover:bg-secondary-100 hover:text-secondary-900 focus:ring-secondary-500 hover:scale-105",danger:"bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 focus:ring-red-500 shadow-lg shadow-red-500/25 hover:shadow-xl hover:shadow-red-500/30 hover:scale-105",premium:"btn-premium"},h={sm:"px-4 py-2 text-sm rounded-xl",md:"px-6 py-3 text-sm rounded-xl",lg:"px-8 py-4 text-base rounded-2xl",xl:"px-10 py-5 text-lg rounded-2xl"},N=l?"animate-pulse-glow":"";return e.jsxs("button",{className:le(g,u[s],h[t],N,a),disabled:n||r,...d,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform -skew-x-12 -translate-x-full transition-transform duration-700 group-hover:translate-x-full"}),r&&e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),c&&!r&&e.jsx("span",{className:"mr-2 flex items-center",children:c}),e.jsx("span",{className:"relative z-10",children:i})]})},H=({label:s,error:t,helpText:r,className:a,id:n,icon:i,premium:l=!1,...c})=>{const d=n||`input-${Math.random().toString(36).substring(2)}`;return e.jsxs("div",{className:"space-y-2",children:[s&&e.jsx("label",{htmlFor:d,className:"block text-sm font-semibold text-secondary-700",children:s}),e.jsxs("div",{className:"relative",children:[i&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-secondary-400",children:i}),e.jsx("input",{id:d,className:le(l?"input-premium":"block w-full rounded-xl border border-secondary-200 px-4 py-3 text-secondary-900 placeholder-secondary-400","transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent","disabled:cursor-not-allowed disabled:bg-secondary-50 disabled:text-secondary-500",t&&"border-red-300 focus:border-red-500 focus:ring-red-500",i&&"pl-10",l&&"shadow-lg shadow-primary-500/10 hover:shadow-primary-500/20",a),...c}),e.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-primary-500/20 to-primary-600/20 opacity-0 transition-opacity duration-300 pointer-events-none focus-within:opacity-100"})]}),t&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center space-x-1 animate-fade-in",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{children:t})]}),r&&!t&&e.jsx("p",{className:"text-sm text-secondary-500",children:r})]})},pe=({isOpen:s,onClose:t,title:r,size:a="md",children:n,premium:i=!0,blur:l=!0})=>{if(o.useEffect(()=>{s?document.body.style.overflow="hidden":document.body.style.overflow="unset";const d=g=>{g.key==="Escape"&&t()};return s&&document.addEventListener("keydown",d),()=>{document.body.style.overflow="unset",document.removeEventListener("keydown",d)}},[s,t]),!s)return null;const c={sm:"max-w-md mx-4",md:"max-w-lg mx-4",lg:"max-w-2xl mx-4",xl:"max-w-4xl mx-4",full:"max-w-7xl mx-4"};return rt.createPortal(e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto animate-fade-in",children:e.jsxs("div",{className:"flex min-h-full items-center justify-center p-4 sm:p-6",children:[e.jsx("div",{className:le("fixed inset-0 transition-all duration-300",l?"backdrop-blur-sm bg-black/50":"bg-black/50"),onClick:t}),e.jsxs("div",{className:le("relative w-full transform transition-all duration-300 animate-scale-in max-h-[90vh] overflow-y-auto",i?"modal-premium":"bg-white rounded-2xl shadow-2xl",c[a]),children:[r&&e.jsxs("div",{className:"flex items-center justify-between border-b border-secondary-200/50 px-4 md:px-6 py-4",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-secondary-900 text-gradient",children:r}),e.jsx("button",{onClick:t,className:"rounded-xl p-2 text-secondary-400 hover:bg-secondary-100 hover:text-secondary-600 transition-all duration-200 hover:scale-110",children:e.jsx(_e,{className:"h-5 w-5"})})]}),!r&&e.jsx("button",{onClick:t,className:"absolute right-4 top-4 z-10 rounded-xl p-2 text-secondary-400 hover:bg-secondary-100 hover:text-secondary-600 transition-all duration-200 hover:scale-110",children:e.jsx(_e,{className:"h-5 w-5"})}),e.jsx("div",{className:le("px-4 md:px-6",r?"py-4 md:py-6":"py-6 md:py-8"),children:n}),e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-r from-primary-500/20 via-transparent to-primary-500/20 pointer-events-none"})]})]})}),document.body)},X=({variant:s="neutral",size:t="sm",children:r,className:a,glow:n=!1,pulse:i=!1})=>{const l="inline-flex items-center font-semibold rounded-full transition-all duration-300",c={primary:"bg-gradient-to-r from-primary-500 to-primary-600 text-white shadow-lg shadow-primary-500/30",secondary:"bg-gradient-to-r from-secondary-100 to-secondary-200 text-secondary-700 border border-secondary-300",success:"bg-gradient-to-r from-success-500 to-success-600 text-white shadow-lg shadow-success-500/30",warning:"bg-gradient-to-r from-accent-500 to-accent-600 text-white shadow-lg shadow-accent-500/30",error:"bg-gradient-to-r from-red-500 to-red-600 text-white shadow-lg shadow-red-500/30",neutral:"bg-gradient-to-r from-secondary-200 to-secondary-300 text-secondary-700",premium:"bg-gradient-to-r from-primary-600 via-primary-500 to-primary-700 text-white shadow-xl shadow-primary-500/40 border border-primary-400/50"},d={sm:"px-2.5 py-1 text-xs",md:"px-3 py-1.5 text-sm",lg:"px-4 py-2 text-base"},g=n?"animate-pulse-glow":"",u=i?"animate-pulse":"";return e.jsx("span",{className:le(l,c[s],d[t],g,u,a),children:r})},es=({isOpen:s,onClose:t,defaultMode:r="signin",initialMode:a,onSuccess:n})=>{const i=()=>a==="login"?"signin":a==="signup"?"signup":r,[l,c]=o.useState(i()),[d,g]=o.useState(!1),[u,h]=o.useState(!1),[N,m]=o.useState(""),{user:y,isGuest:A}=Z();o.useEffect(()=>{s&&a&&c(i())},[s,a]),o.useEffect(()=>{s&&!A&&y&&(console.log("üéâ User authenticated, closing auth modal"),t(),n&&n())},[s,A,y,t,n]);const[w,P]=o.useState({email:"",password:"",fullName:"",username:"",mobileNumber:""}),[S,v]=o.useState({}),_=()=>{const f={};return w.email?/\S+@\S+\.\S+/.test(w.email)||(f.email="Please enter a valid email"):f.email="Email is required",w.password?w.password.length<6&&(f.password="Password must be at least 6 characters"):f.password="Password is required",l==="signup"&&(w.fullName||(f.fullName="Full name is required"),w.username?w.username.length<3?f.username="Username must be at least 3 characters":/^[a-zA-Z0-9_]+$/.test(w.username)||(f.username="Username can only contain letters, numbers, and underscores"):f.username="Username is required",w.mobileNumber?/^\+?[\d\s-()]{10,}$/.test(w.mobileNumber)||(f.mobileNumber="Please enter a valid mobile number"):f.mobileNumber="Mobile number is required"),v(f),Object.keys(f).length===0},j=async f=>{var E;if(f.preventDefault(),m(""),!!_()){h(!0);try{if(console.log("üîê Starting authentication process..."),l==="signup"){const M=await Os(w.email,w.password,w.fullName,w.username,w.mobileNumber);console.log("‚úÖ Sign up successful:",M.user.email)}else{console.log("üîê Starting sign-in process...");const M=await $s(w.email,w.password);console.log("‚úÖ Sign in successful:",(E=M.user)==null?void 0:E.email),M.session&&M.user&&(localStorage.setItem("supabase.auth.token",JSON.stringify(M.session)),localStorage.setItem("user.authenticated","true"),localStorage.setItem("user.email",M.user.email||""),localStorage.setItem("user.data",JSON.stringify(M.user)),console.log("üíæ Session and user data stored successfully")),console.log("üîÑ Authentication complete, forcing page reload..."),t(),setTimeout(()=>{window.location.href=window.location.href},200);return}P({email:"",password:"",fullName:"",username:"",mobileNumber:""}),t(),n&&n()}catch(M){console.error("‚ùå Authentication failed:",M);const R=M instanceof Error?M.message:"Something went wrong. Please try again.";m(R)}finally{h(!1)}}},b=f=>{const{name:E,value:M}=f.target;P(R=>({...R,[E]:M})),S[E]&&v(R=>({...R,[E]:""}))},x=()=>{c(l==="signin"?"signup":"signin"),m(""),v({})};return e.jsx(pe,{isOpen:s,onClose:t,size:"md",premium:!0,children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(ge,{className:"h-6 w-6 text-primary-500 animate-bounce-subtle"}),e.jsx(X,{variant:"premium",glow:!0,pulse:!0,children:"JU CONNECT"}),e.jsx(ge,{className:"h-6 w-6 text-primary-500 animate-bounce-subtle"})]}),e.jsx("h2",{className:"text-2xl md:text-3xl font-display font-bold text-secondary-900 text-gradient",children:l==="signup"?"Join JU CONNECT":"Welcome Back"}),e.jsx("p",{className:"text-secondary-600 text-base md:text-lg",children:l==="signup"?"Create your JU CONNECT account and unlock exclusive features":"Sign in to access your JU CONNECT dashboard"}),l==="signup"&&e.jsxs("div",{className:"grid grid-cols-2 md:flex md:items-center md:justify-center gap-2 md:space-x-4 text-xs md:text-sm text-secondary-500",children:[e.jsxs("div",{className:"flex items-center space-x-1 justify-center",children:[e.jsx(Ae,{className:"h-4 w-4 text-accent-500"}),e.jsx("span",{children:"Upload Files"})]}),e.jsxs("div",{className:"flex items-center space-x-1 justify-center",children:[e.jsx(Ae,{className:"h-4 w-4 text-accent-500"}),e.jsx("span",{children:"Chat globally"})]}),e.jsxs("div",{className:"flex items-center space-x-1 justify-center",children:[e.jsx(Ae,{className:"h-4 w-4 text-accent-500"}),e.jsx("span",{children:"Private Messaging"})]}),e.jsxs("div",{className:"flex items-center space-x-1 justify-center",children:[e.jsx(Ae,{className:"h-4 w-4 text-accent-500"}),e.jsx("span",{children:"Personalized support"})]})]})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4 md:space-y-6",children:[N&&e.jsxs("div",{className:"p-4 text-sm text-red-600 bg-red-50 rounded-xl border border-red-200 flex items-center space-x-2 animate-fade-in",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsx("span",{children:N})]}),l==="signup"&&e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(H,{name:"fullName",label:"Full Name",value:w.fullName,onChange:b,error:S.fullName,placeholder:"Enter your full name",disabled:u,icon:e.jsx(we,{className:"h-5 w-5"}),premium:!0}),e.jsx(H,{name:"username",label:"Username",value:w.username,onChange:b,error:S.username,placeholder:"Choose a unique username",disabled:u,helpText:"This will be displayed publicly",icon:e.jsx(we,{className:"h-5 w-5"}),premium:!0}),e.jsx(H,{name:"mobileNumber",label:"Mobile Number",type:"tel",value:w.mobileNumber,onChange:b,error:S.mobileNumber,placeholder:"Enter your mobile number",disabled:u,icon:e.jsx(Ts,{className:"h-5 w-5"}),premium:!0})]}),e.jsx(H,{name:"email",label:"Email Address",type:"email",value:w.email,onChange:b,error:S.email,placeholder:"Enter your email",disabled:u,icon:e.jsx(Ke,{className:"h-5 w-5"}),premium:!0}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{name:"password",label:"Password",type:d?"text":"password",value:w.password,onChange:b,error:S.password,placeholder:"Enter your password",disabled:u,icon:e.jsx(Pe,{className:"h-5 w-5"}),premium:!0}),e.jsx("button",{type:"button",onClick:()=>g(!d),className:"absolute right-4 top-10 text-secondary-400 hover:text-secondary-600 transition-colors duration-300 hover:scale-110",children:d?e.jsx(Qe,{className:"h-5 w-5"}):e.jsx(Se,{className:"h-5 w-5"})})]}),e.jsx(I,{type:"submit",variant:"premium",size:"lg",className:"w-full",loading:u,disabled:u,glow:!0,children:l==="signup"?"Create JU CONNECT Account":"Sign In to JU CONNECT"}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:x,className:"text-primary-600 hover:text-primary-500 font-semibold transition-colors duration-300 hover:scale-105 transform",disabled:u,children:l==="signup"?"Already have an account? Sign in":"Don't have an account? Join JU CONNECT"})})]}),l==="signup"&&e.jsx("div",{className:"border-t border-secondary-200 pt-4 md:pt-6",children:e.jsxs("div",{className:"text-center text-sm text-secondary-600",children:[e.jsx("p",{className:"mb-3 font-medium",children:"What you get with Membership:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{className:"truncate",children:"Unlimited Downloads"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{className:"truncate",children:"Private Messaging"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{className:"truncate",children:"Upload Content"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{className:"truncate",children:"Priority Support"})]})]})]})})]})})},Kt=async(s,t,r,a)=>{const{data:n}=await p.from("content_reports").select("id").eq("content_id",s).eq("reported_by",t).maybeSingle();if(n)throw new Error("You have already reported this content");const i={content_id:s,reported_by:t,reason:r.trim(),description:(a==null?void 0:a.trim())||null},{data:l,error:c}=await p.from("content_reports").insert([i]).select().single();if(c)throw c;return l},Qt=async(s,t,r,a)=>{const{data:n}=await p.from("chat_reports").select("id").eq("message_id",s).eq("reported_by",t).single();if(n)throw new Error("You have already reported this message");const i={message_id:s,reported_by:t,reason:r.trim(),description:null},{data:l,error:c}=await p.from("chat_reports").insert([i]).select().single();if(c)throw c;return l},Zt=async s=>{let t=p.from("content_reports").select(`
      *,
      content (
        id,
        title,
        content_type
      ),
      reporter:profiles!content_reports_reported_by_fkey (
        id,
        username,
        full_name
      ),
      reviewer:profiles!content_reports_reviewed_by_fkey (
        id,
        username,
        full_name
      )
    `).order("created_at",{ascending:!1});const{data:r,error:a}=await t;if(a)throw a;return r||[]},ea=async s=>{let t=p.from("chat_reports").select(`
      *,
      chat_messages (
        id,
        message,
        user_id
      ),
      reporter:profiles!chat_reports_reported_by_fkey (
        id,
        username,
        full_name
      ),
      reviewer:profiles!chat_reports_reviewed_by_fkey (
        id,
        username,
        full_name
      )
    `).order("created_at",{ascending:!1});const{data:r,error:a}=await t;if(a)throw a;return r||[]},Bs=async(s,t,r,a)=>{const{data:n,error:i}=await p.from("content_reports").update({status:t,reviewed_by:r,admin_notes:(a==null?void 0:a.trim())||null,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(i)throw i;return n},Js=async(s,t,r,a)=>{const{data:n,error:i}=await p.from("chat_reports").update({status:t,reviewed_by:r,admin_notes:(a==null?void 0:a.trim())||null,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(i)throw i;return n},sa=async(s,t,r,a)=>{await Bs(t,"resolved",r,`Content removed: ${a}`);const{error:n}=await p.from("content").delete().eq("id",s);if(n)throw n},ta=async(s,t,r,a)=>{await Js(t,"resolved",r,`Message removed: ${a}`);const{error:n}=await p.from("chat_messages").update({is_reported:!0}).eq("id",s);if(n)throw n},aa=async()=>{const[s,t]=await Promise.all([p.from("content_reports").select("status"),p.from("chat_reports").select("status")]);if(s.error)throw s.error;if(t.error)throw t.error;const r={total:s.data.length,pending:s.data.filter(n=>n.status==="pending").length,reviewed:s.data.filter(n=>n.status==="reviewed").length,resolved:s.data.filter(n=>n.status==="resolved").length,dismissed:s.data.filter(n=>n.status==="dismissed").length},a={total:t.data.length,pending:t.data.filter(n=>n.status==="pending").length,reviewed:t.data.filter(n=>n.status==="reviewed").length,resolved:t.data.filter(n=>n.status==="resolved").length,dismissed:t.data.filter(n=>n.status==="dismissed").length};return{contentReports:r,chatReports:a}},ae=({size:s="md",className:t,variant:r="primary",text:a})=>{const n={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"},i={primary:"text-primary-600",secondary:"text-secondary-600",white:"text-white"};return e.jsxs("div",{className:le("flex flex-col items-center justify-center space-y-3",t),children:[e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:le("animate-spin",n[s],i[r]),fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("div",{className:le("absolute inset-0 rounded-full animate-pulse",s==="xl"?"shadow-glow":"")})]}),a&&e.jsx("p",{className:le("text-sm font-medium animate-pulse",i[r]),children:a})]})},ra=({isOpen:s,onClose:t})=>{var b;const{user:r,profile:a}=Z(),[n,i]=o.useState("overview"),[l,c]=o.useState([]),[d,g]=o.useState([]),[u,h]=o.useState(null),[N,m]=o.useState(!1),[y,A]=o.useState(null),[w,P]=o.useState(!1);o.useEffect(()=>{s&&(a!=null&&a.is_admin)&&S()},[s,a]);const S=async()=>{m(!0);try{const[x,f,E]=await Promise.all([Zt(),ea(),aa()]);c(x),g(f),h(E)}catch(x){console.error("Failed to fetch admin data:",x)}finally{m(!1)}},v=async(x,f,E,M)=>{if(r){P(!0);try{if(M){const R=l.find(O=>O.id===x);R&&await sa(R.content_id,x,r.id,E||"Content removed due to policy violation")}else await Bs(x,f,r.id,E);await S(),A(null)}catch(R){console.error("Failed to update report:",R),alert(R.message||"Failed to update report")}finally{P(!1)}}},_=async(x,f,E,M)=>{if(r){P(!0);try{if(M){const R=d.find(O=>O.id===x);R&&await ta(R.message_id,x,r.id,E||"Message removed due to policy violation")}else await Js(x,f,r.id,E);await S(),A(null)}catch(R){console.error("Failed to update report:",R),alert(R.message||"Failed to update report")}finally{P(!1)}}},j=x=>{switch(x){case"pending":return"warning";case"reviewed":return"primary";case"resolved":return"success";case"dismissed":return"neutral";default:return"neutral"}};return a!=null&&a.is_admin?e.jsx(pe,{isOpen:s,onClose:t,size:"xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(fe,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Admin Panel"})]}),e.jsxs("div",{className:"flex space-x-2 md:space-x-4 mb-6 border-b border-gray-200 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>i("overview"),className:`pb-2 px-1 font-medium text-sm ${n==="overview"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(rs,{className:"h-4 w-4 inline mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Overview"})]}),e.jsxs("button",{onClick:()=>i("content"),className:`pb-2 px-1 font-medium text-sm ${n==="content"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(K,{className:"h-4 w-4 inline mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Content Reports"}),e.jsx("span",{className:"sm:hidden",children:"Content"}),e.jsxs("span",{className:"ml-1",children:["(",l.filter(x=>x.status==="pending").length,")"]})]}),e.jsxs("button",{onClick:()=>i("chat"),className:`pb-2 px-1 font-medium text-sm ${n==="chat"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(Ue,{className:"h-4 w-4 inline mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Chat Reports"}),e.jsx("span",{className:"sm:hidden",children:"Chat"}),e.jsxs("span",{className:"ml-1",children:["(",d.filter(x=>x.status==="pending").length,")"]})]})]}),N?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(ae,{size:"lg"})}):e.jsxs("div",{className:"max-h-64 md:max-h-96 overflow-y-auto",children:[n==="overview"&&u&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-900",children:"Content Reports"})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:u.contentReports.pending}),e.jsxs("div",{className:"text-sm text-orange-700",children:["Pending (",u.contentReports.total," total)"]})]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ue,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"font-medium text-red-900",children:"Chat Reports"})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("div",{className:"text-2xl font-bold text-red-900",children:u.chatReports.pending}),e.jsxs("div",{className:"text-sm text-red-700",children:["Pending (",u.chatReports.total," total)"]})]})]})]}),e.jsx("div",{className:"text-sm text-gray-600",children:e.jsx("p",{children:"Review and moderate reported content to maintain community standards."})})]}),n==="content"&&e.jsx("div",{className:"space-y-4",children:l.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No content reports found"}):l.map(x=>{var f,E;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 md:p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start justify-between space-y-3 md:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(X,{variant:j(x.status),children:x.status}),e.jsx("span",{className:"text-sm text-gray-500",children:x.reason})]}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1 text-sm md:text-base",children:((f=x.content)==null?void 0:f.title)||"Content Title"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 mb-2",children:x.description}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:["Reported by @",(E=x.reporter)==null?void 0:E.username," ‚Ä¢ "," ",Ce(new Date(x.created_at),{addSuffix:!0})]})]}),e.jsx(I,{size:"sm",variant:"outline",className:"w-full md:w-auto",onClick:()=>A(x),children:"Review"})]})},x.id)})}),n==="chat"&&e.jsx("div",{className:"space-y-4",children:d.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No chat reports found"}):d.map(x=>{var f,E;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(X,{variant:j(x.status),children:x.status}),e.jsx("span",{className:"text-sm text-gray-500",children:x.reason})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded mb-2",children:e.jsxs("p",{className:"text-sm text-gray-900",children:['"',(f=x.chat_messages)==null?void 0:f.message,'"']})}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:x.description}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Reported by @",(E=x.reporter)==null?void 0:E.username," ‚Ä¢ "," ",Ce(new Date(x.created_at),{addSuffix:!0})]})]}),e.jsx(I,{size:"sm",variant:"outline",onClick:()=>A(x),children:"Review"})]})},x.id)})})]}),y&&e.jsx(pe,{isOpen:!!y,onClose:()=>A(null),title:"Review Report",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Report Details"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Reason:"})," ",y.reason]}),y.description&&e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"Description:"})," ",y.description]}),e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"Reported by:"})," @",(b=y.reporter)==null?void 0:b.username]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(I,{size:"sm",variant:"outline",onClick:()=>{y.content_id?v(y.id,"reviewed"):_(y.id,"reviewed")},loading:w,children:"Mark Reviewed"}),e.jsx(I,{size:"sm",variant:"danger",onClick:()=>{y.content_id?v(y.id,"resolved","Content removed",!0):_(y.id,"resolved","Message removed",!0)},loading:w,children:"Remove Content"}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>{y.content_id?v(y.id,"dismissed","No action needed"):_(y.id,"dismissed","No action needed")},loading:w,children:"Dismiss"})]})]})})]})}):null},na=async(s,t,r)=>{if(s===t)throw new Error("Cannot send message to yourself");if(!p)throw new Error("Supabase client not initialized");const{data:a}=await p.from("profiles").select("id").eq("id",t).single();if(!a)throw new Error("Recipient not found");const{data:n}=await p.from("user_blocks").select("id").eq("blocker_id",t).eq("blocked_id",s).maybeSingle();if(n)throw new Error("Cannot send message to this user");const i={sender_id:s,recipient_id:t,message:r.trim()},{data:l,error:c}=await p.from("private_messages").insert([i]).select().single();if(c)throw c;return l},ia=async(s,t,r=50,a=0)=>{const{data:n,error:i}=await p.from("private_messages").select(`
      *,
      sender:profiles!private_messages_sender_id_fkey (
        id,
        username,
        full_name,
        avatar_url,
        is_online
      ),
      recipient:profiles!private_messages_recipient_id_fkey (
        id,
        username,
        full_name,
        avatar_url,
        is_online
      )
    `).or(`and(sender_id.eq.${s},recipient_id.eq.${t}),and(sender_id.eq.${t},recipient_id.eq.${s})`).eq("is_deleted_by_sender",!1).eq("is_deleted_by_recipient",!1).order("created_at",{ascending:!0}).range(a,a+r-1);if(i)throw i;return n||[]},la=async s=>{const{data:t,error:r}=await p.from("private_messages").select(`
      *,
      sender:profiles!private_messages_sender_id_fkey (
        id,
        username,
        full_name,
        avatar_url,
        is_online,
        last_seen
      ),
      recipient:profiles!private_messages_recipient_id_fkey (
        id,
        username,
        full_name,
        avatar_url,
        is_online,
        last_seen
      )
    `).or(`sender_id.eq.${s},recipient_id.eq.${s}`).order("created_at",{ascending:!1});if(r)throw r;const a=new Map;return t==null||t.forEach(i=>{const l=i.sender_id===s,c=l?i.recipient_id:i.sender_id,d=l?i.recipient:i.sender;a.has(c)||a.set(c,{otherUser:d,messages:[],unreadCount:0});const g=a.get(c);g.messages.push(i),!l&&!i.is_read&&g.unreadCount++}),Array.from(a.values()).map(i=>({otherUser:i.otherUser,lastMessage:i.messages[0],unreadCount:i.unreadCount})).sort((i,l)=>{var g,u;const c=((g=i.lastMessage)==null?void 0:g.created_at)||"0";return(((u=l.lastMessage)==null?void 0:u.created_at)||"0").localeCompare(c)})},Vs=s=>{const[t,r]=o.useState([]),[a,n]=o.useState([]),[i,l]=o.useState(!1),[c,d]=o.useState(!1),[g,u]=o.useState(null),h=o.useRef(null),N=t.reduce((v,_)=>v+_.unreadCount,0),m=o.useCallback(async(v=!1)=>{if(!s)return;const _=Date.now(),j=parseInt(sessionStorage.getItem(`last-conversations-load-${s}`)||"0");if(!v&&_-j<2e3){console.log("Conversations load rate limited");return}sessionStorage.setItem(`last-conversations-load-${s}`,_.toString());try{l(!0);const b=await la(s);r(b)}catch(b){console.error("Failed to load conversations:",b),u("Failed to load conversations")}finally{l(!1)}},[s]),y=o.useCallback(async v=>{if(s)try{l(!0);const _=await ia(s,v);n(_)}catch(_){console.error("Failed to load conversation:",_),u("Failed to load conversation")}finally{l(!1)}},[s]),A=o.useCallback(async(v,_)=>{if(!(!s||!_.trim()))try{d(!0),u(null);const j=await na(s,v,_.trim());return n(b=>[...b,j]),await m(),j}catch(j){throw console.error("Failed to send message:",j),u(j instanceof Error?j.message:"Failed to send message"),j}finally{d(!1)}},[s,m]),w=o.useCallback(()=>{if(a.length===0)return null;const v=a[0];return v.sender_id===s?v.recipient_id:v.sender_id},[a,s]);o.useEffect(()=>{if(!s)return;const v=w();if(!v)return;const _=setInterval(()=>{y(v)},2e3);return()=>clearInterval(_)},[s,w,y,a.length]),o.useEffect(()=>{if(!s||!p)return;if(h.current&&p.removeChannel(h.current),t.length===0){console.log("No conversations loaded, skipping real-time subscription");return}const v=p.channel(`private_messages_${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"private_messages",filter:`recipient_id.eq.${s}`},async _=>{const j=_.new;if(console.log("New private message received from:",j.sender_id),t.some(x=>x.otherUser.id===j.sender_id)){const x=Date.now(),f=parseInt(sessionStorage.getItem(`last-rt-update-${s}`)||"0");x-f>5e3&&(sessionStorage.setItem(`last-rt-update-${s}`,x.toString()),await m(!1))}}).subscribe();return h.current=v,()=>{h.current&&p&&p.removeChannel(h.current)}},[s,m,y,w,t]),o.useEffect(()=>{m(!1)},[m]),o.useEffect(()=>{if(!s)return;const v=setInterval(()=>{m(!1)},3e3);return()=>clearInterval(v)},[s,m]),o.useEffect(()=>{if(g){const v=setTimeout(()=>u(null),5e3);return()=>clearTimeout(v)}},[g]);const P=o.useCallback(async v=>{if(!s)return;if(await y(v),!t.find(j=>j.otherUser.id===v))try{if(!p)return;const{data:j}=await p.from("profiles").select("id, username, full_name, avatar_url").eq("id",v).single();if(j){const b={otherUser:{id:j.id,username:j.username,full_name:j.full_name,avatar_url:j.avatar_url||void 0,is_online:!1,last_seen:void 0},lastMessage:void 0,unreadCount:0};r(x=>[b,...x])}}catch(j){console.error("Error fetching user profile:",j)}},[s,y,t]),S=o.useCallback(v=>{const _=w();_&&(v.sender_id===_||v.recipient_id===_)&&n(b=>b.some(x=>x.id===v.id)?b:[...b,v]),r(b=>b.map(x=>x.otherUser.id===v.sender_id||x.otherUser.id===v.recipient_id?{...x,lastMessage:v,unreadCount:v.sender_id!==s?x.unreadCount+1:x.unreadCount}:x))},[w,s]);return{conversations:t,currentConversation:a,totalUnreadCount:N,loading:i,sending:c,error:g,loadConversations:m,loadConversation:y,sendMessage:A,startNewConversation:P,setCurrentConversation:n,addMessageToConversation:S}},oa=()=>{const[s,t]=o.useState(!1),[r,a]=o.useState(!1),[n,i]=o.useState(!1),{user:l,profile:c,isGuest:d,signOut:g,debugAuthState:u}=Z(),h=ds(),N=nt(),{totalUnreadCount:m}=Vs((l==null?void 0:l.id)||null);o.useEffect(()=>{console.log("üîç Navbar: Auth state changed"),u()},[l,d,u]);const y=S=>h.pathname===S,A=[{name:"Browse",href:"/",icon:Re},{name:"Categories",href:"/categories",icon:K},{name:"Groups",href:"/groups",icon:ve},{name:"Upload",href:"/upload",icon:Ze},{name:"Requests",href:"/my-requests",icon:As}],w=async()=>{try{t(!1),console.log("üö™ User initiated sign out"),await g()}catch(S){console.error("Error during sign out:",S),t(!1)}},P=(S,v=!1)=>{if(t(!1),v&&(!l||d)){S.preventDefault(),a(!0);return}};return e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"glass sticky top-0 z-40 border-b border-white/20",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-14 sm:h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(ie,{to:"/",className:"flex items-center space-x-2 sm:space-x-3 group",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary-600 group-hover:scale-110 transition-transform duration-300"}),e.jsx("div",{className:"absolute inset-0 bg-primary-500 rounded-full blur-lg opacity-0 group-hover:opacity-30 transition-opacity duration-300"})]}),e.jsx("span",{className:"font-display font-bold text-lg sm:text-xl text-gradient animate-gradient-text hidden xs:block",children:"JU CONNECT"}),e.jsx("span",{className:"font-display font-bold text-lg sm:text-xl text-gradient animate-gradient-text xs:hidden",children:"JU"}),e.jsx(ge,{className:"h-3 w-3 sm:h-4 sm:w-4 text-accent-500 animate-bounce-subtle"})]}),e.jsx("div",{className:"hidden lg:ml-8 lg:flex lg:space-x-2",children:A.map(S=>{const v=["/upload","/my-requests","/groups","/chat"].includes(S.href);return e.jsxs(ie,{to:S.href,onClick:_=>P(_,v),className:le("px-3 xl:px-4 py-2 rounded-xl text-sm font-semibold transition-all duration-300 flex items-center space-x-2 group relative overflow-hidden",y(S.href)?"text-white bg-gradient-to-r from-primary-500 to-primary-600 shadow-lg shadow-primary-500/30":"text-secondary-600 hover:text-primary-600 hover:bg-white/50"),children:[e.jsx(S.icon,{className:le("h-4 w-4 transition-transform duration-300",y(S.href)?"scale-110":"group-hover:scale-110")}),e.jsx("span",{className:"hidden xl:block",children:S.name}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform -skew-x-12 -translate-x-full transition-transform duration-700 group-hover:translate-x-full"}),v&&(!l||d)&&e.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-accent-500 rounded-full animate-pulse"})]},S.name)})})]}),e.jsx("div",{className:"hidden md:flex md:items-center md:space-x-4",children:!l||d?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm text-secondary-600 px-3 py-1 bg-secondary-100 rounded-full",children:"üëã Browsing as Guest"}),e.jsx(I,{size:"sm",variant:"premium",onClick:()=>a(!0),children:"Sign In"})]}):l?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>N("/chat?tab=private"),className:"relative p-3 text-secondary-600 hover:text-primary-600 rounded-xl hover:bg-white/50 transition-all duration-300 hover:scale-110",title:"Messages",children:[e.jsx(Ke,{className:"h-5 w-5"}),m>0&&e.jsx("div",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] bg-red-500 text-white text-xs rounded-full flex items-center justify-center px-1 animate-pulse",children:m>99?"99+":m})]}),(c==null?void 0:c.is_admin)&&e.jsx("button",{onClick:()=>i(!0),className:"p-3 text-secondary-600 hover:text-primary-600 rounded-xl hover:bg-white/50 transition-all duration-300 hover:scale-110",title:"Admin Panel",children:e.jsx(fe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center space-x-3 px-4 py-2 bg-gradient-to-r from-white/80 to-white/60 rounded-2xl border border-white/50 backdrop-blur-sm",children:[e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"h-5 w-5 text-secondary-600"}),e.jsx("div",{className:"status-online absolute -bottom-1 -right-1"})]}),c?e.jsxs(ie,{to:`/profile/${l.id}`,className:"flex flex-col hover:text-primary-600 transition-colors duration-300",children:[e.jsxs("span",{className:"text-sm font-semibold text-secondary-700 hover:text-primary-600",children:["@",c.username]}),c.is_admin&&e.jsx("span",{className:"text-xs text-primary-600 font-medium",children:"Admin"})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-semibold text-secondary-700",children:l.email}),e.jsx("span",{className:"text-xs text-secondary-500",children:"Loading profile..."})]})]}),e.jsx("button",{onClick:w,className:"p-3 text-secondary-600 hover:text-red-600 rounded-xl hover:bg-red-50 transition-all duration-300 hover:scale-110",title:"Sign Out",children:e.jsx(ns,{className:"h-5 w-5"})})]}):null}),e.jsx("div",{className:"lg:hidden flex items-center",children:e.jsx("button",{onClick:()=>t(!s),className:"p-2 rounded-xl text-secondary-600 hover:text-primary-600 hover:bg-white/50 transition-all duration-300","aria-label":s?"Close menu":"Open menu",children:s?e.jsx(_e,{className:"h-5 w-5 sm:h-6 sm:w-6"}):e.jsx(xt,{className:"h-5 w-5 sm:h-6 sm:w-6"})})})]})}),s&&e.jsx("div",{className:"lg:hidden border-t border-white/20 bg-white/95 backdrop-blur-xl animate-fade-in-down",children:e.jsxs("div",{className:"px-4 pt-4 pb-6 space-y-3",children:[A.map(S=>{const v=["/upload","/my-requests","/groups","/chat"].includes(S.href);return e.jsxs(ie,{to:S.href,onClick:_=>P(_,v),className:le("flex items-center space-x-3 px-4 py-3 rounded-xl text-base font-semibold transition-all duration-300 relative overflow-hidden",y(S.href)?"text-white bg-gradient-to-r from-primary-500 to-primary-600 shadow-lg shadow-primary-500/30":"text-secondary-600 hover:text-primary-600 hover:bg-white/50"),children:[e.jsx(S.icon,{className:"h-5 w-5"}),e.jsx("span",{children:S.name}),v&&(!l||d)&&e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-2 h-2 bg-accent-500 rounded-full animate-pulse"})})]},S.name)}),e.jsx("div",{className:"border-t border-secondary-200 pt-4 mt-4",children:!l||d?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"px-4 py-2 text-sm text-secondary-600 bg-secondary-100 rounded-xl",children:"üëã Browsing as Guest"}),e.jsx(I,{className:"w-full",variant:"premium",onClick:()=>{a(!0),t(!1)},children:"Sign In"})]}):l?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 px-4 py-3 bg-gradient-to-r from-white/80 to-white/60 rounded-xl border border-white/50",children:[e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"h-6 w-6 text-secondary-600"}),e.jsx("div",{className:"status-online absolute -bottom-1 -right-1"})]}),e.jsx(ie,{to:`/profile/${l.id}`,className:"flex flex-col hover:text-primary-600 transition-colors duration-300",onClick:()=>t(!1),children:c?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-base font-semibold text-secondary-700 hover:text-primary-600",children:["@",c.username]}),c.is_admin&&e.jsx("span",{className:"text-sm text-primary-600 font-medium",children:"Admin"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-base font-semibold text-secondary-700",children:l.email}),e.jsx("span",{className:"text-sm text-secondary-500",children:"Loading profile..."})]})})]}),(c==null?void 0:c.is_admin)&&e.jsxs("button",{onClick:()=>{i(!0),t(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 text-base font-semibold text-secondary-600 hover:bg-white/50 rounded-xl transition-all duration-300",children:[e.jsx(fe,{className:"h-5 w-5"}),e.jsx("span",{children:"Admin Panel"})]}),e.jsxs("button",{onClick:w,className:"w-full flex items-center space-x-3 px-4 py-3 text-base font-semibold text-red-600 hover:bg-red-50 rounded-xl transition-all duration-300",children:[e.jsx(ns,{className:"h-5 w-5"}),e.jsx("span",{children:"Sign Out"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"px-4 py-2 text-sm text-secondary-600 bg-secondary-100 rounded-xl",children:"üëã Browsing as Guest"}),e.jsx(I,{className:"w-full",variant:"premium",onClick:()=>{a(!0),t(!1)},children:"Sign In"})]})})]})})]}),e.jsx(es,{isOpen:r,onClose:()=>a(!1),onSuccess:()=>a(!1)}),(c==null?void 0:c.is_admin)&&e.jsx(ra,{isOpen:n,onClose:()=>i(!1)})]})},ca=({className:s})=>e.jsxs("footer",{className:le("relative bg-gradient-to-br from-secondary-900 via-secondary-800 to-primary-900 text-white overflow-hidden",s),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary-500/10 via-transparent to-primary-500/10"}),e.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-primary-500/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-accent-500/5 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative max-w-7xl mx-auto py-16 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-12",children:[e.jsxs("div",{className:"col-span-1 md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 group",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"h-10 w-10 text-primary-400 group-hover:scale-110 transition-transform duration-300"}),e.jsx("div",{className:"absolute inset-0 bg-primary-500 rounded-full blur-lg opacity-0 group-hover:opacity-30 transition-opacity duration-300"})]}),e.jsx("span",{className:"font-display font-bold text-2xl text-gradient",children:"JU CONNECT"}),e.jsx(ge,{className:"h-5 w-5 text-accent-400 animate-bounce-subtle"})]}),e.jsx("p",{className:"text-secondary-300 text-lg leading-relaxed max-w-md",children:"A premium platform for JECRC University students. Share knowledge, connect globally, and access thousands of educational resources in a beautiful, secure environment."}),e.jsxs("div",{className:"flex items-center space-x-2 text-secondary-400",children:[e.jsx("span",{children:"Crafted with"}),e.jsx(ht,{className:"h-5 w-5 text-primary-400 animate-pulse"}),e.jsx("span",{children:"for students"}),e.jsx("div",{className:"flex space-x-1 ml-2",children:[...Array(5)].map((t,r)=>e.jsx(Ae,{className:"h-4 w-4 text-accent-400 fill-current animate-bounce-subtle",style:{animationDelay:`${r*.1}s`}},r))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center space-x-2",children:[e.jsx("span",{children:"Quick Links"}),e.jsx("div",{className:"w-8 h-0.5 bg-gradient-to-r from-primary-500 to-transparent"})]}),e.jsx("ul",{className:"space-y-3",children:[{name:"Browse Content",href:"/",external:!1},{name:"Categories",href:"/categories",external:!1},{name:"Upload Content",href:"/upload",external:!1},{name:"Student Chat",href:"/chat",external:!1}].map(t=>e.jsx("li",{children:t.external?e.jsxs("a",{href:t.href,target:"_blank",rel:"noopener noreferrer",className:"text-secondary-300 hover:text-primary-400 transition-all duration-300 flex items-center space-x-2 group",children:[e.jsx("div",{className:"w-1 h-1 bg-primary-500 rounded-full group-hover:w-2 transition-all duration-300"}),e.jsx("span",{className:"group-hover:translate-x-1 transition-transform duration-300",children:t.name})]}):e.jsxs(ie,{to:t.href,className:"text-secondary-300 hover:text-primary-400 transition-all duration-300 flex items-center space-x-2 group",children:[e.jsx("div",{className:"w-1 h-1 bg-primary-500 rounded-full group-hover:w-2 transition-all duration-300"}),e.jsx("span",{className:"group-hover:translate-x-1 transition-transform duration-300",children:t.name})]})},t.name))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center space-x-2",children:[e.jsx("span",{children:"Support"}),e.jsx("div",{className:"w-8 h-0.5 bg-gradient-to-r from-primary-500 to-transparent"})]}),e.jsx("ul",{className:"space-y-3",children:[{name:"Help Center",href:"/help",external:!1},{name:"Privacy Policy",href:"/privacy",external:!1},{name:"Terms of Service",href:"/terms",external:!1},{name:"Contact Us",href:"/contact",external:!1}].map(t=>e.jsx("li",{children:t.external?e.jsxs("a",{href:t.href,target:"_blank",rel:"noopener noreferrer",className:"text-secondary-300 hover:text-primary-400 transition-all duration-300 flex items-center space-x-2 group",children:[e.jsx("div",{className:"w-1 h-1 bg-primary-500 rounded-full group-hover:w-2 transition-all duration-300"}),e.jsx("span",{className:"group-hover:translate-x-1 transition-transform duration-300",children:t.name})]}):e.jsxs(ie,{to:t.href,className:"text-secondary-300 hover:text-primary-400 transition-all duration-300 flex items-center space-x-2 group",children:[e.jsx("div",{className:"w-1 h-1 bg-primary-500 rounded-full group-hover:w-2 transition-all duration-300"}),e.jsx("span",{className:"group-hover:translate-x-1 transition-transform duration-300",children:t.name})]})},t.name))})]})]}),e.jsx("div",{className:"border-t border-secondary-700/50 pt-8 mt-12",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0",children:[e.jsx("p",{className:"text-secondary-400 text-sm",children:"¬© 2025 JU CONNECT. All rights reserved."}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("a",{href:"https://github.com/pritam-ray/JUCONNECT",target:"_blank",rel:"noopener noreferrer",className:"text-secondary-400 hover:text-primary-400 transition-all duration-300 hover:scale-110",children:e.jsx(pt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-gradient-to-r from-primary-500/20 to-primary-600/20 rounded-full border border-primary-500/30",children:[e.jsx("div",{className:"w-2 h-2 bg-success-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-secondary-300 font-medium",children:"v2.0.0"})]})]})]})})]})]}),da=({onAuthRequired:s})=>{const{user:t,isGuest:r}=Z(),a=ds(),{totalUnreadCount:n}=Vs((t==null?void 0:t.id)||null),i=d=>d==="/chat"?a.pathname==="/chat":a.pathname===d,l=[{name:"Home",href:"/",icon:gt,requiresAuth:!1},{name:"Categories",href:"/categories",icon:K,requiresAuth:!1},{name:"Groups",href:"/groups",icon:ve,requiresAuth:!0},{name:"Messages",href:"/chat",icon:Ke,requiresAuth:!0},{name:"Upload",href:"/upload",icon:Ze,requiresAuth:!0}],c=(d,g)=>{g.requiresAuth&&(!t||r)&&(d.preventDefault(),s())};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 md:hidden bg-white/95 backdrop-blur-sm border-t border-secondary-200/50 shadow-lg",children:e.jsx("div",{className:"flex items-center justify-around py-3 px-2",children:l.map(d=>e.jsxs(ie,{to:d.href,onClick:g=>c(g,d),className:le("flex flex-col items-center justify-center py-2 px-2 rounded-xl transition-all duration-300 relative group min-w-0 flex-1",i(d.href)?"text-primary-600 bg-primary-50":"text-secondary-500 hover:text-primary-500 hover:bg-secondary-50"),"aria-label":d.name,children:[e.jsxs("div",{className:"relative mb-1",children:[e.jsx(d.icon,{className:le("h-5 w-5 transition-all duration-300",i(d.href)?"scale-110":"group-hover:scale-110")}),d.name==="Messages"&&n>0&&e.jsx("div",{className:"absolute -top-2 -right-2 min-w-[18px] h-[18px] bg-red-500 text-white text-xs rounded-full flex items-center justify-center px-1 animate-pulse",children:n>99?"99+":n}),d.requiresAuth&&(!t||r)&&e.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-accent-500 rounded-full animate-pulse border border-white"})]}),e.jsx("span",{className:le("text-xs font-medium transition-all duration-300 text-center truncate",d.name.length>8?"text-2xs":"text-xs"),children:d.name})]},d.name))})})})},ma=({children:s})=>{const[t,r]=o.useState(!1),a=ds();return o.useEffect(()=>{r(!0),window.scrollTo({top:0,behavior:"instant"});const n=setTimeout(()=>{r(!1)},100);return()=>clearTimeout(n)},[a.pathname]),t?e.jsx("div",{className:"fixed inset-0 z-50 bg-white flex items-center justify-center",children:e.jsx(ae,{size:"lg"})}):e.jsx(e.Fragment,{children:s})},qe=({children:s,fallback:t,pageName:r="this feature"})=>{const{user:a,isGuest:n,loading:i}=Z();return i?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):(console.log("AuthGuard: user:",!!a,"isGuest:",n,"loading:",i),a&&!n?(console.log("AuthGuard: Allowing access - authenticated user"),e.jsx(e.Fragment,{children:s})):(console.log("AuthGuard: Blocking access - showing auth screen"),t?e.jsx(e.Fragment,{children:t}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(Pe,{className:"h-8 w-8 text-primary-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Authentication Required"}),e.jsxs("p",{className:"text-gray-600",children:["You need to be logged in to access ",r,". Please sign in or create an account to continue."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(I,{onClick:()=>{const l=new CustomEvent("openAuthModal",{detail:{mode:"login"}});window.dispatchEvent(l)},className:"flex items-center justify-center space-x-2",variant:"primary",children:[e.jsx(ft,{className:"h-4 w-4"}),e.jsx("span",{children:"Sign In"})]}),e.jsxs(I,{onClick:()=>{const l=new CustomEvent("openAuthModal",{detail:{mode:"signup"}});window.dispatchEvent(l)},className:"flex items-center justify-center space-x-2",variant:"outline",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{children:"Sign Up"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"or"})})]}),e.jsx(I,{onClick:()=>{window.location.href="/"},variant:"ghost",className:"w-full",children:"Return to Home"})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-500",children:e.jsx("strong",{children:"Available Features for Guests:"})}),e.jsxs("ul",{className:"text-sm text-gray-500 mt-2 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Browse public content"}),e.jsx("li",{children:"‚Ä¢ View help center"}),e.jsx("li",{children:"‚Ä¢ Contact support"})]})]})]})})))},ua="/assets/slide1-Bs0a-rFc.jpg",xa="/assets/slide2-hEhGsOcv.jpg",ha="/assets/slide3-BuwYLEvl.jpg",pa="/assets/slide4-BSNdurEF.jpg",ga="/assets/slide5-CAVaPhPx.jpg",fa="/assets/slide6-DkMIzLmR.jpg";class ya{constructor(){W(this,"cache",new Map);W(this,"DEFAULT_TTL",3e4);W(this,"MAX_CACHE_SIZE",100);W(this,"pendingRequests",new Map)}generateKey(t,r){const a=r?JSON.stringify(r):"";return`${t}${a}`}async get(t){const r=this.cache.get(t);return r?Date.now()>r.timestamp+r.expiry?(this.cache.delete(t),null):(console.log(`üì¶ Cache HIT: ${t}`),r.data):null}set(t,r,a=this.DEFAULT_TTL){if(this.cache.size>=this.MAX_CACHE_SIZE){const n=Array.from(this.cache.entries());n.sort((i,l)=>i[1].timestamp-l[1].timestamp),n.slice(0,10).forEach(([i])=>this.cache.delete(i))}this.cache.set(t,{data:r,timestamp:Date.now(),expiry:a}),console.log(`üíæ Cache SET: ${t}`)}async getOrFetch(t,r,a=this.DEFAULT_TTL){const n=await this.get(t);if(n!==null)return n;if(this.pendingRequests.has(t))return console.log(`‚è≥ Waiting for pending request: ${t}`),this.pendingRequests.get(t);console.log(`üåê Cache MISS, fetching: ${t}`);const i=r().then(l=>(this.set(t,l,a),this.pendingRequests.delete(t),l)).catch(l=>{throw this.pendingRequests.delete(t),l});return this.pendingRequests.set(t,i),i}clear(){this.cache.clear(),this.pendingRequests.clear(),console.log("üóëÔ∏è Cache cleared")}invalidate(t){const r=[];for(const[a]of this.cache)a.includes(t)&&r.push(a);r.forEach(a=>this.cache.delete(a)),console.log(`üîÑ Invalidated ${r.length} cache entries matching: ${t}`)}getStats(){return{cacheSize:this.cache.size,pendingRequests:this.pendingRequests.size}}}const Xe=new ya;setInterval(()=>{const s=Xe.getStats();s.cacheSize>0&&(console.log(`üßπ Cleaning cache, current size: ${s.cacheSize}`),Xe.clear())},300*1e3);const Be=async(s,t,r,a=20,n=0)=>{if(!te())return console.warn("Supabase is not configured. Returning empty content list."),[];const i=Xe.generateKey("approved_content",{contentType:s,categoryId:t,searchQuery:r,limit:a,offset:n});return Xe.getOrFetch(i,async()=>{var l;try{if(!p)return console.warn("Supabase client is not available"),[];let c=p.from("content").select(`
          *,
          categories (
            id,
            name,
            slug
          ),
          profiles (
            id,
            username,
          full_name
        )
      `).eq("is_approved",!0).order("created_at",{ascending:!1}).range(n,n+a-1);if(s&&(c=c.eq("content_type",s)),t&&(c=c.eq("category_id",t)),r){const u=`%${r.trim()}%`;c=c.or(`title.ilike.${u},description.ilike.${u}`)}const{data:d,error:g}=await c;if(g)throw g;return d||[]}catch(c){throw console.error("Failed to fetch content:",c),(l=c.message)!=null&&l.includes("Failed to fetch")||c.name==="TypeError"?new Error("Connection problem. Please check your internet."):new Error("Could not load content. Please try again.")}},3e4)},ba=async s=>{const{data:t,error:r}=await p.from("content").insert([s]).select().single();if(r)throw r;return t},ja=async s=>{const{error:t}=await p.rpc("increment_view_count",{content_id:s});if(t){const{data:r}=await p.from("content").select("view_count").eq("id",s).single();r&&await p.from("content").update({view_count:(r.view_count||0)+1}).eq("id",s)}},wa=async()=>{if(!te())return{total:0,approved:0,pending:0,byType:{question_paper:0,notes:0,syllabus:0,educational_link:0,assignments:0}};try{const{data:s,error:t}=await p.from("content").select("content_type, is_approved");if(t)throw t;return{total:s.length,approved:s.filter(a=>a.is_approved).length,pending:s.filter(a=>!a.is_approved).length,byType:{question_paper:s.filter(a=>a.content_type==="question_paper").length,notes:s.filter(a=>a.content_type==="notes").length,syllabus:s.filter(a=>a.content_type==="syllabus").length,educational_link:s.filter(a=>a.content_type==="educational_link").length,assignments:s.filter(a=>a.content_type==="assignments").length}}}catch(s){return console.error("Failed to fetch content stats:",s),{totalContent:0,totalCategories:0,totalUsers:0,recentUploads:0}}},xs=async()=>{var s;if(!te())return console.warn("Supabase is not configured. Returning empty categories list."),[];try{const{data:t,error:r}=await p.from("categories").select("*").order("name");if(r)throw r;const a=new Map,n=[];return t.forEach(i=>{a.set(i.id,{...i,children:[]})}),t.forEach(i=>{const l=a.get(i.id);if(i.parent_id){const c=a.get(i.parent_id);c&&(c.children=c.children||[],c.children.push(l),l.parent=c)}else n.push(l)}),n}catch(t){throw logger.error("Failed to fetch categories:",t),(s=t.message)!=null&&s.includes("Failed to fetch")||t.name==="TypeError"?new Error("Connection problem. Please check your internet."):new Error("Could not load categories. Please try again.")}},va=async(s,t,r)=>{const a=s.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),{data:n}=await p.from("categories").select("id").eq("slug",a).single();if(n)throw new Error("A category with this name already exists");const i={name:s.trim(),slug:a,description:(t==null?void 0:t.trim())||null,parent_id:r||null},{data:l,error:c}=await p.from("categories").insert([i]).select().single();if(c)throw c;return l},Cs=async()=>{const s=await xs(),{data:t,error:r}=await p.from("content").select("category_id").eq("is_approved",!0);if(r)throw r;const a=new Map;t.forEach(i=>{i.category_id&&a.set(i.category_id,(a.get(i.category_id)||0)+1)});const n=i=>i.map(l=>({...l,content_count:a.get(l.id)||0,children:l.children?n(l.children):[]}));return n(s)},Ee=class Ee{constructor(){W(this,"initialized",!1);W(this,"initializing",!1);W(this,"components",new Set)}static getInstance(){return Ee.instance||(Ee.instance=new Ee),Ee.instance}markComponentMounted(t){return this.components.has(t)?(console.log(`‚ö†Ô∏è Component ${t} already mounted, preventing duplicate mount`),!1):(this.components.add(t),console.log(`‚úÖ Component ${t} mounted`),!0)}markComponentUnmounted(t){this.components.delete(t),console.log(`‚ùå Component ${t} unmounted`)}setInitialized(){this.initialized=!0,this.initializing=!1,console.log("üéØ App fully initialized")}setInitializing(){this.initializing=!0,console.log("‚è≥ App initializing...")}isInitialized(){return this.initialized}isInitializing(){return this.initializing}getMountedComponents(){return Array.from(this.components)}reset(){this.initialized=!1,this.initializing=!1,this.components.clear(),console.log("üîÑ App state reset")}};W(Ee,"instance");let os=Ee;const cs=os.getInstance();typeof window<"u"&&(window.appState=cs);const hs=({content:s,onClick:t,showUploader:r=!1,showReportButton:a=!0})=>{const{user:n,isGuest:i}=Z(),l=h=>{switch(h){case"question_paper":return e.jsx(K,{className:"h-5 w-5"});case"notes":return e.jsx(K,{className:"h-5 w-5"});case"syllabus":return e.jsx(K,{className:"h-5 w-5"});default:return e.jsx(K,{className:"h-5 w-5"})}},c=h=>{switch(h){case"question_paper":return"Question Paper";case"notes":return"Notes";case"syllabus":return"Syllabus";case"assignments":return"Assignments";case"other":return"Other";default:return h}},d=h=>{switch(h){case"question_paper":return"primary";case"notes":return"secondary";case"syllabus":return"warning";case"assignments":return"success";case"other":return"neutral";default:return"neutral"}},g=h=>{if(!h)return"";const N=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(h)/Math.log(1024));return Math.round(h/Math.pow(1024,m)*100)/100+" "+N[m]},u=async h=>{if(h.stopPropagation(),!n||i){alert("Please sign in to report content");return}const N=prompt("Please specify the reason for reporting this content:");if(!N)return;const m=prompt("Additional details (optional):");try{await Kt(s.id,n.id,N.trim(),m==null?void 0:m.trim()),alert("Content reported successfully. Our moderators will review it.")}catch(y){alert(y.message||"Failed to report content")}};return e.jsxs("div",{className:"card-premium p-4 md:p-6 cursor-pointer group relative overflow-hidden",onClick:t,children:[e.jsx("div",{className:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx(ge,{className:"h-4 w-4 text-accent-500 animate-bounce-subtle"})}),e.jsxs("div",{className:"flex items-start justify-between mb-4 md:mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 bg-gradient-to-br from-primary-500 to-primary-600 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300",children:l(s.content_type)}),e.jsx(X,{variant:d(s.content_type),glow:!0,children:c(s.content_type)})]}),e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-3 text-sm text-secondary-500",children:[a&&e.jsx("button",{onClick:u,className:"opacity-0 group-hover:opacity-100 transition-all duration-300 p-1 md:p-2 hover:text-red-600 hover:bg-red-50 rounded-lg hover:scale-110",title:"Report content",children:e.jsx(Is,{className:"h-3 w-3 md:h-4 md:w-4"})}),s.view_count>0&&e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 bg-secondary-100 rounded-lg text-xs",children:[e.jsx(Se,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:s.view_count})]})]})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h3",{className:"font-bold text-secondary-900 text-lg md:text-xl mb-2 md:mb-3 group-hover:text-primary-600 transition-colors duration-300 line-clamp-2",children:s.title}),s.description&&e.jsx("p",{className:"text-secondary-600 text-xs md:text-sm line-clamp-2 md:line-clamp-3 leading-relaxed",children:s.description})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 md:mb-6",children:[s.categories&&e.jsx(X,{variant:"neutral",size:"sm",children:s.categories.name}),s.year&&e.jsxs(X,{variant:"neutral",size:"sm",children:["Year: ",s.year]}),s.semester&&e.jsxs(X,{variant:"neutral",size:"sm",children:["Sem: ",s.semester]})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsxs("div",{className:"flex items-center space-x-2 flex-wrap gap-2",children:[e.jsx(qs,{className:"h-3 w-3 text-secondary-400 hidden sm:block"}),s.tags.slice(0,2).map((h,N)=>e.jsx("span",{className:"text-xs text-secondary-600 bg-secondary-100 px-2 py-1 rounded-full font-medium truncate max-w-20 sm:max-w-none",children:h},N)),s.tags.length>2&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",s.tags.length-2," more"]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between text-sm text-secondary-500 pt-4 md:pt-6 border-t border-secondary-100 space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm",children:[e.jsx(ms,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx("span",{className:"font-medium truncate",children:Ce(new Date(s.created_at),{addSuffix:!0})})]}),r&&s.profiles&&e.jsxs("div",{className:"flex items-center space-x-2 px-2 py-1 bg-secondary-100 rounded-lg text-xs",children:[e.jsx(we,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsxs("span",{className:"font-medium truncate max-w-24 sm:max-w-none",children:["@",s.profiles.username]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-3 self-end sm:self-auto",children:[s.file_size&&e.jsx("span",{className:"text-xs bg-secondary-100 px-2 py-1 rounded-full font-medium whitespace-nowrap",children:g(s.file_size)}),s.file_url&&e.jsx("div",{className:"w-6 h-6 md:w-8 md:h-8 bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-all duration-300 hover:scale-110",children:e.jsx(us,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-br from-primary-500/5 via-transparent to-primary-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"})]})]})},ps=({content:s,isOpen:t,onClose:r})=>{const[a,n]=o.useState(!1);if(o.useEffect(()=>{s&&t&&!a&&(ja(s.id).catch(console.error),n(!0))},[s,t,a]),o.useEffect(()=>{t||n(!1)},[t]),!s)return null;const i=u=>{switch(u){case"question_paper":return"Question Paper";case"notes":return"Notes";case"syllabus":return"Syllabus";case"assignments":return"Assignments";case"other":return"Other";default:return u}},l=u=>{switch(u){case"question_paper":return"primary";case"notes":return"secondary";case"syllabus":return"warning";case"assignments":return"success";case"other":return"neutral";default:return"neutral"}},c=u=>{if(!u)return"";const h=["Bytes","KB","MB","GB"],N=Math.floor(Math.log(u)/Math.log(1024));return Math.round(u/Math.pow(1024,N)*100)/100+" "+h[N]},d=()=>{s.file_url&&window.open(s.file_url,"_blank")},g=()=>{s.external_url&&window.open(s.external_url,"_blank")};return e.jsx(pe,{isOpen:t,onClose:r,size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row items-start justify-between space-y-4 md:space-y-0",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(X,{variant:l(s.content_type),children:i(s.content_type)}),s.categories&&e.jsx(X,{variant:"neutral",children:s.categories.name})]}),e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:s.description})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 p-3 md:p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm text-gray-600",children:[e.jsx(ms,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:Ce(new Date(s.created_at),{addSuffix:!0})})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm text-gray-600",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.view_count," views"]})]}),s.profiles&&e.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm text-gray-600 col-span-2 lg:col-span-1",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsxs("span",{className:"truncate",children:["@",s.profiles.username]})]}),s.file_size&&e.jsxs("div",{className:"text-xs md:text-sm text-gray-600",children:["Size: ",c(s.file_size)]})]}),(s.year||s.semester)&&e.jsxs("div",{className:"flex items-center space-x-4",children:[s.year&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Year:"}),e.jsx(X,{variant:"neutral",children:s.year})]}),s.semester&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Semester:"}),e.jsx(X,{variant:"neutral",children:s.semester})]})]}),s.tags&&s.tags.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(qs,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tags:"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map((u,h)=>e.jsx("span",{className:"text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full",children:u},h))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between pt-4 border-t border-gray-200 space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"text-xs md:text-sm text-gray-500",children:["Content ID: ",s.id.split("-")[0],"..."]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-3 w-full sm:w-auto",children:[s.external_url&&e.jsxs(I,{onClick:g,variant:"outline",size:"sm",className:"flex items-center justify-center space-x-2 w-full sm:w-auto",children:[e.jsx(yt,{className:"h-4 w-4"}),e.jsx("span",{children:"Open Link"})]}),s.file_url&&e.jsxs(I,{onClick:d,size:"sm",className:"flex items-center justify-center space-x-2 w-full sm:w-auto",children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx("span",{children:"Download"})]})]})]}),s.file_url&&s.file_type&&["jpg","png"].includes(s.file_type)&&e.jsx("div",{className:"border rounded-lg overflow-hidden mt-4",children:e.jsx("img",{src:s.file_url,alt:s.title,className:"w-full h-auto max-h-64 md:max-h-96 object-contain"})})]})})},Na=()=>e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Fe,{className:"h-5 w-5 text-yellow-400"})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-yellow-700",children:[e.jsx("strong",{children:"Demo Mode:"})," This app is running in demo mode without a backend connection. Some features may not work as expected."]})})]})}),_a=()=>{var Y,se,G;const{user:s,isGuest:t}=Z(),[r,a]=o.useState([]),[n,i]=o.useState([]),[l,c]=o.useState(!0),[d,g]=o.useState(""),[u,h]=o.useState(""),[N,m]=o.useState(""),[y,A]=o.useState(""),[w,P]=o.useState(null),[S,v]=o.useState(!1),[_,j]=o.useState(!1),[b,x]=o.useState(null),[f,E]=o.useState(!1),M=Je.useMemo(()=>{try{const L=Object.values(Object.assign({"../assets/hero/slide1.jpg":ua,"../assets/hero/slide2.jpg":xa,"../assets/hero/slide3.jpg":ha,"../assets/hero/slide4.jpg":pa,"../assets/hero/slide5.jpg":ga,"../assets/hero/slide6.jpg":fa}));return L.length>0?L:[]}catch(T){return console.warn("Failed to load hero images:",T),[]}},[]),[R,O]=o.useState(0),[Q,q]=o.useState(!1),$=o.useRef(null),ee=T=>O((T+M.length)%M.length),k=()=>{q(!0),$.current&&clearTimeout($.current),$.current=setTimeout(()=>q(!1),8e3)},B=()=>{M.length!==0&&(ee(R+1),k())},re=()=>{M.length!==0&&(ee(R-1),k())};o.useEffect(()=>{if(M.length===0||Q)return;const T=setInterval(()=>{O(L=>(L+1)%M.length)},4e3);return()=>clearInterval(T)},[M.length,Q]),o.useEffect(()=>()=>{$.current&&clearTimeout($.current)},[]);const xe=[{value:"",label:"All Types",icon:"üìö"},{value:"question_paper",label:"Question Papers",icon:"üìù"},{value:"notes",label:"Study Notes",icon:"üìñ"},{value:"syllabus",label:"Syllabus",icon:"üìã"},{value:"assignments",label:"Assignments",icon:"üìÑ"},{value:"other",label:"Other",icon:"üìÑ"}];o.useEffect(()=>cs.markComponentMounted("HomePage")?((async()=>{if(E(!1),!te()){console.log("Supabase not configured, showing demo content"),E(!0),c(!1);return}try{const[L,ye,ss]=await Promise.all([Be(),xs(),wa()]);a(L),i(ye),x(ss),E(!1)}catch(L){console.error("Failed to fetch data:",L),E(!0)}finally{c(!1)}})(),()=>{cs.markComponentUnmounted("HomePage")}):void 0,[]),o.useEffect(()=>{(d||N||y)&&(async()=>{if(te()){c(!0);try{const L=await Be(y,N,d);a(L)}catch(L){console.error("Failed to fetch filtered content:",L),E(!0)}finally{c(!1)}}})()},[d,N,y]),o.useEffect(()=>{!d&&!N&&!y&&(async()=>{if(te())try{const L=await Be();a(L)}catch(L){console.error("Failed to fetch content:",L)}})()},[d,N,y]);const Ne=T=>{P(T),v(!0)},z=()=>{(u.trim().length>=2||u.trim().length===0)&&g(u.trim())},D=T=>{h(T),T.trim()===""&&g("")},U=(T,L=0)=>T.map(ye=>e.jsxs(Je.Fragment,{children:[e.jsxs("option",{value:ye.id,children:["  ".repeat(L),ye.name]}),ye.children&&U(ye.children,L+1)]},ye.id));return l?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-secondary-50 via-white to-primary-50",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx(ae,{size:"xl",text:"Loading content..."}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-secondary-600",children:[e.jsx(ge,{className:"h-5 w-5 animate-bounce-subtle"}),e.jsx("span",{className:"font-medium",children:"Preparing your experience"}),e.jsx(ge,{className:"h-5 w-5 animate-bounce-subtle"})]})]})}):f?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-secondary-50 via-white to-primary-50 flex items-center justify-center",children:e.jsx("div",{className:"max-w-md mx-auto text-center p-6",children:e.jsxs("div",{className:"card-premium p-12",children:[e.jsx("div",{className:"text-primary-500 mb-6",children:e.jsx(fe,{className:"h-20 w-20 mx-auto animate-bounce-subtle"})}),e.jsx("h2",{className:"text-2xl font-bold text-secondary-900 mb-4 text-gradient",children:"Connection Issue"}),e.jsx("p",{className:"text-secondary-600 mb-6 leading-relaxed",children:"We're having trouble connecting to our servers. This might be due to:"}),e.jsxs("ul",{className:"text-left text-sm text-secondary-600 mb-8 space-y-2",children:[e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{children:"Network connectivity issues"})]}),e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{children:"Server configuration problems"})]}),e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsx("span",{children:"Missing environment variables"})]})]}),e.jsx(I,{onClick:()=>window.location.reload(),variant:"premium",size:"lg",className:"w-full",children:"Try Again"})]})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-secondary-50 via-white to-primary-50 mesh-bg",children:[!te()&&e.jsx(Na,{}),e.jsxs("div",{className:"hero-gradient text-white relative overflow-hidden min-h-[35vh] sm:min-h-[30vh] md:min-h-[28vh] lg:min-h-[25vh] flex items-center",onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),children:[e.jsxs("div",{className:"absolute inset-0 -z-0 overflow-hidden",children:[M.length>0?e.jsx("div",{className:"flex h-full transition-transform duration-700 ease-out",style:{transform:`translateX(-${R*100}%)`},children:M.map((T,L)=>e.jsx("div",{className:"w-full h-full flex-shrink-0",children:e.jsx("img",{src:T,alt:`Hero ${L+1}`,className:"w-full h-full object-cover",draggable:!1})},L))}):e.jsx("div",{className:"w-full h-full"}),e.jsx("div",{className:"absolute inset-0 bg-red-600/40 mix-blend-multiply"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/25 via-transparent to-black/25"})]}),e.jsx("div",{className:"absolute top-0 left-1/4 w-48 sm:w-72 md:w-96 h-48 sm:h-72 md:h-96 bg-white/10 rounded-full blur-3xl animate-float pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-48 sm:w-72 md:w-96 h-48 sm:h-72 md:h-96 bg-white/5 rounded-full blur-3xl animate-float pointer-events-none",style:{animationDelay:"2s"}}),e.jsx("div",{className:"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 md:py-8 w-full",children:e.jsxs("div",{className:"text-center space-y-3 sm:space-y-4 md:space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 sm:space-x-3 mb-3 sm:mb-4",children:[e.jsx(ge,{className:"h-5 w-5 sm:h-6 sm:w-6 text-accent-400 animate-bounce-subtle"}),e.jsx(X,{variant:"premium",size:"lg",glow:!0,pulse:!0,children:"The JECRC App"}),e.jsx(ge,{className:"h-5 w-5 sm:h-6 sm:w-6 text-accent-400 animate-bounce-subtle"})]}),e.jsxs("h1",{className:"text-xl sm:text-3xl md:text-4xl lg:text-5xl font-display font-bold mb-3 sm:mb-4 md:mb-5 animate-fade-in-up",children:[e.jsx("span",{className:"block text-white text-shadow-lg",children:"JU CONNECT"}),e.jsx("span",{className:"block text-xs sm:text-base md:text-lg lg:text-xl font-medium text-white/90 mt-1 sm:mt-2",children:"Resource Hub"})]}),e.jsx("p",{className:"text-xs sm:text-sm md:text-base lg:text-lg mb-4 sm:mb-5 md:mb-6 max-w-3xl mx-auto text-white/90 leading-relaxed animate-fade-in-up px-2 sm:px-4",style:{animationDelay:"0.2s"},children:"Access all the study materials, PYQ'S, Notes and many more. Connect with fellow students, and elevate your academic journey with this platform"}),b&&e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3 md:gap-4 max-w-3xl mx-auto animate-fade-in-up px-2 sm:px-4",style:{animationDelay:"0.4s"},children:[{label:"Resources Available",value:b.approved,icon:Re},{label:"Question Papers",value:b.byType.question_paper,icon:K},{label:"Study Notes",value:b.byType.notes,icon:Us},{label:"Subject Areas",value:n.length,icon:ve}].map(T=>e.jsxs("div",{className:"glass p-2 sm:p-3 md:p-4 rounded-lg sm:rounded-xl text-center group hover:scale-105 transition-all duration-300",children:[e.jsx(T.icon,{className:"h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 text-accent-400 mx-auto mb-1 sm:mb-2 group-hover:scale-110 transition-transform duration-300"}),e.jsx("div",{className:"text-sm sm:text-lg md:text-xl font-bold text-white mb-1",children:T.value}),e.jsx("div",{className:"text-2xs sm:text-xs text-white/80 font-medium leading-tight",children:T.label})]},T.label))}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center space-y-2 sm:space-y-0 sm:space-x-3 md:space-x-4 animate-fade-in-up px-2 sm:px-4",style:{animationDelay:"0.6s"},children:[e.jsxs(I,{size:"lg",variant:"secondary",className:"bg-white/30 backdrop-blur-none border-white/30 text-white hover:bg-white/40 w-full sm:w-auto",onClick:()=>{var T;return(T=document.getElementById("content-section"))==null?void 0:T.scrollIntoView({behavior:"smooth"})},children:[e.jsx(bt,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5"}),"Explore Content"]}),(!s||t)&&e.jsxs(I,{size:"lg",variant:"outline",className:"border-white/50 text-white hover:bg-white hover:text-primary-600 w-full sm:w-auto",onClick:()=>j(!0),children:[e.jsx(Ae,{className:"mr-2 h-5 w-5"}),"Join JU CONNECT"]})]})]})}),M.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{"aria-label":"Previous",onClick:re,className:"absolute left-3 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-black/50 hover:bg-black/70 text-white backdrop-blur-none",children:"‚Äπ"}),e.jsx("button",{"aria-label":"Next",onClick:B,className:"absolute right-3 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-black/50 hover:bg-black/70 text-white backdrop-blur-none",children:"‚Ä∫"}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-10 hidden sm:flex items-center gap-1",children:M.map((T,L)=>e.jsx("button",{"aria-label":`Go to slide ${L+1}`,onClick:()=>{ee(L),k()},className:`h-1.5 w-1.5 rounded-full transition-all duration-300 ${R===L?"bg-red-500 scale-125":"bg-white/60 hover:bg-white/90 hover:scale-110"}`},L))})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 md:py-12",id:"content-section",children:[e.jsxs("div",{className:"card-premium p-4 sm:p-6 md:p-8 mb-8 sm:mb-12 animate-fade-in-up",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-secondary-900 mb-2 text-gradient",children:"Find Your Perfect Study Material"}),e.jsx("p",{className:"text-sm sm:text-base text-secondary-600",children:"Use our advanced filters to discover exactly what you need"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 order-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative group flex-1",children:[e.jsx(Oe,{className:"absolute left-3 sm:left-4 top-3 sm:top-4 h-4 w-4 sm:h-5 sm:w-5 text-secondary-400 group-focus-within:text-primary-500 transition-colors duration-300"}),e.jsx("input",{type:"text",placeholder:"Search resources, notes, question papers...",value:u,onChange:T=>D(T.target.value),className:"input-premium pl-10 sm:pl-12 pr-3 sm:pr-4 text-base sm:text-lg w-full h-12 sm:h-14",onKeyDown:T=>{T.key==="Enter"&&(z(),T.currentTarget.blur())}}),e.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-primary-500/10 to-primary-600/10 opacity-0 group-focus-within:opacity-100 transition-opacity duration-300 pointer-events-none"})]}),e.jsxs(I,{onClick:z,variant:"premium",size:"lg",className:"px-4 sm:px-6 flex items-center justify-center gap-2 h-12 sm:h-14 w-full sm:w-auto",disabled:u.trim().length>0&&u.trim().length<2,children:[e.jsx(Oe,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{children:"Search"})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-xs text-secondary-500",children:"üí° Type your search terms and click the Search button or press Enter"})})]}),e.jsx("div",{className:"order-3 lg:order-2",children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:N,onChange:T=>m(T.target.value),className:"input-premium appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"üìö All Categories"}),U(n)]}),e.jsx(is,{className:"absolute right-4 top-4 h-5 w-5 text-secondary-400 pointer-events-none"})]})}),e.jsx("div",{className:"order-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:y,onChange:T=>A(T.target.value),className:"input-premium appearance-none cursor-pointer",children:xe.map(T=>e.jsxs("option",{value:T.value,children:[T.icon," ",T.label]},T.value))}),e.jsx(is,{className:"absolute right-4 top-4 h-5 w-5 text-secondary-400 pointer-events-none"})]})})]}),(d||N||y)&&e.jsxs("div",{className:"mt-6 flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-secondary-600",children:"Active filters:"}),d&&e.jsxs(X,{variant:"premium",className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-3 w-3"}),'"',d,'"',e.jsx("button",{onClick:()=>{g(""),h("")},className:"ml-1 hover:text-red-500 transition-colors",title:"Remove search filter",children:"‚úï"})]}),N&&e.jsxs(X,{variant:"premium",className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-3 w-3"}),(Y=n.find(T=>T.id===N))==null?void 0:Y.name,e.jsx("button",{onClick:()=>m(""),className:"ml-1 hover:text-red-500 transition-colors",title:"Remove category filter",children:"‚úï"})]}),y&&e.jsxs(X,{variant:"premium",className:"flex items-center gap-2",children:[(se=xe.find(T=>T.value===y))==null?void 0:se.icon,(G=xe.find(T=>T.value===y))==null?void 0:G.label,e.jsx("button",{onClick:()=>A(""),className:"ml-1 hover:text-red-500 transition-colors",title:"Remove type filter",children:"‚úï"})]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>{g(""),h(""),m(""),A("")},className:"text-secondary-500 hover:text-primary-600",children:"Clear all filters"})]})]}),e.jsxs("div",{className:"mb-8 flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-secondary-900 text-gradient",children:d||N||y?"Filtered Results":"All Resources"}),e.jsxs("p",{className:"text-secondary-600",children:[r.length," ",r.length===1?"resource":"resources"," found",(d||N||y)&&e.jsx("span",{className:"text-primary-600 font-medium",children:" matching your criteria"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(X,{variant:"premium",glow:!0,children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"Enjoy"]})})]}),r.length===0?e.jsx("div",{className:"text-center py-12 md:py-20",children:e.jsxs("div",{className:"card-premium p-12 max-w-md mx-auto",children:[e.jsx(Re,{className:"h-20 w-20 text-secondary-300 mx-auto mb-6 animate-bounce-subtle"}),d||N||y?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-semibold text-secondary-900 mb-4",children:"No matching resources found"}),e.jsx("p",{className:"text-secondary-600 mb-6",children:"No resources match your current search criteria. Try:"}),e.jsxs("ul",{className:"text-sm text-secondary-600 mb-6 text-left space-y-2",children:[e.jsx("li",{children:"‚Ä¢ Using different keywords"}),e.jsx("li",{children:"‚Ä¢ Checking your spelling"}),e.jsx("li",{children:"‚Ä¢ Selecting a different category"}),e.jsx("li",{children:"‚Ä¢ Browsing all content types"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-semibold text-secondary-900 mb-4",children:"No resources available"}),e.jsx("p",{className:"text-secondary-600 mb-6",children:"There are currently no approved resources in the database."})]}),e.jsx(I,{variant:"premium",onClick:()=>{g(""),h(""),m(""),A("")},children:d||N||y?"Clear Filters":"Refresh"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6 lg:gap-8 animate-fade-in-up",children:r.map((T,L)=>e.jsx("div",{className:"animate-fade-in-up w-full",style:{animationDelay:`${L*.1}s`},children:e.jsx(hs,{content:T,onClick:()=>Ne(T),showUploader:!0})},T.id))}),e.jsxs("div",{className:"mt-8 sm:mt-12 lg:mt-16 xl:mt-20",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8 lg:mb-12",children:[e.jsx("h3",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-secondary-900 mb-2 sm:mb-4 text-gradient",children:"Browse by Subject"}),e.jsx("p",{className:"text-secondary-600 text-sm sm:text-base lg:text-lg px-4",children:"Explore our carefully organized subject categories"})]}),e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3 sm:gap-4 lg:gap-6",children:n.slice(0,8).map((T,L)=>e.jsxs("button",{onClick:()=>m(T.id),className:"card-premium p-3 sm:p-4 lg:p-6 text-left group hover:scale-105 transition-all duration-300 animate-fade-in-up",style:{animationDelay:`${L*.1}s`},children:[e.jsxs("div",{className:"flex flex-col items-center space-y-2 sm:space-y-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 bg-gradient-to-br from-primary-500 to-primary-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300",children:e.jsx(K,{className:"h-4 w-4 sm:h-5 sm:w-5 lg:h-6 lg:w-6 text-white"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"font-semibold text-xs sm:text-sm lg:text-base text-secondary-900 group-hover:text-primary-600 transition-colors duration-300 line-clamp-2",children:T.name}),T.description&&e.jsx("div",{className:"text-xs text-secondary-500 mt-1 line-clamp-1 hidden sm:block",children:T.description})]})]}),e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-br from-primary-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]},T.id))})]}),e.jsx(ps,{content:w,isOpen:S,onClose:()=>{v(!1),P(null)}}),e.jsx(es,{isOpen:_,onClose:()=>j(!1),onSuccess:()=>j(!1)})]})]})},Ca=({onSuccess:s})=>{const[t,r]=o.useState(!1),[a,n]=o.useState(!1),[i,l]=o.useState(!1),[c,d]=o.useState(""),{forceRefreshProfile:g}=Z(),[u,h]=o.useState({email:"",password:"",fullName:"",username:"",mobileNumber:""}),[N,m]=o.useState({}),y=()=>{const P={};return u.email?/\S+@\S+\.\S+/.test(u.email)||(P.email="Please enter a valid email"):P.email="Email is required",u.password?u.password.length<6&&(P.password="Password must be at least 6 characters"):P.password="Password is required",t&&(u.fullName||(P.fullName="Full name is required"),u.username?u.username.length<3?P.username="Username must be at least 3 characters":/^[a-zA-Z0-9_]+$/.test(u.username)||(P.username="Username can only contain letters, numbers, and underscores"):P.username="Username is required",u.mobileNumber?/^\+?[\d\s-()]{10,}$/.test(u.mobileNumber)||(P.mobileNumber="Please enter a valid mobile number"):P.mobileNumber="Mobile number is required"),m(P),Object.keys(P).length===0},A=async P=>{var S;if(P.preventDefault(),d(""),!!y()){l(!0);try{if(t){const v=await Os(u.email,u.password,u.fullName,u.username,u.mobileNumber);console.log("‚úÖ Sign up successful:",v.user.email)}else{const v=await $s(u.email,u.password);console.log("‚úÖ Sign in successful:",(S=v.user)==null?void 0:S.email),v.session&&(localStorage.setItem("supabase.auth.token",JSON.stringify(v.session)),localStorage.setItem("user.authenticated","true"),console.log("üíæ Session stored in localStorage")),sessionStorage.setItem("auth.justSignedIn","true"),console.log("üîÑ Refreshing page to restore authenticated session..."),window.location.reload();return}h({email:"",password:"",fullName:"",username:"",mobileNumber:""}),s&&s()}catch(v){const _=v instanceof Error?v.message:"Something went wrong. Please try again.";d(_),console.error("Auth error:",v)}finally{l(!1)}}},w=P=>{const{name:S,value:v}=P.target;h(_=>({..._,[S]:v})),N[S]&&m(_=>({..._,[S]:""}))};return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:t?"Create Account":"Sign In"}),e.jsx("p",{className:"mt-2 text-gray-600",children:t?"Join our exam preparation community":"Welcome back to JU CONNECT"})]}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[c&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200",children:c}),t&&e.jsxs(e.Fragment,{children:[e.jsx(H,{name:"fullName",label:"Full Name",value:u.fullName,onChange:w,error:N.fullName,placeholder:"Enter your full name",disabled:i}),e.jsx(H,{name:"username",label:"Username",value:u.username,onChange:w,error:N.username,placeholder:"Choose a unique username",disabled:i,helpText:"This will be displayed publicly"}),e.jsx(H,{name:"mobileNumber",label:"Mobile Number",type:"tel",value:u.mobileNumber,onChange:w,error:N.mobileNumber,placeholder:"Enter your mobile number",disabled:i})]}),e.jsx(H,{name:"email",label:"Email Address",type:"email",value:u.email,onChange:w,error:N.email,placeholder:"Enter your email",disabled:i}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{name:"password",label:"Password",type:a?"text":"password",value:u.password,onChange:w,error:N.password,placeholder:"Enter your password",disabled:i}),e.jsx("button",{type:"button",onClick:()=>n(!a),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600",children:a?e.jsx(Qe,{className:"h-5 w-5"}):e.jsx(Se,{className:"h-5 w-5"})})]}),e.jsx(I,{type:"submit",className:"w-full",loading:i,disabled:i,children:t?"Create Account":"Sign In"}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>r(!t),className:"text-blue-600 hover:text-blue-500 font-medium",disabled:i,children:t?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})]})},Sa=()=>{const{user:s,loading:t}=Z();return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(ae,{size:"lg"})}):s?e.jsx(it,{to:"/",replace:!0}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsx("div",{className:"bg-white py-8 px-4 shadow-sm rounded-lg sm:px-10 border border-gray-200",children:e.jsx(Ca,{onSuccess:()=>window.location.href="/"})})})})},Ea=["exe","bat","cmd","com","pif","scr","vbs","js","jar","app","deb","pkg","rpm","dmg","iso","msi","run","ps1","sh","bash","zsh","fish","csh","tcsh"],ka=[/script/i,/payload/i,/exploit/i,/backdoor/i,/trojan/i,/virus/i,/malware/i,/keylog/i,/rootkit/i],Pa=[/('|(\\')|(;)|(\\;)|(\\x27)|(\\x3D))/i,/(\\x3C)|(\\x3E)|(\\x22)|(\\x27)/i,/(select|insert|update|delete|drop|create|alter|exec|execute)/i,/(union|having|order\s+by|group\s+by)/i,/(script|javascript|vbscript|onload|onerror)/i],Ws=s=>{var r;if(!s||s.trim().length===0)return{isValid:!1,error:"File name cannot be empty"};if(s.length>255)return{isValid:!1,error:"File name is too long (max 255 characters)"};const t=(r=s.split(".").pop())==null?void 0:r.toLowerCase();if(t&&Ea.includes(t))return{isValid:!1,error:`File type .${t} is not allowed for security reasons`};for(const a of ka)if(a.test(s))return{isValid:!1,error:"File name contains suspicious content"};for(const a of Pa)if(a.test(s))return{isValid:!1,error:"File name contains invalid characters"};return s.includes("..")||s.includes("/")||s.includes("\\")?{isValid:!1,error:"File name contains invalid path characters"}:/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x9F]/.test(s)?{isValid:!1,error:"File name contains invalid control characters"}:{isValid:!0}},Ys=async s=>{try{if(s.size>5242880)return{isValid:!1,error:"File size exceeds 5MB limit"};if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","image/jpeg","image/png","image/gif","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(s.type))return{isValid:!1,error:"File type not allowed"};const a=await s.slice(0,512).arrayBuffer(),n=new Uint8Array(a),i=[[77,90],[127,69,76,70],[207,250,237,254],[254,237,250,206]];for(const l of i)if(n.length>=l.length){let c=!0;for(let d=0;d<l.length;d++)if(n[d]!==l[d]){c=!1;break}if(c)return{isValid:!1,error:"Executable files are not allowed"}}if(s.type==="text/plain"){const l=await s.text(),c=[/<script/i,/javascript:/i,/vbscript:/i,/on\w+\s*=/i,/eval\s*\(/i,/document\.write/i,/innerHTML/i];for(const d of c)if(d.test(l))return{isValid:!1,error:"File contains potentially malicious script content"}}return{isValid:!0}}catch(t){return console.error("File validation error:",t),{isValid:!1,error:"Failed to validate file content"}}},je=5*1024*1024,Ra={pdf:je,doc:je,docx:je,txt:je,jpg:je,png:je,jpeg:je,gif:je,webp:je},Ta=["pdf","doc","docx","txt","jpg","png","jpeg","gif","webp"],Aa=s=>{var a;if(!s.name||s.name.trim()==="")return{isValid:!1,error:"Please choose a valid file with a proper name"};const t=(a=s.name.split(".").pop())==null?void 0:a.toLowerCase();if(!t||!Ta.includes(t))return{isValid:!1,error:"This file type is not supported. Please choose a PDF, Word document, text file, or image (JPG, PNG)"};const r=Ra[t];return s.size>r?{isValid:!1,error:"Please upload a file or PDF smaller than 5MB"}:s.size===0?{isValid:!1,error:"The file appears to be empty. Please choose a different file"}:{isValid:!0}},Ma=async(s,t,r={})=>{var d,g,u,h,N;const{onProgress:a,onError:n,bucket:i="files",folder:l="general"}=r;let c=null;try{const{fileUploadTrackingService:m}=await ke(async()=>{const{fileUploadTrackingService:R}=await import("./enhancedServices-Bis9DEBu.js");return{fileUploadTrackingService:R}},__vite__mapDeps([0,1,2,3]));if(c=await m.createUploadSession(t,s.name,s.size,s.type),a==null||a({loaded:0,total:100,percentage:0,stage:"validating",message:"Checking file..."}),c&&await m.updateUploadProgress(c.id,5,"pending"),!p){const R="File upload is not available right now. Please try again later";return c&&await m.markUploadFailed(c.id,R),n==null||n(R),{success:!1,error:R}}const y=Aa(s);if(!y.isValid)return c&&await m.markUploadFailed(c.id,y.error),n==null||n(y.error),{success:!1,error:y.error};if(!Ws(s.name).isValid){const R="This file name contains invalid characters. Please rename your file and try again";return n==null||n(R),{success:!1,error:R}}try{if(!(await Ys(s)).isValid){const O="This file appears to be corrupted or unsafe. Please try a different file";return n==null||n(O),{success:!1,error:O}}}catch(R){console.warn("Content validation failed:",R)}a==null||a({loaded:20,total:100,percentage:20,stage:"uploading",message:"Uploading file..."});const w=(d=s.name.split(".").pop())==null?void 0:d.toLowerCase(),P=Date.now(),S=`${t}_${P}_${s.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,v=`${l}/${S}`,{error:_}=await p.storage.from(i).upload(v,s,{cacheControl:"3600",upsert:!1});if(_){let R="Failed to upload file. Please try again";return(g=_.message)!=null&&g.includes("Bucket not found")?R="File storage is not properly set up. Please contact support":(u=_.message)!=null&&u.includes("File size")?R="Please upload a file or PDF smaller than 5MB":(h=_.message)!=null&&h.includes("row-level security policy")?R="You do not have permission to upload files right now":(N=_.message)!=null&&N.includes("already exists")&&(R="A file with this name already exists. Please rename your file and try again"),ne.error("Storage upload error:",_),n==null||n(R),{success:!1,error:R}}a==null||a({loaded:70,total:100,percentage:70,stage:"processing",message:"Processing file..."});const{data:j}=p.storage.from(i).getPublicUrl(v);if(!(j!=null&&j.publicUrl)){const R="Failed to generate file access link. Please try again";return n==null||n(R),{success:!1,error:R}}const b=w==="jpeg"||w==="gif"||w==="webp"?"jpg":w,x={user_id:t,original_filename:s.name,stored_filename:S,file_size:s.size,file_type:b,upload_path:v,is_processed:!1},{data:f,error:E}=await p.from("file_uploads").insert([x]).select().single();if(E){try{await p.storage.from(i).remove([v])}catch(O){ne.error("Failed to cleanup file after DB error:",O)}const R="Failed to save file information. Please try again";return ne.error("Database insert error:",E),n==null||n(R),{success:!1,error:R}}a==null||a({loaded:100,total:100,percentage:100,stage:"complete",message:"Upload complete!"}),c&&await m.updateUploadProgress(c.id,100,"completed");const{activityService:M}=await ke(async()=>{const{activityService:R}=await import("./enhancedServices-Bis9DEBu.js");return{activityService:R}},__vite__mapDeps([0,1,2,3]));return await M.logActivity(t,"upload",{fileName:s.name,fileSize:s.size,fileType:w,uploadPath:v}).catch(R=>console.warn("Failed to log upload activity:",R)),{success:!0,fileUrl:j.publicUrl,fileName:s.name,fileSize:s.size,uploadId:f.id}}catch(m){const y="An unexpected error occurred during upload. Please try again";if(ne.error("File upload error:",m),c){const{fileUploadTrackingService:w}=await ke(async()=>{const{fileUploadTrackingService:P}=await import("./enhancedServices-Bis9DEBu.js");return{fileUploadTrackingService:P}},__vite__mapDeps([0,1,2,3]));await w.markUploadFailed(c.id,y)}const{enhancedErrorReporting:A}=await ke(async()=>{const{enhancedErrorReporting:w}=await import("./enhancedServices-Bis9DEBu.js");return{enhancedErrorReporting:w}},__vite__mapDeps([0,1,2,3]));return await A.reportError(m,{userId:t,operation:"file_upload",component:"fileUploadService",metadata:{fileName:s.name,fileSize:s.size,fileType:s.type}}),n==null||n(y),a==null||a({loaded:0,total:100,percentage:0,stage:"error",message:y}),{success:!1,error:y}}},Ia=({onSuccess:s})=>{const{user:t}=Z(),r=o.useRef(null),[a,n]=o.useState(!1),[i,l]=o.useState(""),[c,d]=o.useState(""),[g,u]=o.useState([]),[h,N]=o.useState(null),[m,y]=o.useState({title:"",description:"",contentType:"notes",categoryId:"",year:"",semester:"",tags:""});Je.useEffect(()=>{(async()=>{try{const j=await xs();u(j)}catch(j){console.error("Failed to fetch categories:",j)}})()},[]);const A=_=>{var x;const j=(x=_.target.files)==null?void 0:x[0];if(!j)return;const b=Ws(j.name);if(!b.isValid){l(b.error||"This file name is not allowed");return}if(Ys(j).then(f=>{if(!f.isValid){l(f.error||"This file cannot be uploaded"),N(null),r.current&&(r.current.value="");return}}),N(j),l(""),!m.title){const f=j.name.split(".").slice(0,-1).join(".");y(E=>({...E,title:f}))}},w=()=>{N(null),r.current&&(r.current.value="")},P=_=>{const{name:j,value:b}=_.target;y(x=>({...x,[j]:b}))},S=async _=>{var j;if(_.preventDefault(),!(!t||!h)){n(!0),l(""),d("");try{if(!h)throw new Error("No file selected");if(!(t!=null&&t.id))throw new Error("User not authenticated");const b={title:m.title,description:m.description,tags:m.tags.split(",").map(f=>f.trim()).filter(Boolean),year:m.year,semester:m.semester},{fileUrl:x}=await Ma(h,t.id,"content",b);await ba({title:m.title.trim(),description:m.description.trim()||null,content_type:m.contentType,category_id:m.categoryId||null,uploaded_by:t.id,file_url:x,file_size:h.size,file_type:(j=h.name.split(".").pop())==null?void 0:j.toLowerCase(),year:m.year?parseInt(m.year):null,semester:m.semester?parseInt(m.semester):null,tags:m.tags.split(",").map(f=>f.trim()).filter(Boolean)}),d("Content uploaded successfully and is now available to everyone!"),y({title:"",description:"",contentType:"notes",categoryId:"",year:"",semester:"",tags:""}),N(null),r.current&&(r.current.value=""),s==null||s()}catch(b){let x=b.message||"Upload failed";x.includes("Failed to upload file")&&(x="File upload failed. Please check your internet connection and try again."),(x.includes("row-level security policy")||x.includes("Unauthorized")||x.includes("permissions are not configured"))&&(x="File uploads are not yet enabled. Please contact the administrator to configure upload permissions."),(x.includes("storage is not configured")||x.includes("Bucket not found"))&&(x="File uploads are temporarily unavailable. The storage system needs to be configured by the administrator."),l(x)}finally{n(!1)}}},v=(_,j=0)=>_.flatMap(b=>[e.jsxs("option",{value:b.id,children:["  ".repeat(j),b.name]},b.id),...b.children?v(b.children,j+1):[]]);return e.jsx("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-0",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 mb-2",children:"Upload Content"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Share your study materials with the community. All uploads are reviewed before publishing."})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4 sm:space-y-6",children:[i&&e.jsxs("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200 flex items-start space-x-2",children:[e.jsx(Fs,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"break-words",children:i})]}),c&&e.jsx("div",{className:"p-3 text-sm text-green-600 bg-green-50 rounded-lg border border-green-200",children:c}),e.jsxs("div",{className:"p-3 text-sm text-blue-600 bg-blue-50 rounded-lg border border-blue-200 flex items-start space-x-2",children:[e.jsx(fe,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Security Notice"}),e.jsx("p",{className:"text-xs mt-1",children:"All files are automatically scanned for security threats and validated before upload. Your content will be available immediately after passing security checks."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select File *"}),h?e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 sm:p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 min-w-0 flex-1",children:[e.jsx(K,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:h.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500",children:[(h.size/(1024*1024)).toFixed(2)," MB"]})]})]}),e.jsx("button",{type:"button",onClick:w,className:"text-red-600 hover:text-red-700 p-1 ml-2 flex-shrink-0",children:e.jsx(_e,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]}):e.jsxs("div",{onClick:()=>{var _;return(_=r.current)==null?void 0:_.click()},className:"border-2 border-dashed border-gray-300 rounded-lg p-4 sm:p-6 lg:p-8 text-center cursor-pointer hover:border-blue-400 transition-colors",children:[e.jsx(Ze,{className:"h-8 w-8 sm:h-10 sm:w-10 lg:h-12 lg:w-12 text-gray-400 mx-auto mb-3 sm:mb-4"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mb-2",children:"Click to select a file or drag and drop"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"Supported: PDF, DOC, DOCX, TXT, JPG, PNG"})]}),e.jsx("input",{ref:r,type:"file",onChange:A,accept:".pdf,.doc,.docx,.txt,.jpg,.png",className:"hidden"})]}),e.jsx(H,{name:"title",label:"Title *",value:m.title,onChange:P,placeholder:"Enter a descriptive title",required:!0,disabled:a}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{name:"description",value:m.description,onChange:P,placeholder:"Describe the content (optional)",rows:3,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Content Type *"}),e.jsxs("select",{name:"contentType",value:m.contentType,onChange:P,required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 appearance-none bg-white",disabled:a,children:[e.jsx("option",{value:"notes",children:"Study Notes"}),e.jsx("option",{value:"question_paper",children:"Question Paper"}),e.jsx("option",{value:"syllabus",children:"Syllabus"}),e.jsx("option",{value:"assignments",children:"Assignments"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{name:"categoryId",value:m.categoryId,onChange:P,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 appearance-none bg-white",disabled:a,children:[e.jsx("option",{value:"",children:"Select a category (optional)"}),v(g)]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(H,{name:"year",label:"Academic Year",type:"number",value:m.year,onChange:P,placeholder:"e.g., 2024",min:"2000",max:"2030",disabled:a,helpText:"Optional"}),e.jsx(H,{name:"semester",label:"Semester",type:"number",value:m.semester,onChange:P,placeholder:"e.g., 1",min:"1",max:"8",disabled:a,helpText:"Optional"})]}),e.jsx(H,{name:"tags",label:"Tags",value:m.tags,onChange:P,placeholder:"algorithms, programming, data structures",helpText:"Comma-separated tags",disabled:a}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-2",children:e.jsx(I,{type:"submit",className:"w-full sm:w-auto order-1 sm:order-2",loading:a,disabled:a||!h||!m.title.trim(),children:"Upload Content"})})]})]})})},qa=()=>{const{user:s,loading:t,isGuest:r}=Z(),[a,n]=o.useState(!1);return o.useEffect(()=>{const i=setTimeout(()=>{t&&(console.log("UploadPage: Forcing content display after timeout"),n(!0))},3e3);return()=>clearTimeout(i)},[t]),console.log("UploadPage: loading =",t,"user =",!!s,"isGuest =",r),t&&!s&&!a?(console.log("UploadPage: Showing loading spinner due to loading =",t),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(ae,{size:"lg"})})):e.jsx("div",{className:"min-h-screen bg-gray-50 py-4 sm:py-6 lg:py-12 px-4 pb-20 sm:pb-4 lg:pb-0",children:e.jsx(Ia,{})})},Ua=async(s=50,t=0)=>{const{data:r,error:a}=await p.from("chat_messages").select(`
      *,
      profiles (
        id,
        username,
        full_name
      )
    `).eq("is_reported",!1).order("created_at",{ascending:!0}).range(t,t+s-1);if(a)throw a;return r||[]},Fa=async(s,t)=>{const r={user_id:t,message:s.trim()},{data:a,error:n}=await p.from("chat_messages").insert([r]).select().single();if(n)throw n;return a},Da=async s=>{const{error:t}=await p.from("chat_messages").delete().eq("id",s);if(t)throw t},za=(s,t,r,a,n={})=>{const i=o.useRef(null),l=o.useRef(null),c=o.useRef(0),d=o.useRef(0),g=o.useRef(!1),{enabled:u=!0,onError:h,onConnected:N,onDisconnected:m}=n;return o.useEffect(()=>{if(!u||!s||!te()||!p)return;const y=Date.now();if(y-d.current<1e3)return;d.current=y,i.current&&p.removeChannel(i.current);const A=p.channel(`group_messages_${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"group_messages",filter:`group_id=eq.${s}`},async w=>{try{if(ne.debug("New message received:",w.new.id),!p)return;const{data:P,error:S}=await p.from("group_messages").select(`
                *,
                profiles (
                  id,
                  username,
                  full_name,
                  avatar_url
                )
              `).eq("id",w.new.id).single();if(S){console.error("‚ùå Error loading new message details:",S),console.error("‚ùå Error details:",{message:S.message,code:S.code,details:S.details,hint:S.hint}),ne.error("Error loading new message:",S),h==null||h(new Error("Could not load new message"));return}P&&t(P)}catch(P){ne.error("Error loading new message:",P),h==null||h(P)}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"group_messages",filter:`group_id=eq.${s}`},w=>{ne.debug("Message updated:",w.new.id),r==null||r(w.new)}).on("postgres_changes",{event:"DELETE",schema:"public",table:"group_messages",filter:`group_id=eq.${s}`},w=>{ne.debug("Message deleted:",w.old.id),a==null||a(w.old.id)}).subscribe(w=>{if(w==="SUBSCRIBED"&&!g.current)g.current=!0,c.current=0,N==null||N();else if(w==="CHANNEL_ERROR")g.current=!1,console.error("Real-time connection failed"),h==null||h(new Error("Live updates are not working right now"));else if(w==="CLOSED"&&g.current&&(g.current=!1,m==null||m(),c.current++,c.current<5)){const P=Math.min(1e3*Math.pow(2,c.current),3e4);l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{},P)}});return i.current=A,()=>{i.current&&p&&(g.current=!1,c.current=0,l.current&&(clearTimeout(l.current),l.current=null),ne.debug("Disconnecting real-time updates"),p.removeChannel(i.current),i.current=null)}},[s,u,t,r,a,h,N,m]),()=>{i.current&&p&&p.removeChannel(i.current)}},La=(s,t,r,a={})=>{const n=o.useRef(null),{enabled:i=!0,onError:l}=a;o.useEffect(()=>{if(!i||!te()||!p)return;n.current&&p.removeChannel(n.current);const c=p.channel("chat_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages"},async d=>{try{if(!p)return;const{data:g,error:u}=await p.from("chat_messages").select(`
                *,
                profiles (
                  id,
                  username,
                  full_name,
                  avatar_url
                )
              `).eq("id",d.new.id).single();if(u)throw u;g&&s(g)}catch(g){console.error("Error fetching new chat message:",g),l==null||l(g)}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_messages"},d=>{t==null||t(d.new)}).on("postgres_changes",{event:"DELETE",schema:"public",table:"chat_messages"},d=>{r==null||r(d.old.id)}).subscribe();return n.current=c,()=>{n.current&&p&&p.removeChannel(n.current)}},[i,s,t,r,l])},Ga=()=>{const{user:s,profile:t,isGuest:r}=Z(),a=o.useRef(null),[n,i]=o.useState(""),[l,c]=o.useState(!1),[d,g]=o.useState(!1),[u,h]=o.useState(null),[N,m]=o.useState([]),[y,A]=o.useState(!0),w=()=>{var f;(f=a.current)==null||f.scrollIntoView({behavior:"smooth"})};o.useEffect(()=>{w()},[N]),o.useEffect(()=>{(async()=>{try{A(!0);const E=await Ua();m(E||[])}catch(E){console.error("Failed to load messages:",E),h("Could not load chat messages. Please refresh the page.")}finally{A(!1)}})()},[]);const P=o.useCallback(f=>{m(E=>{const M=E.findIndex(R=>R.isOptimistic&&R.user_id===f.user_id&&R.message===f.message&&Math.abs(new Date(R.created_at).getTime()-new Date(f.created_at).getTime())<5e3);if(M!==-1){const R=[...E];return R[M]=f,R}else return E.some(O=>O.id===f.id)?E:[...E,f]})},[]),S=o.useCallback(f=>{m(E=>E.map(M=>M.id===f.id?{...M,...f}:M))},[]),v=o.useCallback(f=>{m(E=>E.filter(M=>M.id!==f))},[]);La(P,S,v,{enabled:!0,onError:f=>{console.error("Real-time subscription error:",f),h("Real-time updates unavailable")}}),o.useEffect(()=>{if(u){const f=setTimeout(()=>h(null),5e3);return()=>clearTimeout(f)}},[u]);const _=async()=>{var M,R,O,Q,q;if(!n.trim())return;if(!s||r){c(!0);return}const f=`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,E={id:f,user_id:s.id,message:n.trim(),is_reported:!1,is_flagged:!1,created_at:new Date().toISOString(),profiles:{id:s.id,username:((M=s.user_metadata)==null?void 0:M.username)||((R=s.email)==null?void 0:R.split("@")[0])||"Anonymous",full_name:((O=s.user_metadata)==null?void 0:O.full_name)||((Q=s.user_metadata)==null?void 0:Q.username)||"Anonymous User",avatar_url:((q=s.user_metadata)==null?void 0:q.avatar_url)||null,is_admin:(t==null?void 0:t.is_admin)||!1},isOptimistic:!0};try{g(!0),h(null),m($=>[...$,E]),i(""),await Fa(E.message,s.id)}catch($){console.error("Failed to send message:",$),m(ee=>ee.filter(k=>k.id!==f)),i(E.message),h("Could not send your message. Please try again.")}finally{g(!1)}},j=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),_())},b=async f=>{if(!s||r){c(!0);return}const E=prompt("Please provide a reason for reporting this message:");if(E)try{await Qt(f,s.id,E),alert("Message reported successfully")}catch(M){console.error("Failed to report message:",M),alert("Failed to report message")}},x=async f=>{if(!(!s||!(t!=null&&t.is_admin))&&confirm("Are you sure you want to delete this message?"))try{await Da(f),m(E=>E.filter(M=>M.id!==f))}catch(E){console.error("Failed to delete message:",E),alert("Failed to delete message")}};return y?e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 bg-gradient-to-r from-primary-500 to-primary-600",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"JU Connect Chat"}),e.jsx("p",{className:"text-primary-100",children:"Loading chat messages..."})]}),e.jsx("div",{className:"p-8 flex justify-center",children:e.jsx(ae,{size:"lg"})})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:[e.jsx("div",{className:"p-6 bg-gradient-to-r from-primary-500 to-primary-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(Me,{className:"h-6 w-6"}),"JU Connect Chat"]}),e.jsx("p",{className:"text-primary-100",children:"Chat disabled real-time for better app performance"})]}),e.jsxs("div",{className:"text-white text-sm",children:[N.length," messages"]})]})}),u&&e.jsxs("div",{className:"p-4 bg-red-50 border-l-4 border-red-400 flex items-center gap-2",children:[e.jsx(Fs,{className:"h-5 w-5 text-red-400"}),e.jsx("span",{className:"text-red-700",children:u})]}),e.jsxs("div",{className:"h-96 overflow-y-auto p-4 space-y-4",children:[N.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Me,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No messages yet. Be the first to start the conversation!"})]}):N.map(f=>{var E,M,R;return e.jsxs("div",{className:`flex gap-3 p-3 rounded-lg transition-all duration-200 ${f.is_flagged?"bg-red-50 border border-red-200":"hover:bg-gray-50"} ${f.isOptimistic?"opacity-70 animate-pulse":""}`,children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center",children:e.jsx(we,{className:"h-5 w-5 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:((E=f.profiles)==null?void 0:E.full_name)||((M=f.profiles)==null?void 0:M.username)||"Anonymous"}),((R=f.profiles)==null?void 0:R.is_admin)&&e.jsx("span",{className:"px-2 py-0.5 bg-primary-100 text-primary-700 text-xs rounded-full",children:"Admin"}),e.jsx("span",{className:"text-sm text-gray-500",children:Ce(new Date(f.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:`text-gray-700 ${f.is_flagged?"line-through opacity-60":""}`,children:f.message}),f.is_flagged&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"This message has been flagged"})]}),e.jsxs("div",{className:"flex-shrink-0 flex gap-1",children:[s&&!r&&f.user_id!==s.id&&e.jsx("button",{onClick:()=>b(f.id),className:"p-1 text-gray-400 hover:text-red-500 rounded",title:"Report message",children:e.jsx(Is,{className:"h-4 w-4"})}),s&&(t==null?void 0:t.is_admin)&&e.jsx("button",{onClick:()=>x(f.id),className:"p-1 text-gray-400 hover:text-red-500 rounded",title:"Delete message",children:e.jsx(De,{className:"h-4 w-4"})})]})]},f.id)}),e.jsx("div",{ref:a})]}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:s&&!r?e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{value:n,onChange:f=>i(f.target.value),onKeyPress:j,placeholder:"Type your message... (Press Enter to send)",className:"w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:2,disabled:d})}),e.jsxs(I,{onClick:_,disabled:!n.trim()||d,className:"px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 flex items-center gap-2",children:[d?e.jsx(ae,{size:"sm"}):e.jsx(Ve,{className:"h-4 w-4"}),"Send"]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Sign in to join the conversation"}),e.jsx(I,{onClick:()=>c(!0),className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"Sign In"})]})})]}),e.jsx(es,{isOpen:l,onClose:()=>c(!1),onSuccess:()=>c(!1)})]})},Oa=()=>e.jsx(Ga,{}),$a=({isOpen:s,onClose:t,categories:r})=>{const{user:a}=Z(),[n,i]=o.useState(!1),[l,c]=o.useState(""),[d,g]=o.useState({name:"",description:"",parentId:""}),u=async m=>{if(m.preventDefault(),!(!a||n)){i(!0),c("");try{await va(d.name.trim(),d.description.trim()||void 0,d.parentId||void 0),g({name:"",description:"",parentId:""}),onSuccess(),t()}catch(y){c(y.message||"Failed to create category")}finally{i(!1)}}},h=m=>{const{name:y,value:A}=m.target;g(w=>({...w,[y]:A}))},N=(m,y=0)=>m.map(A=>e.jsxs(Je.Fragment,{children:[e.jsxs("option",{value:A.id,children:["  ".repeat(y),A.name]}),A.children&&N(A.children,y+1)]},A.id));return e.jsx(pe,{isOpen:s,onClose:t,title:"Add New Category",size:"md",children:e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[l&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200",children:l}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-blue-50 rounded-lg",children:[e.jsx(jt,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Create Custom Category"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Add a new category to help organize content better"})]})]}),e.jsx(H,{name:"name",label:"Category Name *",value:d.name,onChange:h,placeholder:"e.g., Machine Learning, Web Development",required:!0,disabled:n,premium:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Parent Category (Optional)"}),e.jsxs("select",{name:"parentId",value:d.parentId,onChange:h,className:"input-premium appearance-none cursor-pointer",disabled:n,children:[e.jsx("option",{value:"",children:"None (Top Level Category)"}),N(r)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a parent category to create a subcategory"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),e.jsx("textarea",{name:"description",value:d.description,onChange:h,placeholder:"Brief description of what this category contains...",rows:3,className:"input-premium resize-none",disabled:n})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(I,{type:"button",variant:"outline",onClick:t,disabled:n,children:"Cancel"}),e.jsxs(I,{type:"submit",loading:n,disabled:n||!d.name.trim(),className:"flex items-center space-x-2",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Category"})]})]})]})})},Ba=()=>{const{user:s,isGuest:t}=Z(),[r,a]=o.useState([]),[n,i]=o.useState(null),[l,c]=o.useState([]),[d,g]=o.useState(!0),[u,h]=o.useState(!1),[N,m]=o.useState(null),[y,A]=o.useState(!1),[w,P]=o.useState(!1);o.useEffect(()=>{(async()=>{try{const x=await Cs();a(x)}catch(x){console.error("Failed to fetch categories:",x)}finally{g(!1)}})()},[]);const S=async()=>{try{const b=await Cs();a(b)}catch(b){console.error("Failed to refresh categories:",b)}},v=async b=>{i(b),h(!0);try{const x=await Be(void 0,b.id);c(x)}catch(x){console.error("Failed to fetch category content:",x)}finally{h(!1)}},_=b=>{m(b),A(!0)},j=(b,x=0)=>e.jsxs("div",{className:`${x>0?"ml-3 sm:ml-6":""}`,children:[e.jsx("div",{className:`p-3 sm:p-4 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-all cursor-pointer ${(n==null?void 0:n.id)===b.id?"ring-2 ring-blue-500 border-blue-500":""}`,onClick:()=>v(b),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0",children:[e.jsx(K,{className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:b.name}),b.description&&e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 line-clamp-2",children:b.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 flex-shrink-0 ml-2",children:[b.content_count!==void 0&&e.jsxs(X,{variant:"neutral",size:"sm",children:[e.jsxs("span",{className:"hidden sm:inline",children:[b.content_count," items"]}),e.jsx("span",{className:"sm:hidden",children:b.content_count})]}),e.jsx(wt,{className:"h-3 w-3 sm:h-4 sm:w-4 text-gray-400"})]})]})}),b.children&&b.children.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:b.children.map(f=>j(f,x+1))})]},b.id);return d?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(ae,{size:"lg"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 pb-20 sm:pb-4 md:pb-0",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-12",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between mb-4 sm:mb-6 lg:mb-8 space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"text-center lg:text-left w-full lg:w-auto",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 mb-2 sm:mb-4",children:"Browse by Categories"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 max-w-2xl px-4 sm:px-0",children:"Explore our organized collection of study materials, question papers, and resources categorized by subject areas"})]}),s&&!t&&e.jsxs(I,{onClick:()=>P(!0),className:"flex items-center justify-center space-x-2 w-full sm:w-auto",size:"sm",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Category"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8",children:[e.jsx("div",{className:"lg:col-span-1 order-2 lg:order-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 lg:p-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Subject Areas"}),e.jsx("div",{className:"space-y-2 sm:space-y-3 max-h-64 sm:max-h-80 lg:max-h-96 overflow-y-auto",children:r.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4 text-sm",children:"No categories available"}):r.map(b=>j(b))})]})}),e.jsx("div",{className:"lg:col-span-2 order-1 lg:order-2",children:n?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 mb-2",children:n.name}),n.description&&e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:n.description})]}),u?e.jsx("div",{className:"flex justify-center py-8 sm:py-12",children:e.jsx(ae,{})}):l.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx(Ds,{className:"h-12 w-12 sm:h-16 sm:w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-2",children:"No content available"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 px-4",children:"There are no resources in this category yet"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:l.map(b=>e.jsx(hs,{content:b,onClick:()=>_(b),showUploader:!0},b.id))})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8 sm:p-12 text-center",children:[e.jsx(K,{className:"h-12 w-12 sm:h-16 sm:w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-2",children:"Select a Category"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 px-4",children:"Choose a subject area from the left to explore available resources"})]})})]}),e.jsx(ps,{content:N,isOpen:y,onClose:()=>{A(!1),m(null)}}),e.jsx($a,{isOpen:w,onClose:()=>P(!1),onSuccess:S,categories:r})]})})},Ja=async s=>{const{data:t,error:r}=await p.from("update_requests").insert([s]).select().single();if(r)throw r;return t},Va=async s=>{const{data:t,error:r}=await p.from("update_requests").select(`
      *,
      profiles!update_requests_user_id_fkey (
        id,
        username,
        full_name
      ),
      reviewer:profiles!update_requests_reviewed_by_fkey (
        id,
        username,
        full_name
      )
    `).eq("user_id",s).order("created_at",{ascending:!1});if(r)throw r;return t||[]},Wa=()=>{const{user:s,loading:t,isGuest:r}=Z(),[a,n]=o.useState([]),[i,l]=o.useState(!0),[c,d]=o.useState(!1);console.log("MyRequestsPage render - authLoading:",t,"user:",!!s,"isGuest:",r),o.useEffect(()=>{const j=setTimeout(()=>{t&&(console.log("MyRequestsPage: Forcing content display after timeout"),d(!0))},5e3);return()=>clearTimeout(j)},[t]);const[g,u]=o.useState(!1),[h,N]=o.useState(!1),[m,y]=o.useState({contentType:"general_query",contentId:"",issueDescription:"",suggestedChanges:""}),A=o.useCallback(async()=>{try{const j=await Va(s.id);n(j)}catch(j){console.error("Failed to fetch data:",j)}finally{l(!1)}},[s]);o.useEffect(()=>{s&&!r&&A()},[s,r,A]);const w=async j=>{if(j.preventDefault(),!(!s||h)){N(!0);try{let b=m.contentType;["general_query","content_update","content_removal","bug_report","feature_request"].includes(m.contentType)&&(b="notes"),await Ja({user_id:s.id,content_type:b,content_id:m.contentId||null,issue_description:m.issueDescription.trim(),suggested_changes:m.suggestedChanges.trim()||null}),y({contentType:"general_query",contentId:"",issueDescription:"",suggestedChanges:""}),u(!1),await A()}catch(b){alert(b.message||"Failed to submit request")}finally{N(!1)}}},P=j=>{switch(j){case"pending":return e.jsx(Ye,{className:"h-4 w-4 text-yellow-500"});case"approved":return e.jsx(Nt,{className:"h-4 w-4 text-green-500"});case"rejected":return e.jsx(vt,{className:"h-4 w-4 text-red-500"});default:return e.jsx(Ye,{className:"h-4 w-4 text-gray-400"})}},S=j=>{switch(j){case"pending":return"warning";case"approved":return"success";case"rejected":return"error";default:return"neutral"}},v=j=>{switch(j){case"question_paper":return"Question Paper";case"notes":return"Study Notes";case"syllabus":return"Syllabus";case"educational_link":return"Educational Link";case"assignments":return"Assignments";case"content_update":return"Content Update";case"content_removal":return"Content Removal";case"bug_report":return"Bug Report";case"feature_request":return"Feature Request";case"general_query":return"General Query";default:return j}},_=j=>{switch(j){case"question_paper":return e.jsx(K,{className:"h-4 w-4"});case"notes":return e.jsx(K,{className:"h-4 w-4"});case"content_update":return e.jsx(ys,{className:"h-4 w-4"});case"content_removal":return e.jsx(De,{className:"h-4 w-4"});case"bug_report":return e.jsx(Fe,{className:"h-4 w-4"});case"feature_request":return e.jsx(bs,{className:"h-4 w-4"});case"general_query":return e.jsx(We,{className:"h-4 w-4"});default:return e.jsx(Ue,{className:"h-4 w-4"})}};return console.log("MyRequestsPage: authLoading =",t,"user =",!!s,"isGuest =",r),t&&!s&&!c?(console.log("MyRequestsPage: Showing loading spinner due to authLoading =",t),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(ae,{size:"lg"})})):e.jsx("div",{className:"min-h-screen bg-gray-50 py-4 sm:py-6 lg:py-12 px-4 pb-20 sm:pb-4 lg:pb-0",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between mb-6 space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"w-full lg:w-auto",children:[e.jsx("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900",children:"Support & Requests"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1 mb-3",children:"Submit your queries, report issues, or request content updates"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-blue-900 mb-2 flex items-center",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"What can you request?"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-blue-800",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(We,{className:"h-3 w-3 mr-2 text-blue-600"}),"General queries & questions"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ys,{className:"h-3 w-3 mr-2 text-blue-600"}),"Content updates & corrections"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(De,{className:"h-3 w-3 mr-2 text-blue-600"}),"Content removal requests"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Fe,{className:"h-3 w-3 mr-2 text-blue-600"}),"Bug reports & technical issues"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(bs,{className:"h-3 w-3 mr-2 text-blue-600"}),"Feature suggestions"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"h-3 w-3 mr-2 text-blue-600"}),"Material-specific issues"]})]})]})]}),e.jsxs(I,{onClick:()=>u(!0),className:"flex items-center justify-center space-x-2 w-full sm:w-auto",size:"sm",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:"New Request"})]})]}),i?e.jsx("div",{className:"flex justify-center py-8 sm:py-12",children:e.jsx(ae,{})}):a.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx(Ue,{className:"h-12 w-12 sm:h-16 sm:w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-2",children:"No requests yet"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mb-4 px-4",children:"You haven't submitted any requests yet. Feel free to ask questions, report issues, or suggest improvements!"}),e.jsx(I,{onClick:()=>u(!0),size:"sm",children:"Submit Your First Request"})]}):e.jsx("div",{className:"space-y-3 sm:space-y-4",children:a.map(j=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 sm:p-4 hover:shadow-sm transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[P(j.status),e.jsx(X,{variant:S(j.status),size:"sm",children:j.status.charAt(0).toUpperCase()+j.status.slice(1)})]}),e.jsxs(X,{variant:"neutral",size:"sm",className:"flex items-center gap-1",children:[_(j.content_type),v(j.content_type)]})]}),e.jsx("h3",{className:"font-medium text-gray-900 mb-2 text-sm sm:text-base",children:"Issue Description"}),e.jsx("p",{className:"text-gray-700 mb-3 text-sm sm:text-base leading-relaxed",children:j.issue_description}),j.suggested_changes&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1 text-sm sm:text-base",children:"Suggested Changes"}),e.jsx("p",{className:"text-gray-700 mb-3 text-sm sm:text-base leading-relaxed",children:j.suggested_changes})]}),j.admin_notes&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1 text-sm sm:text-base",children:"Admin Response"}),e.jsx("p",{className:"text-gray-700 mb-3 text-sm sm:text-base leading-relaxed",children:j.admin_notes})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between text-xs sm:text-sm text-gray-500 pt-3 border-t border-gray-100 space-y-2 sm:space-y-0",children:[e.jsxs("span",{children:["Submitted ",Ce(new Date(j.created_at),{addSuffix:!0})]}),j.reviewed_by&&j.reviewer&&e.jsxs("span",{className:"truncate",children:["Reviewed by @",j.reviewer.username]})]})]},j.id))})]}),e.jsxs(pe,{isOpen:g,onClose:()=>u(!1),title:"Submit a Request",size:"lg",children:[e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Need help or have feedback?"})," Use this form to ask questions, report issues, request content updates, suggest new features, or get support with the platform."]})}),e.jsxs("form",{onSubmit:w,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Request Type *"}),e.jsxs("select",{value:m.contentType,onChange:j=>y(b=>({...b,contentType:j.target.value})),required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 appearance-none bg-white",disabled:h,children:[e.jsx("option",{value:"general_query",children:"General Query - Ask questions or get help"}),e.jsx("option",{value:"content_update",children:"Content Update - Report errors or request corrections"}),e.jsx("option",{value:"content_removal",children:"Content Removal - Request content to be removed"}),e.jsx("option",{value:"bug_report",children:"Bug Report - Report technical issues or glitches"}),e.jsx("option",{value:"feature_request",children:"Feature Request - Suggest new features or improvements"}),e.jsx("option",{value:"notes",children:"Study Notes - Issues with study notes"}),e.jsx("option",{value:"question_paper",children:"Question Paper - Issues with question papers"}),e.jsx("option",{value:"syllabus",children:"Syllabus - Issues with syllabus content"}),e.jsx("option",{value:"educational_link",children:"Educational Link - Issues with educational links"}),e.jsx("option",{value:"assignments",children:"Assignments - Issues with assignments"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose the category that best describes your request"})]}),e.jsx(H,{label:"Content ID (Optional)",value:m.contentId,onChange:j=>y(b=>({...b,contentId:j.target.value})),placeholder:"Enter content ID if you know it",helpText:"If your request is about specific content, you can provide the content ID here",disabled:h}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Describe your request *"}),e.jsx("textarea",{value:m.issueDescription,onChange:j=>y(b=>({...b,issueDescription:j.target.value})),placeholder:"Please describe your query, issue, or request in detail...",rows:4,required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none",disabled:h}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Be as specific as possible to help us understand and address your request"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Details / Suggestions (Optional)"}),e.jsx("textarea",{value:m.suggestedChanges,onChange:j=>y(b=>({...b,suggestedChanges:j.target.value})),placeholder:"Any additional information, suggestions, or proposed solutions...",rows:3,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none",disabled:h})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-2",children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>u(!1),disabled:h,className:"w-full sm:w-auto order-2 sm:order-1",size:"sm",children:"Cancel"}),e.jsx(I,{type:"submit",loading:h,disabled:h||!m.issueDescription.trim(),className:"w-full sm:w-auto order-1 sm:order-2",size:"sm",children:"Submit Request"})]})]})]})]})})},Ya=async s=>{const{data:t,error:r}=await p.from("profiles").select("*").eq("id",s).single();if(r){if(r.code==="PGRST116")return null;throw r}return t},Ha=async s=>{const{data:t,error:r}=await p.from("content").select(`
      id,
      content_type,
      view_count,
      created_at,
      categories (
        name
      )
    `).eq("uploaded_by",s).eq("is_approved",!0);if(r)throw r;const{data:a,error:n}=await p.from("profiles").select("created_at").eq("id",s).single();if(n)throw n;const i=(t==null?void 0:t.length)||0,l=(t==null?void 0:t.reduce((m,y)=>m+(y.view_count||0),0))||0,c=new Date;c.setDate(c.getDate()-30);const d=(t==null?void 0:t.filter(m=>new Date(m.created_at)>c).length)||0,g=new Map;t==null||t.forEach(m=>{var A;const y=((A=m.categories)==null?void 0:A.name)||"Uncategorized";g.set(y,(g.get(y)||0)+1)});const u=Array.from(g.entries()).map(([m,y])=>({name:m,count:y})).sort((m,y)=>y.count-m.count),h=new Map;t==null||t.forEach(m=>{const y=m.content_type;h.set(y,(h.get(y)||0)+1)});const N=Array.from(h.entries()).map(([m,y])=>({type:m,count:y})).sort((m,y)=>y.count-m.count);return{totalUploads:i,totalViews:l,recentUploads:d,joinedDate:a.created_at,categories:u,contentTypes:N}},Xa=async(s,t)=>{const{data:r,error:a}=await p.from("profiles").update(t).eq("id",s).select().single();if(a)throw a;return r},Ka=async(s,t=20,r=0)=>{const{data:a,error:n}=await p.from("content").select(`
      *,
      categories (
        id,
        name,
        slug
      )
    `).eq("uploaded_by",s).eq("is_approved",!0).order("created_at",{ascending:!1}).range(r,r+t-1);if(n)throw n;return a||[]},Qa=()=>{const{userId:s}=lt(),{user:t}=Z(),[r,a]=o.useState(null),[n,i]=o.useState(null),[l,c]=o.useState([]),[d,g]=o.useState(!0),[u,h]=o.useState(!1),[N,m]=o.useState(null),[y,A]=o.useState(!1),[w,P]=o.useState(!1),[S,v]=o.useState(!1),[_,j]=o.useState(""),[b,x]=o.useState({username:"",full_name:"",bio:""}),f=(t==null?void 0:t.id)===s,E=o.useCallback(async()=>{if(s){g(!0);try{const[q,$]=await Promise.all([Ya(s),Ha(s)]);a(q),i($),q&&x({username:q.username,full_name:q.full_name,bio:q.bio||""})}catch(q){console.error("Failed to fetch user data:",q)}finally{g(!1)}}},[s]),M=o.useCallback(async()=>{if(s){h(!0);try{const q=await Ka(s,20,0);c(q)}catch(q){console.error("Failed to fetch user content:",q)}finally{h(!1)}}},[s]);o.useEffect(()=>{s&&E()},[s,E]),o.useEffect(()=>{s&&M()},[s,M]);const R=async q=>{if(q.preventDefault(),!(!t||!f)){v(!0),j("");try{await Xa(t.id,{username:b.username.trim(),full_name:b.full_name.trim(),bio:b.bio.trim()||null}),await E(),P(!1)}catch($){j($.message||"Failed to update profile")}finally{v(!1)}}},O=q=>{m(q),A(!0)},Q=q=>{switch(q){case"question_paper":return"Question Paper";case"notes":return"Notes";case"syllabus":return"Syllabus";case"assignments":return"Assignments";case"other":return"Other";default:return q}};return d?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(ae,{size:"lg",text:"Loading profile..."})}):r?e.jsx("div",{className:"min-h-screen bg-gray-50 py-4 sm:py-6 lg:py-12 pb-20 sm:pb-4 lg:pb-0",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"card-premium p-4 sm:p-6 lg:p-8 mb-6 sm:mb-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 lg:space-x-6 w-full lg:w-auto",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-primary-500 to-primary-600 rounded-full flex items-center justify-center flex-shrink-0 mx-auto sm:mx-0",children:e.jsx(we,{className:"h-8 w-8 sm:h-10 sm:w-10 text-white"})}),e.jsxs("div",{className:"text-center sm:text-left w-full sm:w-auto",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 mb-1",children:r.full_name}),e.jsxs("p",{className:"text-base sm:text-lg text-gray-600 mb-2",children:["@",r.username]}),r.bio&&e.jsx("p",{className:"text-sm sm:text-base text-gray-700 max-w-md leading-relaxed",children:r.bio}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4 mt-3 text-xs sm:text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ms,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsxs("span",{children:["Joined ",Ce(new Date(r.created_at),{addSuffix:!0})]})]}),r.is_admin&&e.jsx(X,{variant:"premium",size:"sm",children:"Admin"})]})]})]}),f&&e.jsxs(I,{onClick:()=>P(!0),variant:"outline",className:"flex items-center justify-center space-x-2 w-full sm:w-auto",size:"sm",children:[e.jsx(zs,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit Profile"})]})]})}),n&&e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"card-premium p-3 sm:p-4 lg:p-6 text-center",children:[e.jsx(Ze,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary-600 mx-auto mb-2"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:n.totalUploads}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Total Uploads"})]}),e.jsxs("div",{className:"card-premium p-3 sm:p-4 lg:p-6 text-center",children:[e.jsx(Se,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600 mx-auto mb-2"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:n.totalViews}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Total Views"})]}),e.jsxs("div",{className:"card-premium p-3 sm:p-4 lg:p-6 text-center",children:[e.jsx(Us,{className:"h-6 w-6 sm:h-8 sm:w-8 text-green-600 mx-auto mb-2"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:n.recentUploads}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Recent Uploads"})]}),e.jsxs("div",{className:"card-premium p-3 sm:p-4 lg:p-6 text-center",children:[e.jsx(rs,{className:"h-6 w-6 sm:h-8 sm:w-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:n.categories.length}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:"Categories"})]})]}),n&&(n.contentTypes.length>0||n.categories.length>0)&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 lg:gap-8 mb-6 sm:mb-8",children:[n.contentTypes.length>0&&e.jsxs("div",{className:"card-premium p-4 sm:p-6",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4 flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{children:"Content Types"})]}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:n.contentTypes.map((q,$)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-700 truncate",children:Q(q.type)}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2",children:[e.jsx("div",{className:"w-16 sm:w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-600 h-2 rounded-full transition-all duration-500",style:{width:`${q.count/n.totalUploads*100}%`,animationDelay:`${$*.1}s`}})}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-900 w-6 sm:w-8 text-right",children:q.count})]})]},q.type))})]}),n.categories.length>0&&e.jsxs("div",{className:"card-premium p-4 sm:p-6",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4 flex items-center space-x-2",children:[e.jsx(rs,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{children:"Top Categories"})]}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:n.categories.slice(0,5).map((q,$)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-700 truncate",children:q.name}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2",children:[e.jsx("div",{className:"w-16 sm:w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:`${q.count/n.totalUploads*100}%`,animationDelay:`${$*.1}s`}})}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-900 w-6 sm:w-8 text-right",children:q.count})]})]},q.name))})]})]}),e.jsxs("div",{className:"card-premium p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900",children:f?"Your Uploads":`${r.full_name}'s Uploads`}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600",children:[l.length," items"]})]}),u?e.jsx("div",{className:"flex justify-center py-8 sm:py-12",children:e.jsx(ae,{})}):l.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx(K,{className:"h-12 w-12 sm:h-16 sm:w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-2",children:f?"No uploads yet":"No public uploads"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 px-4",children:f?"Start sharing your study materials with the community":"This user hasn't shared any content yet"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:l.map((q,$)=>e.jsx("div",{className:"animate-fade-in-up",style:{animationDelay:`${$*.1}s`},children:e.jsx(hs,{content:q,onClick:()=>O(q),showUploader:!1})},q.id))})]}),e.jsx(ps,{content:N,isOpen:y,onClose:()=>{A(!1),m(null)}}),e.jsx(pe,{isOpen:w,onClose:()=>P(!1),title:"Edit Profile",size:"md",children:e.jsxs("form",{onSubmit:R,className:"space-y-4 sm:space-y-6",children:[_&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200",children:_}),e.jsx(H,{name:"username",label:"Username",value:b.username,onChange:q=>x($=>({...$,username:q.target.value})),placeholder:"Enter username",required:!0,disabled:S,premium:!0}),e.jsx(H,{name:"full_name",label:"Full Name",value:b.full_name,onChange:q=>x($=>({...$,full_name:q.target.value})),placeholder:"Enter full name",required:!0,disabled:S,premium:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio (Optional)"}),e.jsx("textarea",{name:"bio",value:b.bio,onChange:q=>x($=>({...$,bio:q.target.value})),placeholder:"Tell us about yourself...",rows:3,className:"input-premium resize-none",disabled:S,maxLength:500}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[b.bio.length,"/500 characters"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-2",children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>P(!1),disabled:S,className:"w-full sm:w-auto order-2 sm:order-1",size:"sm",children:"Cancel"}),e.jsx(I,{type:"submit",loading:S,disabled:S,className:"w-full sm:w-auto order-1 sm:order-2",size:"sm",children:"Save Changes"})]})]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(we,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"User not found"}),e.jsx("p",{className:"text-gray-600",children:"The user profile you're looking for doesn't exist."})]})})},Za=()=>{const s=[{title:"Getting Started",icon:Ds,items:[{question:"How do I create an account?",answer:'Click the "Sign In" button and choose "Create Account". Fill in your details and verify your email to get started.'},{question:"How do I upload content?",answer:"Navigate to the Upload page, select your file type, add a title and description, choose a category, and click upload."},{question:"How do I browse content?",answer:"Use the Browse page to see all content, or visit Categories to filter by specific topics."},{question:"What file types are supported?",answer:"We support PDF documents, images (JPG, PNG), and text files. Maximum file size is 10MB."}]},{title:"Messaging & Chat",icon:Me,items:[{question:"How do I send private messages?",answer:"Click the message icon in the navbar, search for a user, and start a conversation."},{question:"How do I join the global chat?",answer:"Navigate to the Chat page to participate in community discussions."},{question:"Can I see when someone is online?",answer:"Yes, green dots indicate when users are online in conversations."},{question:"How do I report inappropriate messages?",answer:"Click the flag icon next to any message to report it to administrators."}]},{title:"Account & Profile",icon:ve,items:[{question:"How do I update my profile?",answer:"Click on your username in the navbar to access your profile settings."},{question:"How do I change my password?",answer:'Go to your profile settings and click "Change Password".'},{question:"Can I delete my account?",answer:"Contact support through the Contact Us page to request account deletion."},{question:"How do I view my uploaded content?",answer:'Visit the "My Requests" page to see all your uploads and their status.'}]},{title:"Content & Categories",icon:fe,items:[{question:"How are content submissions reviewed?",answer:"All uploads are reviewed by administrators before being published to ensure quality and appropriateness."},{question:"Why was my content rejected?",answer:"Content may be rejected for violating community guidelines, being inappropriate, or not meeting quality standards."},{question:"How do I request a new category?",answer:"Contact administrators through the Contact Us page with your category suggestion."},{question:"Can I edit my uploaded content?",answer:"Currently, you need to contact support to make changes to published content."}]},{title:"Technical Issues",icon:As,items:[{question:"The website is not loading properly",answer:"Try refreshing the page, clearing your browser cache, or using a different browser."},{question:"I'm not receiving email notifications",answer:"Check your spam folder and ensure your email is verified in your profile settings."},{question:"Upload is failing",answer:"Ensure your file is under 10MB and in a supported format. Check your internet connection."},{question:"Messages are not sending",answer:"Refresh the page and try again. If the issue persists, contact support."}]}];return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(ie,{to:"/",className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 mb-4 transition-colors",children:[e.jsx(Le,{className:"h-4 w-4"}),"Back to Home"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-3 bg-primary-100 rounded-xl",children:e.jsx(We,{className:"h-8 w-8 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Help Center"}),e.jsx("p",{className:"text-gray-600",children:"Find answers to frequently asked questions"})]})]})})]}),e.jsx("div",{className:"space-y-6",children:s.map((t,r)=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(t.icon,{className:"h-6 w-6 text-primary-600"})}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:t.title})]}),e.jsx("div",{className:"space-y-4",children:t.items.map((a,n)=>e.jsxs("details",{className:"group",children:[e.jsxs("summary",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:a.question}),e.jsx("div",{className:"ml-4 flex-shrink-0",children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-primary-100 flex items-center justify-center group-open:rotate-45 transition-transform",children:e.jsx("span",{className:"text-primary-600 text-sm font-bold",children:"+"})})})]}),e.jsx("div",{className:"mt-3 px-4 pb-4",children:e.jsx("p",{className:"text-gray-600 leading-relaxed",children:a.answer})})]},n))})]},r))}),e.jsxs("div",{className:"mt-12 bg-gradient-to-r from-primary-500 to-primary-600 rounded-2xl p-8 text-white text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Still need help?"}),e.jsx("p",{className:"mb-6 text-primary-100",children:"Can't find what you're looking for? Our support team is here to help."}),e.jsxs(ie,{to:"/contact",className:"inline-flex items-center gap-2 bg-white text-primary-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors",children:[e.jsx(Me,{className:"h-5 w-5"}),"Contact Support"]})]})]})})},er=()=>e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(ie,{to:"/",className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 mb-4 transition-colors",children:[e.jsx(Le,{className:"h-4 w-4"}),"Back to Home"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:e.jsx(fe,{className:"h-8 w-8 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Privacy Policy"}),e.jsx("p",{className:"text-gray-600",children:"Last updated: August 21, 2025"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 space-y-8",children:[e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Se,{className:"h-6 w-6 text-primary-600"}),"Introduction"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:'JU Connect ("we," "our," or "us") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our educational content sharing platform. By using JU Connect, you agree to the collection and use of information in accordance with this policy.'})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(_t,{className:"h-6 w-6 text-blue-600"}),"Information We Collect"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Personal Information"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:[e.jsx("li",{children:"Email address and username"}),e.jsx("li",{children:"Full name and profile information"}),e.jsx("li",{children:"Academic institution details (if provided)"}),e.jsx("li",{children:"Profile picture (optional)"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Content Information"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:[e.jsx("li",{children:"Files and documents you upload"}),e.jsx("li",{children:"Messages and chat communications"}),e.jsx("li",{children:"Comments and feedback on content"}),e.jsx("li",{children:"Usage patterns and preferences"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Technical Information"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:[e.jsx("li",{children:"IP address and device information"}),e.jsx("li",{children:"Browser type and version"}),e.jsx("li",{children:"Login timestamps and activity logs"}),e.jsx("li",{children:"Cookies and local storage data"})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(ve,{className:"h-6 w-6 text-purple-600"}),"How We Use Your Information"]}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"To provide and maintain our educational platform services"}),e.jsx("li",{children:"To facilitate content sharing and academic collaboration"}),e.jsx("li",{children:"To enable messaging and communication features"}),e.jsx("li",{children:"To moderate content and ensure community safety"}),e.jsx("li",{children:"To send important notifications about your account or content"}),e.jsx("li",{children:"To analyze usage patterns and improve our services"}),e.jsx("li",{children:"To prevent fraud and maintain platform security"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Information Sharing and Disclosure"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"We do not sell, trade, or rent your personal information to third parties. We may share your information only in the following circumstances:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"With Your Consent:"})," When you explicitly agree to share information"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Public Content:"})," Content you upload is visible to other platform users"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Legal Requirements:"})," When required by law or to protect our rights"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Service Providers:"})," With trusted partners who help operate our platform"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Safety:"})," To prevent harm or illegal activities"]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(fe,{className:"h-6 w-6 text-green-600"}),"Data Security"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-4",children:"We implement industry-standard security measures to protect your information:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Encryption of data in transit and at rest"}),e.jsx("li",{children:"Regular security audits and monitoring"}),e.jsx("li",{children:"Secure authentication and access controls"}),e.jsx("li",{children:"Automatic logout for inactive sessions"}),e.jsx("li",{children:"Regular backup and disaster recovery procedures"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Your Rights and Choices"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"You have the following rights regarding your personal information:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Access:"})," Request a copy of your personal data"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Correction:"})," Update or correct inaccurate information"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Deletion:"})," Request deletion of your account and data"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Portability:"})," Export your data in a readable format"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Opt-out:"})," Unsubscribe from notifications"]})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Cookies and Tracking"}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-4",children:"We use cookies and similar technologies to enhance your experience:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Essential cookies for platform functionality"}),e.jsx("li",{children:"Preference cookies to remember your settings"}),e.jsx("li",{children:"Analytics cookies to understand usage patterns"}),e.jsx("li",{children:"Session cookies for authentication"})]}),e.jsx("p",{className:"text-gray-600 mt-4",children:"You can control cookie settings through your browser preferences."})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(De,{className:"h-6 w-6 text-red-600"}),"Data Retention"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"We retain your information for as long as necessary to provide our services and comply with legal obligations:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2 mt-4",children:[e.jsx("li",{children:"Account information: Until account deletion"}),e.jsx("li",{children:"Uploaded content: As long as publicly available"}),e.jsx("li",{children:"Messages: 2 years or until deletion request"}),e.jsx("li",{children:"Logs and analytics: 1 year for security purposes"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Children's Privacy"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"JU Connect is designed for university students and educators (18+). We do not knowingly collect personal information from children under 18. If we discover that a child under 18 has provided personal information, we will delete it immediately."})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Ct,{className:"h-6 w-6 text-yellow-600"}),"Updates to This Policy"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"We may update this Privacy Policy periodically. We will notify you of significant changes via email or platform notification. Your continued use of JU Connect after changes indicates acceptance of the updated policy."})]}),e.jsxs("section",{className:"bg-gray-50 rounded-xl p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Contact Us"}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-4",children:"If you have questions about this Privacy Policy or how we handle your information, please contact us:"}),e.jsxs("div",{className:"space-y-2 text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," privacy@juconnect.edu"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Support:"})," Visit our ",e.jsx(ie,{to:"/contact",className:"text-primary-600 hover:underline",children:"Contact Us"})," page"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," JECRC University, Jaipur, Rajasthan 302022, India"]})]})]})]})]})}),sr=()=>e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(ie,{to:"/",className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 mb-4 transition-colors",children:[e.jsx(Le,{className:"h-4 w-4"}),"Back to Home"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(K,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Terms of Service"}),e.jsx("p",{className:"text-gray-600",children:"Last updated: August 21, 2025"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 space-y-8",children:[e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(St,{className:"h-6 w-6 text-blue-600"}),"Agreement to Terms"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:'By accessing and using JU Connect ("the Platform"), you accept and agree to be bound by the terms and provision of this agreement. These Terms of Service ("Terms") govern your use of our educational content sharing platform operated by JECRC University Connect ("we," "us," or "our").'}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400",children:e.jsx("p",{className:"text-blue-700 font-medium",children:"If you do not agree to abide by the above, please do not use this service."})})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(ve,{className:"h-6 w-6 text-green-600"}),"Eligibility"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-4",children:"JU Connect is intended for educational purposes and is available to:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Current students of JECRC University and affiliated institutions"}),e.jsx("li",{children:"Faculty members and academic staff"}),e.jsx("li",{children:"Alumni and educational researchers"}),e.jsx("li",{children:"Individuals aged 18 years or older"}),e.jsx("li",{children:"Users with legitimate educational interests"})]}),e.jsx("p",{className:"text-gray-600 mt-4",children:"By registering, you represent that you meet these eligibility requirements and that all information provided is accurate and truthful."})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(fe,{className:"h-6 w-6 text-purple-600"}),"Account Responsibilities"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"When you create an account, you agree to:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Provide accurate and complete registration information"}),e.jsx("li",{children:"Maintain the security of your password and account"}),e.jsx("li",{children:"Notify us immediately of any unauthorized use"}),e.jsx("li",{children:"Accept responsibility for all activities under your account"}),e.jsx("li",{children:"Use your real name and authentic information"}),e.jsx("li",{children:"Maintain one account per person"})]}),e.jsx("div",{className:"p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-400",children:e.jsxs("p",{className:"text-yellow-700",children:[e.jsx("strong",{children:"Important:"})," You are responsible for maintaining the confidentiality of your account credentials."]})})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Acceptable Use Policy"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"You may use JU Connect to:"}),e.jsxs("ul",{className:"list-disc list-inside text-green-600 space-y-1",children:[e.jsx("li",{children:"Share educational content and academic resources"}),e.jsx("li",{children:"Collaborate on educational projects and research"}),e.jsx("li",{children:"Participate in academic discussions and forums"}),e.jsx("li",{children:"Access and download shared educational materials"}),e.jsx("li",{children:"Connect with fellow students and educators"})]}),e.jsx("p",{className:"text-gray-600 font-medium mt-6",children:"You may NOT use JU Connect to:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-600 space-y-1",children:[e.jsx("li",{children:"Upload copyrighted material without permission"}),e.jsx("li",{children:"Share inappropriate, offensive, or harmful content"}),e.jsx("li",{children:"Engage in harassment, bullying, or discriminatory behavior"}),e.jsx("li",{children:"Spam, advertise, or promote commercial activities"}),e.jsx("li",{children:"Attempt to hack, disrupt, or damage the platform"}),e.jsx("li",{children:"Create fake accounts or impersonate others"}),e.jsx("li",{children:"Share personal information of others without consent"}),e.jsx("li",{children:"Use automated tools to scrape or download content"})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Content Guidelines"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Content You Upload"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Must be educational, academic, or research-related"}),e.jsx("li",{children:"Should be original work or properly attributed"}),e.jsx("li",{children:"Must not violate copyright or intellectual property rights"}),e.jsx("li",{children:"Should be appropriate for an academic environment"}),e.jsx("li",{children:"Must comply with applicable laws and regulations"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 mt-6",children:"Content Moderation"}),e.jsx("p",{className:"text-gray-600",children:"All uploaded content is subject to review and approval by our moderation team. We reserve the right to remove content that violates these guidelines or is deemed inappropriate for our educational platform."})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Te,{className:"h-6 w-6 text-yellow-600"}),"Intellectual Property Rights"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Your Content"}),e.jsx("p",{className:"text-gray-600",children:"You retain ownership of content you create and upload to JU Connect. By uploading content, you grant us a non-exclusive, worldwide license to host, display, and distribute your content on the platform for educational purposes."}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Platform Content"}),e.jsx("p",{className:"text-gray-600",children:"The JU Connect platform, including its design, features, and functionality, is owned by us and protected by copyright and other intellectual property laws."}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Respect for Others' Rights"}),e.jsx("p",{className:"text-gray-600",children:"You must respect the intellectual property rights of others. If you believe content infringes your rights, please contact us immediately through our reporting system."})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Privacy and Data Usage"}),e.jsxs("p",{className:"text-gray-600 leading-relaxed",children:["Your privacy is important to us. Our collection and use of personal information is governed by our ",e.jsx(ie,{to:"/privacy",className:"text-primary-600 hover:underline",children:"Privacy Policy"}),", which is incorporated into these Terms by reference. By using JU Connect, you also consent to our Privacy Policy."]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Et,{className:"h-6 w-6 text-red-600"}),"Prohibited Activities"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"The following activities are strictly prohibited:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-red-700 mb-2",children:"Security Violations"}),e.jsxs("ul",{className:"text-red-600 text-sm space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Attempting to breach security measures"}),e.jsx("li",{children:"‚Ä¢ Accessing others' accounts without permission"}),e.jsx("li",{children:"‚Ä¢ Introducing malware or viruses"}),e.jsx("li",{children:"‚Ä¢ Reverse engineering the platform"})]})]}),e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-orange-700 mb-2",children:"Content Violations"}),e.jsxs("ul",{className:"text-orange-600 text-sm space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Uploading illegal or harmful content"}),e.jsx("li",{children:"‚Ä¢ Sharing copyrighted material illegally"}),e.jsx("li",{children:"‚Ä¢ Posting spam or unwanted content"}),e.jsx("li",{children:"‚Ä¢ Misrepresenting content ownership"})]})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[e.jsx(Fe,{className:"h-6 w-6 text-orange-600"}),"Enforcement and Consequences"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Violations of these Terms may result in:"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Warning notifications"}),e.jsx("li",{children:"Temporary suspension of account privileges"}),e.jsx("li",{children:"Removal of violating content"}),e.jsx("li",{children:"Permanent account termination"}),e.jsx("li",{children:"Legal action in severe cases"})]}),e.jsx("div",{className:"p-4 bg-orange-50 rounded-lg border-l-4 border-orange-400",children:e.jsx("p",{className:"text-orange-700",children:"We reserve the right to investigate violations and take appropriate action at our discretion."})})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Disclaimers and Limitations"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:'JU Connect is provided "as is" without warranties of any kind. We do not guarantee:'}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 space-y-2",children:[e.jsx("li",{children:"Uninterrupted or error-free service"}),e.jsx("li",{children:"Accuracy or reliability of content"}),e.jsx("li",{children:"Security against all threats"}),e.jsx("li",{children:"Compatibility with all devices or browsers"})]}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Your use of the platform is at your own risk. We are not liable for any damages arising from your use of JU Connect."})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Changes to Terms"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"We may modify these Terms at any time. Significant changes will be announced through the platform or via email. Your continued use after changes indicates acceptance of the new Terms. If you disagree with changes, you must stop using the platform."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Termination"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"Either party may terminate your account at any time. Upon termination, your right to use the platform ceases immediately. We may retain certain information as required by law or for legitimate business purposes."})]}),e.jsxs("section",{className:"bg-gray-50 rounded-xl p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Questions About These Terms"}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-4",children:"If you have questions about these Terms of Service, please contact us:"}),e.jsxs("div",{className:"space-y-2 text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," legal@juconnect.edu"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Support:"})," Visit our ",e.jsx(ie,{to:"/contact",className:"text-primary-600 hover:underline",children:"Contact Us"})," page"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," JECRC University, Jaipur, Rajasthan 302022, India"]})]})]})]})]})}),tr=()=>{const[s,t]=o.useState({name:"",email:"",subject:"",category:"general",message:""}),[r,a]=o.useState(!1),[n,i]=o.useState(!1),l=[{value:"general",label:"General Inquiry"},{value:"technical",label:"Technical Support"},{value:"content",label:"Content Issues"},{value:"account",label:"Account Problems"},{value:"privacy",label:"Privacy Concerns"},{value:"feedback",label:"Feedback & Suggestions"}],c=h=>{const{name:N,value:m}=h.target;t(y=>({...y,[N]:m}))},d=async h=>{h.preventDefault(),a(!0),await new Promise(N=>setTimeout(N,2e3)),i(!0),a(!1),setTimeout(()=>{i(!1),t({name:"",email:"",subject:"",category:"general",message:""})},3e3)},g=[{icon:Ke,title:"Email Support",description:"Get help via email",contact:"support@juconnect.edu",response:"Response within 24 hours"},{icon:Me,title:"Live Chat",description:"Chat with our support team",contact:"Available 9 AM - 6 PM",response:"Instant response"},{icon:Ts,title:"Phone Support",description:"Call for urgent issues",contact:"+91 33 2414-6666",response:"Mon-Fri, 9 AM - 5 PM"}],u=[{question:"How quickly do you respond to support requests?",answer:"We aim to respond to all inquiries within 24 hours during business days."},{question:"Can I get help with technical issues?",answer:"Yes! Our technical support team can help with platform issues, login problems, and more."},{question:"How do I report inappropriate content?",answer:"Use the report button on any content, or contact us directly with details."},{question:"Can you help with account recovery?",answer:"Absolutely. Contact us with your account details and we'll help you regain access."}];return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(ie,{to:"/",className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 mb-4 transition-colors",children:[e.jsx(Le,{className:"h-4 w-4"}),"Back to Home"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-3 bg-primary-100 rounded-xl",children:e.jsx(Me,{className:"h-8 w-8 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Contact Us"}),e.jsx("p",{className:"text-gray-600",children:"We're here to help! Reach out with any questions or concerns."})]})]})})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-6",children:"Send us a Message"}),n?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ve,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Message Sent!"}),e.jsx("p",{className:"text-gray-600",children:"Thank you for contacting us. We'll get back to you soon."})]}):e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",value:s.name,onChange:c,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Your full name"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:c,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"your.email@example.com"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsx("select",{id:"category",name:"category",value:s.category,onChange:c,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:l.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject *"}),e.jsx("input",{type:"text",id:"subject",name:"subject",value:s.subject,onChange:c,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Brief description of your inquiry"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:"Message *"}),e.jsx("textarea",{id:"message",name:"message",value:s.message,onChange:c,required:!0,rows:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none",placeholder:"Please provide as much detail as possible about your inquiry..."})]}),e.jsx(I,{type:"submit",disabled:r,className:"w-full bg-primary-600 text-white py-3 rounded-lg hover:bg-primary-700 disabled:opacity-50 flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:"sm"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"h-5 w-5"}),"Send Message"]})})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Other Ways to Reach Us"}),e.jsx("div",{className:"space-y-4",children:g.map((h,N)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(h.icon,{className:"h-5 w-5 text-primary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:h.title}),e.jsx("p",{className:"text-sm text-gray-600",children:h.description}),e.jsx("p",{className:"text-sm font-medium text-primary-600",children:h.contact}),e.jsx("p",{className:"text-xs text-gray-500",children:h.response})]})]},N))})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(kt,{className:"h-5 w-5 text-primary-600"}),"Our Office"]}),e.jsxs("div",{className:"space-y-3 text-gray-600",children:[e.jsx("p",{children:e.jsx("strong",{children:"JU Connect Support Center"})}),e.jsxs("p",{children:["JECRC University",e.jsx("br",{}),"Plot No. IS-2036 to IS-2039 Ramchandrapura Industrial Area",e.jsx("br",{}),"Jaipur, Sitapura, Vidhani, Rajasthan 302022",e.jsx("br",{}),"India"]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ye,{className:"h-4 w-4 text-primary-600"}),e.jsx("span",{className:"font-medium",children:"Office Hours"})]}),e.jsx("p",{className:"text-sm",children:"Monday - Friday: 9:00 AM - 6:00 PM"}),e.jsx("p",{className:"text-sm",children:"Saturday: 10:00 AM - 4:00 PM"}),e.jsx("p",{className:"text-sm",children:"Sunday: Closed"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-primary-600"}),"Quick FAQ"]}),e.jsx("div",{className:"space-y-4",children:u.map((h,N)=>e.jsxs("details",{className:"group",children:[e.jsxs("summary",{className:"flex items-center justify-between cursor-pointer text-sm font-medium text-gray-900 hover:text-primary-600",children:[h.question,e.jsx("span",{className:"ml-2 transform group-open:rotate-45 transition-transform",children:"+"})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 leading-relaxed",children:h.answer})]},N))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsx(ie,{to:"/help",className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"View Full Help Center ‚Üí"})})]})]})]})]})})},ar={getAllGroups:{calls:0,lastReset:Date.now(),maxCalls:2,resetInterval:6e4},getUserGroups:{calls:0,lastReset:Date.now(),maxCalls:3,resetInterval:6e4}},gs={allGroups:{data:null,timestamp:0,ttl:3e4}},rr=(s,t)=>{{const r=gs.allGroups;if(r.data&&Date.now()-r.timestamp<r.ttl)return r.data}return null},nr=(s,t,r)=>{gs.allGroups={data:t,timestamp:Date.now(),ttl:3e4}},Hs=s=>{const t=ar[s],r=Date.now();return r-t.lastReset>t.resetInterval&&(t.calls=0,t.lastReset=r),t.calls>=t.maxCalls?!1:(t.calls++,!0)},ir=async()=>{if(!p)return console.error("Supabase not available"),[];const s=rr();if(s)return s;if(!Hs("getAllGroups"))return console.warn("getAllClassGroups: Rate limit exceeded, returning cached/empty data"),gs.allGroups.data||[];try{const{data:t,error:r}=await p.from("class_groups").select("id, name, description, year, section, subject, member_count, created_by, is_active, is_password_protected, created_at, updated_at").eq("is_active",!0).order("year",{ascending:!0}).order("section",{ascending:!0}).limit(10);if(r){if(console.error("Error fetching all groups:",r),r.code==="42P01")return console.warn("class_groups table does not exist yet"),[];throw r}const a=(t||[]).map(n=>({...n,is_member:!1,user_role:void 0,unread_count:0,join_status:n.is_password_protected?"üîí Password Protected":"Open to Join",password_hash:null}));return nr("allGroups",a),a}catch(t){return console.error("Error fetching all groups:",t),[]}},lr=async s=>{if(!p||!s)return console.error("Supabase not available or no user ID provided"),[];if(!Hs("getUserGroups"))return console.warn("getUserGroups: Rate limit exceeded, returning cached/empty data"),[];try{const{data:t,error:r}=await p.from("group_members").select(`
        group_id,
        role,
        joined_at,
        class_groups!inner (
          id,
          name,
          description,
          year,
          section,
          subject,
          member_count,
          created_by,
          is_active,
          created_at,
          updated_at
        )
      `).eq("user_id",s).eq("is_active",!0).eq("class_groups.is_active",!0);if(r)throw console.error("Error fetching user groups:",r),r;return(t||[]).map(a=>({id:a.class_groups.id,name:a.class_groups.name,description:a.class_groups.description,year:a.class_groups.year,section:a.class_groups.section,subject:a.class_groups.subject,created_by:a.class_groups.created_by,is_active:a.class_groups.is_active,member_count:a.class_groups.member_count,created_at:a.class_groups.created_at,updated_at:a.class_groups.updated_at,user_role:a.role,unread_count:0,is_member:!0}))}catch(t){return console.error("Error fetching user groups:",t),[]}},or=async s=>{if(!p)throw new Error("Database connection not available");if(!s.name||!s.year||!s.section||!s.subject||!s.created_by)throw new Error("Missing required fields for group creation");const t={name:s.name,description:s.description||"",year:s.year,section:s.section,subject:s.subject,created_by:s.created_by,is_password_protected:!!s.password,member_count:1,is_active:!0},{data:r,error:a}=await p.from("class_groups").insert([t]).select().single();if(a)throw console.error("Error creating group:",a),new Error("Failed to create group");return r},Ss=async(s,t,r)=>{if(!p)throw new Error("Supabase not available");const{data:a,error:n}=await p.from("class_groups").select("is_password_protected").eq("id",s).single();if(n)throw new Error("Group not found");if(a.is_password_protected){if(!r)throw new Error("This group requires a password to join");const{data:c,error:d}=await p.rpc("verify_group_password",{group_id_param:s,password_param:r});if(d)throw new Error("Error verifying password");if(!c)throw new Error("Incorrect password")}const{data:i}=await p.from("group_members").select("*").eq("group_id",s).eq("user_id",t).single();if(i){if(i.is_active)throw new Error("You are already a member of this group");{const{error:c}=await p.from("group_members").update({is_active:!0}).eq("group_id",s).eq("user_id",t);if(c)throw console.error("Error reactivating membership:",c),new Error("Failed to rejoin group. Please try again.");return}}const{error:l}=await p.from("group_members").insert([{group_id:s,user_id:t,role:"member"}]);if(l)throw console.error("Error joining group:",l),l.message.includes("infinite recursion")?new Error("Database configuration issue. Please contact support or try again later."):l.code==="23505"?new Error("You are already a member of this group"):new Error(`Failed to join group: ${l.message}`)},cr=async(s,t)=>{if(!p)throw new Error("Supabase not available");const{error:r}=await p.from("group_members").update({is_active:!1}).eq("group_id",s).eq("user_id",t);if(r)throw r},Xs=async s=>{if(!p)return console.warn("Supabase not available for getGroupMembers"),[];if(!s)return console.warn("No group ID provided for getGroupMembers"),[];try{const{data:t,error:r}=await p.from("group_members").select(`
        *,
        profiles (
          id,
          username,
          full_name,
          avatar_url,
          is_online,
          last_seen
        )
      `).eq("group_id",s).eq("is_active",!0).order("role",{ascending:!1}).order("joined_at",{ascending:!0});if(r){if(console.error("Database error in getGroupMembers:",r),r.code==="42P01")return console.warn("group_members table does not exist yet"),[];throw r}return t||[]}catch(t){if(console.error("Error in getGroupMembers:",t),t instanceof Error&&t.message.includes("table does not exist"))return[];throw t}},dr=async(s,t,r,a="text",n,i)=>{if(!p)throw new Error("Supabase not available");if(!s||!t||!r.trim())throw new Error("Missing required parameters");try{const l={group_id:s,user_id:t,message:r.trim(),message_type:a,file_url:(n==null?void 0:n.file_url)||null,file_name:(n==null?void 0:n.file_name)||null,file_size:(n==null?void 0:n.file_size)||null,reply_to:i||null},{data:c,error:d}=await p.from("group_messages").insert([l]).select().single();if(d)throw console.error("Error sending message:",d),d.code==="42P01"?new Error("There is a technical issue. Please try again later."):d.code==="42501"?new Error("You are already in this group"):new Error("Could not join the group. Please try again.");return c}catch(l){throw console.error("Error in sendGroupMessage:",l),l}},mr=async(s,t=50,r=0)=>{if(!p)return[];if(!s)return[];try{const{data:a,error:n}=await p.from("group_messages").select("*").eq("group_id",s).order("created_at",{ascending:!0}).range(r,r+t-1);if(n)throw n;return!a||a.length===0?[]:await Promise.all(a.map(async l=>{const{data:c}=await p.from("profiles").select("id, username, full_name, avatar_url").eq("id",l.user_id).single();return{...l,profiles:c||{id:l.user_id,username:"Unknown User",full_name:"Unknown User",avatar_url:null}}}))}catch(a){if(console.error("Error fetching group messages:",a),a instanceof Error&&a.message.includes("table does not exist"))return[];throw a}},Ks=async(s,t)=>{if(!p)throw new Error("Supabase not available");const{data:r,error:a}=await p.rpc("is_group_admin",{group_id_param:s,user_id_param:t});return a?(console.error("Error checking admin status:",a),!1):r||!1},ur=async(s,t,r)=>{if(!p)throw new Error("Supabase not available");const{data:a,error:n}=await p.rpc("promote_to_admin",{group_id_param:s,target_user_id_param:t,requesting_user_id_param:r});if(n)throw n;return a},xr=async(s,t,r)=>{if(!p)throw new Error("Supabase not available");const{data:a,error:n}=await p.rpc("demote_admin",{group_id_param:s,target_user_id_param:t,requesting_user_id_param:r});if(n)throw n;return a},hr=async(s,t,r)=>{if(!p)throw new Error("Supabase not available");const{data:a,error:n}=await p.rpc("remove_group_member",{group_id_param:s,target_user_id_param:t,requesting_user_id_param:r});if(n)throw n;return a},pr=async(s,t,r,a)=>{if(!p)throw new Error("Supabase not available");const{data:n,error:i}=await p.rpc("update_group_details",{group_id_param:s,new_name:t||null,new_description:r||null,requesting_user_id_param:a});if(i)throw i;return n},gr=async(s,t)=>{if(!p)throw new Error("Supabase not available");const{data:r,error:a}=await p.rpc("delete_group",{group_id_param:s,requesting_user_id_param:t});if(a)throw a;return r},fr=async s=>{if(!p)throw new Error("Supabase not available");const{data:t,error:r}=await p.from("group_admin_info").select("*").eq("group_id",s).single();if(r)throw r;return t},yr=({isOpen:s,onClose:t,onSuccess:r})=>{const{user:a}=Z(),[n,i]=o.useState(!1),[l,c]=o.useState(""),[d,g]=o.useState({name:"",description:"",year:1,section:"",subject:"",isPasswordProtected:!1,password:"",confirmPassword:""}),[u,h]=o.useState(!1),N=async y=>{if(y.preventDefault(),!(!a||n)){if(d.isPasswordProtected){if(!d.password){c("Password is required for protected groups");return}if(d.password!==d.confirmPassword){c("Passwords do not match");return}if(d.password.length<4){c("Password must be at least 4 characters long");return}}i(!0),c("");try{await or({name:d.name.trim(),description:d.description.trim()||void 0,year:d.year,section:d.section.trim().toUpperCase(),subject:d.subject.trim()||void 0,created_by:a.id,password:d.isPasswordProtected?d.password:void 0}),g({name:"",description:"",year:1,section:"",subject:"",isPasswordProtected:!1,password:"",confirmPassword:""}),r()}catch(A){A.code==="23505"?c("A group like this already exists. Please try different details."):c(A.message||"Could not create the group. Please try again.")}finally{i(!1)}}},m=y=>{const{name:A,value:w,type:P}=y.target;if(P==="checkbox"){const S=y.target;g(v=>({...v,[A]:S.checked}))}else g(S=>({...S,[A]:A==="year"?parseInt(w):w}))};return e.jsx(pe,{isOpen:s,onClose:t,title:"Create Class Group",size:"lg",children:e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[l&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200",children:l}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-blue-50 rounded-lg",children:[e.jsx(ve,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Create Your Class Group"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Bring your classmates together for better collaboration"})]})]}),e.jsx(H,{name:"name",label:"Group Name *",value:d.name,onChange:m,placeholder:"e.g., Computer Science 4th Year Section B",required:!0,disabled:n,premium:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Year *"}),e.jsx("select",{name:"year",value:d.year,onChange:m,required:!0,className:"input-premium appearance-none cursor-pointer",disabled:n,children:[1,2,3,4,5].map(y=>e.jsxs("option",{value:y,children:["Year ",y]},y))})]}),e.jsx(H,{name:"section",label:"Section *",value:d.section,onChange:m,placeholder:"e.g., A, B, C",required:!0,disabled:n,premium:!0})]}),e.jsx(H,{name:"subject",label:"Subject (Optional)",value:d.subject,onChange:m,placeholder:"e.g., Computer Science, Mathematics",disabled:n,premium:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),e.jsx("textarea",{name:"description",value:d.description,onChange:m,placeholder:"Brief description of the group purpose...",rows:3,className:"input-premium resize-none",disabled:n})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(Pe,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Group Privacy"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Control who can join your group"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"isPasswordProtected",name:"isPasswordProtected",checked:d.isPasswordProtected,onChange:m,disabled:n,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"isPasswordProtected",className:"text-sm font-medium text-gray-700",children:"Password protect this group"})]}),d.isPasswordProtected&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(H,{name:"password",label:"Group Password *",type:u?"text":"password",value:d.password,onChange:m,placeholder:"Enter password (min 4 characters)",required:d.isPasswordProtected,disabled:n,premium:!0}),e.jsx("button",{type:"button",onClick:()=>h(!u),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600",children:u?e.jsx(Qe,{className:"h-4 w-4"}):e.jsx(Se,{className:"h-4 w-4"})})]}),e.jsx(H,{name:"confirmPassword",label:"Confirm Password *",type:"password",value:d.confirmPassword,onChange:m,placeholder:"Confirm your password",required:d.isPasswordProtected,disabled:n,premium:!0}),e.jsxs("div",{className:"text-xs text-gray-500 bg-yellow-50 p-2 rounded border",children:[e.jsx("p",{className:"font-medium text-yellow-700 mb-1",children:"üîí Password Protected Group"}),e.jsx("p",{children:"Only users with the correct password can join this group. Make sure to share the password securely with your classmates."})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(I,{type:"button",variant:"outline",onClick:t,disabled:n,children:"Cancel"}),e.jsxs(I,{type:"submit",loading:n,disabled:n||!d.name.trim()||!d.section.trim(),className:"flex items-center space-x-2",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Group"})]})]})]})})},br=({isOpen:s,onClose:t,onSubmit:r,groupName:a,loading:n=!1,error:i})=>{const[l,c]=o.useState(""),[d,g]=o.useState(!1),u=N=>{N.preventDefault(),l.trim()&&r(l.trim())},h=()=>{c(""),g(!1),t()};return e.jsx(pe,{isOpen:s,onClose:h,title:"Group Password Required",size:"sm",children:e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx(Pe,{className:"h-8 w-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-900",children:"Password Protected Group"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:['"',a,'" requires a password to join']})]})]}),i&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200",children:i}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{label:"Enter Group Password",type:d?"text":"password",value:l,onChange:N=>c(N.target.value),placeholder:"Enter the group password",required:!0,disabled:n,premium:!0,autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>g(!d),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600",disabled:n,children:d?e.jsx(Qe,{className:"h-4 w-4"}):e.jsx(Se,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg",children:e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:"Tip:"})," Contact the group admin or a member to get the password if you don't have it."]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(I,{type:"button",variant:"outline",onClick:h,disabled:n,children:"Cancel"}),e.jsxs(I,{type:"submit",loading:n,disabled:n||!l.trim(),className:"flex items-center space-x-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{children:"Join Group"})]})]})]})})},Es=({onGroupSelect:s})=>{const{user:t,isGuest:r,loading:a}=Z(),[n,i]=o.useState([]),[l,c]=o.useState([]),[d,g]=o.useState(!0),[u,h]=o.useState(null),[N,m]=o.useState(!1),[y,A]=o.useState(!1),[w,P]=o.useState(null),[S,v]=o.useState(""),[_,j]=o.useState(""),[b,x]=o.useState(null),[f,E]=o.useState("my-groups"),[M,R]=o.useState(null),O=o.useRef(!0),Q=o.useRef(null),q=o.useRef(!0),$=o.useMemo(()=>t==null?void 0:t.id,[t==null?void 0:t.id]),ee=o.useMemo(()=>r,[r]),k=o.useMemo(()=>a,[a]),B=o.useCallback(async()=>{if(!O.current){console.log("ClassGroupList: Component unmounted, skipping fetch");return}Q.current&&clearTimeout(Q.current);const U=Date.now(),Y=parseInt(sessionStorage.getItem("last-groups-fetch")||"0"),se=U-Y;if(se<15e3){console.log("Groups fetch rate limited - last fetch was",se/1e3,"seconds ago, minimum 15 seconds required");return}sessionStorage.setItem("last-groups-fetch",U.toString()),console.log("ClassGroupList: Starting fetchGroups with userId:",$,"isGuest:",ee,"authLoading:",k);try{g(!0),R(null);let G=[],T=[];try{G=await ir(),console.log("All groups fetched:",G.length)}catch(L){console.error("Failed to fetch all groups:",L),R(`Failed to load groups: ${L.message}`),G=[]}if($&&!ee)try{T=await lr($),console.log("User groups fetched:",T.length)}catch(L){console.error("Failed to fetch user groups:",L),G.length===0&&R(`Failed to load user groups: ${L.message}`),T=[]}i(G),c(T)}catch(G){console.error("Failed to fetch groups:",G),R(`Failed to load groups: ${G.message||"Unknown error"}`),i([]),c([])}finally{g(!1)}},[$,ee,k]);if(o.useEffect(()=>{if(k){console.log("ClassGroupList: Skipping fetch - auth still loading");return}return q.current?(q.current=!1,Q.current=setTimeout(()=>{console.log("ClassGroupList: First mount - triggering fetchGroups after delay"),B()},500)):Q.current=setTimeout(()=>{console.log("ClassGroupList: Subsequent call - triggering fetchGroups"),B()},300),()=>{Q.current&&clearTimeout(Q.current)}},[B,k]),o.useEffect(()=>()=>{O.current=!1,Q.current&&clearTimeout(Q.current)},[]),k)return e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(ae,{})});const re=async(U,Y)=>{if(!t||r)return;const se=Y||n.find(G=>G.id===U);if(se!=null&&se.is_password_protected){P(se),A(!0),v("");return}try{h(U),await Ss(U,t.id),await B()}catch(G){console.error("Failed to join group:",G),alert(G.message||"Could not join the group. Please try again.")}finally{h(null)}},xe=async U=>{if(!(!w||!t))try{h(w.id),v(""),await Ss(w.id,t.id,U),A(!1),P(null),await B()}catch(Y){console.error("Failed to join protected group:",Y),v(Y.message||"Failed to join group")}finally{h(null)}},Ne=()=>{A(!1),P(null),v(""),h(null)},z=U=>U.filter(Y=>{var T,L;const se=Y.name.toLowerCase().includes(_.toLowerCase())||((T=Y.description)==null?void 0:T.toLowerCase().includes(_.toLowerCase()))||((L=Y.subject)==null?void 0:L.toLowerCase().includes(_.toLowerCase())),G=b===null||Y.year===b;return se&&G}),D=Array.from(new Set(n.map(U=>U.year))).sort();return d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(ae,{size:"lg",text:"Loading groups..."})}):M?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsxs("div",{className:"text-red-600 text-center",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Unable to load groups"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:M}),e.jsx(I,{onClick:B,className:"mt-4",children:"Try Again"})]}),e.jsxs("div",{className:"text-center text-sm text-gray-500 mt-4",children:[e.jsx("p",{children:"This might be because:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Database migrations haven't been applied"}),e.jsx("li",{children:"Group tables don't exist yet"}),e.jsx("li",{children:"Network connectivity issue"})]})]})]}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-3 sm:space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Class Groups"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Join your class groups to collaborate and share resources"})]}),t&&!r&&e.jsxs(I,{onClick:()=>m(!0),className:"flex items-center space-x-2",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Group"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search groups...",value:_,onChange:U=>j(U.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm sm:text-base"})]}),e.jsxs("div",{className:"flex items-center space-x-2 min-w-0",children:[e.jsx(is,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),e.jsxs("select",{value:b||"",onChange:U=>x(U.target.value?parseInt(U.target.value):null),className:"flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"All Years"}),D.map(U=>e.jsxs("option",{value:U,children:["Year ",U]},U))]})]})]})}),e.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>E("my-groups"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${f==="my-groups"?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["My Groups (",l.length,")"]}),e.jsxs("button",{onClick:()=>E("all-groups"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${f==="all-groups"?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["All Groups (",n.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:f==="my-groups"?z(l).length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(Re,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:_||b?"No matching groups found":"No groups joined yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:_||b?"Try adjusting your search criteria":"Join your first class group to get started"}),!_&&!b&&e.jsx(I,{onClick:()=>E("all-groups"),children:"Browse All Groups"})]}):z(l).map(U=>e.jsx(ks,{group:U,onSelect:()=>s(U),onJoin:()=>re(U.id,U),isJoining:u===U.id,showJoinButton:!1,userId:$},U.id)):z(n).length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(Re,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No groups found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your search criteria"})]}):z(n).map(U=>{const Y=l.some(se=>se.id===U.id);return e.jsx(ks,{group:U,onSelect:()=>s(U),onJoin:()=>re(U.id,U),isJoining:u===U.id,showJoinButton:!Y&&!!t&&!r,isJoined:Y,userId:$},U.id)})}),e.jsx(yr,{isOpen:N,onClose:()=>m(!1),onSuccess:()=>{m(!1),B()}}),e.jsx(br,{isOpen:y,onClose:Ne,onSubmit:xe,groupName:(w==null?void 0:w.name)||"",loading:u===(w==null?void 0:w.id),error:S})]})},ks=({group:s,onSelect:t,onJoin:r,isJoining:a,showJoinButton:n,isJoined:i=!1,userId:l})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs(X,{variant:"primary",children:["Year ",s.year," - ",s.semester]}),s.user_role==="admin"&&e.jsxs(X,{variant:"warning",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"Admin"]}),s.creator_id===l&&e.jsxs(X,{variant:"success",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"Creator"]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.name}),s.subject&&e.jsx("p",{className:"text-sm text-primary-600 font-medium mb-2",children:s.subject}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.description})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.member_count," members"]})]}),s.is_password_protected&&e.jsxs("div",{className:"flex items-center space-x-1 text-amber-600",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Protected"})]}),s.unread_count&&s.unread_count>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsxs("span",{className:"text-primary-600 font-medium",children:[s.unread_count," unread"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ye,{className:"h-3 w-3"}),e.jsx("span",{children:Ce(new Date(s.updated_at||s.created_at||new Date),{addSuffix:!0})})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:i?e.jsx(I,{onClick:t,className:"flex-1",variant:"primary",children:"Open Group"}):n?e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>r(s),loading:a,disabled:a,className:"flex-1",children:s.is_password_protected?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Join Group"]}):"Join Group"}),e.jsx(I,{onClick:t,variant:"outline",className:"px-3",children:"View"})]}):e.jsx(I,{onClick:t,variant:"outline",className:"flex-1",children:"View Group"})})]}),jr=async({file:s,groupId:t,userId:r})=>{var a,n,i,l;if(!p)throw new Error("Supabase not available");try{if(console.log("üìÅ Starting group file upload:",{fileName:s.name,fileSize:s.size,groupId:t,userId:r}),!s||s.size===0)throw new Error("Invalid file - file is empty or corrupted");if(s.size>5*1024*1024)throw new Error("File size too large - please upload a file smaller than 5MB");const{data:c,error:d}=await p.from("group_members").select("id").eq("group_id",t).eq("user_id",r).eq("is_active",!0).single();if(d||!c)throw console.error("‚ùå User not a member of group:",d),new Error("You are not a member of this group");console.log("‚úÖ User membership verified");const g=((a=s.name.split(".").pop())==null?void 0:a.toLowerCase())||"",u=Date.now(),h=s.name.replace(/[^a-zA-Z0-9.-]/g,"_"),N=`${r}_${u}_${h}`,y=`${`group-files/${t}`}/${N}`;console.log("üì§ Uploading to storage:",y);const{data:A,error:w}=await p.storage.from("files").upload(y,s,{cacheControl:"3600",upsert:!1});if(w)throw console.error("‚ùå Storage upload failed:",w),(n=w.message)!=null&&n.includes("row-level security policy")?new Error("You do not have permission to upload files. Please check your account permissions."):(i=w.message)!=null&&i.includes("Bucket not found")?new Error("File storage is not properly configured. Please contact support."):new Error(`Failed to upload file: ${w.message}`);console.log("‚úÖ File uploaded to storage successfully");const{data:P}=p.storage.from("files").getPublicUrl(y);if(!(P!=null&&P.publicUrl))throw new Error("Failed to generate file access link");const S=P.publicUrl;console.log("‚úÖ Generated public URL:",S);const v={group_id:t,user_id:r,message:`üìé ${s.name}`,message_type:"file",file_url:S,file_name:s.name,file_size:s.size};console.log("üí¨ Creating group message:",v);const{data:_,error:j}=await p.from("group_messages").insert([v]).select(`
        *,
        profiles (
          id,
          username,
          full_name,
          avatar_url
        )
      `).single();if(j){console.error("‚ùå Failed to create group message:",j);try{await p.storage.from("files").remove([y]),console.log("üßπ Cleaned up uploaded file after message error")}catch(b){console.error("Failed to cleanup uploaded file:",b)}throw(l=j.message)!=null&&l.includes("row-level security policy")?new Error("You do not have permission to send messages in this group."):new Error(`Failed to send file message: ${j.message}`)}return console.log("‚úÖ Group file message created successfully:",_.id),{id:_.id,group_id:_.group_id,user_id:_.user_id,file_url:_.file_url,file_name:_.file_name,file_size:_.file_size,message_type:"file",created_at:_.created_at}}catch(c){throw console.error("‚ùå Error uploading group file:",c),c.message?new Error(c.message):new Error("Failed to upload file. Please try again.")}},wr=async(s,t,r)=>{if(!p)throw new Error("Supabase not available");try{return console.log("üîê Generating secure download URL for:",s),await vr(s,t,r)}catch(a){throw console.error("‚ùå Secure download URL generation failed:",a.message),a}},vr=async(s,t,r)=>{if(!p)throw new Error("Supabase not available");try{console.log("üîê Processing file URL:",s);let a,n;if(s.includes("/storage/v1/object/public/")){const c=s.split("/storage/v1/object/public/");if(c.length<2)throw new Error("Invalid public file URL format");const[d,...g]=c[1].split("/");a=d,n=g.join("/")}else if(s.includes("/storage/v1/object/sign/")){const c=s.split("/storage/v1/object/sign/");if(c.length<2)throw new Error("Invalid signed file URL format");const d=c[1].split("?")[0],[g,...u]=d.split("/");a=g,n=u.join("/")}else throw new Error("Unrecognized file URL format");if(console.log("üîê Extracted - Bucket:",a,"Path:",n),r){const{data:c,error:d}=await p.from("group_members").select("id").eq("group_id",r).eq("user_id",t).eq("is_active",!0).single();if(d||!c)throw new Error("Access denied: User not authorized to download this file")}const{data:i,error:l}=await p.storage.from(a).createSignedUrl(n,3600);if(l)throw console.error("‚ùå Error generating signed URL:",l),new Error(`Failed to generate secure download link: ${l.message}`);if(!(i!=null&&i.signedUrl))throw new Error("No signed URL generated");return console.log("‚úÖ Direct signed URL generated successfully"),i.signedUrl}catch(a){throw console.error("‚ùå Direct signed URL generation failed:",a.message),a}},Nr=async({fileUrl:s,fileName:t,userId:r,groupId:a})=>{try{console.log("üîí Starting secure download for:",t);const n=await wr(s,r,a),i=document.createElement("a");i.href=n,i.download=t,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),console.log("‚úÖ Secure download completed for:",t)}catch(n){console.error("‚ùå Secure download failed:",n.message),console.log("‚ö†Ô∏è Falling back to direct download for:",t);try{const i=document.createElement("a");i.href=s,i.download=t,i.target="_blank",i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),console.log("‚úÖ Fallback download completed for:",t)}catch{console.error("‚ùå Fallback download also failed:",fallbackError.message),window.open(s,"_blank")}}},_r=({group:s,isOpen:t,onClose:r,onGroupUpdated:a})=>{const{user:n}=Z(),[i,l]=o.useState(!1),[c,d]=o.useState([]),[g,u]=o.useState(null),[h,N]=o.useState(!1),[m,y]=o.useState(!1),[A,w]=o.useState(!1),[P,S]=o.useState(s.name),[v,_]=o.useState(s.description||""),[j,b]=o.useState(""),[x,f]=o.useState(""),E=o.useCallback(async()=>{if(n)try{l(!0);const[k,B]=await Promise.all([Xs(s.id),fr(s.id)]);d(k),u(B)}catch(k){b(k.message)}finally{l(!1)}},[n,s.id]),M=o.useCallback(async()=>{if(n)try{const k=await Ks(s.id,n.id);N(k)}catch(k){console.error("Error checking admin status:",k)}},[n,s.id]);o.useEffect(()=>{t&&n&&E()},[t,n,s.id,E]),o.useEffect(()=>{n&&(y(s.created_by===n.id),M())},[n,s.created_by,M]);const R=async k=>{if(n)try{l(!0);const B=await ur(s.id,k,n.id);B.success?(f(B.message||"Member promoted to admin"),await E()):b(B.error||"Failed to promote member")}catch(B){b(B.message)}finally{l(!1)}},O=async k=>{if(n)try{l(!0);const B=await xr(s.id,k,n.id);B.success?(f(B.message||"Admin demoted to member"),await E()):b(B.error||"Failed to demote admin")}catch(B){b(B.message)}finally{l(!1)}},Q=async(k,B)=>{if(n&&confirm(`Are you sure you want to remove ${B} from the group?`))try{l(!0);const re=await hr(s.id,k,n.id);re.success?(f(re.message||"Member removed successfully"),await E(),a()):b(re.error||"Failed to remove member")}catch(re){b(re.message)}finally{l(!1)}},q=async()=>{if(n)try{l(!0);const k=await pr(s.id,P!==s.name?P:void 0,v!==s.description?v:void 0,n.id);k.success?(f(k.message||"Group updated successfully"),w(!1),a()):b(k.error||"Failed to update group")}catch(k){b(k.message)}finally{l(!1)}},$=async()=>{if(!n)return;const k=`Are you sure you want to delete "${s.name}"? This action cannot be undone and will remove all members, messages, and files.`;if(confirm(k))try{l(!0);const B=await gr(s.id,n.id);B.success?(f(B.message||"Group deleted successfully"),a(),r()):b(B.error||"Failed to delete group")}catch(B){b(B.message)}finally{l(!1)}},ee=()=>{b(""),f("")};return!h&&!m?e.jsx(pe,{isOpen:t,onClose:r,title:"Access Denied",size:"sm",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Only group admins can access this panel."}),e.jsx(I,{onClick:r,className:"mt-4",children:"Close"})]})}):e.jsx(pe,{isOpen:t,onClose:r,title:"Group Administration",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[j&&e.jsxs("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200 flex justify-between items-center",children:[e.jsx("span",{children:j}),e.jsx("button",{onClick:ee,children:e.jsx(_e,{className:"h-4 w-4"})})]}),x&&e.jsxs("div",{className:"p-3 text-sm text-green-600 bg-green-50 rounded-lg border border-green-200 flex justify-between items-center",children:[e.jsx("span",{children:x}),e.jsx("button",{onClick:ee,children:e.jsx(_e,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(Te,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Group Information"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[(g==null?void 0:g.admin_count)||0," admins ‚Ä¢ ",(g==null?void 0:g.total_members)||0," total members"]})]})]}),A?e.jsxs("div",{className:"space-y-4",children:[e.jsx(H,{label:"Group Name",value:P,onChange:k=>S(k.target.value),premium:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:v,onChange:k=>_(k.target.value),className:"input-premium resize-none",rows:3,placeholder:"Group description..."})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(I,{onClick:q,loading:i,className:"flex items-center space-x-2",children:[e.jsx(Pt,{className:"h-4 w-4"}),e.jsx("span",{children:"Save Changes"})]}),e.jsx(I,{variant:"outline",onClick:()=>{w(!1),S(s.name),_(s.description||"")},children:"Cancel"})]})]}):e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),e.jsxs(I,{variant:"outline",onClick:()=>w(!0),className:"flex items-center space-x-2",children:[e.jsx(zs,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Group Members"}),i?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ae,{})}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:c.map(k=>{var B,re;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(B=k.profiles)==null?void 0:B.full_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["@",(re=k.profiles)==null?void 0:re.username]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(X,{variant:k.role==="admin"?"primary":"secondary",children:k.role==="admin"?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-3 w-3 mr-1"})," Admin"]}):"Member"}),k.user_id===s.created_by&&e.jsx(X,{variant:"success",children:"Creator"})]})]}),k.user_id!==(n==null?void 0:n.id)&&e.jsxs("div",{className:"flex space-x-2",children:[k.role==="member"?e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>R(k.user_id),disabled:i,className:"flex items-center space-x-1",children:[e.jsx(Ms,{className:"h-3 w-3"}),e.jsx("span",{children:"Promote"})]}):k.user_id!==s.created_by&&e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>O(k.user_id),disabled:i,className:"flex items-center space-x-1",children:[e.jsx(Rt,{className:"h-3 w-3"}),e.jsx("span",{children:"Demote"})]}),k.user_id!==s.created_by&&e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>{var xe;return Q(k.user_id,((xe=k.profiles)==null?void 0:xe.full_name)||"User")},disabled:i,className:"flex items-center space-x-1 text-red-600 hover:bg-red-50",children:[e.jsx(Tt,{className:"h-3 w-3"}),e.jsx("span",{children:"Remove"})]})]})]},k.id)})})]}),m&&e.jsxs("div",{className:"border border-red-200 rounded-lg p-4 bg-red-50",children:[e.jsx("h3",{className:"font-medium text-red-900 mb-2",children:"Danger Zone"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:"These actions are permanent and cannot be undone."}),e.jsxs(I,{variant:"outline",onClick:$,disabled:i,className:"flex items-center space-x-2 text-red-600 border-red-300 hover:bg-red-100",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{children:"Delete Group"})]})]})]})})},Ps=({group:s,onBack:t,onLeaveGroup:r})=>{var fs;const{user:a,loading:n}=Z(),[i,l]=o.useState([]),[c,d]=o.useState([]),[g,u]=o.useState(""),[h,N]=o.useState(!0),[m,y]=o.useState(!1),[A,w]=o.useState(!1),[P,S]=o.useState(!1),[v,_]=o.useState(null),[j,b]=o.useState(!1),[x,f]=o.useState(!1),[E,M]=o.useState(!1),[R,O]=o.useState(null),[Q,q]=o.useState(!1),$=o.useRef(null),ee=o.useRef(null),k=o.useRef(null),B=o.useCallback(C=>{l(F=>{let J=-1;if(C.message_type==="file"?J=F.findIndex(V=>V.isOptimistic&&V.user_id===C.user_id&&V.message_type==="file"&&V.file_name===C.file_name&&Math.abs(new Date(V.created_at).getTime()-new Date(C.created_at).getTime())<3e4):J=F.findIndex(V=>V.isOptimistic&&V.user_id===C.user_id&&V.message===C.message&&Math.abs(new Date(V.created_at).getTime()-new Date(C.created_at).getTime())<5e3),J!==-1){const V=[...F];return V[J]=C,V}else return F.some(oe=>oe.id===C.id)?F:[...F,C]}),D()},[]),re=o.useCallback(C=>{l(F=>F.map(J=>J.id===C.id?{...J,...C}:J))},[]),xe=o.useCallback(C=>{l(F=>F.filter(J=>J.id!==C))},[]);za((s==null?void 0:s.id)||null,B,re,xe,{enabled:!!(s!=null&&s.id)&&!!a&&!h,onError:C=>{console.error("Real-time messages error:",C)},onConnected:()=>{q(!0)},onDisconnected:()=>{q(!1)}}),o.useEffect(()=>{const C=setInterval(()=>{l(F=>{const J=Date.now();let V=!1;const oe=F.map(me=>me.isOptimistic&&J-new Date(me.created_at).getTime()>1e4?(console.log("üßπ Auto-cleaning stuck optimistic message:",me.id),V=!0,{...me,isOptimistic:!1}):me);return V?oe:F})},5e3);return()=>clearInterval(C)},[]),o.useEffect(()=>{s.id&&a&&(async()=>{try{N(!0),O(null);try{const F=await mr(s.id);l(F)}catch(F){console.error("Failed to load messages:",F),l([])}d([]),M(!1),setTimeout(()=>{D()},100)}catch(F){console.error("Error initializing group data:",F),O(`Failed to load group data. ${F instanceof Error?F.message:"Please try again."}`)}finally{N(!1)}})()},[s.id,s.creator_id,s.name,a==null?void 0:a.id,a]),o.useEffect(()=>{!h&&i.length>0&&setTimeout(()=>{D()},50)},[i,h]),o.useEffect(()=>{!h&&i.length>0&&(console.log("Chat loading finished, scrolling to bottom with",i.length,"messages"),setTimeout(()=>{D()},200))},[h,i.length]);const Ne=async()=>{if(a)try{const C=await Ks(s.id,a.id);M(C||s.creator_id===a.id)}catch(C){console.error("Error checking admin status:",C),M(s.creator_id===a.id)}},z=async()=>{if(s.id)try{console.log("Loading members for group:",s.id);const C=await Xs(s.id);console.log("Loaded members:",C.length),d(C)}catch(C){console.error("Error loading members:",C)}},D=()=>{if(ee.current){const C=ee.current;console.log("Scrolling to bottom - ScrollHeight:",C.scrollHeight,"ClientHeight:",C.clientHeight),requestAnimationFrame(()=>{C.scrollTo({top:C.scrollHeight,behavior:"smooth"})})}else console.warn("Messages container ref not available for scrolling")},U=async()=>{var V,oe,me;if(!g.trim()||!a||m)return;y(!0);const C=`temp-${Date.now()}`,F={id:C,group_id:s.id,user_id:a.id,message:g.trim(),created_at:new Date().toISOString(),profiles:{id:a.id,username:((V=a.email)==null?void 0:V.split("@")[0])||"user",full_name:((oe=a.user_metadata)==null?void 0:oe.full_name)||"Unknown User",avatar_url:(me=a.user_metadata)==null?void 0:me.avatar_url},isOptimistic:!0};l(ce=>[...ce,F]),u(""),_(null),D();const J=setTimeout(()=>{console.log("üîÑ Fallback: Removing optimistic state for message:",C),l(ce=>ce.map(ue=>ue.id===C?{...ue,isOptimistic:!1}:ue))},5e3);try{const ce=await dr(s.id,a.id,g.trim(),"text",void 0,v==null?void 0:v.id);console.log("‚úÖ Message sent successfully:",ce.id),clearTimeout(J),setTimeout(()=>{l(ue=>ue.find(be=>be.id===C&&be.isOptimistic)?(console.log("üîÑ Manually replacing optimistic message (realtime delayed)"),ue.map(be=>be.id===C?{...ce,profiles:F.profiles,isOptimistic:!1}:be)):ue)},2e3)}catch(ce){console.error("‚ùå Error sending message:",ce),clearTimeout(J),l(ue=>ue.filter(de=>de.id!==C)),O("Could not send your message. Please try again.")}finally{y(!1)}},Y=async C=>{var oe,me,ce,ue;const F=(oe=C.target.files)==null?void 0:oe[0];if(!F||!a||A)return;w(!0);const J=`temp-file-${Date.now()}`,V={id:J,group_id:s.id,user_id:a.id,message:`üìé ${F.name}`,message_type:"file",file_url:"uploading",file_name:F.name,file_size:F.size,created_at:new Date().toISOString(),profiles:{id:a.id,username:((me=a.email)==null?void 0:me.split("@")[0])||"user",full_name:((ce=a.user_metadata)==null?void 0:ce.full_name)||"Unknown User",avatar_url:(ue=a.user_metadata)==null?void 0:ue.avatar_url},isOptimistic:!0};l(de=>[...de,V]),_(null),D();try{console.log("Uploading file:",F.name);const de=await jr({file:F,groupId:s.id,userId:a.id});console.log("File uploaded successfully:",de),l(be=>be.filter(ts=>ts.id!==J))}catch(de){console.error("Error uploading file:",de),l(ts=>ts.filter(Zs=>Zs.id!==J));const be=(de==null?void 0:de.message)||"Could not upload your file. Please try again.";O(be),setTimeout(()=>O(null),5e3)}finally{w(!1),k.current&&(k.current.value="")}},se=async()=>{if(!(!a||P)){S(!0);try{await cr(s.id,a.id),r==null||r()}catch(C){console.error("Error leaving group:",C),O("Could not leave the group. Please try again.")}finally{S(!1)}}},G=C=>{C.key==="Enter"&&!C.shiftKey&&(C.preventDefault(),U())},T=C=>{var J;switch((J=C.split(".").pop())==null?void 0:J.toLowerCase()){case"pdf":return e.jsx(K,{className:"h-4 w-4 text-red-500"});case"doc":case"docx":return e.jsx(K,{className:"h-4 w-4 text-blue-500"});case"txt":return e.jsx(K,{className:"h-4 w-4 text-gray-500"});case"jpg":case"jpeg":case"png":case"gif":return e.jsx(It,{className:"h-4 w-4 text-green-500"});default:return e.jsx(Mt,{className:"h-4 w-4 text-gray-500"})}},L=C=>{if(C===0)return"0 Bytes";const F=1024,J=["Bytes","KB","MB","GB"],V=Math.floor(Math.log(C)/Math.log(F));return parseFloat((C/Math.pow(F,V)).toFixed(2))+" "+J[V]},ye=async(C,F)=>{if(!a){console.error("‚ùå User not authenticated for download"),O("Please log in to download files");return}if(!s.id){console.error("‚ùå Group ID not available for download"),O("Unable to download file: Group not found");return}try{console.log("üîí Initiating secure download for:",F),console.log("üìÅ File URL:",C),console.log("üë§ User ID:",a.id),console.log("üë• Group ID:",s.id),await Nr({fileUrl:C,fileName:F,userId:a.id,groupId:s.id}),console.log("‚úÖ Download process completed for:",F)}catch(J){console.error("‚ùå Download failed:",(J==null?void 0:J.message)||J);const V=(J==null?void 0:J.message)||"Download failed";O(`Failed to download ${F}: ${V}`)}},ss=C=>{var me,ce;const F=C.user_id===(a==null?void 0:a.id),J=C.isOptimistic,V=C.message_type==="file"&&C.file_url,oe=V&&C.file_url==="uploading";return e.jsx("div",{className:`flex mb-4 ${F?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg break-words overflow-hidden ${F?`bg-blue-600 text-white ${J?"opacity-70":""}`:"bg-gray-200 text-gray-800"}`,children:[!F&&e.jsx("p",{className:"text-xs font-semibold mb-1",children:((me=C.profiles)==null?void 0:me.full_name)||((ce=C.profiles)==null?void 0:ce.username)||"Unknown User"}),V?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`flex items-center space-x-2 p-2 rounded-md ${F?"bg-white bg-opacity-10":"bg-gray-100"}`,children:[T(C.file_name||""),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium break-words",children:C.file_name}),e.jsx("p",{className:"text-xs opacity-75",children:C.file_size?L(C.file_size):"Unknown size"}),oe&&e.jsx("p",{className:"text-xs opacity-75 animate-pulse",children:"Uploading..."})]}),!oe&&e.jsx("button",{onClick:()=>ye(C.file_url,C.file_name),className:`p-1 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors ${F?"text-white":"text-gray-600"}`,title:"Download file",children:e.jsx(us,{className:"h-4 w-4"})})]}),C.message&&C.message!==`üìé ${C.file_name}`&&e.jsx("p",{className:"text-sm break-words",children:C.message})]}):e.jsx("p",{className:"text-sm break-words",children:C.message}),e.jsxs("p",{className:"text-xs opacity-75 mt-1",children:[new Date(C.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),J&&e.jsxs("span",{className:"text-orange-400",children:[oe?" (uploading...)":" (sending...)",e.jsx("button",{onClick:()=>{console.log("üëÜ Manually confirming message:",C.id),l(ue=>ue.map(de=>de.id===C.id?{...de,isOptimistic:!1}:de))},className:"ml-2 text-xs text-blue-400 hover:text-blue-300 underline",children:"confirm"})]})]})]})},C.id)};return n||!a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(I,{variant:"ghost",size:"sm",onClick:t,className:"p-2",children:e.jsx(Le,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.year?`Year ${s.year} - ${s.semester}`:"",s.subject?` ‚Ä¢ ${s.subject}`:""]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(I,{variant:"ghost",size:"sm",onClick:()=>b(!j),className:"p-2",children:[e.jsx(ve,{className:"w-5 h-5"}),e.jsx("span",{className:"ml-1 text-sm",children:c.length})]}),E&&e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>f(!x),className:"p-2 text-yellow-600 hover:text-yellow-700",children:e.jsx(Te,{className:"w-5 h-5"})}),e.jsx(I,{variant:"ghost",size:"sm",onClick:se,disabled:P,className:"p-2 text-red-600 hover:text-red-700",children:e.jsx(ns,{className:"w-5 h-5"})})]})]}),R&&e.jsx("div",{className:"p-4 bg-red-50 border-b border-red-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-red-700 text-sm",children:R}),e.jsx("button",{onClick:()=>O(null),className:"text-red-500 hover:text-red-700",children:e.jsx(_e,{className:"w-4 h-4"})})]})}),x&&E&&e.jsx("div",{className:"border-b border-gray-200",children:e.jsx(_r,{group:s,isOpen:!0,onClose:()=>f(!1),onGroupUpdated:()=>{z(),Ne()}})}),j&&e.jsxs("div",{className:"border-b border-gray-200 bg-gray-50 p-4 max-h-48 overflow-y-auto",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:["Members (",c.length,")"]}),e.jsx("div",{className:"space-y-2",children:c.map(C=>{var F,J,V,oe;return e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-gray-600",children:((J=(F=C.profiles)==null?void 0:F.full_name)==null?void 0:J.charAt(0))||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((V=C.profiles)==null?void 0:V.full_name)||((oe=C.profiles)==null?void 0:oe.username)||"Unknown User"}),C.role==="admin"&&e.jsxs("span",{className:"text-xs text-yellow-600 flex items-center",children:[e.jsx(Te,{className:"w-3 h-3 mr-1"}),"Admin"]})]})]})},C.id)})})]}),e.jsxs("div",{ref:ee,className:"flex-1 overflow-y-auto p-4 space-y-4",children:[h?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(ae,{})}):R?e.jsx("div",{className:"flex items-center justify-center h-full text-red-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium",children:"Error Loading Messages"}),e.jsx("p",{className:"text-sm mb-4",children:R}),e.jsx(I,{onClick:()=>{O(null),N(!0),window.location.reload()},className:"text-sm",children:"Try Again"})]})}):i.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium",children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start the conversation!"})]})}):i.map(C=>ss(C)),e.jsx("div",{ref:$})]}),v&&e.jsxs("div",{className:"p-3 bg-gray-100 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Replying to ",((fs=v.profiles)==null?void 0:fs.full_name)||"Unknown User"]}),e.jsx("p",{className:"text-sm text-gray-700 truncate",children:v.message})]}),e.jsx("button",{onClick:()=>_(null),className:"text-gray-400 hover:text-gray-600 ml-2",children:e.jsx(_e,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 bg-white mb-16 md:mb-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"file",ref:k,onChange:Y,className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>{var C;return(C=k.current)==null?void 0:C.click()},disabled:A,className:"p-2",children:e.jsx(At,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("textarea",{value:g,onChange:C=>u(C.target.value),onKeyPress:G,placeholder:"Type a message...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:1,disabled:m})}),e.jsx(I,{onClick:U,disabled:!g.trim()||m,className:"p-2",children:e.jsx(Ve,{className:"w-5 h-5"})})]}),A&&e.jsxs("div",{className:"mt-2 text-sm text-gray-500 flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Uploading file..."]})]})]})},Cr=()=>{const[s,t]=o.useState(null),[r,a]=o.useState(window.innerWidth<768),[n,i]=o.useState(0);o.useEffect(()=>{const g=()=>{a(window.innerWidth<768)};return window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]);const l=g=>{t(g)},c=()=>{t(null)},d=()=>{t(null),i(g=>g+1)};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:r?e.jsx("div",{className:"h-screen flex flex-col",children:s?e.jsx(Ps,{group:s,onBack:c,onLeaveGroup:d}):e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-20",children:e.jsx(Es,{onGroupSelect:l},n)})}):e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 md:py-12",children:s?e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 h-[calc(100vh-200px)]",children:e.jsx(Ps,{group:s,onBack:c,onLeaveGroup:d})}):e.jsx(Es,{onGroupSelect:l},n)})})};function Sr(){const[s,t]=o.useState(!1),[r,a]=o.useState("login"),{user:n,isGuest:i}=Z();return o.useEffect(()=>{const l=c=>{const{mode:d}=c.detail;a(d||"login"),t(!0)};return window.addEventListener("openAuthModal",l),()=>{window.removeEventListener("openAuthModal",l)}},[]),o.useEffect(()=>{!i&&n&&s&&(console.log("üéâ User authenticated in App, closing auth modal"),t(!1))},[i,n,s]),e.jsx(ot,{children:e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-secondary-50 via-white to-primary-50 pb-16 md:pb-0",children:[e.jsx(oa,{}),e.jsx("main",{className:"flex-1 relative overflow-hidden",children:e.jsx(ma,{children:e.jsxs(ct,{children:[e.jsx(he,{path:"/",element:e.jsx(_a,{})}),e.jsx(he,{path:"/auth",element:e.jsx(Sa,{})}),e.jsx(he,{path:"/categories",element:e.jsx(Ba,{})}),e.jsx(he,{path:"/help",element:e.jsx(Za,{})}),e.jsx(he,{path:"/privacy",element:e.jsx(er,{})}),e.jsx(he,{path:"/terms",element:e.jsx(sr,{})}),e.jsx(he,{path:"/contact",element:e.jsx(tr,{})}),e.jsx(he,{path:"/upload",element:e.jsx(qe,{pageName:"the Upload page",children:e.jsx(qa,{})})}),e.jsx(he,{path:"/chat",element:e.jsx(qe,{pageName:"Messages",children:e.jsx(Oa,{})})}),e.jsx(he,{path:"/my-requests",element:e.jsx(qe,{pageName:"My Requests",children:e.jsx(Wa,{})})}),e.jsx(he,{path:"/groups",element:e.jsx(qe,{pageName:"Groups",children:e.jsx(Cr,{})})}),e.jsx(he,{path:"/profile/:userId",element:e.jsx(qe,{pageName:"User Profile",children:e.jsx(Qa,{})})})]})})}),e.jsx(ca,{className:"hidden md:block"}),e.jsx(da,{onAuthRequired:()=>t(!0)}),e.jsx(es,{isOpen:s,onClose:()=>t(!1),onSuccess:()=>t(!1),initialMode:r})]})})}function Er(){return e.jsx(Ht,{children:e.jsx(Yt,{children:e.jsx(Sr,{})})})}class kr{constructor(){W(this,"pendingRequests",new Map);W(this,"REQUEST_TIMEOUT",3e4);W(this,"requestCount",0)}generateKey(t,r){const a=(r==null?void 0:r.method)||"GET",n=r!=null&&r.body?JSON.stringify(r.body):"";return`${a}:${t}:${n}`}async deduplicate(t,r,a){const n=this.generateKey(t,a);this.requestCount++,console.log(`üåê API Call #${this.requestCount}: ${n.substring(0,100)}...`),this.cleanupExpiredRequests();const i=this.pendingRequests.get(n);if(i)return console.log(`üîÑ Deduplicating request: ${n.substring(0,50)}...`),i.promise;const l=r().finally(()=>{this.pendingRequests.delete(n)});return this.pendingRequests.set(n,{promise:l,timestamp:Date.now()}),l}cleanupExpiredRequests(){const t=Date.now();for(const[r,a]of this.pendingRequests)t-a.timestamp>this.REQUEST_TIMEOUT&&this.pendingRequests.delete(r)}getStats(){return{pendingRequests:this.pendingRequests.size,totalRequests:this.requestCount}}reset(){this.pendingRequests.clear(),this.requestCount=0}}const Qs=new kr,Rs=globalThis.fetch;globalThis.fetch=async(s,t)=>{const r=typeof s=="string"?s:s.toString();return r.includes("supabase")||r.includes("localhost:54321")?Qs.deduplicate(r,()=>Rs(s,t),t):Rs(s,t)};setInterval(()=>{const s=Qs.getStats();s.totalRequests>0&&console.log(`üìä Request Stats: ${s.totalRequests} total, ${s.pendingRequests} pending`)},1e4);window.addEventListener("unhandledrejection",s=>{var t,r,a,n,i,l;if(console.error("Unhandled promise rejection:",s.reason),(r=(t=s.reason)==null?void 0:t.message)!=null&&r.includes("infinite recursion")||(n=(a=s.reason)==null?void 0:a.message)!=null&&n.includes("Maximum call stack")||(l=(i=s.reason)==null?void 0:i.message)!=null&&l.includes("out of memory")){console.error("CRITICAL ERROR PREVENTED:",s.reason.message);const c=document.createElement("div");c.innerHTML=`
      <div style="position: fixed; top: 20px; right: 20px; background: #ef4444; color: white; padding: 16px; border-radius: 8px; z-index: 9999; max-width: 300px;">
        <h4 style="margin: 0 0 8px 0; font-weight: bold;">Critical Error Detected</h4>
        <p style="margin: 0 0 8px 0; font-size: 14px;">The app prevented a potential crash. Please reload the page.</p>
        <button onclick="window.location.reload()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
          Reload
        </button>
      </div>
    `,document.body.appendChild(c),setTimeout(()=>{window.location.reload()},1e4)}s.preventDefault()});window.addEventListener("error",s=>{var t,r,a,n,i,l;console.error("Uncaught error:",s.error),((r=(t=s.error)==null?void 0:t.message)!=null&&r.includes("infinite recursion")||(n=(a=s.error)==null?void 0:a.message)!=null&&n.includes("Maximum call stack")||(l=(i=s.error)==null?void 0:i.message)!=null&&l.includes("out of memory"))&&(console.error("CRITICAL ERROR CAUGHT:",s.error.message),s.preventDefault())});Lt.createRoot(document.getElementById("root")).render(e.jsx(Er,{}));export{ne as l,p as s};
